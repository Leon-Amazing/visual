import{c as a}from"./app.6795915a.js";import{_ as p}from"./plugin-vue_export-helper.21dcd24c.js";var t="/visual/webgl-practice/1.png",e="/visual/webgl-practice/1.gif",o="/visual/webgl-practice/2.gif",c="/visual/webgl-practice/3.gif",l="/visual/webgl-practice/4.gif",u="/visual/webgl-practice/5.gif",r="/visual/webgl-practice/6.gif",i="/visual/webgl-practice/7.gif",k="/visual/webgl-practice/8.gif",b="/visual/webgl-practice/10.png",m="/visual/webgl-practice/11.png",d="/visual/webgl-practice/12.png",g="/visual/webgl-practice/13.png",y="/visual/webgl-practice/14.png",f="/visual/webgl-practice/15.png",w="/visual/webgl-practice/21.gif",n="/visual/webgl-practice/16.png",v="/visual/webgl-practice/17.png",h="/visual/webgl-practice/18.png",x="/visual/webgl-practice/19.png",j="/visual/webgl-practice/20.png",_="/visual/webgl-practice/22.png",P="/visual/webgl-practice/23.png",q="/visual/webgl-practice/24.png",M="/visual/webgl-practice/25.png",S="/visual/webgl-practice/26.png",E="/visual/webgl-practice/27.png",A="/visual/webgl-practice/28.png",s="/visual/webgl-practice/29.jpg",T="/visual/webgl-practice/29.png";const C={},F=a('<h1 id="webgl\u5B9E\u8DF5" tabindex="-1"><a class="header-anchor" href="#webgl\u5B9E\u8DF5" aria-hidden="true">#</a> WebGL\u5B9E\u8DF5</h1><h2 id="\u4E00-\u7ED8\u5236\u661F\u661F" tabindex="-1"><a class="header-anchor" href="#\u4E00-\u7ED8\u5236\u661F\u661F" aria-hidden="true">#</a> \u4E00.\u7ED8\u5236\u661F\u661F</h2><p><img src="'+t+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u7ED8\u5236\u661F\u661F<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">#webgl</span> <span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;./images/sky.jpg&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
      <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>
      <span class="token property">background-position</span><span class="token punctuation">:</span> right bottom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute float a_PointSize<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> a_PointSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      float dist <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dist <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        discard<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u5F00\u542F\u7247\u5143\u7684\u989C\u8272\u5408\u6210\u529F\u80FD</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u7247\u5143\u7684\u5408\u6210\u65B9\u5F0F</span>
    gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

    <span class="token comment">// \u83B7\u53D6 attribute \u548C uniform \u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stars<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> s<span class="token punctuation">,</span> a <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> s<span class="token punctuation">,</span> a <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.87</span><span class="token punctuation">,</span> <span class="token number">0.91</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div></details><h2 id="\u4E8C-\u661F\u661F\u60F3\u4F60\u7728\u773C\u775B" tabindex="-1"><a class="header-anchor" href="#\u4E8C-\u661F\u661F\u60F3\u4F60\u7728\u773C\u775B" aria-hidden="true">#</a> \u4E8C.\u661F\u661F\u60F3\u4F60\u7728\u773C\u775B</h2><p><img src="`+e+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u661F\u661F\u5411\u4F60\u7728\u773C\u775B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">#webgl</span> <span class="token punctuation">{</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;./images/sky.jpg&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
      <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>
      <span class="token property">background-position</span><span class="token punctuation">:</span> right bottom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute float a_PointSize<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> a_PointSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      float dist <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dist <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        discard<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Compose <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Compose.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Track.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u5F00\u542F\u7247\u5143\u7684\u989C\u8272\u5408\u6210\u529F\u80FD</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u7247\u5143\u7684\u5408\u6210\u65B9\u5F0F</span>
    gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

    <span class="token comment">// \u83B7\u53D6 attribute \u548C uniform \u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//\u5408\u6210\u5BF9\u8C61</span>
    <span class="token keyword">const</span> compose <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> s<span class="token punctuation">,</span> a <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// s \u5927\u5C0F a \u900F\u660E\u5EA6</span>
      stars<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//\u5EFA\u7ACB\u8F68\u9053\u5BF9\u8C61</span>
      <span class="token keyword">const</span> track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token number">1500</span><span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      compose<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      compose<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> s<span class="token punctuation">,</span> a <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.87</span><span class="token punctuation">,</span> <span class="token number">0.91</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br></div></div><p>Track.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Track</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">onEnd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prevTime<span class="token operator">=</span><span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> keyMap<span class="token punctuation">,</span> timeLen<span class="token punctuation">,</span> target<span class="token punctuation">,</span> loop<span class="token punctuation">,</span> start<span class="token punctuation">,</span>prevTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> time <span class="token operator">=</span> t <span class="token operator">-</span> start<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeLen <span class="token operator">&gt;=</span> prevTime <span class="token operator">&amp;&amp;</span> timeLen <span class="token operator">&lt;</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>prevTime<span class="token operator">=</span>time
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      time <span class="token operator">=</span> time <span class="token operator">%</span> timeLen<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> fms<span class="token punctuation">]</span> <span class="token keyword">of</span> keyMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> last <span class="token operator">=</span> fms<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> fms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> fms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> fms<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> fms<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getValBetweenFms</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> fms<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getValBetweenFms</span><span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> fms<span class="token punctuation">,</span> last</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> last<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fm1 <span class="token operator">=</span> fms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fm2 <span class="token operator">=</span> fms<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;=</span> fm1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> time <span class="token operator">&lt;=</span> fm2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> delta <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> fm2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> fm1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> fm2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> fm1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> k <span class="token operator">=</span> delta<span class="token punctuation">.</span>y <span class="token operator">/</span> delta<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      <span class="token keyword">const</span> b <span class="token operator">=</span> fm1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> fm1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> k<span class="token punctuation">;</span>
      <span class="token keyword">return</span> k <span class="token operator">*</span> time <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>Compose.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Compose</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      ele<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u57FA\u4E8E\u65F6\u95F4\u8F68\u7684\u76EE\u6807\u5BF9\u8C61\u5220\u9664\u65F6\u95F4\u8F68</span>
  <span class="token function">deleteByTarget</span><span class="token punctuation">(</span><span class="token parameter">targrt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>target <span class="token operator">===</span> targrt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        children<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></details><h2 id="\u4E09-\u72EE\u5B50\u5EA7" tabindex="-1"><a class="header-anchor" href="#\u4E09-\u72EE\u5B50\u5EA7" aria-hidden="true">#</a> \u4E09.\u72EE\u5B50\u5EA7</h2><p><img src="`+o+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u72EE\u5B50\u5EA7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">{</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">#canvas</span> <span class="token punctuation">{</span>
            <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&quot;./images/sky2.jpg&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
            <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>
            <span class="token property">background-position</span><span class="token punctuation">:</span> right bottom<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        attribute vec4 a_Attr<span class="token punctuation">;</span>
        varying float v_Alpha<span class="token punctuation">;</span> <span class="token comment">// varying\u58F0\u660E\u7684\u76F8\u5F53\u4E8E\u5168\u5C40\u53D8\u91CF</span>
        <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>a_Attr<span class="token punctuation">.</span>x<span class="token punctuation">,</span>a_Attr<span class="token punctuation">.</span>y<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            gl_PointSize <span class="token operator">=</span> a_Attr<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
            v_Alpha <span class="token operator">=</span> a_Attr<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        precision mediump float<span class="token punctuation">;</span>
        uniform bool u_IsPOINTS<span class="token punctuation">;</span>
        varying float v_Alpha<span class="token punctuation">;</span>
        <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>u_IsPOINTS<span class="token punctuation">)</span><span class="token punctuation">{</span>
                float dist<span class="token operator">=</span><span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.87</span><span class="token punctuation">,</span><span class="token number">0.91</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>v_Alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    discard<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.87</span><span class="token punctuation">,</span><span class="token number">0.91</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>v_Alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">import</span> <span class="token punctuation">{</span> 
          initShaders<span class="token punctuation">,</span> 
          getMousePosInWebgl<span class="token punctuation">,</span> 
          glToCssPos 
        <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Poly.js&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> Sky <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Sky.js&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> Compose <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Compose.js&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Track.js&#39;</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

        <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
        <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
        <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

        <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
        <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
        <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5237\u5E95\u8272</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u591C\u7A7A</span>
        <span class="token keyword">const</span> sky <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sky</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5EFA\u7ACB\u5408\u6210\u5BF9\u8C61</span>
        <span class="token keyword">const</span> compose <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u5F53\u524D\u6B63\u5728\u7ED8\u5236\u7684\u591A\u8FB9\u5F62</span>
        <span class="token keyword">let</span> poly <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// \u9F20\u6807\u5212\u4E0A\u7684\u70B9</span>
        <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// \u53D6\u6D88\u53F3\u51FB\u63D0\u793A</span>
        canvas<span class="token punctuation">.</span><span class="token function-variable function">oncontextmenu</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>button <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">popVertice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMousePosInWebgl</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">addVertice</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">crtPoly</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMousePosInWebgl</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
            point <span class="token operator">=</span> <span class="token function">hoverPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
            canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> point <span class="token operator">?</span> <span class="token string">&#39;pointer&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;default&#39;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> obj <span class="token operator">=</span> poly<span class="token punctuation">.</span>geoData<span class="token punctuation">[</span>poly<span class="token punctuation">.</span>geoData<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
                obj<span class="token punctuation">.</span>x <span class="token operator">=</span> x
                obj<span class="token punctuation">.</span>y <span class="token operator">=</span> y
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            compose<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            sky<span class="token punctuation">.</span><span class="token function">updateVertices</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;y&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pointSize&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;alpha&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">function</span> <span class="token function">crtPoly</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> o1 <span class="token operator">=</span> point <span class="token operator">?</span> point <span class="token operator">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token literal-property property">pointSize</span><span class="token operator">:</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">alpha</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
            <span class="token keyword">const</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token literal-property property">pointSize</span><span class="token operator">:</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">alpha</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
            poly <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token literal-property property">attrName</span><span class="token operator">:</span> <span class="token string">&#39;a_Attr&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">geoData</span><span class="token operator">:</span> <span class="token punctuation">[</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;LINE_STRIP&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">circleDot</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            sky<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>poly<span class="token punctuation">)</span>
            <span class="token function">crtTrack</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span>
            <span class="token function">crtTrack</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">addVertice</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> geoData <span class="token punctuation">}</span> <span class="token operator">=</span> poly
            <span class="token keyword">if</span> <span class="token punctuation">(</span>point<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                geoData<span class="token punctuation">[</span>geoData<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> point
            <span class="token punctuation">}</span>
            <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token literal-property property">pointSize</span><span class="token operator">:</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">alpha</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
            geoData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token function">crtTrack</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">popVertice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            poly<span class="token punctuation">.</span>geoData<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> compose
            <span class="token keyword">const</span> last <span class="token operator">=</span> children<span class="token punctuation">[</span>children<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
            children<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span>
            poly <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">crtTrack</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> pointSize <span class="token punctuation">}</span> <span class="token operator">=</span> obj
            <span class="token keyword">const</span> track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            track<span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">2000</span>
            track<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token boolean">true</span>
            track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                    <span class="token string">&quot;pointSize&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">,</span> pointSize<span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">1500</span><span class="token punctuation">,</span> pointSize<span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span>
                    <span class="token string">&quot;alpha&quot;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            compose<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">hoverPoint</span><span class="token punctuation">(</span><span class="token parameter">mx<span class="token punctuation">,</span> my</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">{</span> geoData <span class="token punctuation">}</span> <span class="token keyword">of</span> sky<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> obj <span class="token keyword">of</span> geoData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>poly<span class="token operator">&amp;&amp;</span>obj <span class="token operator">===</span> poly<span class="token punctuation">.</span>geoData<span class="token punctuation">[</span>poly<span class="token punctuation">.</span>geoData<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">continue</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">const</span> delta <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">x</span><span class="token operator">:</span> mx <span class="token operator">-</span> obj<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
                        <span class="token literal-property property">y</span><span class="token operator">:</span> my <span class="token operator">-</span> obj<span class="token punctuation">.</span>y
                    <span class="token punctuation">}</span>
                    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">glToCssPos</span><span class="token punctuation">(</span>delta<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
                    <span class="token keyword">const</span> dist <span class="token operator">=</span> x <span class="token operator">*</span> x <span class="token operator">+</span> y <span class="token operator">*</span> y
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>dist <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> obj
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">3</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sky<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br></div></div></details><h2 id="\u56DB-\u89C6\u56FE\u77E9\u9635\u4E0E\u4E09\u89D2\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#\u56DB-\u89C6\u56FE\u77E9\u9635\u4E0E\u4E09\u89D2\u51FD\u6570" aria-hidden="true">#</a> \u56DB.\u89C6\u56FE\u77E9\u9635\u4E0E\u4E09\u89D2\u51FD\u6570</h2><p><img src="`+c+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u6B63\u5F26\u66F2\u7EBF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      initShaders<span class="token punctuation">,</span> 
      ScaleLinear
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      Matrix4<span class="token punctuation">,</span> 
      Vector3
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* \u89C6\u56FE\u77E9\u9635 */</span>
    <span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">/* x,z \u65B9\u5411\u7684\u7A7A\u95F4\u5750\u6807\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token punctuation">]</span>
    <span class="token comment">/* x,z \u65B9\u5411\u7684\u5F27\u5EA6\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minAngX<span class="token punctuation">,</span> maxAngX<span class="token punctuation">,</span> minAngZ<span class="token punctuation">,</span> maxAngZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">]</span>

    <span class="token comment">/* \u6BD4\u4F8B\u5C3A\uFF1A\u5C06\u7A7A\u95F4\u5750\u6807\u548C\u5F27\u5EA6\u76F8\u6620\u5C04 */</span>
    <span class="token keyword">const</span> scalerX <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minPosX<span class="token punctuation">,</span> minAngX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> maxAngX<span class="token punctuation">)</span>
    <span class="token keyword">const</span> scalerZ <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minPosZ<span class="token punctuation">,</span> minAngZ<span class="token punctuation">,</span> maxPosZ<span class="token punctuation">,</span> maxAngZ<span class="token punctuation">)</span>

    <span class="token comment">/* \u6CE2\u6D6A\u5BF9\u8C61 */</span>
    <span class="token keyword">const</span> wave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">vertices</span><span class="token operator">:</span> <span class="token function">crtVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_ViewMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> viewMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u52A8\u753B:\u504F\u79FBphi */</span>
    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">+=</span> <span class="token number">0.08</span>
      <span class="token function">updateVertices</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span>
      wave<span class="token punctuation">.</span><span class="token function">updateBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span>
      wave<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u5EFA\u7ACB\u9876\u70B9\u96C6\u5408 */</span>
    <span class="token keyword">function</span> <span class="token function">crtVertices</span><span class="token punctuation">(</span><span class="token parameter">offset <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> z <span class="token operator">=</span> minPosZ<span class="token punctuation">;</span> z <span class="token operator">&lt;</span> maxPosZ<span class="token punctuation">;</span> z <span class="token operator">+=</span> <span class="token number">0.04</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> minPosX<span class="token punctuation">;</span> x <span class="token operator">&lt;</span> maxPosX<span class="token punctuation">;</span> x <span class="token operator">+=</span> <span class="token number">0.03</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> vertices
    <span class="token punctuation">}</span>

    <span class="token comment">//\u66F4\u65B0\u9876\u70B9\u9AD8\u5EA6</span>
    <span class="token keyword">function</span> <span class="token function">updateVertices</span><span class="token punctuation">(</span><span class="token parameter">offset <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> vertices <span class="token punctuation">}</span> <span class="token operator">=</span> wave
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>posX<span class="token punctuation">,</span> posZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> angZ <span class="token operator">=</span> <span class="token function">scalerZ</span><span class="token punctuation">(</span>posZ<span class="token punctuation">)</span>
        <span class="token keyword">const</span> Omega <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">const</span> a <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.03</span>
        <span class="token keyword">const</span> phi <span class="token operator">=</span> <span class="token function">scalerX</span><span class="token punctuation">(</span>posX<span class="token punctuation">)</span> <span class="token operator">+</span> offset
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SinFn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> Omega<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u6B63\u5F26\u51FD\u6570 */</span>
    <span class="token keyword">function</span> <span class="token function">SinFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> Omega<span class="token punctuation">,</span> phi</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Omega <span class="token operator">*</span> x <span class="token operator">+</span> phi<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br></div></div></details><h2 id="\u4E94-\u4E00\u62B9\u7EFF\u610F" tabindex="-1"><a class="header-anchor" href="#\u4E94-\u4E00\u62B9\u7EFF\u610F" aria-hidden="true">#</a> \u4E94.\u4E00\u62B9\u7EFF\u610F</h2><p><img src="`+l+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u4E00\u62B9\u7EFF\u610F<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec4 a_Color<span class="token punctuation">;</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    varying vec4 v_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
      v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    varying vec4 v_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      initShaders<span class="token punctuation">,</span> 
      ScaleLinear<span class="token punctuation">,</span> 
      SinFn 
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      Matrix4<span class="token punctuation">,</span> 
      Vector3<span class="token punctuation">,</span> 
      Color 
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* \u89C6\u56FE\u77E9\u9635 */</span>
    <span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">/* x,z \u65B9\u5411\u7684\u7A7A\u95F4\u5750\u6807\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token punctuation">]</span>
    <span class="token comment">/* x,z \u65B9\u5411\u7684\u5F27\u5EA6\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minAngX<span class="token punctuation">,</span> maxAngX<span class="token punctuation">,</span> minAngZ<span class="token punctuation">,</span> maxAngZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">]</span>

    <span class="token comment">/* \u6BD4\u4F8B\u5C3A\uFF1A\u5C06\u7A7A\u95F4\u5750\u6807\u548C\u5F27\u5EA6\u76F8\u6620\u5C04 */</span>
    <span class="token keyword">const</span> scalerX <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minPosX<span class="token punctuation">,</span> minAngX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> maxAngX<span class="token punctuation">)</span>
    <span class="token keyword">const</span> scalerZ <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minPosZ<span class="token punctuation">,</span> minAngZ<span class="token punctuation">,</span> maxPosZ<span class="token punctuation">,</span> maxAngZ<span class="token punctuation">)</span>

    <span class="token comment">/* y \u65B9\u5411\u7684\u5750\u6807\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.03</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> a12 <span class="token operator">=</span> a1 <span class="token operator">+</span> a2
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minY<span class="token punctuation">,</span> maxY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>a12<span class="token punctuation">,</span> a12<span class="token punctuation">]</span>

    <span class="token comment">/* \u8272\u76F8\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minH<span class="token punctuation">,</span> maxH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.55</span><span class="token punctuation">]</span>

    <span class="token comment">/* \u6BD4\u4F8B\u5C3A\uFF1A\u5C06y\u5750\u6807\u548C\u8272\u76F8\u76F8\u6620\u5C04 */</span>
    <span class="token keyword">const</span> scalerC <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minY<span class="token punctuation">,</span> minH<span class="token punctuation">,</span> maxY<span class="token punctuation">,</span> maxH<span class="token punctuation">)</span>

    <span class="token comment">/* \u989C\u8272\u5BF9\u8C61\uFF0C\u53EF\u901A\u8FC7HSL\u83B7\u53D6\u989C\u8272 */</span>
    <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u6CE2\u6D6A\u5BF9\u8C61\u7684\u884C\u6570\u548C\u5217\u6570 */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">,</span> cols<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span>

    <span class="token comment">/* \u6CE2\u6D6A\u5BF9\u8C61\u7684\u4E24\u4E2Aattribute\u53D8\u91CF\uFF0C\u5206\u522B\u662F\u4F4D\u7F6E\u548C\u989C\u8272 */</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> a_Color <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>

    <span class="token comment">/* \u7C7B\u76EE\u5C3A\u5BF8 */</span>
    <span class="token keyword">const</span> categorySize <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>size <span class="token operator">+</span> a_Color<span class="token punctuation">.</span>size

    <span class="token comment">/* \u6CE2\u6D6A\u5BF9\u8C61 */</span>
    <span class="token keyword">const</span> wave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token function">getSource</span><span class="token punctuation">(</span>
        cols<span class="token punctuation">,</span> rows<span class="token punctuation">,</span>
        minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_ViewMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> viewMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        a_Position<span class="token punctuation">,</span>
        a_Color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// \u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u52A8\u753B:\u504F\u79FBphi */</span>
    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">+=</span> <span class="token number">0.08</span>
      <span class="token function">updateSource</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span>
      wave<span class="token punctuation">.</span><span class="token function">updateAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u6E32\u67D3 */</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      wave<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u5EFA\u7ACB\u9876\u70B9\u96C6\u5408 */</span>
    <span class="token keyword">function</span> <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token parameter">cols<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> spaceZ <span class="token operator">=</span> <span class="token punctuation">(</span>maxPosZ <span class="token operator">-</span> minPosZ<span class="token punctuation">)</span> <span class="token operator">/</span> rows
      <span class="token keyword">const</span> spaceX <span class="token operator">=</span> <span class="token punctuation">(</span>maxPosX <span class="token operator">-</span> minPosX<span class="token punctuation">)</span> <span class="token operator">/</span> cols
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> z <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> z<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> cols<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> px <span class="token operator">=</span> x <span class="token operator">*</span> spaceX <span class="token operator">+</span> minPosX
          <span class="token keyword">const</span> pz <span class="token operator">=</span> z <span class="token operator">*</span> spaceZ <span class="token operator">+</span> minPosZ
          source<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pz<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> source
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u66F4\u65B0\u9876\u70B9\u9AD8\u5EA6\u548C\u989C\u8272 */</span>
    <span class="token keyword">function</span> <span class="token function">updateSource</span><span class="token punctuation">(</span><span class="token parameter">offset <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> source<span class="token punctuation">,</span> categorySize <span class="token punctuation">}</span> <span class="token operator">=</span> wave
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> categorySize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>posX<span class="token punctuation">,</span> posZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>source<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> angZ <span class="token operator">=</span> <span class="token function">scalerZ</span><span class="token punctuation">(</span>posZ<span class="token punctuation">)</span>
        <span class="token keyword">const</span> Omega <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">const</span> a <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span> <span class="token operator">*</span> a1 <span class="token operator">+</span> a2
        <span class="token keyword">const</span> phi <span class="token operator">=</span> <span class="token function">scalerX</span><span class="token punctuation">(</span>posX<span class="token punctuation">)</span> <span class="token operator">+</span> offset
        <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">SinFn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> Omega<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span>
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> y
        <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token function">scalerC</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">setHSL</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span>
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> r
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> g
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> b
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br></div></div></details><h2 id="\u516D-\u4E00\u7247\u6625\u8272" tabindex="-1"><a class="header-anchor" href="#\u516D-\u4E00\u7247\u6625\u8272" aria-hidden="true">#</a> \u516D.\u4E00\u7247\u6625\u8272</h2><p><img src="`+u+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u4E00\u7247\u6625\u8272<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec4 a_Color<span class="token punctuation">;</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    varying vec4 v_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
      v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    varying vec4 v_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      initShaders<span class="token punctuation">,</span> 
      ScaleLinear<span class="token punctuation">,</span> 
      SinFn<span class="token punctuation">,</span> 
      GetIndexInGrid 
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      Matrix4<span class="token punctuation">,</span> 
      Vector3<span class="token punctuation">,</span> 
      Color 
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* \u89C6\u56FE\u77E9\u9635 */</span>
    <span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">/* x,z \u65B9\u5411\u7684\u7A7A\u95F4\u5750\u6807\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token punctuation">]</span>
    <span class="token comment">/* x,z \u65B9\u5411\u7684\u5F27\u5EA6\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minAngX<span class="token punctuation">,</span> maxAngX<span class="token punctuation">,</span> minAngZ<span class="token punctuation">,</span> maxAngZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">]</span>
    <span class="token comment">/* \u6BD4\u4F8B\u5C3A\uFF1A\u5C06\u7A7A\u95F4\u5750\u6807\u548C\u5F27\u5EA6\u76F8\u6620\u5C04 */</span>
    <span class="token keyword">const</span> scalerX <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minPosX<span class="token punctuation">,</span> minAngX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> maxAngX<span class="token punctuation">)</span>
    <span class="token keyword">const</span> scalerZ <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minPosZ<span class="token punctuation">,</span> minAngZ<span class="token punctuation">,</span> maxPosZ<span class="token punctuation">,</span> maxAngZ<span class="token punctuation">)</span>


    <span class="token comment">/* y \u65B9\u5411\u7684\u5750\u6807\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.03</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> a12 <span class="token operator">=</span> a1 <span class="token operator">+</span> a2
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minY<span class="token punctuation">,</span> maxY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span>a12<span class="token punctuation">,</span> a12<span class="token punctuation">]</span>

    <span class="token comment">/* \u8272\u76F8\u6781\u503C */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>minH<span class="token punctuation">,</span> maxH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span>

    <span class="token comment">/* \u6BD4\u4F8B\u5C3A\uFF1A\u5C06y\u5750\u6807\u548C\u8272\u76F8\u76F8\u6620\u5C04 */</span>
    <span class="token keyword">const</span> scalerC <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>minY<span class="token punctuation">,</span> minH<span class="token punctuation">,</span> maxY<span class="token punctuation">,</span> maxH<span class="token punctuation">)</span>

    <span class="token comment">/* \u989C\u8272\u5BF9\u8C61\uFF0C\u53EF\u901A\u8FC7HSL\u83B7\u53D6\u989C\u8272 */</span>
    <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u6CE2\u6D6A\u5BF9\u8C61\u7684\u884C\u6570\u548C\u5217\u6570 */</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">,</span> cols<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span>

    <span class="token comment">/* \u6CE2\u6D6A\u5BF9\u8C61\u7684\u4E24\u4E2Aattribute\u53D8\u91CF\uFF0C\u5206\u522B\u662F\u4F4D\u7F6E\u548C\u989C\u8272 */</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> a_Color <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>

    <span class="token comment">/* \u7C7B\u76EE\u5C3A\u5BF8 */</span>
    <span class="token keyword">const</span> categorySize <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>size <span class="token operator">+</span> a_Color<span class="token punctuation">.</span>size

    <span class="token comment">//\u83B7\u53D6\u7D22\u5F15\u4F4D\u7F6E\u7684\u65B9\u6CD5</span>
    <span class="token keyword">const</span> getInd <span class="token operator">=</span> <span class="token function">GetIndexInGrid</span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span> categorySize<span class="token punctuation">)</span>

    <span class="token comment">/* \u83B7\u53D6\u57FA\u7840\u6570\u636E
       vertices \u6309\u7167\u884C\u5217\u5F62\u5F0F\u6392\u5217\u7684\u9876\u70B9\u96C6\u5408
       indexes \u4E09\u89D2\u7F51\u683C\u7684\u9876\u70B9\u7D22\u5F15\uFF0C\u5176\u5143\u7D20\u4E3A\u9876\u70B9\u5728vertices\u4E2D\u7684\u7D22\u5F15
    */</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> indexes <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">crtBaseData</span><span class="token punctuation">(</span>
      cols<span class="token punctuation">,</span> rows<span class="token punctuation">,</span>
      minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* \u5EFA\u7ACB\u6CE2\u6D6A\u5BF9\u8C61 */</span>
    <span class="token keyword">const</span> wave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token function">getSource</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> categorySize<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_ViewMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> viewMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        a_Position<span class="token punctuation">,</span>
        a_Color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//\u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token comment">/* \u52A8\u753B:\u504F\u79FBphi */</span>
    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">+=</span> <span class="token number">0.08</span>
      <span class="token function">updateSource</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span>
      wave<span class="token punctuation">.</span><span class="token function">updateAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u6E32\u67D3 */</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      wave<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      wave<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token string">&#39;LINES&#39;</span><span class="token punctuation">)</span>
      <span class="token comment">// wave.draw(&#39;TRIANGLES&#39;)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u5EFA\u7ACB\u57FA\u7840\u6570\u636E */</span>
    <span class="token keyword">function</span> <span class="token function">crtBaseData</span><span class="token punctuation">(</span><span class="token parameter">cols<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> minPosX<span class="token punctuation">,</span> maxPosX<span class="token punctuation">,</span> minPosZ<span class="token punctuation">,</span> maxPosZ</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> spaceZ <span class="token operator">=</span> <span class="token punctuation">(</span>maxPosZ <span class="token operator">-</span> minPosZ<span class="token punctuation">)</span> <span class="token operator">/</span> rows
      <span class="token keyword">const</span> spaceX <span class="token operator">=</span> <span class="token punctuation">(</span>maxPosX <span class="token operator">-</span> minPosX<span class="token punctuation">)</span> <span class="token operator">/</span> cols
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> z <span class="token operator">&lt;</span> rows<span class="token punctuation">;</span> z<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> cols<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> px <span class="token operator">=</span> x <span class="token operator">*</span> spaceX <span class="token operator">+</span> minPosX
          <span class="token keyword">const</span> pz <span class="token operator">=</span> z <span class="token operator">*</span> spaceZ <span class="token operator">+</span> minPosZ
          vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pz<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>z <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">[</span>x0<span class="token punctuation">,</span> z0<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> z <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
            indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
              <span class="token function">getInd</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> z0<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">getInd</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> z0<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">getInd</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">getInd</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> z0<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">getInd</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">getInd</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> indexes <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/* \u5EFA\u7ACB\u9876\u70B9\u96C6\u5408 */</span>
    <span class="token keyword">function</span> <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token parameter">vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> categorySize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      indexes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>vertices<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> categorySize<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> arr
    <span class="token punctuation">}</span>

    <span class="token comment">//\u66F4\u65B0\u9876\u70B9\u9AD8\u5EA6</span>
    <span class="token keyword">function</span> <span class="token function">updateSource</span><span class="token punctuation">(</span><span class="token parameter">offset <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> source<span class="token punctuation">,</span> categorySize <span class="token punctuation">}</span> <span class="token operator">=</span> wave
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> categorySize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>posX<span class="token punctuation">,</span> posZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>source<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> angZ <span class="token operator">=</span> <span class="token function">scalerZ</span><span class="token punctuation">(</span>posZ<span class="token punctuation">)</span>
        <span class="token keyword">const</span> Omega <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">const</span> a <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span> <span class="token operator">*</span> a1 <span class="token operator">+</span> a2
        <span class="token keyword">const</span> phi <span class="token operator">=</span> <span class="token function">scalerX</span><span class="token punctuation">(</span>posX<span class="token punctuation">)</span> <span class="token operator">+</span> offset
        <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">SinFn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> Omega<span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span>
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> y
        <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token function">scalerC</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">setHSL</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span>
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> r
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> g
        source<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> b
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br></div></div></details><h2 id="\u4E03-\u7EB9\u7406\u8F6C\u573A" tabindex="-1"><a class="header-anchor" href="#\u4E03-\u7EB9\u7406\u8F6C\u573A" aria-hidden="true">#</a> \u4E03.\u7EB9\u7406\u8F6C\u573A</h2><p><img src="`+r+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u7EB9\u7406\u8F6C\u573A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    uniform sampler2D u_Pattern<span class="token punctuation">;</span>
    uniform float u_Ratio<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      vec4 o <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 p <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> p<span class="token punctuation">,</span> u_Ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Track.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> imgPromise<span class="token punctuation">,</span> initShaders<span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u6570\u636E\u6E90</span>
    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ratio</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> track <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      source<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLE_STRIP&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Ratio</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> obj<span class="token punctuation">.</span>ratio
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> i1 <span class="token operator">=</span> n <span class="token operator">%</span> len
      <span class="token keyword">const</span> i2 <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> len

      <span class="token keyword">const</span> originImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      originImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/pattern</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      <span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      pattern<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/pattern</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>originImg<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">changeImg</span><span class="token punctuation">(</span>originImg<span class="token punctuation">,</span> pattern<span class="token punctuation">)</span>
        <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">changeImg</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>imgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">0</span>

      rect<span class="token punctuation">.</span>maps <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_Pattern</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      rect<span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">1500</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>onEnd <span class="token operator">=</span> loadImg
      track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;ratio&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u52A8\u753B */</span>
    <span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      track<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      rect<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>u_Ratio<span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">.</span>ratio<span class="token punctuation">;</span>
      rect<span class="token punctuation">.</span><span class="token function">updateUniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u6E32\u67D3</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rect<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br></div></div></details><h2 id="\u516B-\u82B1\u6837\u8F6C\u573A" tabindex="-1"><a class="header-anchor" href="#\u516B-\u82B1\u6837\u8F6C\u573A" aria-hidden="true">#</a> \u516B.\u82B1\u6837\u8F6C\u573A</h2><p><img src="`+i+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u82B1\u6837\u8F6C\u573A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    uniform sampler2D u_Pattern<span class="token punctuation">;</span>
    uniform sampler2D u_Gradient<span class="token punctuation">;</span>
    uniform float u_Ratio<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      vec4 o <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 p <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 g <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Gradient<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      float f <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>r <span class="token operator">+</span> u_Ratio<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> p<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Track.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> imgPromise<span class="token punctuation">,</span> initShaders<span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u6570\u636E\u6E90</span>
    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ratio</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> track <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      source<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLE_STRIP&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Ratio</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> obj<span class="token punctuation">.</span>ratio
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> i1 <span class="token operator">=</span> n <span class="token operator">%</span> len
      <span class="token keyword">const</span> i2 <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> len
      <span class="token keyword">const</span> i3 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span>

      <span class="token keyword">const</span> originImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      originImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/pattern</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      <span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      pattern<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/pattern</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      <span class="token keyword">const</span> gradient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      gradient<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/mask</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i3<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>originImg<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>gradient<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">changeImg</span><span class="token punctuation">(</span>originImg<span class="token punctuation">,</span> pattern<span class="token punctuation">,</span> gradient<span class="token punctuation">)</span>
        <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">changeImg</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>imgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">0</span>

      rect<span class="token punctuation">.</span>maps <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_Pattern</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_Gradient</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      rect<span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>onEnd <span class="token operator">=</span> loadImg
      track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;ratio&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u52A8\u753B */</span>
    <span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      track<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      rect<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>u_Ratio<span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">.</span>ratio<span class="token punctuation">;</span>
      rect<span class="token punctuation">.</span><span class="token function">updateUniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u6E32\u67D3</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rect<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br></div></div></details><h2 id="\u4E5D-\u6362\u88C5\u8FBE\u4EBA" tabindex="-1"><a class="header-anchor" href="#\u4E5D-\u6362\u88C5\u8FBE\u4EBA" aria-hidden="true">#</a> \u4E5D.\u6362\u88C5\u8FBE\u4EBA</h2><p><img src="`+k+`" alt=""></p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>\u6362\u88C5\u8FBE\u4EBA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body</span> <span class="token punctuation">{</span>
      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
    <span class="token punctuation">}</span>

    <span class="token selector">canvas</span> <span class="token punctuation">{</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> antiquewhite<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    uniform sampler2D u_Pattern1<span class="token punctuation">;</span>
    uniform sampler2D u_Pattern2<span class="token punctuation">;</span>
    uniform sampler2D u_Mask<span class="token punctuation">;</span>
    uniform float u_Ratio<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      vec4 o <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 p1 <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern1<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 p2 <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern2<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 m <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Mask<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
      vec4 p3 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        p3 <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> u_Ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      gl_FragColor <span class="token operator">=</span> p3<span class="token operator">*</span>o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Track.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> imgPromise<span class="token punctuation">,</span> initShaders<span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ratio</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> track <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      source<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLE_STRIP&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Ratio</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> obj<span class="token punctuation">.</span>ratio
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> originImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    originImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/dress.jpg</span><span class="token template-punctuation string">\`</span></span>

    <span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    mask<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/mask-dress.jpg&#39;</span>

    Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token function">imgPromise</span><span class="token punctuation">(</span>originImg<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">imgPromise</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      rect<span class="token punctuation">.</span>maps <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> originImg <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_Mask</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> mask <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      n<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> i1 <span class="token operator">=</span> n <span class="token operator">%</span> len
      <span class="token keyword">const</span> i2 <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> len

      <span class="token keyword">const</span> pattern1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      pattern1<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/pattern</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      <span class="token keyword">const</span> pattern2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      pattern2<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/pattern</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>i2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>

      Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>pattern1<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">imgPromise</span><span class="token punctuation">(</span>pattern2<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">changeImg</span><span class="token punctuation">(</span>pattern1<span class="token punctuation">,</span> pattern2<span class="token punctuation">)</span>
        <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">changeImg</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>imgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>ratio <span class="token operator">=</span> <span class="token number">0</span>
      rect<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Pattern1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      rect<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Pattern2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
      rect<span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">1500</span><span class="token punctuation">;</span>
      track<span class="token punctuation">.</span>onEnd <span class="token operator">=</span> loadImg
      track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token string">&quot;ratio&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* \u52A8\u753B */</span>
    <span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      track<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      rect<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>u_Ratio<span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">.</span>ratio<span class="token punctuation">;</span>
      rect<span class="token punctuation">.</span><span class="token function">updateUniform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u6E32\u67D3</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      rect<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br></div></div></details><h2 id="\u5341-\u53D8\u6362\u56FE\u7247" tabindex="-1"><a class="header-anchor" href="#\u5341-\u53D8\u6362\u56FE\u7247" aria-hidden="true">#</a> \u5341.\u53D8\u6362\u56FE\u7247</h2><h3 id="_1-\u57FA\u70B9\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u70B9\u53D8\u6362" aria-hidden="true">#</a> 1.\u57FA\u70B9\u53D8\u6362</h3><h4 id="_1-1\u57FA\u70B9\u53D8\u6362\u7684\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_1-1\u57FA\u70B9\u53D8\u6362\u7684\u539F\u7406" aria-hidden="true">#</a> 1.1\u57FA\u70B9\u53D8\u6362\u7684\u539F\u7406</h4><p><img src="`+b+'" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><p>\u56FE\u7247img\uFF0Cimg \u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D</p><p><code>\u6C42</code>\uFF1A\u8BA9img\u57FA\u4E8E\u5176\u5DE6\u4E0A\u89D2\u70B9P\u70B9\u8FDB\u884C\u65CB\u8F6C\u548C\u7F29\u653E\u7684\u65B9\u6CD5</p><p>\u601D\u8DEF\uFF1A</p><ol><li>\u4E0D\u8981\u628A\u76EE\u5149\u90FD\u653E\u5728\u5DE6\u4E0A\u89D2\u70B9\u4E0A\uFF0C\u4F1A\u5F88\u590D\u6742</li><li>\u7528\u77E9\u9635\u7684\u601D\u60F3\u770B\u95EE\u9898\uFF0C\u5C31\u4F1A\u6BD4\u8F83\u8F7B\u677E\u3002</li></ol><p><code>\u89E3</code>\uFF1A</p><ol><li>\u628Aimg\u88C5\u996D\u76D2\u91CC\uFF0C\u996D\u76D2\u7684\u672C\u5730\u77E9\u9635\u662Fmi\u3002</li></ol><p>\u5F53\u524Dmi\u548C\u4E16\u754C\u5750\u6807\u7CFB\u91CD\u5408\u3002</p><p><img src="'+m+'" alt=""></p><ol start="2"><li>\u8BA9mi \u7684\u4F4D\u7F6E\u51CF\u53BB\u70B9P</li></ol><p><img src="'+d+'" alt=""></p><p>\u200B\u5982\u679C\u6211\u4EEC\u73B0\u5728\u65CB\u8F6Cmi\u7684\u8BDD\uFF0C\u996D\u76D2\u4F1A\u57FA\u4E8Emi\u7684\u5750\u6807\u539F\u70B9\u65CB\u8F6C\uFF0C\u8FD9\u660E\u663E\u4E0D\u662F\u6211\u4EEC\u60F3\u8981\u7684\u3002</p><ol start="3"><li>\u628A\u996D\u76D2\u88C5\u51B0\u7BB1\u91CC\uFF0C\u51B0\u7BB1\u7684\u672C\u5730\u77E9\u9635\u662Fmb\u3002</li></ol><p><img src="'+g+'" alt=""></p><p>\u200B\u5F53\u524Dmb\u548C\u4E16\u754C\u5750\u6807\u7CFB\u91CD\u5408\u3002</p><ol start="4"><li>\u8BA9mb \u7684\u4F4D\u7F6E\u52A0\u4E0A\u70B9P</li></ol><p><img src="'+y+'" alt=""></p><p>\u6B64\u65F6\u7684img\u548C\u6700\u521D\u59CB\u7684img\u91CD\u5408<br> \u6B64\u65F6img\u7684\u5DE6\u4E0A\u89D2\u70B9P\u548Cmb\u7684\u5750\u6807\u539F\u70B9\u91CD\u5408<br> \u6B64\u65F6\u6211\u4EEC\u65CB\u8F6Cmb\uFF0C\u51B0\u7BB1\u4F1A\u57FA\u4E8Emb\u7684\u5750\u6807\u539F\u70B9\u65CB\u8F6C\uFF0C\u540C\u65F6\u4E5F\u5E26\u52A8\u4E86\u56FE\u7247\u57FA\u4E8E\u70B9P\u65CB\u8F6C</p><p>5.\u8BA1\u7B97\u6A21\u578B\u77E9\u9635\uFF0C\u53D8\u6362\u56FE\u7247\u9876\u70B9\u7684\u521D\u59CB\u70B9\u4F4D\uFF0C\u4ECE\u800C\u5F97\u5230\u56FE\u7247\u9876\u70B9\u57FA\u4E8E\u70B9P\u53D8\u6362\u540E\u7684\u4F4D\u7F6E\u3002</p><p>\u6A21\u578B\u77E9\u9635 = mb * mi<br> \u56FE\u7247\u9876\u70B9\u57FA\u4E8E\u70B9P\u53D8\u6362\u540E\u7684\u4F4D\u7F6E = \u6A21\u578B\u77E9\u9635 * \u56FE\u7247\u9876\u70B9\u7684\u521D\u59CB\u70B9\u4F4D</p><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="'+f+`" alt=""></p><p><code>\u6CE8</code>\uFF1A<br> \u996D\u76D2\u5305\u542B\u4E86\u56FE\u7247\u7684\u521D\u59CB\u70B9\u4F4D\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3Athree.js\u4E2DObject3D\u3002<br> \u51B0\u7BB1\u5305\u542B\u4E86\u996D\u76D2\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3Athree.js\u4E2D\u7684Group\u3002</p><h4 id="_1-2\u57FA\u70B9\u53D8\u6362\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_1-2\u57FA\u70B9\u53D8\u6362\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 1.2\u57FA\u70B9\u53D8\u6362\u7684\u4EE3\u7801\u5B9E\u73B0</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7EB9\u7406 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    OrthographicCamera<span class="token punctuation">,</span>
    Vector3
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Mat.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Geo.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Obj3D.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Scene.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6B63\u4EA4\u76F8\u673A</span>
  <span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
  <span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
  <span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
  <span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>matrixWorldInverse
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> scence <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//\u8BA1\u7B97\u56FE\u7247\u9876\u70B9 </span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span> h<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">,</span>
    <span class="token operator">-</span>hw<span class="token punctuation">,</span> <span class="token operator">-</span>hh<span class="token punctuation">,</span>
    hw<span class="token punctuation">,</span> hh<span class="token punctuation">,</span>
    hw<span class="token punctuation">,</span> <span class="token operator">-</span>hh<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u58F0\u660E\u996D\u76D2\u548C\u51B0\u7BB1\u7684\u672C\u5730\u77E9\u9635\uFF0C\u4EE5\u53CA\u56FE\u7247\u7684\u53D8\u6362\u57FA\u70B9 */</span>
  <span class="token comment">// \u996D\u76D2\u672C\u5730\u77E9\u9635</span>
  <span class="token keyword">const</span> mi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u51B0\u7BB1\u672C\u5730\u77E9\u9635</span>
  <span class="token keyword">const</span> mb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6A21\u578B\u77E9\u9635 (\u7531 mb*mi \u5F97\u5230)</span>
  <span class="token keyword">const</span> mm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u57FA\u70B9</span>
  <span class="token keyword">let</span> orignInd <span class="token operator">=</span> <span class="token number">4</span>

  <span class="token comment">//\u57FA\u4E8E\u56FE\u7247\u7684\u53D8\u6362\u57FA\u70B9\u5E03\u9635</span>
  <span class="token function">setOrign</span><span class="token punctuation">(</span>orignInd<span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    mi<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    mb<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* \u51C6\u5907\u4E00\u5F20\u56FE\u7247 */</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/erha.jpg&#39;</span>
  <span class="token keyword">let</span> mat <span class="token operator">=</span> <span class="token keyword">null</span>
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;textureVertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token keyword">const</span> fs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;textureFragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs<span class="token punctuation">,</span> fs<span class="token punctuation">)</span>
    mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      program<span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          image<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLE_STRIP&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* \u5728\u6E32\u67D3\u65B9\u6CD5\u91CC\u53D8\u6362\u51B0\u7BB1\u540E\uFF0C\u4E58\u4EE5\u996D\u76D2\u7684\u672C\u5730\u77E9\u9635\uFF0C\u5F97\u5230\u56FE\u7247\u7684\u6A21\u578B\u77E9\u9635 */</span>
  <span class="token keyword">let</span> ang <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ang <span class="token operator">+=</span> <span class="token number">0.02</span>
    <span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    mm<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
      mb<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
          <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> mm<span class="token punctuation">.</span>elements
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+w+`" alt=""></p></details><h3 id="_2-\u4E8C\u6B21\u57FA\u70B9\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#_2-\u4E8C\u6B21\u57FA\u70B9\u53D8\u6362" aria-hidden="true">#</a> 2.\u4E8C\u6B21\u57FA\u70B9\u53D8\u6362</h3><p>\u7EE7\u6211\u4EEC\u4E0A\u4E00\u6B21\u53D8\u6362\u4E4B\u540E\uFF0C\u82E5\u6211\u4EEC\u60F3\u518D\u57FA\u4E8E\u56FE\u7247\u7684\u5176\u5B83\u89D2\u70B9\u8FDB\u884C\u53D8\u6362\uFF0C\u6BD4\u5982\u53F3\u4E0B\u89D2\uFF0C\u5E94\u8BE5\u600E\u4E48\u529E\u5462\uFF1F</p><p>\u8FD9\u4E2A\u95EE\u9898\u7684\u89E3\u51B3\u601D\u8DEF\u5E76\u4E0D\u552F\u4E00\uFF0C\u54B1\u5148\u8BF4\u4E00\u4E2A\u6700\u7B80\u5355\u7684\u601D\u8DEF\uFF1A<br> 1.\u6BCF\u4E00\u6B21\u53D8\u6362\u5B8C\u6210\u540E\uFF0C\u76F4\u63A5\u57FA\u4E8E\u4E0A\u4E00\u6B21\u7684\u6A21\u578B\u77E9\u9635\u4FEE\u6539\u9876\u70B9\u7684\u539F\u59CB\u70B9\u4F4D\u3002 2.\u57FA\u4E8E\u65B0\u7684\u57FA\u70B9\u4F4D\u7F6E\uFF0C\u91CD\u590D\u7B2C\u4E00\u6B21\u57FA\u70B9\u53D8\u6362\u7684\u6B65\u9AA4\u3002</p><p>\u4F8B\u5B50\u4E0A\u9762\u7684\u56FE\u7247\u6BCF\u65CB\u8F6C45\xB0\uFF0C\u6539\u53D8\u4E00\u6B21\u53D8\u6362\u57FA\u70B9\u3002<br> \u5177\u4F53\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ang <span class="token operator">+=</span> <span class="token number">0.005</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ang <span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ang <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        orignInd <span class="token operator">=</span> <span class="token punctuation">(</span>orignInd <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">8</span>
        <span class="token function">setOrign</span><span class="token punctuation">(</span>orignInd<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    mm<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
        mb<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> mm<span class="token punctuation">.</span>elements
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mm<span class="token punctuation">)</span>
        vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>x
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>
    geo<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> vertices
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>\u4E0A\u9762\u7684formatVertices() \u65B9\u6CD5\u4FBF\u662F\u57FA\u4E8E\u6A21\u578B\u77E9\u9635\u683C\u5F0F\u5316vertices\u70B9\u4F4D\u7684\u65B9\u6CD5\uFF0C\u4FEE\u6539\u5B8C\u540E\uFF0C\u540C\u6B65\u66F4\u65B0geo\u51E0\u4F55\u4F53\u91CC\u7684\u9876\u70B9\u70B9\u4F4D\u3002</p><h3 id="_3-\u7528\u9F20\u6807\u53D8\u6362\u56FE\u7247" tabindex="-1"><a class="header-anchor" href="#_3-\u7528\u9F20\u6807\u53D8\u6362\u56FE\u7247" aria-hidden="true">#</a> 3.\u7528\u9F20\u6807\u53D8\u6362\u56FE\u7247</h3><h4 id="_3-1\u529F\u80FD\u63CF\u8FF0" tabindex="-1"><a class="header-anchor" href="#_3-1\u529F\u80FD\u63CF\u8FF0" aria-hidden="true">#</a> 3.1\u529F\u80FD\u63CF\u8FF0</h4><ol><li>\u53D8\u6362\u8282\u70B9</li></ol><p>\u53D8\u6362\u8282\u70B9\u5C31\u662F\u56FE\u7247\u7684\u56DB\u4E2A\u89D2\u70B9 + \u63CF\u8FB9\u3002<br> \u53D8\u6362\u8282\u70B9\u6CA1\u5565\u5B9E\u9645\u529F\u80FD\uFF0C\u5C31\u662F\u6574\u4E2A\u89C6\u89C9\u6837\u5F0F\uFF0C\u8BA9\u7528\u6237\u77E5\u9053\u6B64\u56FE\u53EF\u53D8\u6362\u3002</p><p><img src="`+n+'" alt=""></p><ol start="2"><li>\u4F4D\u79FB</li></ol><p>\u5F53\u9F20\u6807\u5728\u56FE\u7247\u4E2D\u7684\u65F6\u5019\uFF0C\u6309\u4F4F\u9F20\u6807\u53EF\u4EE5\u62D6\u62FD\u56FE\u7247\u3002</p><p><img src="'+v+'" alt=""></p><ol start="3"><li>\u7F29\u653E</li></ol><p>\u5F53\u9F20\u6807\u5230\u56FE\u7247\u8282\u70B9\u7684\u8DDD\u79BB\u5C0F\u4E8E15\u50CF\u7D20\u65F6\uFF0C\u5F00\u542F\u9F20\u6807\u5BF9\u56FE\u7247\u7684\u7F29\u653E\u529F\u80FD\u3002</p><p>\u9ED8\u8BA4\uFF1A\u5C45\u4E2D+\u7B49\u6BD4\u7F29\u653E<br> alt \u952E\uFF1A\u4EE5\u9F20\u6807\u5BF9\u9762\u7684\u70B9\u4E3A\u57FA\u70B9\u8FDB\u884C\u7F29\u653E<br> shift \u952E\uFF1A\u81EA\u7531\u7F29\u653E</p><p><img src="'+h+'" alt=""></p><ol start="3"><li>\u65CB\u8F6C</li></ol><p>\u5F53\u9F20\u6807\u5230\u56FE\u7247\u8282\u70B9\u7684\u8DDD\u79BB\u5C0F\u4E8E40\u50CF\u7D20\u65F6\uFF0C\u5F00\u542F\u9F20\u6807\u5BF9\u56FE\u7247\u7684\u65CB\u8F6C\u529F\u80FD\u3002</p><p>\u9ED8\u8BA4\uFF1A\u5C45\u4E2D+\u6309\u7167\u7279\u5B9A\u5F27\u5EA6(15\xB0)\u65CB\u8F6C<br> alt \u952E\uFF1A\u4EE5\u9F20\u6807\u5BF9\u9762\u7684\u70B9\u4E3A\u57FA\u70B9\u8FDB\u884C\u65CB\u8F6C<br> shift \u952E\uFF1A\u81EA\u7531\u65CB\u8F6C</p><p><img src="'+x+`" alt=""></p><p>\u57FA\u672C\u7684\u53D8\u6362\u529F\u80FD\u5C31\u662F\u8FD9\u6837\uFF0C\u63A5\u4E0B\u6765\u8BF4\u4E00\u4E0B\u5177\u4F53\u7684\u4EE3\u7801\u5B9E\u73B0\u3002</p><h4 id="_3-2\u524D\u671F\u51C6\u5907-\u56FE\u7247-\u5916\u6846" tabindex="-1"><a class="header-anchor" href="#_3-2\u524D\u671F\u51C6\u5907-\u56FE\u7247-\u5916\u6846" aria-hidden="true">#</a> 3.2\u524D\u671F\u51C6\u5907-\u56FE\u7247+\u5916\u6846</h4><ol><li>\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668\uFF0C\u4E00\u5957\u7ED8\u5236\u70B9\u548C\u7EBF\uFF0C\u4E00\u5957\u7740\u7EB9\u7406\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- \u70B9\u548C\u7EBF --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7740\u7EB9\u7406 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><ol start="2"><li>\u51C6\u5907webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  Matrix4<span class="token punctuation">,</span> 
  OrthographicCamera<span class="token punctuation">,</span> 
  Vector3 
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Obj3D.js&#39;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Scene.js&#39;</span>
<span class="token keyword">import</span> Rect <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Rect.js&#39;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="3"><li>\u901A\u8FC7\u6B63\u4EA4\u76F8\u673A\u83B7\u53D6\u6295\u5F71\u89C6\u56FE\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>matrixWorldInverse
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="4"><li>\u901A\u8FC7\u56FE\u7247\u5C3A\u5BF8\uFF0C\u83B7\u53D6\u56FE\u7247\u548C\u56FE\u7247\u5916\u6846\u7684\u9876\u70B9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u56FE\u7247\u5C3A\u5BF8</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span> h<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token comment">// \u56FE\u7247\u9876\u70B9</span>
<span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">,</span>
    <span class="token operator">-</span>hw<span class="token punctuation">,</span> <span class="token operator">-</span>hh<span class="token punctuation">,</span>
    hw<span class="token punctuation">,</span> hh<span class="token punctuation">,</span>
    hw<span class="token punctuation">,</span> <span class="token operator">-</span>hh<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// \u56FE\u7247\u5916\u6846\u9876\u70B9</span>
<span class="token keyword">let</span> verticesOut <span class="token operator">=</span> <span class="token function">getVerticesOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* \u57FA\u4E8Evertices\u83B7\u53D6verticesOut */</span>
<span class="token keyword">function</span> <span class="token function">getVerticesOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><code>\u6CE8</code>\uFF1A<br> \u56FE\u7247\u662F\u7528TRIANGLE_STRIP\u4E09\u89D2\u5E26\u753B\u7684\uFF1B<br> \u56FE\u7247\u5916\u6846\u662F\u7528LINE_LOOP \u95ED\u5408\u7EBF\u6761\u548C\u70B9POINTS \u753B\u7684\u3002<br> \u56FE\u7247\u548C\u56FE\u7247\u5916\u6846\u7684\u9876\u70B9\u6392\u5E8F\u662F\u4E0D\u540C\u7684\u3002</p><ol start="5"><li>\u7ED8\u5236\u56FE\u7247\u5916\u6846\u548C\u56FE\u7247</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scence <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u56FE\u7247\u5916\u6846-\u70B9\u548C\u7EBF</span>
<span class="token keyword">let</span> matOut <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">let</span> geoOut <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> vs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;solidVertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token keyword">const</span> fs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;solidFragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs<span class="token punctuation">,</span> fs<span class="token punctuation">)</span>
    matOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        program<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;LINE_LOOP&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    geoOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">array</span><span class="token operator">:</span> verticesOut<span class="token punctuation">,</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoOut<span class="token punctuation">,</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matOut <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u56FE\u7247</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/erha.jpg&#39;</span>
<span class="token keyword">let</span> mat <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">let</span> geo <span class="token operator">=</span> <span class="token keyword">null</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;textureVertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token keyword">const</span> fs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;textureFragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs<span class="token punctuation">,</span> fs<span class="token punctuation">)</span>
    mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        program<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                image<span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLE_STRIP&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><p>scence.unshift(obj) \u4EE5\u524D\u7F6E\u7684\u65B9\u5F0F\u6DFB\u52A0\u4E09\u7EF4\u5BF9\u8C61\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    objs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        children<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        obj<span class="token punctuation">.</span>parent<span class="token operator">=</span><span class="token keyword">this</span>
        obj<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u4E4B\u6240\u4EE5\u8FD9\u4E48\u505A\u662F\u4E3A\u4E86\u5C06\u56FE\u7247\u653E\u5728\u56FE\u6846\u4E0B\u9762\uFF0C\u4E5F\u5C31\u662F\u5148\u6E32\u67D3\u56FE\u7247\uFF0C\u518D\u6E32\u67D3\u56FE\u6846\u3002</p><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+n+`" alt=""></p><p>\u63A5\u4E0B\u6765\u4FBF\u53EF\u4EE5\u5728\u56FE\u7247\u4E0A\u6DFB\u52A0\u9F20\u6807\u4EA4\u4E92\u4E8B\u4EF6\u4E86\u3002</p><h4 id="_3-3\u62D6\u62FD\u56FE\u7247" tabindex="-1"><a class="header-anchor" href="#_3-3\u62D6\u62FD\u56FE\u7247" aria-hidden="true">#</a> 3.3\u62D6\u62FD\u56FE\u7247</h4><p>\u62D6\u62FD\u56FE\u7247\u662F\u6BD4\u8F83\u7B80\u5355\u7684\uFF0C\u6240\u4EE5\u54B1\u4EEC\u5148\u4ECE\u6700\u7B80\u5355\u7684\u8BF4\u8D77\u3002</p><ol><li>\u5148\u58F0\u660E\u4E00\u4E9B\u5FC5\u5907\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u53D8\u6362\u72B6\u6001</span>
<span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
<span class="token comment">// \u53D8\u6362\u6570\u636E\u662F\u5426\u53D1\u751F\u6539\u53D8</span>
<span class="token keyword">let</span> change <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">// \u53D8\u6362\u72B6\u6001\u4E0Ecursor\u72B6\u6001\u7684\u5BF9\u5E94\u5173\u7CFB</span>
<span class="token keyword">const</span> cursorMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&#39;drag&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;move&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&#39;rotate&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;alias&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&#39;scale&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pointer&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&#39;none&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// \u62D6\u62FD\u8D77\u59CB\u4F4D\u4E0E\u7ED3\u675F\u4F4D(\u4E16\u754C\u5750\u6807\u7CFB)</span>
<span class="token keyword">const</span> dragStart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> dragEnd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u4F4D\u79FB\u91CF</span>
<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u996D\u76D2\u672C\u5730\u77E9\u9635</span>
<span class="token keyword">const</span> mi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u51B0\u7BB1\u672C\u5730\u77E9\u9635</span>
<span class="token keyword">const</span> mb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">const</span> mm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ol start="2"><li>\u76D1\u542Ccanvas\u7684\u9F20\u6807\u6309\u4E0B\u4E8B\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u9F20\u6807\u7684\u4E16\u754C\u5750\u6807\u4F4D</span>
    <span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6\u53D8\u6362\u72B6\u6001\uFF0C\u5982\u679C\u9F20\u6807\u5728\u56FE\u50CF\u91CC\uFF0C\u90A3\u4E48\u53D8\u6362\u72B6\u6001\u5C31\u662F&#39;drag&#39;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInImg</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">&#39;drag&#39;</span>
        dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u9F20\u6807\u6309\u4E0B\u65F6\uFF0C\u4E3B\u8981\u505A\u4E862\u4EF6\u4E8B\u60C5\uFF1A</p><ul><li>\u9F20\u6807\u5728canvas\u4E2D\u7684\u4F4D\u7F6E\u8F6C\u4E16\u754C\u4F4D\uFF0C\u4EE5\u4FBF\u4E8E\u5224\u65AD\u9F20\u6807\u548C\u56FE\u7247\u9876\u70B9\u7684\u5173\u7CFB\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">worldPos</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token comment">// \u88C1\u526A\u7A7A\u95F4\u4F4D</span>
    <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>clientX <span class="token operator">-</span> hw<span class="token punctuation">)</span> <span class="token operator">/</span> hw<span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token punctuation">(</span>clientY <span class="token operator">-</span> hh<span class="token punctuation">)</span> <span class="token operator">/</span> hh<span class="token punctuation">,</span>
        <span class="token number">0</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u9F20\u6807\u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>
        pvMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u56DE\u987E\u4E00\u4E0B\u6211\u4EEC\u4E4B\u524D\u6240\u5B66\u7684\u77E9\u9635\u77E5\u8BC6\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u88C1\u526A\u7A7A\u95F4\u4F4D <span class="token operator">=</span> \u6295\u5F71\u89C6\u56FE\u77E9\u9635 <span class="token operator">*</span> \u6A21\u578B\u77E9\u9635 <span class="token operator">*</span> \u521D\u59CB\u9876\u70B9\u4F4D
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7531\u4E0A\u5F0F\u53EF\u5F97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u521D\u59CB\u9876\u70B9\u4F4D<span class="token operator">=</span> <span class="token punctuation">(</span>\u6295\u5F71\u89C6\u56FE\u77E9\u9635 <span class="token operator">*</span> \u6A21\u578B\u77E9\u9635<span class="token punctuation">)</span>\u7684\u9006\u77E9\u9635 <span class="token operator">*</span> \u88C1\u526A\u7A7A\u95F4\u4F4D
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u56E0\u4E3A\u56FE\u7247\u9876\u70B9\u5C31\u662F\u57FA\u4E8E\u4E16\u754C\u5750\u6807\u7CFB\u5B9A\u4F4D\u7684\uFF0C\u4E16\u754C\u5750\u6807\u7CFB\u662F\u5355\u4F4D\u77E9\u9635\uFF0C\u4EFB\u4F55\u77E9\u9635\u4E0E\u5355\u4F4D\u77E9\u9635\u76F8\u4E58\u90FD\u4E0D\u4F1A\u53D1\u751F\u6539\u53D8\uFF0C\u6240\u4EE5\u6A21\u578B\u77E9\u9635\u53EF\u4EE5\u5FFD\u7565\u3002</p><p>\u6700\u7EC8\uFF0C\u9F20\u6807\u7684\u4E16\u754C\u70B9\u4F4D\u5C31\u662F\u8FD9\u6837\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u83B7\u53D6\u53D8\u6362\u72B6\u6001\uFF0C\u5982\u679C\u9F20\u6807\u5728\u56FE\u50CF\u91CC\uFF0C\u90A3\u4E48\u53D8\u6362\u72B6\u6001\u5C31\u662F&#39;drag&#39;\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInImg</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token string">&#39;drag&#39;</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>isInImg(dragStart) \u662F\u5224\u65AD\u9F20\u6807\u662F\u5426\u5728\u56FE\u50CF\u4E2D\u7684\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isInImg</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span>
        p<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span>
        p<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>inTriangle()\uFF1A\u5224\u65AD\u9876\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\uFF0C\u8FD4\u56DE\u5E03\u5C14\u503C\u3002</p><p>\u56E0\u4E3A\u56FE\u7247\u7531\u4E24\u4E2A\u4E09\u89D2\u5F62\u7EC4\u6210\uFF0C\u6240\u4EE5\u6211\u505A\u4E86\u4E24\u6B21\u5224\u65AD\u3002<br> \u53EA\u8981\u70B9\u4F4D\u5728\u4EFB\u610F\u4E09\u89D2\u5F62\u4E2D\uFF0C\u5C31\u8BF4\u660E\u70B9\u4F4D\u5728\u56FE\u7247\u4E2D\u3002</p><p>\u81F3\u4E8E\u5224\u65AD\u70B9\u4F4D\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\u7684\u65B9\u6CD5\uFF0C\u6211\u4EEC\u4E4B\u524D\u8BF4\u8FC7\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span><span class="token parameter">p0<span class="token punctuation">,</span> triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> bool<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> bx<span class="token punctuation">,</span> by<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p0<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p0<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
    p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p0<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p0<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ax <span class="token operator">*</span> by <span class="token operator">-</span> bx <span class="token operator">*</span> ay<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="3"><li>\u76D1\u542Ccanvas\u7684\u9F20\u6807\u79FB\u52A8\u4E8B\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u9F20\u6807\u4E16\u754C\u4F4D</span>
    <span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u8BBE\u7F6E\u9F20\u6807\u6837\u5F0F</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cursorState <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInImg</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cursorState <span class="token operator">=</span> <span class="token string">&#39;drag&#39;</span>
        <span class="token punctuation">}</span>
        canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> cursorMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cursorState<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u53D8\u6362\u56FE\u7247</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    change <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&#39;drag&#39;</span><span class="token operator">:</span>
            <span class="token function">drag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u9F20\u6807\u79FB\u52A8\u65F6\uFF0C\u4E3B\u8981\u505A\u4E864\u4EF6\u4E8B\u60C5\uFF1A</p><ul><li><p>\u83B7\u53D6\u9F20\u6807\u4E16\u754C\u4F4D\uFF0C\u4EE5\u4FBF\u4E8E\u5224\u65AD\u9F20\u6807\u548C\u56FE\u7247\u9876\u70B9\u7684\u5173\u7CFB\u3002</p></li><li><p>\u8BBE\u7F6E\u9F20\u6807\u6837\u5F0F\uFF0C\u6B64\u64CD\u4F5C\u662F\u5728\u56FE\u7247\u4E0D\u5904\u4E8E\u4EFB\u4F55\u53D8\u6362\u72B6\u6001\u65F6\u6267\u884C\u7684\u3002</p></li><li><p>\u53D8\u6362\u56FE\u7247</p><ul><li>drag()\uFF1A\u901A\u8FC7\u62D6\u62FD\u7ED3\u675F\u4F4D\u51CF\u62D6\u62FD\u8D77\u59CB\u4F4D\u5F97\u5230\u56FE\u7247\u7684\u504F\u79FB\u91CF\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">drag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    offset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
        dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul><p>\u6E32\u67D3 render()</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> elements <span class="token punctuation">}</span> <span class="token operator">=</span> mm<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">getModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> elements
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    matOut<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> elements
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u6211\u4EEC\u91CD\u70B9\u770B\u4E00\u4E0B\u8BA1\u7B97\u6A21\u578B\u77E9\u9635\u7684\u65B9\u6CD5getModelMatrix()</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4F4D\u79FB\u77E9\u9635</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> px<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> py <span class="token punctuation">}</span> <span class="token operator">=</span> offset
    <span class="token keyword">const</span> moveMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> px<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> py<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u6A21\u578B\u77E9\u9635</span>
    <span class="token keyword">return</span> mb<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>moveMatrix<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li>\u76D1\u542Ccanvas\u7684\u9F20\u6807\u62AC\u8D77\u4E8B\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">!==</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>change<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            change <span class="token operator">=</span> <span class="token boolean">false</span>
            offset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token string">&#39;default&#39;</span>
            <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u9F20\u6807\u62AC\u8D77\u65F6\uFF0C\u4E3B\u8981\u505A\u4E86\u4EE5\u4E0B\u4E8B\u60C5\uFF1A</p><ul><li>\u6E05\u7406state \u72B6\u6001</li><li>\u6E05\u7A7A\u56FE\u7247\u7684\u53D8\u6362\u6570\u636E</li><li>\u6062\u590D\u9F20\u6807\u6837\u5F0F</li><li>\u683C\u5F0F\u5316\u9876\u70B9\u6570\u636E\uFF0C\u5E76\u66F4\u65B0\u51E0\u4F55\u4F53\u7684\u9876\u70B9\u96C6\u5408</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mm<span class="token punctuation">)</span>
        vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>x
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>
    verticesOut <span class="token operator">=</span> <span class="token function">getVerticesOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    geo<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> vertices
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    geoOut<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> verticesOut
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-4\u65CB\u8F6C\u56FE\u7247" tabindex="-1"><a class="header-anchor" href="#_3-4\u65CB\u8F6C\u56FE\u7247" aria-hidden="true">#</a> 3.4\u65CB\u8F6C\u56FE\u7247</h4><ol><li>\u58F0\u660E\u5FC5\u5907\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u53D8\u6362\u57FA\u70B9</span>
<span class="token keyword">let</span> orign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u62D6\u62FD\u8D77\u59CB\u4F4D\u4E0E\u7ED3\u675F\u4F4D\u51CF\u53D8\u6362\u57FA\u70B9\u4F4D</span>
<span class="token keyword">const</span> start2Orign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> end2Orign <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u65CB\u8F6C\u8D77\u59CB\u5F27\u5EA6</span>
<span class="token keyword">let</span> startAng <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// \u65CB\u8F6C\u91CF</span>
<span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>\u9F20\u6807\u6309\u4E0B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u9F20\u6807\u62D6\u62FD\u7684\u8D77\u59CB\u4F4DdragStart\uFF0C\u6B64\u4F4D\u7F6E\u4E3A\u4E16\u754C\u5750\u6807\u4F4D</span>
    <span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6\u53D8\u6362\u72B6\u6001\uFF0C\u5982\u679C\u9F20\u6807\u5728\u56FE\u50CF\u91CC\uFF0C\u90A3\u4E48\u53D8\u6362\u72B6\u6001\u5C31\u662F&#39;drag&#39;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInImg</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">&#39;drag&#39;</span>
        dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">selectNode</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
            state <span class="token operator">=</span> node<span class="token punctuation">.</span>state
            <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            start2Orign<span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">,</span> orign<span class="token punctuation">)</span>
            startAng <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>start2Orign<span class="token punctuation">.</span>y<span class="token punctuation">,</span> start2Orign<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u9F20\u6807\u6309\u4E0B\u65F6\uFF0C\u53EA\u8981\u4E0D\u662F\u5728\u56FE\u7247\u91CC\uFF0C\u5C31\u4F1A\u505A\u4EE5\u4E0B\u4E8B\u60C5\uFF1A</p><ul><li>\u9009\u62E9\u8282\u70B9selectNode(dragStart)\uFF0C\u8FD4\u56DE\u8282\u70B9\u7D22\u5F15\u548C\u53D8\u6362\u72B6\u6001</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">selectNode</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            node <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> i<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">&#39;rotate&#39;</span> <span class="token punctuation">}</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li><p>\u82E5\u9009\u4E2D\u8282\u70B9\uFF0C\u5219\u66F4\u65B0\u53D8\u6362\u72B6\u6001\u3001\u57FA\u70B9\u3001\u62D6\u62FD\u8D77\u70B9\u76F8\u5BF9\u4E8E\u57FA\u70B9\u7684\u4F4D\u7F6E\u3001\u8D77\u59CB\u5F27\u5EA6\u3002</p><p>\u8BE6\u7EC6\u770B\u4E00\u4E0B\u8BBE\u7F6E\u57FA\u70B9\u7684\u65B9\u6CD5\uFF1A</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    orign<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    mi<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    mb<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>
        x1 <span class="token operator">+</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
        y1 <span class="token operator">+</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li>\u9F20\u6807\u79FB\u52A8</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u9F20\u6807\u4E16\u754C\u4F4D</span>
    <span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u8BBE\u7F6E\u9F20\u6807\u6837\u5F0F</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">===</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cursorState <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInImg</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cursorState <span class="token operator">=</span> <span class="token string">&#39;drag&#39;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">selectNode</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
            cursorState <span class="token operator">=</span> node <span class="token operator">?</span> node<span class="token punctuation">.</span>state <span class="token operator">:</span> <span class="token string">&#39;none&#39;</span>
        <span class="token punctuation">}</span>
        canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> cursorMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cursorState<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u53D8\u6362\u56FE\u7247</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    end2Orign<span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span>mp<span class="token punctuation">,</span> orign<span class="token punctuation">)</span>
    change <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&#39;drag&#39;</span><span class="token operator">:</span>
            <span class="token function">drag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">&#39;rotate&#39;</span><span class="token operator">:</span>
            <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>rotate() \u65CB\u8F6C\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> endAng <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>end2Orign<span class="token punctuation">.</span>y<span class="token punctuation">,</span> end2Orign<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
    angle <span class="token operator">=</span> endAng <span class="token operator">-</span> startAng
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>render() \u65B9\u6CD5\u65E0\u9700\u6539\u53D8\uFF0C\u53EA\u662F\u5176\u4E2D\u83B7\u53D6\u6A21\u578B\u77E9\u9635getModelMatrix() \u7684\u65B9\u6CD5\u91CC\uFF0C\u9700\u8981\u628A\u65CB\u8F6C\u91CF\u7B97\u8FDB\u53BB\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4F4D\u79FB\u77E9\u9635</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> px<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> py <span class="token punctuation">}</span> <span class="token operator">=</span> offset
    <span class="token keyword">const</span> moveMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> px<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> py<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u65CB\u8F6C\u77E9\u9635</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>s<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> rotateMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
        c<span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u6A21\u578B\u77E9\u9635</span>
    <span class="token keyword">return</span> mb<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>moveMatrix<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>rotateMatrix<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ol start="3"><li>\u9F20\u6807\u62AC\u8D77</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">!==</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>change<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            change <span class="token operator">=</span> <span class="token boolean">false</span>
            offset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            angle <span class="token operator">=</span> <span class="token number">0</span>
            canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token string">&#39;default&#39;</span>
            <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u56FE\u7247\u65CB\u8F6C\u7684\u6574\u4F53\u903B\u8F91\u5C31\u662F\u8FD9\u6837\uFF0C\u5F53\u524D\u56FE\u7247\u9ED8\u8BA4\u662F\u57FA\u4E8E\u56FE\u7247\u4E2D\u5FC3\u81EA\u7531\u65CB\u8F6C\u3002<br> \u6211\u4EEC\u53EF\u4EE5\u518D\u4E3A\u5176\u505A\u4E00\u4E0B\u4F18\u5316\uFF1A\u6309\u4F4Falt\u952E\uFF0C\u57FA\u4E8E\u9F20\u6807\u5BF9\u9762\u7684\u8282\u70B9\u53D8\u6362\u3002</p><ol start="4"><li>alt \u952E\u6539\u53D8\u57FA\u70B9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5F53\u524D\u6309\u4E0B\u7684\u952E</span>
<span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u5F53\u524D\u8282\u70B9\u7D22\u5F15</span>
<span class="token keyword">let</span> nodeInd <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// \u8282\u70B9\u5BF9\u9762\u7684\u70B9</span>
<span class="token keyword">const</span> opposite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// \u76D1\u542Ccanvas\u7684\u9F20\u6807\u6309\u4E0B\u4E8B\u4EF6</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u9F20\u6807\u62D6\u62FD\u7684\u8D77\u59CB\u4F4DdragStart\uFF0C\u6B64\u4F4D\u7F6E\u4E3A\u4E16\u754C\u5750\u6807\u4F4D</span>
    <span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6\u53D8\u6362\u72B6\u6001\uFF0C\u5982\u679C\u9F20\u6807\u5728\u56FE\u50CF\u91CC\uFF0C\u90A3\u4E48\u53D8\u6362\u72B6\u6001\u5C31\u662F&#39;drag&#39;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInImg</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state <span class="token operator">=</span> <span class="token string">&#39;drag&#39;</span>
        dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> <span class="token function">selectNode</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
            state <span class="token operator">=</span> node<span class="token punctuation">.</span>state
            nodeInd <span class="token operator">=</span> node<span class="token punctuation">.</span>index
            <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            start2Orign<span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">,</span> orign<span class="token punctuation">)</span>
            startAng <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>start2Orign<span class="token punctuation">.</span>y<span class="token punctuation">,</span> start2Orign<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keydown&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> keyCode <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>keyCode<span class="token punctuation">)</span>
    <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> keyCode <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>keyCode<span class="token punctuation">)</span>
    <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* \u8BBE\u7F6E\u57FA\u70B9 */</span>
<span class="token keyword">function</span> <span class="token function">setOrign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">getOppo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    orign<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    mi<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    mb<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u5BF9\u9762\u7684\u70B9</span>
<span class="token keyword">function</span> <span class="token function">getOppo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> i2 <span class="token operator">=</span> opposite<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nodeInd<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i2<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u4E2D\u70B9</span>
<span class="token keyword">function</span> <span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>
        x1 <span class="token operator">+</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
        y1 <span class="token operator">+</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><ol start="5"><li>\u9ED8\u8BA4\u6309\u7167\u7279\u5B9A\u5F27\u5EA6\u65CB\u8F6C\u3002\u6309\u4F4Fshift\u952E\u65F6\uFF0C\u518D\u81EA\u7531\u65CB\u8F6C\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6BCF\u6B21\u65CB\u8F6C\u7684\u5F27\u5EA6</span>
<span class="token keyword">let</span> angSpace <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">12</span>
<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> endAng <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>end2Orign<span class="token punctuation">.</span>y<span class="token punctuation">,</span> end2Orign<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
    angle <span class="token operator">=</span> endAng <span class="token operator">-</span> startAng
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keys<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>angle <span class="token operator">/</span> angSpace<span class="token punctuation">)</span> <span class="token operator">*</span> angSpace
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_3-5\u7F29\u653E\u56FE\u7247" tabindex="-1"><a class="header-anchor" href="#_3-5\u7F29\u653E\u56FE\u7247" aria-hidden="true">#</a> 3.5\u7F29\u653E\u56FE\u7247</h4><ol><li>\u5EFA\u7ACB\u5FC5\u5907\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u7F29\u653E\u91CF</span>
<span class="token keyword">let</span> zoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>\u9F20\u6807\u79FB\u52A8</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    \u2026\u2026
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            \u2026\u2026
            <span class="token keyword">case</span> <span class="token string">&#39;scale&#39;</span><span class="token operator">:</span>
                <span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* \u7F29\u653E */</span>
<span class="token keyword">function</span> <span class="token function">scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sx <span class="token operator">=</span> end2Orign<span class="token punctuation">.</span>x <span class="token operator">/</span> start2Orign<span class="token punctuation">.</span>x
    <span class="token keyword">const</span> sy <span class="token operator">=</span> end2Orign<span class="token punctuation">.</span>y <span class="token operator">/</span> start2Orign<span class="token punctuation">.</span>y
    <span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u81EA\u7531\u7F29\u653E</span>
        zoom<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>sx<span class="token punctuation">,</span> sy<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u7B49\u6BD4\u7F29\u653E</span>
        <span class="token keyword">const</span> ratio <span class="token operator">=</span> end2Orign<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> start2Orign<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        zoom<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
            ratio <span class="token operator">*</span> sx <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>sx<span class="token punctuation">)</span><span class="token punctuation">,</span>
            ratio <span class="token operator">*</span> sy <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>sy<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="3"><li>\u9009\u62E9\u8282\u70B9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">selectNode</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            node <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> i<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">&#39;scale&#39;</span> <span class="token punctuation">}</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            node <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">index</span><span class="token operator">:</span> i<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">&#39;rotate&#39;</span> <span class="token punctuation">}</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> node
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="4"><li>\u9F20\u6807\u62AC\u8D77</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mouseup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    \u2026\u2026
    zoom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    \u2026\u2026
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>\u6A21\u578B\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4F4D\u79FB\u77E9\u9635</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> px<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> py <span class="token punctuation">}</span> <span class="token operator">=</span> offset
    <span class="token keyword">const</span> moveMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> px<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> py<span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u65CB\u8F6C\u77E9\u9635</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>s<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> rotateMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
        c<span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u7F29\u653E\u77E9\u9635</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> sx<span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> sy <span class="token punctuation">}</span> <span class="token operator">=</span> zoom
    <span class="token keyword">const</span> scaleMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
        sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u6A21\u578B\u77E9\u9635</span>
    <span class="token keyword">return</span> mb<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>moveMatrix<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>rotateMatrix<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>scaleMatrix<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u4E0A\u9762\u7684\u4F4D\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u77E9\u9635\uFF0C\u6211\u662F\u6545\u610F\u5C55\u5F00\u7684\uFF0C\u4EE5\u65B9\u4FBF\u5927\u5BB6\u7406\u89E3\u77E9\u9635\u53D8\u6362\u7684\u672C\u8D28\u3002<br> \u5176\u5B9E\u6211\u4EEC\u4E5F\u53EF\u4EE5\u4F7F\u7528Matrix4 \u5BF9\u8C61\u5185\u7F6E\u7684\u65B9\u6CD5\u8FDB\u884C\u53D8\u6362\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> mb<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span>
                position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0</span>
            <span class="token punctuation">)</span>
    	<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
        	<span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span>
    	<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>zoom<span class="token punctuation">.</span>x<span class="token punctuation">,</span> zoom<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mi<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u5230\u76EE\u524D\u4E3A\u6B62\uFF0C\u7F29\u653E\u7684\u57FA\u672C\u6D41\u7A0B\u5C31\u641E\u5B9A\u4E86\u3002</p><p>\u7136\u800C\uFF0C\u955C\u50CF\u7F29\u653E\u65F6\uFF0C\u8FD8\u4F1A\u5E26\u6765\u4E00\u4E2A\u5751\uFF0C\u6B64\u5751\u4F1A\u5F71\u54CD\u56FE\u7247\u7684\u9009\u62E9\u3002</p><h4 id="_3-6\u955C\u50CF\u7F29\u653E\u65F6\u7684\u56FE\u7247\u9009\u62E9" tabindex="-1"><a class="header-anchor" href="#_3-6\u955C\u50CF\u7F29\u653E\u65F6\u7684\u56FE\u7247\u9009\u62E9" aria-hidden="true">#</a> 3.6\u955C\u50CF\u7F29\u653E\u65F6\u7684\u56FE\u7247\u9009\u62E9</h4><p>\u4E14\u770B\u4E0B\u56FE\uFF1A<br><img src="`+j+`" alt=""></p><p>\u4E4B\u524D\u662F\u901A\u8FC7\u4E0B\u9762\u7684\u65B9\u6CD5\u5224\u65AD\u70B9\u4F4D\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span><span class="token parameter">p0<span class="token punctuation">,</span> triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> bool<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> bx<span class="token punctuation">,</span> by<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p0<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p0<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
    p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p0<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
    p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p0<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ax <span class="token operator">*</span> by <span class="token operator">-</span> bx <span class="token operator">*</span> ay<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u4E0A\u9762\u7684 cross([p0, p1, p2]) &lt; 0 \u662F\u9488\u5BF9\u9006\u65F6\u9488\u7ED8\u56FE\u7684\u60C5\u51B5\u6765\u5224\u65AD\u7684\u3002</p><p>\u82E5\u662F\u987A\u65F6\u9488\u7ED8\u56FE\uFF0C\u70B9\u4F4D\u5728\u4E09\u89D2\u5F62\u4E2D\u9700\u8981\u6EE1\u8DB3\u7684\u6761\u4EF6\u5C31\u5E94\u8BE5\u662Fcross([p0, p1, p2]) &gt; 0<br> \u56E0\u6B64\u6211\u4EEC\u9700\u8981\u5224\u65AD\u4E00\u4E0B\uFF0C\u8FD9\u4E2A\u56FE\u7247\u662F\u9006\u65F6\u9488\u753B\u7684\uFF0C\u8FD8\u662F\u987A\u65F6\u9488\u753B\u7684\u3002</p><p>\u4E4B\u524D\u6211\u4EEC\u8BF4\u8FC7\u4E00\u4E2A\u539F\u7406\uFF1A\u53C9\u4E58\u662F\u6709\u65B9\u5411\u7684\u3002<br> \u901A\u8FC7\u4E0A\u9762\u7684\u539F\u7406\u53EF\u4EE5\u77E5\u9053\uFF1A\u5728\u4E8C\u7EF4\u591A\u8FB9\u5F62\u4E2D\uFF0C\u901A\u8FC7\u53C9\u4E58\u6C42\u51FA\u7684\u591A\u8FB9\u5F62\u7684\u9762\u79EF\u662F\u6709\u6B63\u8D1F\u4E4B\u5206\u7684\u3002<br> \u901A\u8FC7\u8FD9\u4E2A\u591A\u8FB9\u5F62\u7684\u9762\u79EF\u7684\u6B63\u8D1F\uFF0C\u4FBF\u53EF\u4EE5\u5224\u65AD\u56FE\u7247\u662F\u9006\u65F6\u9488\u753B\u7684\uFF0C\u8FD8\u662F\u987A\u65F6\u9488\u753B\u7684\u3002<br> \u5BF9\u4E8E\u591A\u8FB9\u5F62\u6C42\u9762\u79EF\u7684\u5177\u4F53\u63A8\u5BFC\u8FC7\u7A0B\uFF0C\u6211\u5C31\u4E0D\u7EC6\u8BF4\u4E86\uFF0C\u56E0\u4E3A\u7EC6\u8BF4\u6211\u81F3\u5C11\u5F97\u8BF4\u4E00\u4E2A\u5C0F\u65F6\u3002<br> \u5927\u5BB6\u5148\u81EA\u5DF1\u7406\u89E3\uFF0C\u8981\u662F\u7406\u89E3\u4E0D\u4E86\uFF0C\u6211\u518D\u5355\u72EC\u7ED9\u5927\u5BB6\u5F15\u4E00\u7AE0\u51FA\u6765\u3002</p><p>\u63A5\u4E0B\u6765\u54B1\u4EEC\u901A\u8FC7\u4EE3\u7801\u8BF4\u4E00\u4E0B\u5176\u5177\u4F53\u5B9E\u73B0\u8FC7\u7A0B\u3002</p><ol><li>\u5148\u5C01\u88C5\u4E00\u4E2A\u6309\u9006\u65F6\u9488\u83B7\u53D6\u56FE\u7247\u4E2D\u4E24\u4E2A\u4E09\u89D2\u5F62\u7684\u65B9\u6CD5\uFF0C\u4EE5\u4FBF\u590D\u7528</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getTriangles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> vertices<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>\u518D\u5C01\u88C5\u4E00\u4E2A\u83B7\u53D6\u9762\u79EF\u7684\u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getTriangles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">cross</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">cross</span><span class="token punctuation">(</span>t2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u4E0A\u9762\u6240\u6C42\u7684\u9762\u79EF\u5B9E\u9645\u4E0A\u662F\u56FE\u7247\u9762\u79EF\u7684\u4E24\u500D\uFF0C\u4E0D\u8FC7\u8FD9\u90FD\u65E0\u6240\u8C13\uFF0C\u6211\u53EA\u9700\u8981\u9762\u79EF\u7684\u6B63\u8D1F\u3002</p><ol start="3"><li>\u58F0\u660E\u9762\u79EF\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u9762\u79EF</span>
<span class="token keyword">let</span> area <span class="token operator">=</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>\u5728\u5224\u65AD\u70B9\u4F4D\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\u7684\u65F6\u5019\uFF0C\u4E58\u4E0A\u9762\u79EF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span><span class="token parameter">p0<span class="token punctuation">,</span> triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>area <span class="token operator">*</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bool<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="5"><li>\u9762\u79EF\u9700\u8981\u968F\u9876\u70B9\u6570\u636E\u7684\u683C\u5F0F\u5316\u540C\u6B65\u66F4\u65B0</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mm<span class="token punctuation">)</span>
        vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>x
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>
    area <span class="token operator">=</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    geo<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> vertices
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    geoOut<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token function">getVerticesOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_4-\u4FDD\u7559\u521D\u59CB\u70B9\u4F4D" tabindex="-1"><a class="header-anchor" href="#_4-\u4FDD\u7559\u521D\u59CB\u70B9\u4F4D" aria-hidden="true">#</a> 4.\u4FDD\u7559\u521D\u59CB\u70B9\u4F4D</h3><p>\u6211\u4E4B\u524D\u5728\u53D8\u6362\u56FE\u7247\u65F6\uFF0C\u5176\u5B9E\u8FD8\u6709\u4E00\u5904\u7455\u75B5\uFF0C\u90A3\u5C31\u662F\u65E0\u6CD5\u4FDD\u7559\u521D\u59CB\u70B9\u4F4D\u3002</p><p>\u521D\u59CB\u70B9\u4F4D\u4E0E\u6D6E\u70B9\u6570\u8FDB\u884C\u591A\u6B21\u8FD0\u7B97\uFF0C\u5BB9\u6613\u5F15\u8D77\u6570\u636E\u5931\u771F\u3002</p><p>\u5F53\u7136\uFF0C\u82E5\u53D8\u6362\u6B21\u6570\u4E0D\u591A\uFF0C\u8089\u773C\u662F\u5F88\u96BE\u53D1\u73B0\u5931\u771F\u7684\u3002</p><p>\u5BF9\u4E8E\u4E0A\u9762\u7684\u95EE\u9898\uFF0C\u6211\u4EEC\u662F\u53EF\u4EE5\u901A\u8FC7\u4FDD\u7559\u521D\u59CB\u70B9\u4F4D\u6765\u89E3\u51B3\u7684\u3002</p><p>\u63A5\u4E0B\u6765\u54B1\u4EEC\u8BF4\u4E00\u4E0B\u5176\u5B9E\u73B0\u601D\u8DEF\u3002</p><h4 id="_4-1\u5B9E\u73B0\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#_4-1\u5B9E\u73B0\u601D\u8DEF" aria-hidden="true">#</a> 4.1\u5B9E\u73B0\u601D\u8DEF</h4><p><code>\u5DF2\u77E5</code>\uFF1A\u56FE\u7247img</p><p><code>\u6C42</code>\uFF1A\u57FA\u4E8E\u56FE\u7247\u7684\u5DE6\u4E0A\u89D2\u70B9P\u53D8\u6362\u56FE\u7247\uFF0C\u4E14\u4FDD\u7559\u56FE\u7247\u521D\u59CB\u70B9\u4F4D\u7684\u65B9\u6CD5</p><p><code>\u89E3</code>\uFF1A</p><ol><li>\u642D\u5EFA\u77E9\u9635</li></ol><ul><li>\u628A\u56FE\u7247\u88C5\u753B\u6846\u91CC\uFF0C\u753B\u6846\u7684\u672C\u5730\u77E9\u9635\u662Fmh</li><li>\u628A\u753B\u6846\u88C5\u996D\u76D2\u91CC\uFF0C\u996D\u76D2\u7684\u672C\u5730\u77E9\u9635\u662Fmi</li><li>\u628A\u996D\u76D2\u88C5\u51B0\u7BB1\u91CC\uFF0C\u51B0\u7BB1\u7684\u672C\u5730\u77E9\u9635\u662Fmb</li></ul><ol start="2"><li>\u8BBE\u7F6E\u53D8\u6362\u57FA\u70B9\uFF1A</li></ol><ul><li>mi-P</li><li>mb+P</li></ul><ol start="3"><li><p>\u53D8\u6362\u51B0\u7BB1\u7684\u672C\u5730\u77E9\u9635mb</p></li><li><p>\u5728\u7B2C\u4E8C\u6B21\u53D8\u6362\u65F6\uFF0C\u5C06\u6240\u6709\u53D8\u6362\u6570\u636E\u5408\u5165\u753B\u6846mh\u4E2D</p></li><li><p>\u6E32\u67D3\u65F6\u7684\u6A21\u578B\u77E9\u9635\uFF1A</p></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mb<span class="token operator">*</span>mi<span class="token operator">*</span>mh
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_4-2\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_4-2\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 4.2\u4EE3\u7801\u5B9E\u73B0</h4><p>\u5728\u4E4B\u524D\u4EE3\u7801\u7684\u57FA\u7840\u4E0A\u8FDB\u884C\u4FEE\u6539\u3002</p><ol><li>\u58F0\u660E\u5FC5\u5907\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u56FE\u7247\u521D\u59CB\u9876\u70B9</span>
<span class="token keyword">const</span> verticesBasic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">,</span>
    <span class="token operator">-</span>hw<span class="token punctuation">,</span> <span class="token operator">-</span>hh<span class="token punctuation">,</span>
    hw<span class="token punctuation">,</span> hh<span class="token punctuation">,</span>
    hw<span class="token punctuation">,</span> <span class="token operator">-</span>hh<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// \u56FE\u7247\u9876\u70B9\u7684\u4E16\u754C\u4F4D</span>
<span class="token keyword">const</span> vertices <span class="token operator">=</span> Float32Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>verticesBasic<span class="token punctuation">)</span>
<span class="token comment">// \u753B\u6846\u672C\u5730\u77E9\u9635</span>
<span class="token keyword">const</span> mh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="2"><li>\u5C06\u56FE\u7247\u548C\u56FE\u7247\u5916\u6846\u7684\u9876\u70B9\u6570\u636E\u5199\u6B7B\uFF0C\u4E4B\u540E\u5728\u53D8\u6362\u7684\u65F6\u5019\u65E0\u9700\u4FEE\u6539\u521D\u59CB\u70B9\u4F4D\uFF0C\u76F4\u63A5\u4FEE\u6539\u6A21\u578B\u77E9\u9635\u5373\u53EF\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>geoOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                verticesBasic<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> verticesBasic<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                verticesBasic<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> verticesBasic<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                verticesBasic<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> verticesBasic<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                verticesBasic<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> verticesBasic<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u2026\u2026
geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">array</span><span class="token operator">:</span> verticesBasic<span class="token punctuation">,</span>
            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol start="3"><li>\u5728\u683C\u5F0F\u5316\u9876\u70B9\u6570\u636E\u7684\u65B9\u6CD5\u91CC\uFF0C\u5DF2\u7ECF\u65E0\u9700\u66F4\u65B0\u51E0\u4F55\u4F53\u7684\u9876\u70B9\u6570\u636E\uFF0C\u53EA\u9700\u8981\u83B7\u53D6\u56FE\u7247\u9876\u70B9\u7684\u4E16\u754C\u4F4D\u5373\u53EF\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">formatVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mh<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>mm<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mh<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> verticesBasic<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>verticesBasic<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> verticesBasic<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mh<span class="token punctuation">)</span>
        vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>x
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>
    area <span class="token operator">=</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>\u5728\u6E32\u67D3\u65B9\u6CD5\u91CC\u8BA1\u7B97\u6A21\u578B\u77E9\u9635\u7684\u65F6\u5019\uFF0C\u518D\u4E58\u4E0A\u753B\u6846\u7684\u672C\u5730\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mm<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token function">getModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> elements <span class="token punctuation">}</span> <span class="token operator">=</span> mm<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mh<span class="token punctuation">)</span>
    mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> elements
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    matOut<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> elements
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scence<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u5173\u4E8E\u9F20\u6807\u5BF9\u56FE\u50CF\u7684\u53D8\u6362\u6211\u4EEC\u5C31\u8BF4\u5230\u8FD9\u3002</p><p>\u867D\u7136\u6211\u4EEC\u5728\u8FD9\u91CC\u662F\u62FF\u4E8C\u7EF4\u56FE\u7247\u4E3E\u7684\u4F8B\u5B50\uFF0C\u7136\u800C\u5176\u5B9E\u73B0\u601D\u60F3\u90FD\u662F\u6309\u4E09\u7EF4\u8D70\u7684\uFF0C\u5C31\u6BD4\u5982\u6A21\u578B\u77E9\u9635\u7684\u8FD0\u7B97\u3002</p><p>\u901A\u8FC7\u4E0A\u9762\u7684\u4F8B\u5B50\uFF0C\u5927\u5BB6\u53EF\u4EE5\u77E5\u9053\u4FEE\u6539\u6A21\u578B\u7684\u4E24\u79CD\u65B9\u5F0F\uFF1A</p><ul><li>\u76F4\u63A5\u4FEE\u6539\u6784\u6210\u6A21\u578B\u7684\u521D\u59CB\u70B9\u4F4D</li><li>\u4FEE\u6539\u6A21\u578B\u77E9\u9635</li></ul><p>\u5F53\u7136\uFF0C\u4E0A\u9762\u7684\u64CD\u4F5C\u6700\u7EC8\u90FD\u662F\u5728\u79FB\u52A8\u6A21\u578B\u7684\u521D\u59CB\u70B9\u4F4D\uFF0C\u53EA\u662F\u5176\u5E94\u7528\u573A\u666F\u4F1A\u6709\u6240\u4E0D\u540C\u3002<br> \u524D\u8005\u9002\u5408\u5BF9\u6A21\u578B\u7684\u5C40\u90E8\u9876\u70B9\u8FDB\u884C\u4FEE\u6539\uFF0C\u5C31\u6BD4\u5982\u5BF9\u56FE\u7247\u7684\u67D0\u4E00\u4E2A\u9876\u70B9\u8FDB\u884C\u62C9\u626F\u3002<br> \u540E\u8005\u9002\u5408\u5BF9\u6A21\u578B\u7684\u6240\u6709\u9876\u70B9\u7EDF\u4E00\u53D8\u6362\u3002</p><p>\u5927\u5BB6\u7406\u89E3\u4E86\u8FD9\u4E24\u79CD\u65B9\u5F0F\u7684\u5DEE\u5F02\uFF0C\u4E5F\u5C31\u77E5\u9053\u4E86\u5728three.js \u91CC\u4EC0\u4E48\u65F6\u5019\u8981\u4FEE\u6539BufferGeometry\u5BF9\u8C61\u91CC\u7684\u9876\u70B9\uFF0C\u4EC0\u4E48\u65F6\u5019\u4FEE\u6539Object3D\u5BF9\u8C61\u7684\u672C\u5730\u77E9\u9635\u3002</p><h3 id="\u6269\u5C55-\u5C55\u671B\u6D4F\u89C8\u56683d\u56FE\u5F62\u7684\u65B9\u5411" tabindex="-1"><a class="header-anchor" href="#\u6269\u5C55-\u5C55\u671B\u6D4F\u89C8\u56683d\u56FE\u5F62\u7684\u65B9\u5411" aria-hidden="true">#</a> \u6269\u5C55\uFF1A\u5C55\u671B\u6D4F\u89C8\u56683D\u56FE\u5F62\u7684\u65B9\u5411</h3><p>\u81EA2000\u5E74\u540E\uFF0C\u968F\u7740Direct3D \u7684\u65E5\u76CA\u58EE\u5927\uFF0COpenGL \u5DF2\u7ECF\u9010\u6E10\u5931\u53BB\u4E86\u66FE\u7ECF\u7684\u8F89\u714C\uFF0C\u867D\u7136 2009 \u5E74\u540E\uFF0COpenGL \u9646\u7EED\u4ECE3.1\u53D1\u5E03\u5230\u4E86\u73B0\u5728\u76844.5\u3002<br> 2011\u5E74\uFF0C\u57FA\u4E8EOpenGL \u6807\u51C6\u53D1\u5E03\u7684WebGL\u6210\u4E3A\u4E86OpenGL \u7684\u4E00\u5927\u4EAE\u70B9\uFF0CWebGL\u81F3\u4ECA\u5728\u6D4F\u89C8\u56683d\u56FE\u5F62\u59CB\u7EC8\u662F\u4E00\u5BB6\u72EC\u5927\uFF0C\u4E0D\u53EF\u66FF\u4EE3\u3002<br> \u7136\u800C\uFF0C\u6210\u4E5F\u8427\u4F55\u8D25\u4E5F\u8427\u4F55\uFF0C WebGL\u7684\u53D1\u5C55\u53D7\u5236\u4E8EOpenGL \u7684\u5F88\u591A\u5386\u53F2\u9057\u7559\u95EE\u9898\u3002<br> \u968F\u7740webGPU\u7684\u51FA\u73B0\uFF0CWebGL\u5728\u672A\u6765\u88ABwebGPU\u66FF\u4EE3\u5DF2\u7ECF\u6210\u4E3A\u4E86\u5FC5\u7136\u3002</p><p>\u56E0\u6B64\uFF0C\u6211\u81EA\u5DF1\u505A\u4E2A\u7B80\u5355\u9884\u6D4B\uFF1A</p><ul><li>\u81F3\u5C115\u5E74\u5185\uFF0CWebGL\u4E0D\u4F1A\u88ABwebGPU\u66FF\u4EE3\u3002</li><li>\u5C31\u7B97\u6240\u6709\u6D4F\u89C8\u5668\u90FD\u517C\u5BB9webGPU\u4E86\uFF0CWebGL \u4E5F\u4E0D\u4F1A\u5728\u77ED\u671F\u5185\u88AB\u6D4F\u89C8\u5668\u5C4F\u853D\u3002</li><li>webGPU \u751F\u6001\u7684\u5F62\u6210\u9700\u8981\u5F88\u957F\u7684\u65F6\u95F4\uFF0C\u4ECEwebgl\u81F3\u4ECA10\u5E74\u7684\u6162\u70ED\u8FC7\u7A0B\uFF0C\u80FD\u770B\u51FA\u4E00\u4E8C\u3002</li></ul><p>\u57FA\u4E8EWebGL\u7684\u73B0\u72B6\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u66F4\u591A\u7684\u91CD\u5FC3\u653E\u5728\u56FE\u5F62\u5B66\uFF0C\u56E0\u4E3A\u5F53\u6211\u4EEC\u56FE\u5F62\u5B66\u624E\u5B9E\u4E86\uFF0C\u65E0\u8BBA\u8BED\u8A00\u89C4\u5219\u5982\u4F55\u53BB\u53D8\uFF0C\u6211\u4EEC\u90FD\u53EF\u4EE5\u7A33\u4F4F\u9635\u811A\uFF0C\u5230\u65F6\u65E0\u975E\u5C31\u662F\u518D\u5B66\u4E00\u904Dapi\u3002</p><p>\u5982\u679C\u5927\u5BB6\u5728\u8003\u8651\u4E3A\u4EE5\u540E\u7684\u4E2D\u5E74\u5371\u673A\u62BC\u6CE8\uFF0C\u5728\u6211\u770B\u6765\uFF0C\u56FE\u5F62\u5B66\u5C31\u662F\u4E00\u4E2A\u4E0D\u9519\u7684\u9009\u62E9\uFF0C\u5176\u6B21\u624D\u662Fthree.js\u3001Babylon.js \u4E4B\u7C7B\u7684\u6E90\u7801\uFF0C\u6700\u540E\u5728\u65E5\u5E38\u751F\u6D3B\u4E2D\u518D\u4E00\u70B9\u70B9\u7684\u7EC3\u4E60\u548C\u79EF\u7D2F\u4E00\u4E0B\u827A\u672F\u548C\u5BA1\u7F8E\u80FD\u529B\u3002</p><h2 id="\u5341\u4E00-\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E00-\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61" aria-hidden="true">#</a> \u5341\u4E00.\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61</h2><p><code>\u6CE8</code>\uFF1A\u8FD9\u91CC\u6240\u8BF4\u7684\u4E8C\u7EF4\u56FE\u5F62\u548C\u4E09\u7EF4\u56FE\u5F62\u90FD\u662F\u7531\u4E09\u89D2\u7F51\u6784\u6210\u7684\u3002</p><h3 id="_1-\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61\u7684\u57FA\u672C\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_1-\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61\u7684\u57FA\u672C\u539F\u7406" aria-hidden="true">#</a> 1.\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61\u7684\u57FA\u672C\u539F\u7406</h3><p>\u9996\u5148\u4E86\u89E3\u51E0\u4E2A\u6982\u5FF5\uFF1A</p><ul><li>\u4ECE\u76F8\u673A\u89C6\u70B9\u4F4D\u5C04\u5411\u9F20\u6807\u70B9\u53EF\u4EE5\u505A\u4E00\u6761\u5C04\u7EBF\u3002</li><li>\u6784\u6210\u4E09\u89D2\u5F62\u7684\u4E09\u4E2A\u9876\u70B9\u53EF\u4EE5\u786E\u5B9A\u4E00\u4E2A\u5E73\u9762\u3002</li><li>\u5728\u7531\u4E09\u89D2\u7F51\u6784\u6210\u7684\u4E09\u7EF4\u6A21\u578B\u4E2D\uFF0C\u9009\u4E2D\u4E00\u4E2A\u4E09\u89D2\u5F62\uFF0C\u5C31\u662F\u9009\u4E2D\u4E86\u4E09\u7EF4\u6A21\u578B\u3002</li></ul><p>\u56E0\u6B64\uFF0C\u8981\u5224\u65AD\u9F20\u6807\u662F\u5426\u9009\u6B63\u4E86\u6A21\u578B\uFF0C\u5C31\u5F97\u6309\u4EE5\u4E0B\u51E0\u6B65\u8D70\uFF1A</p><ol><li>\u83B7\u53D6\u4ECE\u76F8\u673A\u89C6\u70B9\u4F4D\u5C04\u5411\u9F20\u6807\u70B9\u7684\u5C04\u7EBFray\u3002</li><li>\u83B7\u53D6\u5C04\u7EBF ray \u4E0E\u4E09\u89D2\u5F62\u6240\u5728\u7684\u5E73\u9762\u7684\u4EA4\u70B9M\u3002</li><li>\u5224\u65AD\u4EA4\u70B9 M \u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\u3002</li></ol><h4 id="_1-1\u5C04\u7EBF" tabindex="-1"><a class="header-anchor" href="#_1-1\u5C04\u7EBF" aria-hidden="true">#</a> 1.1\u5C04\u7EBF</h4><p>\u9996\u5148\u58F0\u660E\uFF0C\u5C04\u7EBF\u548C\u5411\u91CF\u4E0D\u662F\u4E00\u56DE\u4E8B\uFF0C\u867D\u7136\u5B83\u4EEC\u90FD\u6709\u65B9\u5411\u3002<br> \u5411\u91CF\u662F\u6709\u65B9\u5411\uFF0C\u6709\u957F\u5EA6\u7684\u91CF\u3002</p><p>\u5728\u7528\u5750\u6807\u4F4D(x, y, z)\u8868\u793A\u7684\u5411\u91CF\u4E2D\uFF0C\u5176\u8D77\u70B9\u5C31\u662F\u539F\u70B9\u3002 \u6BD4\u5982\u5DF2\u77E5A\u3001B\u4E24\u70B9\uFF0C\u90A3\u4E48\u5411\u91CFAB=B-A\uFF0C\u5176\u56FE\u50CF\u6027\u8D28\u5C31\u662FA\u8FD9\u4E2A\u8D77\u70B9\u6700\u7EC8\u4F1A\u88AB\u5BF9\u9F50\u5230\u539F\u70B9\u4E0A\u3002</p><p>\u800C\u5C04\u7EBF\u662F\u6709\u65B9\u5411\uFF0C\u957F\u5EA6\u65E0\u9650\uFF0C\u539F\u70B9\u53EF\u53D8\u7684\u7EBF\u3002<br> \u5C04\u7EBF\uFF08ray\uFF09\uFF0C\u662F\u6307\u7531\u7EBF\u6BB5\u7684\u4E00\u7AEF\u65E0\u9650\u5EF6\u957F\u6240\u5F62\u6210\u7684\u7EBF\u3002\u5C04\u7EBF\u4EC5\u6709\u4E00\u4E2A\u7AEF\u70B9\uFF0C\u65E0\u6CD5\u6D4B\u91CF\u957F\u5EA6\u3002</p><p>\u5176\u56FE\u50CF\u5982\u4E0B\uFF1A<br><img src="`+_+'" alt=""></p><p>\u53EF\u4EE5\u60F3\u8C61\u624B\u7535\u7B52\u53D1\u51FA\u7684\u5149\u7EBF\uFF1A</p><ul><li>\u624B\u7535\u7B52\u7684\u4F4D\u7F6E\u5C31\u662F\u539F\u70B9O\uFF0C\u4E5F\u662F\u5149\u6E90\u7684\u4F4D\u7F6E\uFF0C\u8FD9\u4E2A\u4F4D\u7F6E\u662F\u53EF\u53D8\u7684\u3002</li><li>\u624B\u7535\u7B52\u6240\u7167\u5C04\u7684\u65B9\u5411\u5C31\u662F\u5C04\u7EBF\u7684\u65B9\u5411v\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8F6C\u52A8\u624B\u7535\u7B52\uFF0C\u6539\u53D8\u5C04\u7EBF\u7684\u65B9\u5411\u3002</li></ul><p>\u82E5\u5728\u5C04\u7EBF\u4E0A\u57FA\u4E8E\u67D0\u4E2A\u57FA\u5E95\u505A\u523B\u5EA6\uFF0C\u90A3\u4E48\uFF1A</p><ul><li>\u5728 V \u65B9\u5411\u4E0A\u7684\u523B\u5EA6\u5927\u5C0F\u548C\u523B\u5EA6\u5230\u539F\u70B9\u7684\u8DDD\u79BB\u6210\u6B63\u6BD4\u3002</li><li>\u5728 V \u7684\u53CD\u65B9\u5411\u4E0A\u7684\u523B\u5EA6\u5927\u5C0F\u548C\u523B\u5EA6\u5230\u539F\u70B9\u7684\u8DDD\u79BB\u6210\u53CD\u6BD4\u3002</li></ul><p>\u901A\u8FC7\u5C04\u7EBF\u7684\u7279\u6027\uFF0C\u53EF\u4EE5\u60F3\u5230\u9F50\u6B21\u5750\u6807\u7CFB\u91CC\u7684x\u3001y\u3001z\u8F74\u5C31\u662F\u5C04\u7EBF\u3002</p><p>\u5728three.js \u91CC\u5C31\u6709\u4E00\u4E2A\u5C04\u7EBF\u5BF9\u8C61 Ray ( origin : Vector3, direction : Vector3 )</p><ul><li>origin \u5C04\u7EBF\u539F\u70B9</li><li>direction \u5C04\u7EBF\u65B9\u5411\u3002</li></ul><h4 id="_1-2\u5E73\u9762" tabindex="-1"><a class="header-anchor" href="#_1-2\u5E73\u9762" aria-hidden="true">#</a> 1.2\u5E73\u9762</h4><p>\u786E\u5B9A\u4E00\u4E2A\u5E73\u9762\u7684\u51E0\u79CD\u5E38\u89C1\u65B9\u6CD5\uFF1A</p><ol><li>\u4E0D\u5171\u7EBF\u7684\u4E09\u70B9\u786E\u5B9A\u4E00\u4E2A\u5E73\u9762</li></ol><p><img src="'+P+'" alt=""></p><ol start="2"><li>\u5E73\u9762\u6CD5\u7EBF+\u5E73\u9762\u5185\u4EFB\u610F\u4E00\u70B9</li></ol><p><img src="'+q+'" alt=""></p><ol start="3"><li>\u5E73\u9762\u6CD5\u7EBF+\u5E73\u9762\u5230\u539F\u70B9\u7684\u6709\u5411\u8DDD\u79BB</li></ol><p><img src="'+M+'" alt=""></p><p>\u5728three.js \u91CC\u5C31\u6709\u4E00\u4E2A\u5E73\u9762\u5BF9\u8C61Plane( normal : Vector3, constant : Float)\uFF0C\u5176\u6784\u9020\u53C2\u6570\u4E2D\uFF1A</p><ul><li>normal \u5C31\u662F\u4E0A\u9762\u7684\u5E73\u9762\u6CD5\u5411\u91CF\uFF0C\u7B80\u79F0\u6CD5\u7EBF</li><li>constant \u5219\u662F\u5E73\u9762\u5230\u539F\u70B9\u7684\u6709\u5411\u8DDD\u79BB</li></ul><p>\u4ECE\u6B64\u4E4B\u5916\uFF0CPlane\u4E5F\u63D0\u4F9B\u4E86\u901A\u8FC7\u524D\u4E24\u79CD\u65B9\u5F0F\u5EFA\u7ACB\u5E73\u9762\u7684\u65B9\u6CD5\uFF1A</p><ul><li>setFromCoplanarPoints ( a : Vector3, b : Vector3, c : Vector3 ) \u4E0D\u5171\u7EBF\u7684\u4E09\u70B9\u786E\u5B9A\u5E73\u9762</li><li>setFromNormalAndCoplanarPoint ( normal : Vector3, point : Vector3 ) \u5E73\u9762\u6CD5\u7EBF+\u5E73\u9762\u5185\u4EFB\u610F\u4E00\u70B9\u786E\u5B9A\u5E73\u9762</li></ul><h3 id="_2-\u5C04\u7EBF\u4E0E\u5E73\u9762\u7684\u4EA4\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-\u5C04\u7EBF\u4E0E\u5E73\u9762\u7684\u4EA4\u70B9" aria-hidden="true">#</a> 2.\u5C04\u7EBF\u4E0E\u5E73\u9762\u7684\u4EA4\u70B9</h3><h4 id="_2-1\u6570\u5B66\u89E3" tabindex="-1"><a class="header-anchor" href="#_2-1\u6570\u5B66\u89E3" aria-hidden="true">#</a> 2.1\u6570\u5B66\u89E3</h4><p><img src="'+S+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u5E73\u9762\u03B1 <ul><li>\u70B9A(ax,ay,az)\u4E3A\u5E73\u9762\u03B1 \u4E2D\u4EFB\u4E00\u70B9</li><li>\u5411\u91CFn(nx,ny,nz)\u4E3A\u5E73\u9762\u03B1\u7684\u6CD5\u5411\u91CF</li></ul></li><li>\u5C04\u7EBFl <ul><li>\u5C04\u7EBFl \u7684\u539F\u70B9\u4E3A\u70B9E(ex,ey,ez)</li><li>\u5C04\u7EBFl \u7684\u65B9\u5411\u4E3Av(vx,vy,vz)</li></ul></li></ul><p><code>\u6C42</code>\uFF1A\u5C04\u7EBFl\u4E0E\u5E73\u9762\u03B1\u7684\u4EA4\u70B9M</p><p><code>\u89E3</code>\uFF1A</p><p>\u56E0\u4E3A\uFF1A<br> \u03B1\u22A5n\u21D2\u03B1 \u4E2D\u7684\u6240\u6709\u76F4\u7EBF\u22A5n<br> (M-A)\u2208\u03B1<br> \u6240\u4EE5\uFF0C\u7531\u5782\u76F4\u5411\u91CF\u7684\u5173\u7CFB\u5F97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token constant">M</span><span class="token operator">-</span><span class="token constant">A</span><span class="token punctuation">)</span>\xB7n<span class="token operator">=</span><span class="token number">0</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7531\u5411\u91CF\u7684\u6570\u4E58\u5F97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">EM</span><span class="token operator">=</span>\u03BB<span class="token operator">*</span>v
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6240\u4EE5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">M</span><span class="token operator">-</span><span class="token constant">E</span><span class="token operator">=</span>\u03BB<span class="token operator">*</span>v
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u56E0\u4E3A\uFF1A</p><p>\u5411\u91CF\u7684\u52A0\u51CF\u8FD0\u7B97\u7B26\u5408\u4EA4\u6362\u5F8B</p><p>\u6240\u4EE5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">M</span><span class="token operator">=</span>\u03BBv<span class="token operator">+</span><span class="token constant">E</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u63A5\u4E0B\u6765\u6C42\u51FA\u03BB\uFF0C\u4FBF\u53EF\u5F97M \u503C\u3002</p><p>\u5BF9\u6BD4\u4E0A\u9762\u6C42\u51FA\u7684\u4E24\u4E2A\u7B49\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token constant">M</span><span class="token operator">-</span><span class="token constant">A</span><span class="token punctuation">)</span>\xB7n<span class="token operator">=</span><span class="token number">0</span>  \u2460
<span class="token constant">M</span><span class="token operator">=</span>\u03BBv<span class="token operator">+</span><span class="token constant">E</span>     \u2461
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>M \u662F\u6211\u4EEC\u6700\u7EC8\u8981\u6C42\u7684\u56E0\u53D8\u91CF</li><li>\u03BB \u662F\u6211\u4EEC\u4E0B\u4E00\u6B65\u8981\u6C42\u7684\u672A\u77E5\u6570</li><li>\u5176\u4F59\u7684\u5C04\u7EBF\u65B9\u5411v\u3001\u5E73\u9762\u6CD5\u7EBFn\u3001\u5C04\u7EBF\u539F\u70B9E\uFF0C\u90FD\u662F\u5DF2\u77E5\u5E38\u91CF</li></ul><p>\u6240\u4EE5\uFF0C\u4E0A\u9762\u7684\u4E24\u4E2A\u7B49\u5F0F\u5C31\u662F\u4E00\u4E2A\u4E8C\u5143\u4E00\u6B21\u65B9\u7A0B\u5F0F\u7EC4\uFF0CM\u3001\u03BB \u5C31\u5176\u4E2D\u7684\u4E8C\u5143\u3002</p><p>\u7528\u6D88\u5143\u6CD5\u628A\u7B49\u5F0F\u2461\u4EE3\u5165\u7B49\u5F0F\u2460 \u4E2D \u6D88\u6389M\uFF0C\u5F97\u5230\u03BB\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>\u03BBv<span class="token operator">+</span><span class="token constant">E</span><span class="token operator">-</span><span class="token constant">A</span><span class="token punctuation">)</span>\xB7n<span class="token operator">=</span><span class="token number">0</span>
\u03BBv\xB7n<span class="token operator">=</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token operator">-</span><span class="token constant">E</span><span class="token punctuation">)</span>\xB7n
\u03BB<span class="token operator">=</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token operator">-</span><span class="token constant">E</span><span class="token punctuation">)</span>\xB7n<span class="token operator">/</span>v\xB7n
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5C06\u03BB \u4EE3\u5165\u7B49\u5F0F\u2461\u4E2D\uFF0C\u5F97\u5230M\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">M</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token operator">-</span><span class="token constant">E</span><span class="token punctuation">)</span>\xB7n<span class="token operator">/</span>v\xB7n<span class="token punctuation">)</span><span class="token operator">*</span>v<span class="token operator">+</span><span class="token constant">E</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0A\u9762\u7684\u516C\u5F0F\u4FBF\u662F\u5C04\u7EBF\u4E0E\u5E73\u9762\u7684\u4EA4\u70B9\u516C\u5F0F\u4E86\u3002</p><p>\u6570\u5B66\u539F\u7406\u5DF2\u901A\uFF0C\u63A5\u4E0B\u6765\u54B1\u4EEC\u7528\u4EE3\u7801\u5B9E\u73B0\u4E00\u4E0B\u3002</p><h4 id="_2-2\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-2\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 2.2\u4EE3\u7801\u5B9E\u73B0</h4><p>\u62FF\u52FE\u80A1\u5B9A\u7406\u4E2D\u7684\u7279\u6B8A\u6570\u636E\u4E3E\u4F8B\u3002</p><p><img src="`+E+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E09\u89D2\u5F62ABC</span>
<span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment">// \u89C6\u70B9</span>
<span class="token keyword">const</span> <span class="token constant">E</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token comment">// \u9F20\u6807\u70B9</span>
<span class="token keyword">const</span> <span class="token constant">P</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>\u6C42</code>\uFF1A\u4EE5\u76F8\u673A\u89C6\u70B9\u4E3A\u539F\u70B9\u4E14\u6307\u5411\u9F20\u6807\u4F4D\u7F6E\u7684\u5C04\u7EBF\u4E0E\u4E09\u89D2\u5F62 ABC \u6240\u5728\u7684\u5E73\u9762\u7684\u4EA4\u70B9 M</p><p><code>\u89E3</code>\uFF1A</p><p>\u901A\u8FC7\u52FE\u80A1\u5B9A\u7406\u53EF\u77E5\uFF0C\u5176\u4EA4\u70B9M\u5FC5\u7136\u662F\u96F6\u70B9\uFF0C\u63A5\u4E0B\u6765\u7528\u4EE3\u7801\u6D4B\u4E00\u4E0B\u3002</p><p>\u5148\u6C42\u4E00\u4E0B\u4E09\u89D2\u5F62ABC\u7684\u6CD5\u7EBF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">AB</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">BC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span><span class="token constant">AB</span><span class="token punctuation">,</span> <span class="token constant">BC</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u901A\u8FC7\u89C6\u70B9\u548C\u9F20\u6807\u70B9\u8BA1\u7B97\u5C04\u7EBF\u65B9\u5411</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">P</span><span class="token punctuation">,</span> <span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5C04\u7EBF\u4E0E\u5E73\u9762\u7684\u4EA4\u70B9\u516C\u5F0F\u6C42\u4EA4\u70B9</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// M=((A-E)\xB7n/v\xB7n)*v+E</span>
<span class="token keyword">const</span> <span class="token constant">M</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>
    <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6700\u540E\u8F93\u51FA\u4E00\u4E0BM\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;M&#39;</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Vector3 {x: 0, y: -1.7763568394002505e-15, z: -3.552713678800501e-15}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E0A\u9762\u7684y\u3001z\u5206\u91CF\u53D7\u5230\u4E86\u6D6E\u70B9\u6570\u7684\u8BEF\u5DEE\u5F71\u54CD\uFF0C\u4E0D\u597D\u5206\u8FA8\u5176\u5177\u4F53\u5927\u5C0F\u3002<br> \u53EF\u4EE5\u53D6\u5176\u5C0F\u6570\u70B9\u540E5\u4F4D\u770B\u770B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token constant">M</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">M</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token constant">M</span><span class="token punctuation">.</span>z<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 0.00000 -0.00000 -0.00000</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u4E0A\u53EF\u77E5\u4EA4\u70B9M\u5C31\u662F\u96F6\u70B9\u3002<br> \u5176\u5B9E\uFF0C\u4E5F\u53EF\u4EE5\u7528 three.js \u6765\u6D4B\u8BD5\u4E0A\u9762\u7684\u7B97\u6CD5\u5BF9\u4E0D\u5BF9\u3002</p><h4 id="_2-3three-js\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_2-3three-js\u6D4B\u8BD5" aria-hidden="true">#</a> 2.3three.js\u6D4B\u8BD5</h4><ol><li>\u7528\u4E0D\u5171\u7EBF\u7684\u4E09\u70B9\u5EFA\u5E73\u9762</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromCoplanarPoints</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>\u8BA1\u7B97\u5C04\u7EBF\u65B9\u5411</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">P</span><span class="token punctuation">,</span> <span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>\u7528\u57FA\u70B9\u548C\u5C04\u7EBF\u65B9\u5411\u5EFA\u7ACB\u5C04\u7EBF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ray</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="4"><li>\u7528\u5C04\u7EBF\u5BF9\u8C61\u7684 intersectPlane() \u65B9\u6CD5\u6C42\u5C04\u7EBF\u4E0E\u5E73\u9762\u7684\u4EA4\u70B9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">M</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ray<span class="token punctuation">.</span><span class="token function">intersectPlane</span><span class="token punctuation">(</span>plane<span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="5"><li>\u8F93\u51FAM</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;M&#39;</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//M Vector3 {x: 0, y: 0, z: 0}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5176\u4EA4\u70B9\u662F\u96F6\u70B9\uFF0C\u4E0E\u4E4B\u524D\u7B97\u8FC7\u7684\u4E00\u6837\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u8FD8\u53EF\u4EE5\u518D\u62FF\u51E0\u4E2A\u5728\u52FE\u80A1\u5B9A\u7406\u4E4B\u5185\u7684\u7279\u6B8A\u9AD8\u5EA6\u7684\u4E09\u89D2\u5F62\u6765\u8BD5\u4E00\u4E0B\u3002<br> \u6BD4\u5982\u9AD8\u5EA6\u4E3A6\u30019\u7684\u4E09\u89D2\u5F62\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6D4B\u8BD5\u90FD\u662F\u6CA1\u95EE\u9898\u7684\u3002</p><p>\u73B0\u5728\uFF0C\u77E5\u9053\u4E86\u5C04\u7EBF\u548C\u4E09\u89D2\u5F62\u6240\u5728\u5E73\u9762\u7684\u4EA4\u70B9\uFF0C\u63A5\u4E0B\u6765\u4FBF\u53EF\u4EE5\u5224\u65AD\u4E00\u4E0B\u8FD9\u4E2A\u4EA4\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\u4E86\u3002</p><h3 id="_3-\u5728\u7A7A\u95F4\u4E2D\u5224\u65AD\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D" tabindex="-1"><a class="header-anchor" href="#_3-\u5728\u7A7A\u95F4\u4E2D\u5224\u65AD\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D" aria-hidden="true">#</a> 3.\u5728\u7A7A\u95F4\u4E2D\u5224\u65AD\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D</h3><p>\u4E4B\u524D\u5728\u4E8C\u7EF4\u5E73\u9762\u4E2D\u7528\u53C9\u4E58\u5224\u65AD\u8FC7\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\uFF0C\u5728\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u4E5F\u662F\u8981\u7528\u53C9\u4E58\u6765\u5224\u65AD\u7684\u3002<br> \u53EA\u4E0D\u8FC7\uFF0C\u4E09\u7EF4\u5411\u91CF\u7684\u53C9\u4E58\u7ED3\u679C\u8FD8\u662F\u5411\u91CF\uFF0C\u65E0\u6CD5\u50CF\u4E8C\u7EF4\u5411\u91CF\u7684\u53C9\u4E58\u90A3\u6837\uFF0C\u7528\u4E00\u4E2A\u5B9E\u6570\u7ED3\u679C\u5224\u65AD\u5176\u5927\u4E8E\u96F6\u8FD8\u662F\u5C0F\u4E8E\u96F6\u3002<br> \u56E0\u6B64\uFF0C\u5728\u7A7A\u95F4\u4E2D\u5224\u65AD\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D\uFF0C\u8FD8\u5F97\u518D\u52A0\u4E00\u6B65\u64CD\u4F5C\u3002\u81F3\u4E8E\u8FD9\u4E00\u6B65\u662F\u5565\uFF0C\u54B1\u4EEC\u4E00\u6B65\u6B65\u6765\u8BF4\u3002</p><h4 id="_3-1\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-1\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 3.1\u4EE3\u7801\u5B9E\u73B0</h4><p><img src="`+A+`" alt=""></p><p>\u7531\u4E0A\u4E00\u4E2A\u4F8B\u5B50\u7684\u4E09\u89D2\u5F62ABC\u548C\u7A7A\u95F4\u70B9M\u4E3A\u5DF2\u77E5\u6761\u4EF6\u3002<br> \u5224\u65AD\uFF1A\u70B9M\u662F\u5426\u5728\u4E09\u89D2\u5F62ABC\u4E2D</p><p><code>\u89E3</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u4E09\u89D2\u5F62</span>
<span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">]</span>
<span class="token comment">// \u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D</span>
<span class="token keyword">function</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">M</span><span class="token punctuation">,</span> triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> ma <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> ab <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        <span class="token keyword">const</span> d <span class="token operator">=</span> ma<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bool <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bool
<span class="token punctuation">}</span>
<span class="token keyword">const</span> bool <span class="token operator">=</span> <span class="token function">inTriangle</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">,</span> triangle<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u8BE6\u7EC6\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u7684inTriangle()\u65B9\u6CD5</p><ol><li>for \u5FAA\u73AF\u904D\u5386\u4E09\u89D2\u5F62\u7684\u4E09\u6761\u8FB9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>\u5206\u522B\u5C06\u70B9\u548C\u4E09\u89D2\u5F62\u7684\u4E09\u6761\u8FB9\u505A\u53C9\u4E58\u8FD0\u7B97</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ma <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ab <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment">// ma\u548Cab\u7684\u5782\u76F4\u5411\u91CF</span>
<span class="token keyword">const</span> d <span class="token operator">=</span> ma<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u4E0A\u9762\u7684\u53C9\u4E58\u7ED3\u679C\u53EF\u4EE5\u7406\u89E3\u4E3A\u4E00\u6761\u5782\u76F4\u5411\u91CF\uFF0C\u6B64\u5782\u76F4\u5411\u91CF\u5782\u76F4\u4E09\u89D2\u7684\u4E09\u6761\u8FB9\uFF0C\u4E14\u5782\u76F4\u4E8EM\u70B9\u5230\u4E09\u89D2\u5F62\u4E09\u6761\u8FB9\u7684\u8FDE\u7EBF\u3002</p><p>\u91CD\u70B9\u8981\u77E5\u9053\uFF0C\u8FD9\u6761\u5782\u76F4\u5411\u91CF\u662F\u6709\u65B9\u5411\u7684\uFF0C\u5B83\u53EF\u80FD\u4E0E\u4E09\u89D2\u5F62\u7684\u6CD5\u7EBF\u540C\u5411\uFF0C\u4E5F\u53EF\u80FD\u4E0E\u4E09\u89D2\u5F62\u7684\u6CD5\u7EBF\u5F02\u5411\u3002<br> \u5F53M\u70B9\u5728\u4E09\u89D2\u5F62\u4E2D\u662F\uFF0CM\u70B9\u8FDE\u63A5\u4E09\u89D2\u5F62\u4E09\u8FB9\u5F97\u5230\u7684\u5782\u76F4\u5411\u91CF\u4F1A\u6709\u4E00\u4E2A\u7279\u70B9\uFF0C\u8981\u4E48\u90FD\u5728\u4E09\u89D2\u5F62\u6CD5\u7EBF\u7684\u6B63\u65B9\u5411\u4E0A\uFF0C\u8981\u4E48\u90FD\u4E0E\u4E09\u89D2\u5F62\u6CD5\u7EBF\u7684\u8D1F\u65B9\u5411\u4E0A\u3002<br> \u81F3\u4E8E\u4EC0\u4E48\u65F6\u5019\u5728\u6B63\u65B9\u5411\u4E0A\uFF0C\u4EC0\u4E48\u65F6\u5019\u5728\u8D1F\u65B9\u5411\u4E0A\uFF0C\u8FD9\u8DDF\u9F20\u6807\u70B9\u548C\u4E09\u89D2\u5F62\u4E09\u6761\u8FB9\u7684\u8FDE\u63A5\u987A\u5E8F\uFF0C\u4EE5\u53CA\u4E09\u89D2\u5F62\u7684\u7ED8\u56FE\u987A\u5E8F\u6709\u5173\u3002</p><ol start="3"><li>\u5224\u65AD\u5782\u76F4\u5411\u91CF\u5728\u4E09\u89D2\u5F62\u7684\u54EA\u4E00\u4FA7</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> len <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bool <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">break</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5728\u4E0A\u9762\uFF0C\u5229\u7528\u4E24\u4E2A\u5411\u91CF\u7684\u70B9\u79EF\u53EF\u4EE5\u5C06\u4E24\u4E2A\u5411\u91CF\u7684\u65B9\u5411\u5173\u7CFB\u8F6C\u6362\u4E3A\u4E00\u4E2A\u5B9E\u6570\u3002<br> \u81F3\u4E8E\u5176\u5177\u4F53\u539F\u7406\uFF0C\u5728\u9AD8\u4E2D\u8BFE\u672C\u7684\u70B9\u79EF\u91CC\u6709\u8BF4\uFF0C\u5728\u8FD9\u91CC\u5C31\u5148\u7B80\u5355\u8BF4\u4E00\u4E0B\u4E86\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A\u5411\u91CFa\u3001b</p><p><code>\u5219</code>\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>a\xB7b=|a|*|b|*cos&lt;a,b&gt;
cos&lt;a,b&gt;=a\xB7b/|a|*|b|
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4EE5\u5411\u91CFa \u4E3A\u5750\u6807\u57FA\u7EBF\uFF0C\u5219\uFF1A</p><ul><li>\u5F53cos&lt;a,b&gt;\u5927\u4E8E0\u65F6\uFF0C&lt;a,b&gt;\u2208(-90\xB0,90\xB0)\uFF0Ca\u5728\u5411\u91CFb \u7684\u6B63\u65B9\u5411\u4E0A</li><li>\u5F53cos&lt;a,b&gt;\u5C0F\u4E8E0\u65F6\uFF0C&lt;a,b&gt;\u2208(90\xB0,180\xB0)\u222A(-90\xB0,-180\xB0)\uFF0Ca\u5728\u5411\u91CFb \u7684\u8D1F\u65B9\u5411\u4E0A</li></ul><p>\u56E0\u4E3A\uFF0C\u4E4B\u524D\u662F\u6309\u7167\u4E09\u89D2\u5F62\u7684\u7ED8\u56FE\u987A\u5E8F\u8BA9\u9F20\u6807\u70B9\u4E0E\u4E09\u89D2\u5F62\u7684\u4E09\u6761\u8FB9\u8FDB\u884C\u7684\u8FDE\u63A5\uFF0C\u7136\u540E\u5206\u522B\u6C42\u51FA\u4E86\u4E09\u6761\u5782\u76F4\u5411\u91CF\u3002<br> \u6240\u4EE5\uFF0C\u5F53\u4E09\u89D2\u5F62\u662F\u9006\u65F6\u9488\u753B\u7684\uFF0C\u4E14\u9F20\u6807\u70B9\u5728\u4E09\u89D2\u5F62\u4E2D\u65F6\uFF0C\u4E09\u6761\u5782\u76F4\u5411\u91CF\u90FD\u5728\u4E09\u89D2\u5F62\u6CD5\u7EBF\u7684\u6B63\u65B9\u5411\u4E0A\u3002<br> \u82E5\u6709\u4E00\u6761\u5782\u76F4\u5411\u91CF\u4E0D\u5728\u4E09\u89D2\u5F62\u6CD5\u7EBF\u7684\u6B63\u65B9\u5411\u4E0A\uFF0C\u90A3\u5C31\u8BF4\u660E M \u70B9\u4E0D\u5728\u4E09\u89D2\u5F62\u4E2D\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u4F9D\u65E7 three.js \u6D4B\u8BD5\u4E00\u4E0B\u3002</p><h4 id="_3-2-three-js-\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_3-2-three-js-\u6D4B\u8BD5" aria-hidden="true">#</a> 3.2 three.js \u6D4B\u8BD5</h4><p>\u5C04\u7EBF\u5BF9\u8C61\u76F4\u63A5\u6709\u4E00\u4E2AintersectTriangle() \u65B9\u6CD5\uFF0C\u7528\u4E8E\u5224\u65AD\u5C04\u7EBF\u662F\u5426\u7A7F\u8FC7\u4E86\u4E00\u4E2A\u4E09\u89D2\u5F62\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token keyword">const</span> plane <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromCoplanarPoints</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> dir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">P</span><span class="token punctuation">,</span> <span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> ray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ray</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token constant">M</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    ray<span class="token punctuation">.</span><span class="token function">intersectTriangle</span><span class="token punctuation">(</span>
        <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span>
        <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token constant">M</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>intersectTriangle ( a : Vector3, b : Vector3, c : Vector3, backfaceCulling : Boolean, target : Vector3 )</p><ul><li>a, b, c - \u7EC4\u6210\u4E09\u89D2\u5F62\u7684\u4E09\u4E2AVector3\u3002</li><li>backfaceCulling - \u662F\u5426\u4F7F\u7528\u80CC\u9762\u5254\u9664\u3002</li><li>target \u2014 \u7ED3\u679C\u5C06\u4F1A\u88AB\u590D\u5236\u5230\u8FD9\u4E00Vector3\u4E2D\u3002</li></ul><p>\u6CE8\uFF1A\u4F7F\u7528intersectTriangle()\u65B9\u6CD5\u65F6\uFF0C\u82E5\u5C04\u7EBF\u6CA1\u6709\u7A7F\u8FC7\u4E09\u89D2\u5F62\uFF0C\u4F1A\u8FD4\u56DE\u96F6\u70B9\u3002\u8FD9\u4E2A\u6709\u70B9\u5751\uFF0C\u4E07\u4E00\u5C04\u7EBF\u548C\u4E09\u89D2\u5F62\u7684\u4EA4\u70B9\u5C31\u662F\u96F6\u70B9\uFF0C\u90A3\u5C31\u6CA1\u6CD5\u5224\u65AD\u5C04\u7EBF\u6709\u6CA1\u6709\u7A7F\u8FC7\u4E09\u89D2\u5F62\u4E86\u3002</p><h3 id="_4-\u9F20\u6807\u9009\u62E9\u7ACB\u65B9\u4F53" tabindex="-1"><a class="header-anchor" href="#_4-\u9F20\u6807\u9009\u62E9\u7ACB\u65B9\u4F53" aria-hidden="true">#</a> 4.\u9F20\u6807\u9009\u62E9\u7ACB\u65B9\u4F53</h3><p>\u5728\u8FD9\u4E2A\u6848\u4F8B\u4E2D\u6240\u6D89\u53CA\u7684\u77E5\u8BC6\u70B9\u4EE5\u524D\u90FD\u8BF4\u8FC7\uFF0C\u6240\u4EE5\u76F4\u63A5\u4E0A\u4EE3\u7801\u3002<br> \u4E4B\u524D\u54B1\u4EEC\u7528\u9876\u70B9\u7D22\u5F15\u753B\u8FC7\u4E00\u4E2A\u5F69\u8272\u7684\u7ACB\u65B9\u4F53\uFF0C\u5C31\u5728\u8FD9\u57FA\u7840\u4E0A\u505A\u9009\u62E9\u4E86\u3002</p><h4 id="_4-1\u58F0\u660E\u5FC5\u5907\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_4-1\u58F0\u660E\u5FC5\u5907\u53D8\u91CF" aria-hidden="true">#</a> 4.1\u58F0\u660E\u5FC5\u5907\u53D8\u91CF</h4><p>\u5148\u5C06\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3001\u9876\u70B9\u96C6\u5408\u548C\u9876\u70B9\u7D22\u5F15\u63D0\u53D6\u51FA\u6765\uFF0C\u4EE5\u5907\u540E\u7528\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// \u65CB\u8F6C\u72B6\u6001</span>
<span class="token keyword">let</span> selected <span class="token operator">=</span> <span class="token boolean">false</span>
    
<span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
<span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// \u9876\u70B9\u7D22\u5F15</span>
<span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>    <span class="token comment">// front</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>    <span class="token comment">// right</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment">// up</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// left</span>
    <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// down</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span>     <span class="token comment">// back</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_4-2\u9F20\u6807\u79FB\u52A8\u4E8B\u4EF6" tabindex="-1"><a class="header-anchor" href="#_4-2\u9F20\u6807\u79FB\u52A8\u4E8B\u4EF6" aria-hidden="true">#</a> 4.2\u9F20\u6807\u79FB\u52A8\u4E8B\u4EF6</h4><p>\u5728\u9F20\u6807\u79FB\u52A8\u7684\u65F6\u5019\uFF0C\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF0C\u5E76\u9009\u62E9\u5BF9\u8C61\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">selectObj</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u91CD\u70B9\u770B\u4E00\u4E0B\u9009\u62E9\u5BF9\u8C61\u7684\u65B9\u6CD5selectObj(event)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">selectObj</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u9F20\u6807\u4E16\u754C\u4F4D</span>
    <span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u5C04\u7EBF</span>
    <span class="token keyword">const</span> ray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ray</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    <span class="token comment">// \u9009\u62E9\u72B6\u6001</span>
    selected <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// \u904D\u5386\u4E09\u7EF4\u5BF9\u8C61\u91CC\u7684\u6240\u6709\u4E09\u89D2\u5F62</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u4E09\u89D2\u5F62</span>
        <span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token function">getVector3</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">getVector3</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">getVector3</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
        <span class="token comment">//\u5C04\u7EBF\u4E0E\u4E09\u89D2\u5F62\u7684\u4EA4\u70B9\u3002\u82E5\u6709\u4EA4\u70B9\uFF0C\u8FD4\u56DE\u4EA4\u70B9\uFF1B\u82E5\u65E0\u4EA4\u70B9\u8FD4\u56DEnull</span>
        <span class="token keyword">const</span> interPos <span class="token operator">=</span> <span class="token function">intersectTriangle</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> triangle<span class="token punctuation">)</span>
        <span class="token comment">//\u53EA\u8981\u4E00\u4E2A\u4E09\u89D2\u5F62\u88AB\u9009\u4E2D\uFF0C\u5219\u4E09\u7EF4\u5BF9\u8C61\u88AB\u9009\u4E2D</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>interPos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            selected <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol><li>worldPos()\u83B7\u53D6\u9F20\u6807\u4E16\u754C\u4F4D\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u54B1\u4EEC\u4E4B\u524D\u5728\u57FA\u70B9\u53D8\u6362\u4E2D\u5199\u8FC7</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">worldPos</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>hw<span class="token punctuation">,</span> hh<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token comment">// \u88C1\u526A\u7A7A\u95F4\u4F4D</span>
    <span class="token keyword">const</span> cp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>clientX <span class="token operator">-</span> hw<span class="token punctuation">)</span> <span class="token operator">/</span> hw<span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token punctuation">(</span>clientY <span class="token operator">-</span> hh<span class="token punctuation">)</span> <span class="token operator">/</span> hh<span class="token punctuation">,</span>
        <span class="token number">0</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u9F20\u6807\u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4F4D\u7F6E</span>
    <span class="token keyword">return</span> cp<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>
        pvMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u5C04\u7EBF\u7684Ray\u5BF9\u8C61\u662Fthree.js\u91CC\u7684\uFF0C\u5176lookAt()\u65B9\u6CD5\u53EF\u4EE5\u8BA9\u5C04\u7EBF\u5C04\u5411\u67D0\u4E2A\u70B9\u4F4D\uFF0C\u4ECE\u800C\u6539\u53D8\u5C04\u7EBF\u7684\u65B9\u5411\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ray</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>\u53D8\u91CF\u7ACB\u65B9\u4F53\u4E2D\u7684\u6240\u6709\u4E09\u89D2\u5F62\u7684\u65F6\u5019\uFF0C\u662F\u5148\u4EE5\u4E09\u4E2A\u70B9\u4F4D\u5355\u4F4D\u904D\u5386\u7684\u9876\u70B9\u7D22\u5F15\uFF0C\u7136\u540E\u518D\u57FA\u4E8E\u9876\u70B9\u7D22\u5F15\u4ECE\u9876\u70B9\u96C6\u5408\u4E2D\u5BFB\u627E\u76F8\u5E94\u7684\u9876\u70B9\u6570\u636E\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u4E09\u89D2\u5F62</span>
    <span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token function">getVector3</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">getVector3</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">getVector3</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>getVector3() \u57FA\u4E8E\u9876\u70B9\u7D22\u5F15\u4ECE\u9876\u70B9\u96C6\u5408\u4E2D\u5BFB\u627E\u76F8\u5E94\u7684\u9876\u70B9\u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getVector3</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> j <span class="token operator">*</span> <span class="token number">3</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>
        vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>\u83B7\u53D6\u5C04\u7EBF\u4E0E\u4E09\u89D2\u5F62\u7684\u4EA4\u70B9\u3002\u82E5\u6709\u4EA4\u70B9\uFF0C\u8FD4\u56DE\u4EA4\u70B9\uFF1B\u82E5\u65E0\u4EA4\u70B9\u8FD4\u56DEnull</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> interPos <span class="token operator">=</span> <span class="token function">intersectTriangle</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span> triangle<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>intersectTriangle() \u65B9\u6CD5\u7684\u5B9E\u73B0\u539F\u7406\uFF0C\u4E4B\u524D\u5DF2\u7ECF\u5199\u8FC7</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">intersectTriangle</span><span class="token punctuation">(</span><span class="token parameter">ray<span class="token punctuation">,</span> triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token constant">E</span><span class="token punctuation">,</span> <span class="token literal-property property">direction</span><span class="token operator">:</span> v <span class="token punctuation">}</span> <span class="token operator">=</span> ray
    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">]</span> <span class="token operator">=</span> triangle
    <span class="token comment">// \u4E09\u89D2\u5F62\u7684\u6CD5\u7EBF</span>
    <span class="token keyword">const</span> <span class="token constant">AB</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token constant">BC</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subVectors</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span><span class="token constant">AB</span><span class="token punctuation">,</span> <span class="token constant">BC</span><span class="token punctuation">)</span>

    <span class="token comment">// \u5C04\u7EBF\u548C\u5E73\u9762\u7684\u4EA4\u70B9</span>
    <span class="token keyword">const</span> <span class="token constant">M</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>
        <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">/</span> v<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">)</span>

    <span class="token comment">// \u5224\u65AD\u70B9M\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D</span>
    <span class="token keyword">let</span> bool <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> ma <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> ab <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        <span class="token keyword">const</span> d <span class="token operator">=</span> ma<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>ab<span class="token punctuation">)</span>
        <span class="token keyword">const</span> len <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            bool <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">M</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="5"><li>\u66F4\u65B0\u9009\u62E9\u72B6\u6001\uFF0C\u53EA\u8981\u4E00\u4E2A\u4E09\u89D2\u5F62\u88AB\u9009\u4E2D\uFF0C\u5219\u4E09\u7EF4\u5BF9\u8C61\u88AB\u9009\u4E2D</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>interPos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selected <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">break</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u9F20\u6807\u9009\u62E9\u4E09\u7EF4\u5BF9\u8C61\u7684\u57FA\u672C\u539F\u7406\u5C31\u662F\u8FD9\u6837\u3002</p><p>\u4EE5\u524D\uFF0C\u6211\u9047\u5230\u4E00\u4E2A\u9700\u6C42\uFF1A\u573A\u666F\u91CC\u6709\u4E00\u67B6\u5927\u98CE\u8F66\uFF0C\u5F53\u7528\u6237\u628A\u9F20\u6807\u653E\u5728\u98CE\u8F66\u7684\u98CE\u6247\u4E0A\u65F6\uFF0C\u98CE\u6247\u5C31\u8F6C\u52A8\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u54B1\u4EEC\u5C31\u628A\u8FD9\u4E2A\u7ACB\u65B9\u4F53\u5F53\u6210\u98CE\u6247\uFF0C\u5F53\u9F20\u6807\u653E\u4E0A\u53BB\u7684\u65F6\u5019\uFF0C\u98CE\u6247\u65E2\u80FD\u8F6C\u52A8\uFF0C\u8FD8\u80FD\u53D8\u8272\u3002</p><ol start="6"><li>\u58F0\u660E\u5FC5\u5907\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u63D2\u503C-\u7528\u4E8E\u4FEE\u6539\u7247\u5143\u989C\u8272</span>
<span class="token keyword">let</span> time <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// \u5F27\u5EA6-\u7528\u4E8E\u65CB\u8F6C\u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">let</span> ang <span class="token operator">=</span> <span class="token number">0</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="7"><li>\u5728\u83B7\u53D6\u9876\u70B9\u7684\u65F6\u5019\uFF0C\u7528\u6A21\u578B\u77E9\u9635\u5C06\u5176\u8F6C\u6362\u6210\u4E16\u754C\u4F4D</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getVector3</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> j <span class="token operator">*</span> <span class="token number">3</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>
        vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>modelMatrix<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u4E4B\u524D\u5F3A\u8C03\u8FC7\uFF0C\u5224\u65AD\u56FE\u5F62\u5173\u7CFB\u7684\u65F6\u5019\uFF0C\u4E00\u5B9A\u8981\u7EDF\u4E00\u5750\u6807\u7CFB\u3002<br> \u4E4B\u524D\u83B7\u53D6\u7684\u9F20\u6807\u4F4D\u662F\u4E16\u754C\u4F4D\uFF0C\u6240\u4EE5\u6A21\u578B\u9876\u70B9\u4E5F\u4E00\u5B9A\u8981\u662F\u4E16\u754C\u4F4D\u3002</p><ol start="8"><li>\u5728\u8FDE\u7EED\u6E32\u67D3\u7684\u65F6\u5019\uFF0C\u82E5\u9F20\u6807\u9009\u4E2D\u4E86\u5BF9\u8C61\uFF0C\u5C31\u8BA9\u7ACB\u65B9\u4F53\u65E2\u80FD\u65CB\u8F6C\uFF0C\u4E5F\u80FD\u53D8\u8272\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span>
        <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span>
        pvMatrix<span class="token punctuation">.</span>elements
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        time <span class="token operator">+=</span> <span class="token number">20</span>
        ang <span class="token operator">+=</span> <span class="token number">0.05</span>
        mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_Time&#39;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> time<span class="token punctuation">}</span><span class="token punctuation">)</span>
        mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>
            <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span><span class="token punctuation">.</span>elements
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="\u5341\u4E8C-\u522B\u5885\u5BA4\u5185\u5E03\u5C40\u56FE" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E8C-\u522B\u5885\u5BA4\u5185\u5E03\u5C40\u56FE" aria-hidden="true">#</a> \u5341\u4E8C.\u522B\u5885\u5BA4\u5185\u5E03\u5C40\u56FE</h2><p>\u63A5\u4E0B\u6765\uFF0C\u8981\u505A\u4E00\u680B\u522B\u5885\u5BA4\u5185\u5E03\u5C40\u56FE\u7684\u7A7A\u95F4\u5C55\u793A\u3002<br><img src="`+s+`" alt=""></p><p>\u6B64\u6848\u4F8B\u4F1A\u6BCF\u9694\u4E00\u6BB5\u65F6\u95F4\uFF0C\u4F9D\u6B21\u5BF9\u697C\u5C42\u8FDB\u884C\u7279\u5199\u3002<br> \u697C\u5C42\u7684\u7279\u5199\u8981\u901A\u8FC7\u4E24\u4E2A\u77E9\u9635\u5B9E\u73B0\uFF1A</p><ul><li>\u6A21\u578B\u77E9\u9635\uFF1A\u8BA9\u5F53\u524D\u697C\u5C42\u5411\u524D\u4E00\u6B65\u8D70\uFF0C\u7136\u540E\u653E\u5927\u3002</li><li>\u89C6\u56FE\u77E9\u9635\uFF1A\u628A\u955C\u5934\u62C9\u5411\u5F53\u524D\u697C\u5C42\u3002</li></ul><p>\u4E0A\u9762\u7684\u6548\u679C\u4E0D\u662F\u77AC\u95F4\u5B8C\u6210\u7684\uFF0C\u5B83\u8FD8\u9700\u8981\u4E00\u4E2A\u8865\u95F4\u52A8\u753B\u53BB\u8FC7\u6E21\u3002<br> \u56E0\u6B64\uFF0C\u5728\u8FD9\u4E2A\u6848\u4F8B\u91CC\uFF0C\u6211\u4EEC\u91CD\u70B9\u8981\u8BF4\u7684\u77E5\u8BC6\u70B9\u662F\u76F8\u673A\u8F68\u9053\u7684\u8865\u95F4\u52A8\u753B\u3002<br> \u76F8\u673A\u8F68\u9053\u7684\u8865\u95F4\u52A8\u753B\uFF0C\u662F\u6211\u4EEC\u5B9E\u9645\u5DE5\u4F5C\u4E2D\u4E0D\u53EF\u907F\u514D\u7684\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u60F3\u8C61\u5230\u8BB8\u8BB8\u591A\u591A\u4E0E\u4E4B\u76F8\u5173\u7684\u573A\u666F\u3002<br> \u6BD4\u5982\u57284s\u5E97\u91CC\uFF0C\u4E00\u8F86\u6C7D\u8F66\u6A21\u578B\u7684\u5C55\u793A\u3002\u6211\u53EF\u4EE5\u901A\u8FC7\u4E00\u4E2A\u4EA4\u4E92\u64CD\u4F5C\uFF0C\u5C06\u76F8\u673A\u4ECE\u5916\u90E8\u6253\u5165\u5185\u90E8\uFF0C\u770B\u4E00\u4E0B\u6C7D\u8F66\u7684\u5185\u90E8\u7ED3\u6784\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u54B1\u4EEC\u5C31\u5148\u5B8C\u5584\u4E00\u4E0B\u4E4B\u524D\u7684webgl \u6846\u67B6\uFF0C\u4EE5\u65B9\u4FBF\u6211\u4EEC\u66F4\u597D\u7684\u53BB\u4E3E\u4F8B\u5B50\u3002</p><h3 id="_1-\u5B8C\u5584webgl-\u6846\u67B6" tabindex="-1"><a class="header-anchor" href="#_1-\u5B8C\u5584webgl-\u6846\u67B6" aria-hidden="true">#</a> 1.\u5B8C\u5584webgl \u6846\u67B6</h3><p>\u5F53\u524D\u8FD9\u4E2A webgl \u6846\u67B6\u662F\u4EE5\u9700\u6C42\u4E3A\u9A71\u52A8\u7684\uFF0C\u6CA1\u6709\u4E00\u4E0B\u5B50\u5C3D\u5584\u5C3D\u7F8E\uFF0C\u90A3\u6837\u4F1A\u6709\u592A\u591A\u529F\u80FD\u7528\u4E0D\u4E0A\uFF0C\u4E5F\u4E0D\u597D\u7406\u89E3\u3002<br> \u5728\u5BF9\u5176\u505A\u8FDB\u4E00\u6B65\u5B8C\u5584\u4E4B\u524D\uFF0C\u5148\u901A\u8FC7\u4E00\u4E2A\u4F8B\u5B50\u56DE\u987E\u4E00\u4E0B\u5F53\u524Dwebgl \u6846\u67B6\u7684\u8FD0\u4F5C\u539F\u7406\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u7A0B\u5E8F\u70B9\u5BF9\u8C61A\uFF0C\u5C5E\u4E8E\u6B64\u7A0B\u5E8F\u5BF9\u8C61\u7684\u4E09\u7EF4\u5BF9\u8C61\u6709\u4E24\u4E2A <ul><li>\u4E09\u7EF4\u5BF9\u8C61A1</li><li>\u4E09\u7EF4\u5BF9\u8C61A2</li></ul></li><li>\u7A0B\u5E8F\u70B9\u5BF9\u8C61B\uFF0C\u5C5E\u4E8E\u6B64\u7A0B\u5E8F\u5BF9\u8C61\u7684\u4E09\u7EF4\u5BF9\u8C61\u6709\u4E24\u4E2A <ul><li>\u4E09\u7EF4\u5BF9\u8C61B1</li><li>\u4E09\u7EF4\u5BF9\u8C61B2</li></ul></li></ul><p><code>\u7ED8\u56FE\u903B\u8F91</code>\uFF1A</p><ol><li><p>\u6E05\u7406\u753B\u5E03</p></li><li><p>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61A1</p></li></ol><ul><li>\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61A</li><li>\u66F4\u65B0attribute \u53D8\u91CF</li><li>\u66F4\u65B0uniform \u53D8\u91CF</li><li>\u7ED8\u56FE</li></ul><ol start="3"><li>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61A2</li></ol><ul><li>\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61A</li><li>\u66F4\u65B0attribute \u53D8\u91CF</li><li>\u66F4\u65B0uniform \u53D8\u91CF</li><li>\u7ED8\u56FE</li></ul><ol start="4"><li>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61B1</li></ol><ul><li>\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61B</li><li>\u66F4\u65B0attribute \u53D8\u91CF</li><li>\u66F4\u65B0uniform \u53D8\u91CF</li><li>\u7ED8\u56FE</li></ul><ol start="5"><li>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61B2</li></ol><ul><li>\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61B</li><li>\u66F4\u65B0attribute \u53D8\u91CF</li><li>\u66F4\u65B0uniform \u53D8\u91CF</li><li>\u7ED8\u56FE</li></ul><p>\u89C2\u5BDF\u4E0A\u9762\u7684\u7ED8\u56FE\u903B\u8F91\uFF0C\u53EF\u4EE5\u77E5\u9053\uFF1A</p><ul><li>\u540C\u4E00\u6750\u8D28\u7684\u4E09\u7EF4\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u5171\u7528\u4EE5\u4E0B\u6570\u636E\uFF1A <ul><li>\u7A0B\u5E8F\u5BF9\u8C61</li><li>attribute\u53D8\u91CF\u540D</li><li>uniform \u53D8\u91CF\u540D</li></ul></li><li>\u4E0D\u540C\u7684\u4E09\u7EF4\u5BF9\u8C61\uFF0C\u72EC\u7ACB\u5177\u5907\u4EE5\u4E0B\u6570\u636E\uFF1A <ul><li>attribute \u6570\u636E</li><li>uniform \u6570\u636E</li><li>buffer \u7F13\u51B2\u533A\u5BF9\u8C61</li></ul></li></ul><p>\u56E0\u6B64\u53EF\u4EE5\u5C06\u6750\u8D28\u63D0\u53D6\u51FA\u6765\uFF0C\u76F8\u540C\u6750\u8D28\u7684\u5BF9\u8C61\u4E00\u8D77\u6E32\u67D3\uFF0C\u903B\u8F91\u5982\u4E0B\uFF1A</p><ol><li><p>\u6E05\u7406\u753B\u5E03</p></li><li><p>\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61A</p><ul><li><p>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61A1</p></li><li><p>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61A2</p></li></ul></li><li><p>\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61B</p><ul><li><p>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61B1</p></li><li><p>\u7ED8\u5236\u4E09\u7EF4\u5BF9\u8C61B2</p></li></ul></li></ol><p>\u4E0A\u9762\u4FBF\u662F\u57FA\u672C\u7684\u4F18\u5316\u601D\u8DEF\uFF0C\u63A5\u4E0B\u6765\u7528\u4EE3\u7801\u5199\u4E00\u4E0B\u3002</p><h4 id="_1-1-scene-\u573A\u666F\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_1-1-scene-\u573A\u666F\u5BF9\u8C61" aria-hidden="true">#</a> 1.1 Scene \u573A\u666F\u5BF9\u8C61</h4><p>\u6574\u4F53\u4EE3\u7801</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">gl</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">programs</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children2Draw</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Scene</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">registerProgram</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token punctuation">{</span> program<span class="token punctuation">,</span> attributeNames<span class="token punctuation">,</span> uniformNames<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span>programs <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> attributes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> uniforms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
    attributeNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      attributes<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    uniformNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      uniforms<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    programs<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token punctuation">{</span>program<span class="token punctuation">,</span>attributes<span class="token punctuation">,</span>uniforms<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token operator">...</span>objs<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setObjs</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">unshift</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>objs<span class="token punctuation">,</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setObjs</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setObjs</span><span class="token punctuation">(</span><span class="token parameter">objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    objs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span>parent<span class="token operator">=</span><span class="token keyword">this</span>
      obj<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateChildren2Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateChildren2Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateChildren2Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>children<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> children2Draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">program</span><span class="token operator">:</span>name <span class="token punctuation">}</span> <span class="token operator">=</span> child<span class="token punctuation">.</span>mat
      <span class="token keyword">if</span> <span class="token punctuation">(</span>children2Draw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        children2Draw<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        children2Draw<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children2Draw<span class="token operator">=</span>children2Draw
  <span class="token punctuation">}</span>
  <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mat <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>gl<span class="token punctuation">,</span>children2Draw<span class="token punctuation">,</span>programs<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>objs<span class="token punctuation">]</span> <span class="token keyword">of</span> children2Draw<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> program<span class="token punctuation">,</span> attributes<span class="token punctuation">,</span> uniforms <span class="token punctuation">}</span> <span class="token operator">=</span> programs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
      objs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> <span class="token punctuation">{</span> drawType<span class="token punctuation">,</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token literal-property property">mat</span><span class="token operator">:</span><span class="token punctuation">{</span>mode<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">=</span>obj
        obj<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> attributes<span class="token punctuation">,</span> uniforms<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> mode <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span>drawType<span class="token punctuation">]</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>count<span class="token punctuation">,</span>mode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          mode<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">[</span>drawType<span class="token punctuation">]</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>count<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">drawArrays</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">drawElements</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><ol><li>\u9ED8\u8BA4\u5C5E\u6027</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">gl</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">programs</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children2Draw</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>children \u53D8\u6210\u4E86Set\u5BF9\u8C61\uFF0C\u4EE5\u907F\u514D\u4E09\u7EF4\u5BF9\u8C61\u7684\u91CD\u590D\u6DFB\u52A0\u3002<br> programs \u7A0B\u5E8F\u5BF9\u8C61\u96C6\u5408</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">\u7A0B\u5E8F\u5BF9\u8C61\u7684\u540D\u79F0</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span>\u7A0B\u5E8F\u5BF9\u8C61<span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span>attribute\u53D8\u91CF\u540D\u96C6\u5408
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span>uniform\u53D8\u91CF\u540D\u96C6\u5408
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>children2Draw \u7528\u4E8E\u7ED8\u56FE\u7684\u7A0B\u5E8F\u5BF9\u8C61\u548C\u4E09\u7EF4\u5BF9\u8C61\u7684\u96C6\u5408\uFF0C\u6570\u636E\u7ED3\u6784\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">\u7A0B\u5E8F\u5BF9\u8C61\u7684\u540D\u79F0</span><span class="token operator">:</span><span class="token punctuation">[</span>\u5C5E\u4E8E\u6B64\u7A0B\u5E8F\u5BF9\u8C61\u7684\u6240\u6709\u4E09\u7EF4\u5BF9\u8C61<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u4E00\u4E2A\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61\u7684\u65B9\u6CD5\uFF0C\u65B9\u4FBF\u5C06\u5177\u6709\u76F8\u540C\u7A0B\u5E8F\u5BF9\u8C61\u7684\u4E09\u7EF4\u5BF9\u8C61\u4E00\u8D77\u6E32\u67D3\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">registerProgram</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> <span class="token punctuation">{</span> program<span class="token punctuation">,</span> attributeNames<span class="token punctuation">,</span> uniformNames<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span>programs <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> attributes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> uniforms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
  attributeNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    attributes<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  uniformNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    uniforms<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  programs<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token punctuation">{</span>program<span class="token punctuation">,</span>attributes<span class="token punctuation">,</span>uniforms<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>name\uFF1A\u7A0B\u5E8F\u5BF9\u8C61\u7684\u540D\u79F0</li><li>option\uFF1A{} <ul><li>program\uFF1A\u7A0B\u5E8F\u5BF9\u8C61</li><li>attributeNames\uFF1Aattribute\u53D8\u91CF\u540D\u96C6\u5408\uFF0C\u5982[&#39;a_Position&#39;,&#39;a_Pin&#39;,\u2026\u2026]</li><li>uniformNames\uFF1Auniform\u53D8\u91CF\u540D\u96C6\u5408\uFF0C\u5982[&#39;u_PvMatrix&#39;,&#39;u_ModelMatrix&#39;,\u2026\u2026]</li></ul></li></ul><ol start="3"><li><p>\u4E4B\u524D\u7684init \u521D\u59CB\u5316\u65B9\u6CD5\u53EF\u4EE5\u5220\u6389\u4E86\uFF0C\u56E0\u4E3AScene\u5BF9\u8C61\u7684registerProgram\u65B9\u6CD5\u548CObject \u5BF9\u8C61\u7684init() \u65B9\u6CD5\u5DF2\u7ECF\u5206\u644A\u4E86\u6B64\u529F\u80FD\u3002</p></li><li><p>\u589E\u5220\u4E09\u7EF4\u5BF9\u8C61\uFF0C\u5176\u539F\u7406\u548C\u4E4B\u524D\u4E00\u6837</p></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token operator">...</span>objs<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setObjs</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">unshift</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>objs<span class="token punctuation">,</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setObjs</span><span class="token punctuation">(</span>objs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">setObjs</span><span class="token punctuation">(</span><span class="token parameter">objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    objs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        obj<span class="token punctuation">.</span>parent<span class="token operator">=</span><span class="token keyword">this</span>
        obj<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gl<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateChildren2Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateChildren2Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\u5728\u589E\u5220\u4E09\u7EF4\u5BF9\u8C61\u65F6\uFF0C\u9700\u8981\u540C\u6B65\u66F4\u65B0children2Draw \u96C6\u5408</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateChildren2Draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>children<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
  <span class="token keyword">const</span> children2Draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">program</span><span class="token operator">:</span>name <span class="token punctuation">}</span> <span class="token operator">=</span> child<span class="token punctuation">.</span>mat
    <span class="token keyword">if</span> <span class="token punctuation">(</span>children2Draw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children2Draw<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      children2Draw<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>children2Draw<span class="token operator">=</span>children2Draw
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="5"><li>\u6279\u91CF\u8BBE\u7F6E\u6240\u6709\u6A21\u578B\u7684uniform \u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mat <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="6"><li>\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>gl<span class="token punctuation">,</span>children2Draw<span class="token punctuation">,</span>programs<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>objs<span class="token punctuation">]</span> <span class="token keyword">of</span> children2Draw<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> program<span class="token punctuation">,</span> attributes<span class="token punctuation">,</span> uniforms <span class="token punctuation">}</span> <span class="token operator">=</span> programs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
    objs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> <span class="token punctuation">{</span> drawType<span class="token punctuation">,</span>count<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token literal-property property">mat</span><span class="token operator">:</span><span class="token punctuation">{</span>mode<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">=</span>obj
      obj<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> attributes<span class="token punctuation">,</span> uniforms<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> mode <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">[</span>drawType<span class="token punctuation">]</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>count<span class="token punctuation">,</span>mode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mode<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">m</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span>drawType<span class="token punctuation">]</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>count<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">drawArrays</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">drawElements</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_1-2-geo-\u51E0\u4F55\u4F53\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_1-2-geo-\u51E0\u4F55\u4F53\u5BF9\u8C61" aria-hidden="true">#</a> 1.2 Geo \u51E0\u4F55\u4F53\u5BF9\u8C61</h4><p>\u6574\u4F53\u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">drawType</span><span class="token operator">:</span><span class="token string">&#39;drawArrays&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Geo</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initIndex</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">initData</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> attr <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      attr<span class="token punctuation">.</span>buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      attr<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">initIndex</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> index<span class="token punctuation">.</span>array<span class="token punctuation">.</span>length
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawElements&#39;</span>
      index<span class="token punctuation">.</span>buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>index<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      index<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> array<span class="token punctuation">,</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">/</span> size
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawArrays&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>attrs<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateIndex</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>attrs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>attr<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> buffer<span class="token punctuation">,</span> size<span class="token punctuation">,</span> needUpdate<span class="token punctuation">,</span> array <span class="token punctuation">}</span> <span class="token operator">=</span> attr
      <span class="token keyword">const</span> location<span class="token operator">=</span>attrs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        attr<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>array<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> size<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateIndex</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>index<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>index<span class="token punctuation">.</span>array<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">setData</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
      index<span class="token punctuation">.</span>array<span class="token operator">=</span>val
      <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> val<span class="token punctuation">.</span>length
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawElements&#39;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>array<span class="token punctuation">,</span>size<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span>array<span class="token punctuation">.</span>length<span class="token operator">/</span>size
      <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawArrays&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><p>\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u7684\u4EE3\u7801\u3002</p><ol><li>\u521D\u59CB\u5316\u65B9\u6CD5</li></ol><ul><li>\u5220\u6389\u4E4B\u524D\u7684useProgram \u65B9\u6CD5\uFF0C\u56E0\u4E3A\u6B64\u65B9\u6CD5\u5DF2\u7ECF\u5728Scene\u5BF9\u8C61\u4E2D\u7EDF\u4E00\u6267\u884C\u3002</li><li>\u5728\u521D\u59CB\u5316\u65B9\u6CD5\u4E2D\uFF0C\u53EA\u5EFA\u7ACB\u5B58\u50A8attribute \u6570\u636E\u548C\u9876\u70B9\u7D22\u5F15\u96C6\u5408\u7684WebGLBuffer \u7F13\u51B2\u533A\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initIndex</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">initData</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> attr <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    attr<span class="token punctuation">.</span>buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    attr<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">initIndex</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> index<span class="token punctuation">.</span>array<span class="token punctuation">.</span>length
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawElements&#39;</span>
    index<span class="token punctuation">.</span>buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>index<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    index<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> array<span class="token punctuation">,</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">/</span> size
    <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawArrays&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol start="2"><li>\u66F4\u65B0\u65B9\u6CD5\u548C\u4E4B\u524D\u7684\u5DEE\u5F02\u4E0D\u5927\u3002\u5728\u66F4\u65B0attribute \u6570\u636E\u65F6\uFF0Clocation\u9700\u8981\u4ECEScene \u5BF9\u8C61\u7684programs\u4E2D\u83B7\u53D6\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>attrs<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateIndex</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>attrs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>attr<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> buffer<span class="token punctuation">,</span> size<span class="token punctuation">,</span> needUpdate<span class="token punctuation">,</span> array <span class="token punctuation">}</span> <span class="token operator">=</span> attr
    <span class="token keyword">const</span> location<span class="token operator">=</span>attrs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>buffer<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      attr<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
      gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>array<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> size<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">updateIndex</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>index<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      index<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
      gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span>index<span class="token punctuation">.</span>array<span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="3"><li>\u8BBE\u7F6Eattribute \u6570\u636E\u548C\u7D22\u5F15\u96C6\u5408\u7684\u65B9\u6CD5\u548C\u4E4B\u524D\u4E00\u6837\u3002</li></ol><h4 id="_1-3-mat-\u6750\u8D28\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_1-3-mat-\u6750\u8D28\u5BF9\u8C61" aria-hidden="true">#</a> 1.3 Mat \u6750\u8D28\u5BF9\u8C61</h4><p>\u6574\u4F53\u4EE3\u7801\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Mat</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      map<span class="token punctuation">.</span>texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMap</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> map<span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateMap</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      format <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span>
      image<span class="token punctuation">,</span>
      wrapS<span class="token punctuation">,</span>
      wrapT<span class="token punctuation">,</span>
      magFilter<span class="token punctuation">,</span>
      minFilter<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> map
    gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">TEXTURE</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ind<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> map<span class="token punctuation">.</span>texture<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      format<span class="token punctuation">,</span>
      format<span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
      image
    <span class="token punctuation">)</span>
    wrapS<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span>
      wrapS
    <span class="token punctuation">)</span>
    wrapT<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span>
      wrapT
    <span class="token punctuation">)</span>
    magFilter<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span>
      magFilter
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>minFilter <span class="token operator">||</span> minFilter <span class="token operator">&gt;</span> <span class="token number">9729</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">generateMipmap</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    minFilter<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
      minFilter
    <span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>uniforms<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>uniforms<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>obj<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> location <span class="token operator">=</span> uniforms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> obj
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;Matrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>map<span class="token punctuation">]</span><span class="token operator">=</span>arr
      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        map<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMap</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>map<span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> map<span class="token punctuation">.</span>texture<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>uniforms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setData</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setMap</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><p>\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u7684\u4EE3\u7801\u3002</p><ol><li>\u5728\u9ED8\u8BA4\u5C5E\u6027\u4E2D\uFF0Cprogram\u5C5E\u6027\u5BF9\u5E94\u7A0B\u5E8F\u5BF9\u8C61\u7684\u6CE8\u518C\u540D\uFF0C\u5B9E\u9645\u7684\u7A0B\u5E8F\u5BF9\u8C61\u9700\u8981\u901A\u8FC7\u6CE8\u518C\u540D\u4ECEScene\u5BF9\u8C61\u7684programs \u4E2D\u83B7\u53D6\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>\u6539\u53D8\u9ED8\u8BA4\u5C5E\u6027\u4E2Ddata \u7684\u6570\u636E\u7ED3\u6784\u3002</li></ol><p>\u4E4B\u524Ddata \u7684\u6570\u636E\u7ED3\u679C\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>    
    <span class="token literal-property property">location</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">needUpdate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  \u2026\u2026    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li><p>location \u5DF2\u7ECF\u653E\u5728\u4E86Scene \u5BF9\u8C61\u7684programs\u4E2D\uFF0C\u6240\u4EE5\u53EF\u4EE5\u5220\u6389\u3002</p></li><li><p>needUpdate \u53EA\u9002\u7528\u4E8E\u4E00\u4E2A\u7A0B\u5E8F\u5BF9\u8C61\u5BF9\u5E94\u4E00\u4E2A\u4E09\u7EF4\u5BF9\u8C61\u7684\u60C5\u51B5\u3002</p><p>\u5728\u4E00\u4E2A\u7A0B\u5E8F\u5BF9\u8C61\u5BF9\u5E94\u591A\u4E2A\u4E09\u7EF4\u5BF9\u8C61\u7684\u65F6\u5019\uFF0C\u5728\u6BCF\u4E2A\u4E09\u7EF4\u5BF9\u8C61\u7ED8\u5236\u524D\uFF0C\u90FD\u9700\u8981\u66F4\u65B0uniform\u6570\u636E\u3002</p><p>\u6240\u4EE5\uFF0CneedUpdate \u523B\u610F\u5220\u6389</p></li></ul><ol start="3"><li>\u5728maps \u6570\u636E\u7ED3\u6784\u4E2D\uFF0C\u5199\u5165texture\u548CneedUpdate \u5C5E\u6027\uFF0C\u8BA9\u8D34\u56FE\u5728\u9700\u8981\u66F4\u65B0\u7684\u65F6\u5019\u518D\u66F4\u65B0\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span><span class="token punctuation">{</span>
    image<span class="token punctuation">,</span>
    format<span class="token punctuation">,</span>
    wrapS<span class="token punctuation">,</span>
    wrapT<span class="token punctuation">,</span>
    magFilter<span class="token punctuation">,</span>
    minFilter<span class="token punctuation">,</span>
    texture<span class="token punctuation">,</span>  
    needUpdate<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="4"><li>\u5728\u521D\u59CB\u5316\u65B9\u6CD5\u4E2D\uFF0C\u53EA\u5BF9\u8D34\u56FE\u6570\u636E\u505A\u4E00\u4E0B\u7F13\u5B58\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">.</span>texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMap</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> map<span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>updateMap()\u66F4\u65B0\u8D34\u56FE\u7684\u65B9\u6CD5\u4F1A\u8BBE\u7F6EWebGLTexture \u5BF9\u8C61\u7684\u5404\u79CD\u5C5E\u6027\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateMap</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    format <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span>
    image<span class="token punctuation">,</span>
    wrapS<span class="token punctuation">,</span>
    wrapT<span class="token punctuation">,</span>
    magFilter<span class="token punctuation">,</span>
    minFilter<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> map
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">TEXTURE</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ind<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> map<span class="token punctuation">.</span>texture<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
    format<span class="token punctuation">,</span>
    format<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
    image
  <span class="token punctuation">)</span>
  wrapS<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span>
    wrapS
  <span class="token punctuation">)</span>
  wrapT<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span>
    wrapT
  <span class="token punctuation">)</span>
  magFilter<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span>
    magFilter
  <span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>minFilter <span class="token operator">||</span> minFilter <span class="token operator">&gt;</span> <span class="token number">9729</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">generateMipmap</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  minFilter<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
    minFilter
  <span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><ol start="5"><li>\u66F4\u65B0\u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>uniforms<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>uniforms<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>obj<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> location <span class="token operator">=</span> uniforms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> obj
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;Matrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span>map<span class="token punctuation">]</span><span class="token operator">=</span>arr
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      map<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">false</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMap</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>map<span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> map<span class="token punctuation">.</span>texture<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>uniforms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="6"><li>\u8BBE\u7F6Euniform\u6570\u636E\u548C\u8D34\u56FE\u6570\u636E\u7684\u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setData</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">setMap</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
  obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_1-4-obj3d-\u4E09\u7EF4\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_1-4-obj3d-\u4E09\u7EF4\u5BF9\u8C61" aria-hidden="true">#</a> 1.4 Obj3D \u4E09\u7EF4\u5BF9\u8C61</h4><p>Obj3D \u4E09\u7EF4\u5BF9\u8C61\u7684\u6574\u4F53\u4EE3\u7801\u548C\u4E4B\u524D\u7684\u5DEE\u5F02\u4E0D\u5927\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">geo</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mat</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Obj3D</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>geo<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>attributes<span class="token punctuation">,</span>uniforms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>geo<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>attributes<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>uniforms<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>\u5BF9\u4E8Ewebgl\u6846\u67B6\u7684\u642D\u5EFA\uFF0C\u5927\u5BB6\u7B80\u5355\u7406\u89E3\u4E00\u4E0B\u5176\u5B9E\u73B0\u539F\u7406\u548C\u8FC7\u7A0B\u5C31\u53EF\u4EE5\u4E86\u3002<br> \u5E76\u4E0D\u5EFA\u8BAE\u5927\u5BB6\u5728webgl\u6846\u67B6\u523B\u610F\u82B1\u8D39\u592A\u591A\u7684\u65F6\u95F4\uFF0C\u539F\u56E0\u6709\u4E24\u70B9\uFF1A</p><ul><li>\u4E0Ewebgl\u6846\u67B6\u76F8\u6BD4\uFF0C\u56FE\u5F62\u5B66\u624D\u662F\u91CD\u70B9\u3002\u56E0\u4E3A\u6211\u4EEC\u82E5\u4E0D\u61C2\u56FE\u5F62\u5B66\uFF0C\u662F\u65E0\u6CD5\u7075\u6D3B\u9A7E\u9A6Dthree.js \u8FD9\u79CD\u73B0\u6709\u6846\u67B6\u7684\u3002</li><li>\u672A\u6765WebGPU \u4F1A\u66FF\u4EE3WebGL\u3002</li></ul><h3 id="_2-\u7ED8\u5236\u522B\u5885\u7684\u697C\u5C42\u5E03\u5C40\u56FE" tabindex="-1"><a class="header-anchor" href="#_2-\u7ED8\u5236\u522B\u5885\u7684\u697C\u5C42\u5E03\u5C40\u56FE" aria-hidden="true">#</a> 2.\u7ED8\u5236\u522B\u5885\u7684\u697C\u5C42\u5E03\u5C40\u56FE</h3><p>\u5F53\u524D\u8FD9\u680B\u522B\u5885\u6709\u516D\u5C42\u697C\uFF0C\u54B1\u4EEC\u5148\u5C06\u8FD9\u516D\u5C42\u697C\u7684\u5E03\u5C40\u56FE\u753B\u51FA\u6765\u3002</p><ol><li>\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="2"><li>\u5F15\u5165\u5404\u79CD\u7EC4\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram<span class="token punctuation">,</span> imgPromise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> 
  Matrix4<span class="token punctuation">,</span> 
  PerspectiveCamera<span class="token punctuation">,</span> 
  Vector3 
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Obj3D.js&#39;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Scene.js&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>\u83B7\u53D6webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u8BBE\u7F6E\u5176\u6E05\u7406\u753B\u5E03\u7684\u989C\u8272\uFF0C\u5F00\u542F\u6DF1\u5EA6\u6D4B\u8BD5\u548C\u900F\u660E\u5EA6\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>\u5EFA\u7ACB\u52A0\u8F7D\u56FE\u7247\u7684promise\u96C6\u5408\uFF0C\u7B49\u6240\u6709\u56FE\u7247\u90FD\u52A0\u8F7D\u6210\u529F\u540E\u518D\u6E32\u67D3\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ele<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png</span><span class="token template-punctuation string">\`</span></span>
  <span class="token keyword">return</span> <span class="token function">imgPromise</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>\u58F0\u660E\u6BCF\u5C42\u697C\u4E4B\u95F4\u7684\u9AD8\u5EA6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5C42\u9AD8</span>
<span class="token keyword">const</span> fh <span class="token operator">=</span> <span class="token number">0.5</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="6"><li>\u5EFA\u7ACB\u8F68\u9053\u63A7\u5236\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u89C6\u70B9\u76F8\u5BF9\u4E8E\u76EE\u6807\u70B9\u7684\u4F4D\u7F6E</span>
<span class="token keyword">const</span> dist <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2.8</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
<span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span>
<span class="token comment">//\u89C6\u70B9</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span>
<span class="token punctuation">]</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
<span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="7"><li>\u5EFA\u7ACB\u573A\u666F\u5BF9\u8C61\uFF0C\u7136\u540E\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// \u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="8"><li>\u5F53\u6240\u6709\u56FE\u7247\u90FD\u52A0\u8F7D\u6210\u529F\u540E\u518D\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">imgs</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">img<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">crtObj</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> ind<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>crtObj(img, ind) \u57FA\u4E8E\u56FE\u7247\u548C\u56FE\u7247\u7D22\u5F15\u5EFA\u7ACB\u4E09\u7EF4\u5BF9\u8C61</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">crtObj</span><span class="token punctuation">(</span><span class="token parameter">image<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> fh <span class="token operator">*</span> ind
  <span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> y
  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;img&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        image<span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLE_STRIP&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
          <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>
          <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
          <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>render() \u8FDE\u7EED\u6E32\u67D3\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="9"><li>orbit\u8F68\u9053\u63A7\u5236\u5668\u7684\u4EA4\u4E92\u4E8B\u4EF6\u548C\u4E4B\u524D\u90FD\u4E00\u6837</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u6700\u7EC8\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+s+`" alt=""></p><p>\u573A\u666F\u5DF2\u7ECF\u642D\u5EFA\u5B8C\u6210\uFF0C\u63A5\u4E0B\u6765\u5C31\u8981\u8003\u8651\u522B\u5885\u697C\u5C42\u7684\u5207\u6362\u52A8\u753B\u4E86\u3002<br> \u522B\u5885\u697C\u5C42\u7684\u5207\u6362\uFF0C\u9700\u8981\u4E00\u4E2A\u901A\u8FC7\u624B\u52A8\u8BBE\u7F6E\u89C6\u70B9\u548C\u76EE\u6807\u70B9\u66F4\u65B0\u76F8\u673A\u8F68\u9053\u7684\u529F\u80FD\u3002<br> \u5F53\u524D\u5199\u7684OrbitControls \u8FD8\u6709\u70B9\u7455\u75B5\uFF0C\u65E0\u6CD5\u5B9E\u73B0\u6B64\u529F\u80FD\uFF0C\u6240\u4EE5\u9700\u8981\u5B8C\u5584\u4E00\u4E0B\u3002</p><h3 id="_3-\u5B8C\u5584\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#_3-\u5B8C\u5584\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" aria-hidden="true">#</a> 3.\u5B8C\u5584\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668</h3><p>\u5148\u56DE\u987E\u4E00\u4E0B\u5F53\u524D\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u7684\u66F4\u65B0\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>camera<span class="token punctuation">,</span>target<span class="token punctuation">,</span>spherical<span class="token punctuation">,</span>panOffset<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>

  <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u76F8\u673A</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
    target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
  spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u4E0A\u9762\u7684\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A\uFF0C\u5B9E\u9645\u4E0A\u662F\u6CA1\u610F\u4E49\u7684\u3002\u56E0\u4E3A\u76F8\u673A\u4F4D\u7F6E\u4F1A\u88AB\u540E\u9762\u7684\u7403\u5750\u6807\u91CD\u5199\u3002</p><ol><li>\u6211\u4EEC\u82E5\u60F3\u8BA9\u76F8\u673A\u76EE\u6807\u70B9\u548C\u89C6\u70B9\u4F4D\u7F6E\u5F71\u54CD\u8F68\u9053\u63A7\u5236\u5668\uFF0C\u90A3\u5C31\u5F97\u628A\u8FD9\u4E2A\u66F4\u65B0\u65B9\u6CD5\u62C6\u5206\u4E00\u4E0B\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u66F4\u65B0\u76F8\u673A\u8F68\u9053</span>
<span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>camera<span class="token punctuation">,</span>target<span class="token punctuation">,</span>spherical<span class="token punctuation">,</span>panOffset<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u91CD\u7F6E\u504F\u79FB\u91CF</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u66F4\u65B0\u76F8\u673A\u8F68\u9053</span>
<span class="token function">updateSph</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>camera<span class="token punctuation">,</span>target<span class="token punctuation">,</span>spherical<span class="token punctuation">,</span>panOffset<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
    target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u91CD\u7F6E\u7403\u5750\u6807</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
<span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>camera<span class="token punctuation">,</span>target<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u91CD\u7F6E\u7403\u5750\u6807</span>
<span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>spherical<span class="token punctuation">,</span>camera<span class="token punctuation">,</span>target<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
  spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ol start="2"><li>\u5728\u76F8\u673A\u8F68\u9053\u7684\u5E73\u79FB\u65B9\u6CD5\u4E2D\u8C03\u7528updatePos() \u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">panPerspectiveCamera</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">panOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li>\u5728\u76F8\u673A\u8F68\u9053\u7684\u7F29\u653E\u548C\u65CB\u8F6C\u65B9\u6CD5\u4E2D\u8C03\u7528updateSph() \u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">dollyPerspectiveCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSph</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">dollyOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSph</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSph</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="4"><li>\u6784\u9020\u51FD\u6570</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5173\u4E8E\u76F8\u673A\u8F68\u9053\u7684\u5B8C\u5584\u5C31\u8BF4\u5230\u8FD9\uFF0C\u81EA\u5DF1\u9020\u8F6E\u5B50\u7684\u597D\u5904\u5C31\u662F\u53EF\u4EE5\u57FA\u4E8E\u81EA\u5DF1\u7684\u529F\u80FD\u9700\u6C42\u968F\u65F6\u8C03\u6574\u3002</p><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u53BB\u505A\u8865\u95F4\u52A8\u753B\u3002</p><h3 id="_4-\u76F8\u673A\u8F68\u9053\u7684\u8865\u95F4\u52A8\u753B" tabindex="-1"><a class="header-anchor" href="#_4-\u76F8\u673A\u8F68\u9053\u7684\u8865\u95F4\u52A8\u753B" aria-hidden="true">#</a> 4.\u76F8\u673A\u8F68\u9053\u7684\u8865\u95F4\u52A8\u753B</h3><ol><li>\u5F15\u5165\u5408\u6210\u5BF9\u8C61\u548C\u8F68\u9053\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Compose <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Compose.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Track.js&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>\u58F0\u660E\u5FC5\u5907\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5F53\u524D\u697C\u5C42</span>
<span class="token keyword">let</span> curFloor <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">//\u5EFA\u7ACB\u5408\u6210\u5BF9\u8C61</span>
<span class="token keyword">const</span> compose <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u8865\u95F4\u6570\u636E</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>z1<span class="token punctuation">,</span> z2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.65</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
<span class="token comment">// \u6240\u6709\u697C\u5C42\u6240\u5BF9\u5E94\u7684\u8865\u95F4\u6570\u636E</span>
<span class="token keyword">const</span> floorData <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> promises<span class="token punctuation">.</span>length <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">z</span><span class="token operator">:</span> z1<span class="token punctuation">,</span> <span class="token literal-property property">s</span><span class="token operator">:</span> s1 <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// \u76F8\u673A\u7684\u8865\u95F4\u6570\u636E</span>
<span class="token keyword">const</span> cameraData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token comment">// \u697C\u5C42\u8FD0\u52A8\u65B9\u5411</span>
<span class="token keyword">let</span> dir <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="3"><li>\u6BCF\u9694\u4E00\u6BB5\u65F6\u95F4\uFF0C\u5207\u6362\u697C\u5C42</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">changeFloor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>curFloor <span class="token operator">&gt;</span> promises<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dir <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>curFloor <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dir <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">setFloor</span><span class="token punctuation">(</span>curFloor <span class="token operator">+</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>\u5BF9\u67D0\u4E2A\u697C\u5C42\u8FDB\u884C\u7279\u5199 setFloor(n)</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">setFloor</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">updateFloor</span><span class="token punctuation">(</span>curFloor<span class="token punctuation">,</span> z1<span class="token punctuation">,</span> s1<span class="token punctuation">)</span>
  curFloor <span class="token operator">=</span> n
  <span class="token function">updateFloor</span><span class="token punctuation">(</span>curFloor<span class="token punctuation">,</span> z2<span class="token punctuation">,</span> s2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5BF9\u4EE5\u524D\u7279\u5199\u7684\u697C\u5C42\u53D6\u6D88\u7279\u5199\uFF0C\u7136\u540E\u518D\u5BF9\u5F53\u524D\u697C\u5C42\u8FDB\u884C\u7279\u5199\u3002</p><ol start="5"><li>\u66F4\u65B0\u697C\u5C42updateFloor(n, z, s)</li></ol><ul><li>n \u5C42\u6570</li><li>z \u697C\u5C42z\u4F4D\u7F6E</li><li>s \u697C\u5C42\u7F29\u653E\u6570\u636E</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateFloor</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> z<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> floor2 <span class="token operator">=</span> floorData<span class="token punctuation">[</span>n<span class="token punctuation">]</span>
  <span class="token keyword">const</span> floor1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>floor2 <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>floor2<span class="token punctuation">,</span> <span class="token punctuation">{</span> z<span class="token punctuation">,</span> s <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> cameraData1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>cameraData <span class="token punctuation">}</span>
  cameraData<span class="token punctuation">.</span>y <span class="token operator">=</span> fh <span class="token operator">*</span> n
  <span class="token function">crtTrack</span><span class="token punctuation">(</span>floor1<span class="token punctuation">,</span> floor2<span class="token punctuation">)</span>
  <span class="token function">crtTrack</span><span class="token punctuation">(</span>cameraData1<span class="token punctuation">,</span> cameraData<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>floor1 \u697C\u5C42\u8865\u95F4\u52A8\u753B\u7684\u7B2C1\u5E27</li><li>floor2 \u697C\u5C42\u8865\u95F4\u52A8\u753B\u7684\u7B2C2\u5E27</li><li>cameraData1 \u76F8\u673A\u8865\u95F4\u52A8\u753B\u7684\u7B2C1\u5E27</li><li>cameraData \u76F8\u673A\u8865\u95F4\u52A8\u753B\u7684\u7B2C2\u5E27</li></ul><ol start="6"><li>\u5EFA\u7ACB\u65F6\u95F4\u8F68crtTrack(f1,f2)</li></ol><ul><li>f1 \u8865\u95F4\u52A8\u753B\u7B2C1\u5E27\u7684\u6570\u636E</li><li>f2 \u8865\u95F4\u52A8\u753B\u7B2C2\u5E27\u7684\u6570\u636E</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">crtTrack</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  compose<span class="token punctuation">.</span><span class="token function">deleteByTarget</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span>
  <span class="token keyword">const</span> track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span>
  track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>   obj1<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span> obj2<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&#39;z&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> obj1<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">,</span> obj2<span class="token punctuation">.</span>z<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&#39;s&#39;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span> obj1<span class="token punctuation">.</span>s<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">,</span> obj2<span class="token punctuation">.</span>s<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  compose<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="7"><li>\u5F53\u6240\u6709\u56FE\u7247\u90FD\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u6E32\u67D3\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">imgs</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  imgs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">img<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">crtObj</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> ind<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">setFloor</span><span class="token punctuation">(</span>curFloor<span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span>changeFloor<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="8"><li>\u5728\u6E32\u67D3\u65B9\u6CD5\u4E2D\uFF0C\u66F4\u65B0\u5408\u6210\u5BF9\u8C61\u3001\u6A21\u578B\u77E9\u9635\u548C\u76F8\u673A\u8F68\u9053\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  compose<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">updateModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">updateOrbit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>updateModelMatrix() \u66F4\u65B0\u6A21\u578B\u77E9\u9635</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateModelMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  floorData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> z<span class="token punctuation">,</span> s <span class="token punctuation">}</span><span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">]</span><span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>mat<span class="token punctuation">.</span>data<span class="token punctuation">.</span>u_ModelMatrix
    value<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> z
    value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> s
    value<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> s
    value<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> s
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>updateOrbit() \u66F4\u65B0\u76F8\u673A\u8F68\u9053</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateOrbit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> cameraData
  target<span class="token punctuation">.</span>y <span class="token operator">=</span> y
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> dist<span class="token punctuation">.</span>y <span class="token operator">+</span> y
  orbit<span class="token punctuation">.</span><span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u522B\u5885\u4E09\u7EF4\u5E03\u5C40\u56FE\u7684\u6574\u4F53\u4EE3\u7801\u5C31\u5199\u5230\u8FD9\u3002</p><p>\u4E4B\u540E\u5927\u5BB6\u8FD8\u53EF\u4EE5\u518D\u505A\u8FDB\u4E00\u6B65\u5B8C\u5584\uFF1A</p><ul><li>\u5C06\u5E73\u9762\u56FE\u53D8\u62103d\u6A21\u578B\u56FE\uFF0C\u8FD9\u5C31\u662F\u4E00\u4E2A\u6A21\u578B\u5BFC\u5165\u7684\u95EE\u9898\uFF0C\u5F88\u7B80\u5355\uFF0C\u6211\u4EEC\u540E\u9762\u4F1A\u8BF4\u3002</li><li>\u901A\u8FC7\u9F20\u6807\u4E8B\u4EF6\u5207\u6362\u697C\u5C42\u3002 <ul><li>\u70B9\u51FB\u6309\u94AE\u5207\u6362\u697C\u5C42\u3002</li><li>\u70B9\u51FB\u6A21\u578B\u5207\u6362\u697C\u5C42\u3002\u6A21\u578B\u7684\u9009\u62E9\u65B9\u6CD5\u6211\u4EEC\u4E4B\u524D\u5DF2\u7ECF\u8BF4\u8FC7\uFF0C\u6240\u4EE5\u6211\u4E5F\u5C31\u4E0D\u518D\u5BF9\u697C\u5C42\u505A\u9009\u62E9\u4E86</li></ul></li></ul><p><img src="`+T+'" alt=""></p><p>\u5E0C\u671B\u5927\u5BB6\u53EF\u4EE5\u7167\u846B\u82A6\u753B\u74E2\uFF0C\u5C06\u8BFE\u7A0B\u91CC\u5E95\u5C42\u539F\u7406\u878D\u6C47\u8D2F\u901A\uFF0C\u636E\u4E3A\u5DF1\u7528\u3002<br> \u4EE5\u540E\u9047\u5230\u76F8\u5173\u9700\u6C42\u7684\u9879\u76EE\uFF0C\u90FD\u53EF\u4EE5\u5FEB\u901F\u7684\u6293\u4F4F\u672C\u8D28\uFF0C\u6709\u6761\u4E0D\u7D0A\u7684\u5F00\u53D1\u9879\u76EE\u3002<br> \u5373\u4F7F\u73B0\u6709\u7684\u6846\u67B6\u7528\u7740\u4E0D\u987A\u624B\u4E86\uFF0C\u4E5F\u53EF\u4EE5\u81EA\u5DF1\u53BB\u6539\u88C5\u3002</p>',538);function O(R,D){return F}var V=p(C,[["render",O]]);export{V as default};
