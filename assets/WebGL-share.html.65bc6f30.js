import{r as P,o as S,a as E,b as s,d as t,F as M,c as a,e as n}from"./app.6795915a.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";var T="/visual/webgl-share/1.png",A="/visual/webgl-share/2.png",B="/visual/webgl-share/3.png",F="/visual/webgl-share/4.png",C="/visual/webgl-share/5.png",c="/visual/webgl-share/6.png",I="/visual/webgl-share/7.png",l="/visual/webgl-share/8.png",L="/visual/webgl-share/9.png",O="/visual/webgl-share/11.png",u="/visual/webgl-share/12.png",D="/visual/webgl-share/13.png",z="/visual/webgl-share/14.png",U="/visual/webgl-share/15.png",V="/visual/webgl-share/16.png",N="/visual/webgl-share/1.gif",G="/visual/webgl-share/2.gif",W="/visual/webgl-share/17.png",H="/visual/webgl-share/18.png",Y="/visual/webgl-share/19.png",X="/visual/webgl-share/20.png",K="/visual/webgl-share/21.png",Z="/visual/webgl-share/22.png",Q="/visual/webgl-share/23.png",$="/visual/webgl-share/24.png",J="/visual/webgl-share/25.png",nn="/visual/webgl-share/26.png",sn="/visual/webgl-share/27.png",an="/visual/webgl-share/28.png",pn="/visual/webgl-share/29.png",tn="/visual/webgl-share/30.png",en="/visual/webgl-share/31.png",on="/visual/webgl-share/32.png",cn="/visual/webgl-share/34.png",ln="/visual/webgl-share/33.png",un="/visual/webgl-share/35.png",rn="/visual/webgl-share/3.gif",kn="/visual/webgl-share/4.gif",bn="/visual/webgl-share/5.gif",mn="/visual/webgl-share/36.png",dn="/visual/webgl-share/37.png",gn="/visual/webgl-share/38.png",vn="/visual/webgl-share/39.png",yn="/visual/webgl-share/40.png",fn="/visual/webgl-share/41.png",hn="/visual/webgl-share/42.png",wn="/visual/webgl-share/43.png",xn="/visual/webgl-share/44.png",_n="/visual/webgl-share/45.png",jn="/visual/webgl-share/46.png",qn="/visual/webgl-share/47.png",Pn="/visual/webgl-share/48.png",Sn="/visual/webgl-share/49.png",En="/visual/webgl-share/50.png",Mn="/visual/webgl-share/60.png",Rn="/visual/webgl-share/61.png",Tn="/visual/webgl-share/51.png",An="/visual/webgl-share/52.png",Bn="/visual/webgl-share/53.png",Fn="/visual/webgl-share/54.png",Cn="/visual/webgl-share/55.png",In="/visual/webgl-share/56.png",r="/visual/webgl-share/57.png",Ln="/visual/webgl-share/58.png",On="/visual/webgl-share/59.png",Dn="/visual/webgl-share/62.png",i="/visual/webgl-share/63.png",zn="/visual/webgl-share/64.png",Un="/visual/webgl-share/65.png",Vn="/visual/webgl-share/66.png",Nn="/visual/webgl-share/67.gif",Gn="/visual/webgl-share/68.png",Wn="/visual/webgl-share/69.png",k="/visual/webgl-share/80.png",Hn="/visual/webgl-share/70.png",Yn="/visual/webgl-share/71.png",Xn="/visual/webgl-share/72.png",Kn="/visual/webgl-share/73.png",Zn="/visual/webgl-share/74.png",Qn="/visual/webgl-share/75.png",$n="/visual/webgl-share/76.png",Jn="/visual/webgl-share/77.png",ns="/visual/webgl-share/78.png",ss="/visual/webgl-share/79.png",as="/visual/webgl-share/81.png",ps="/visual/webgl-share/82.png",ts="/visual/webgl-share/83.png",es="/visual/webgl-share/84.png",os="/visual/webgl-share/86.gif",cs="/visual/webgl-share/85.jpg",ls="/visual/webgl-share/87.jpg",us="/visual/webgl-share/88.jpg",rs="/visual/webgl-share/89.png",is="/visual/webgl-share/90.png",ks="/visual/webgl-share/91.png",bs="/visual/webgl-share/92.png",ms="/visual/webgl-share/93.png",ds="/visual/webgl-share/94.png",gs="/visual/webgl-share/95.png",vs="/visual/webgl-share/96.png",b="/visual/webgl-share/97.png",ys="/visual/webgl-share/98.png",fs="/visual/webgl-share/99.png",hs="/visual/webgl-share/100.png",ws="/visual/webgl-share/101.png",xs="/visual/webgl-share/102.png",_s="/visual/webgl-share/103.png",m="/visual/webgl-share/104.png",d="/visual/webgl-share/105.png",js="/visual/webgl-share/106.png",qs="/visual/webgl-share/107.png",Ps="/visual/webgl-share/108.png",Ss="/visual/webgl-share/109.png",Es="/visual/webgl-share/110.png",Ms="/visual/webgl-share/111.png",Rs="/visual/webgl-share/112.gif",Ts="/visual/webgl-share/113.png",As="/visual/webgl-share/116.gif",e="/visual/webgl-share/114.png",Bs="/visual/webgl-share/117.gif",Fs="/visual/webgl-share/115.png",Cs="/visual/webgl-share/118.png",Is="/visual/webgl-share/119.png",Ls="/visual/webgl-share/120.png",Os="/visual/webgl-share/121.png",Ds="/visual/webgl-share/122.gif",zs="/visual/webgl-share/123.png",Us="/visual/webgl-share/124.png",Vs="/visual/webgl-share/125.png",Ns="/visual/webgl-share/126.png",Gs="/visual/webgl-share/127.png",Ws="/visual/webgl-share/128.png",Hs="/visual/webgl-share/129.png",Ys="/visual/webgl-share/130.png",Xs="/visual/webgl-share/131.png",Ks="/visual/webgl-share/132.png",Zs="/visual/webgl-share/133.png",Qs="/visual/webgl-share/134.png",$s="/visual/webgl-share/135.png",o="/visual/webgl-share/136.png",Js="/visual/webgl-share/137.png",na="/visual/webgl-share/138.png",sa="/visual/webgl-share/139.png",aa="/visual/webgl-share/140.png",pa="/visual/webgl-share/141.png",ta="/visual/webgl-share/142.png",ea="/visual/webgl-share/143.png",g="/visual/webgl-share/144.png",oa="/visual/webgl-share/145.png",ca="/visual/webgl-share/146.png",la="/visual/webgl-share/147.png",ua="/visual/webgl-share/148.png",ra="/visual/webgl-share/149.png",ia="/visual/webgl-share/150.png",ka="/visual/webgl-share/151.png",ba="/visual/webgl-share/152.png",ma="/visual/webgl-share/153.png",da="/visual/webgl-share/154.png",ga="/visual/webgl-share/155.png",va="/visual/webgl-share/156.png",ya="/visual/webgl-share/157.png",fa="/visual/webgl-share/158.png",ha="/visual/webgl-share/159.png",wa="/visual/webgl-share/160.png",xa="/visual/webgl-share/161.png",_a="/visual/webgl-share/162.png",ja="/visual/webgl-share/163.png",qa="/visual/webgl-share/164.png",Pa="/visual/webgl-share/165.png",Sa="/visual/webgl-share/166.png",Ea="/visual/webgl-share/167.png",Ma="/visual/webgl-share/168.png",Ra="/visual/webgl-share/169.png",Ta="/visual/webgl-share/170.png",Aa="/visual/webgl-share/171.png",Ba="/visual/webgl-share/172.png",v="/visual/webgl-share/173.png",Fa="/visual/webgl-share/174.png",Ca="/visual/webgl-share/175.png",Ia="/visual/webgl-share/176.png",La="/visual/webgl-share/177.jpg",y="/visual/webgl-share/178.png",Oa="/visual/webgl-share/179.png",Da="/visual/webgl-share/180.png",f="/visual/webgl-share/181.jpg",za="/visual/webgl-share/182.png",Ua="/visual/webgl-share/183.png",Va="/visual/webgl-share/184.png",Na="/visual/webgl-share/185.png",Ga="/visual/webgl-share/186.png",h="/visual/webgl-share/187.png",Wa="/visual/webgl-share/188.png",Ha="/visual/webgl-share/189.jpg",w="/visual/webgl-share/190.png",Ya="/visual/webgl-share/191.png",x="/visual/webgl-share/192.png",Xa="/visual/webgl-share/193.png",Ka="/visual/webgl-share/194.png",_="/visual/webgl-share/195.png",Za="/visual/webgl-share/196.png",Qa="/visual/webgl-share/197.png",$a="/visual/webgl-share/198.png",Ja="/visual/webgl-share/199.png",np="/visual/webgl-share/200.png",sp="/visual/webgl-share/201.png",ap="/visual/webgl-share/202.png",pp="/visual/webgl-share/203.png",tp="/visual/webgl-share/205.png",ep="/visual/webgl-share/206.png",j="/visual/webgl-share/207.png",q="/visual/webgl-share/208.png",op="/visual/webgl-share/209.png",cp="/visual/webgl-share/210.png",lp="/visual/webgl-share/211.png";const up={},rp=a('<h1 id="webgl" tabindex="-1"><a class="header-anchor" href="#webgl" aria-hidden="true">#</a> WebGL</h1><h2 id="\u4E00\u3001webgl\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001webgl\u4ECB\u7ECD" aria-hidden="true">#</a> \u4E00\u3001WebGL\u4ECB\u7ECD</h2><blockquote><p>WebGL\uFF08Web Graphics Library\uFF09\u662F\u4E00\u79CD 3D \u7ED8\u56FE\u534F\u8BAE\uFF0CWebGL\u6280\u672F\u7ED3\u5408\u4E86HTML5\u548CJavaScript\u5728\u7F51\u9875\u4E0A\u7ED8\u5236\u548C\u6E32\u67D3\u590D\u6742\u7684\u4E09\u7EF4\u56FE\u5F62\uFF0C\u5E76\u5141\u8BB8\u7528\u6237\u4E0E\u4E4B\u8FDB\u884C\u4EA4\u4E92\u7684\u6280\u672F\u3002\u5E76\u4E14WebGL\u662F\u5185\u5D4C\u5728\u6D4F\u89C8\u5668\u4E2D\u7684\uFF0C\u4E0D\u5FC5\u5B89\u88C5\u63D2\u4EF6\u548C\u5E93\u5C31\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\uFF0C\u56E0\u4E3A\u5176\u57FA\u4E8E\u6D4F\u89C8\u5668\u7684\u7279\u6027\uFF0C\u53EF\u4EE5\u5728\u591A\u5E73\u53F0\u4E0A\u8FD0\u884CWebGL\u7A0B\u5E8F\uFF0C\u5982\u8BA1\u7B97\u673A\u3001\u5E73\u677F\u548C\u624B\u673A\u3002</p></blockquote><p><img src="'+T+'" alt=""></p><h3 id="_1-webgl\u7684\u8D77\u6E90" tabindex="-1"><a class="header-anchor" href="#_1-webgl\u7684\u8D77\u6E90" aria-hidden="true">#</a> 1.WebGL\u7684\u8D77\u6E90</h3><p>WebGL\uFF08\u4F7F\u7528\u7684\u8BED\u8A00\u53EB\u505AGLSL ES\uFF09\u662F\u57FA\u4E8E\u53E6\u4E00\u79CD\u4E09\u7EF4\u56FE\u5F62\u6E32\u67D3\u6280\u672FOpenGL ES2.0\u4EA7\u751F\u7684\uFF0C\u6DFB\u52A0\u4E86\u65B0\u7279\u6027\u5E76\u4E14\u79FB\u9664\u4E86\u5F88\u591A\u9648\u65E7\u65E0\u7528\u7684\u65E7\u7279\u6027\uFF0C\u66F4\u52A0\u8F7B\u91CF\uFF0C\u4FDD\u6301\u8DB3\u591F\u7684\u80FD\u529B\u6765\u6E32\u67D3\u7CBE\u7F8E\u7684\u4E09\u7EF4\u56FE\u5F62\u3002</p><p><img src="'+A+'" alt=""></p><h3 id="_2-webgl\u7A0B\u5E8F\u7684\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#_2-webgl\u7A0B\u5E8F\u7684\u7ED3\u6784" aria-hidden="true">#</a> 2.WebGL\u7A0B\u5E8F\u7684\u7ED3\u6784</h3><p>\u4F20\u7EDF\u7684\u52A8\u6001\u7F51\u9875\u548CWebGL\u7F51\u9875\u7ED3\u6784\u5BF9\u6BD4\u5982\u4E0B\uFF1A</p><p><img src="'+B+`" alt=""></p><h2 id="\u4E8C\u3001webgl\u57FA\u7840\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001webgl\u57FA\u7840\u77E5\u8BC6" aria-hidden="true">#</a> \u4E8C\u3001WebGL\u57FA\u7840\u77E5\u8BC6</h2><h3 id="_1-\u5237\u5E95\u8272" tabindex="-1"><a class="header-anchor" href="#_1-\u5237\u5E95\u8272" aria-hidden="true">#</a> 1.\u5237\u5E95\u8272</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// \u83B7\u53D6 &lt;canvas&gt; \u5143\u7D20</span>
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6 WebGL \u7ED8\u56FE\u4E0A\u4E0B\u6587</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u989C\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6E05\u7A7A\u989C\u8272\u7F13\u51B2\u533A</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+F+'" alt=""></p><p>\u6CE8\u610F\uFF1A<br><img src="'+C+'" alt=""></p></details><h3 id="_2-webgl-\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_2-webgl-\u5750\u6807\u7CFB" aria-hidden="true">#</a> 2.webgl \u5750\u6807\u7CFB</h3><blockquote><p>canvas 2d \u753B\u5E03\u7684\u5750\u6807\u7CFB<br> canvas 2d \u5750\u6807\u7CFB\u7684\u539F\u70B9\u5728\u5DE6\u4E0A\u89D2<br> canvas 2d \u5750\u6807\u7CFB\u7684 y \u8F74\u65B9\u5411\u662F\u671D\u4E0B\u7684<br> canvas 2d \u5750\u6807\u7CFB\u7684\u5750\u6807\u57FA\u5E95\u6709\u4E24\u4E2A\u5206\u91CF\uFF0C\u5206\u522B\u662F\u4E00\u4E2A\u50CF\u7D20\u7684\u5BBD\u548C\u4E00\u4E2A\u50CF\u7D20\u7684\u9AD8\uFF0C\u5373 1 \u4E2A\u5355\u4F4D\u7684\u5BBD\u4FBF\u662F 1 \u4E2A\u50CF\u7D20\u7684\u5BBD\uFF0C1 \u4E2A\u5355\u4F4D\u7684\u9AD8\u4FBF\u662F\u4E00\u4E2A\u50CF\u7D20\u7684\u9AD8</p></blockquote><p><img src="'+c+'" alt=""></p><blockquote><p>webgl \u7684\u5750\u6807\u7CFB<br> webgl \u5750\u6807\u7CFB\u7684\u5750\u6807\u539F\u70B9\u5728\u753B\u5E03\u4E2D\u5FC3<br> webgl \u5750\u6807\u7CFB\u7684 y \u8F74\u65B9\u5411\u662F\u671D\u4E0A\u7684<br> webgl \u5750\u6807\u57FA\u5E95\u4E2D\u7684\u4E24\u4E2A\u5206\u91CF\u5206\u522B\u662F\u534A\u4E2A canvas \u7684\u5BBD\u548C canvas \u7684\u9AD8\uFF0C\u5373 1 \u4E2A\u5355\u4F4D\u7684\u5BBD\u4FBF\u662F\u534A\u4E2A\u4E2A canvas \u7684\u5BBD\uFF0C1 \u4E2A\u5355\u4F4D\u7684\u9AD8\u4FBF\u662F\u534A\u4E2A canvas \u7684\u9AD8</p></blockquote><p><img src="'+I+`" alt=""></p><h3 id="_3-webgl-\u753B\u4E00\u4E2A\u70B9" tabindex="-1"><a class="header-anchor" href="#_3-webgl-\u753B\u4E00\u4E2A\u70B9" aria-hidden="true">#</a> 3.webgl \u753B\u4E00\u4E2A\u70B9</h3><h4 id="a-canvas-2d-\u7684\u7ED8\u56FE\u57FA\u672C\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#a-canvas-2d-\u7684\u7ED8\u56FE\u57FA\u672C\u6B65\u9AA4" aria-hidden="true">#</a> a. canvas 2d \u7684\u7ED8\u56FE\u57FA\u672C\u6B65\u9AA4</h4><ol><li>\u627E\u4E00\u5F20\u753B\u5E03</li><li>\u627E\u4E00\u652F\u753B\u7B14</li><li>\u5F00\u59CB\u753B\u753B</li></ol><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//canvas\u753B\u5E03</span>
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u4E8C\u7EF4\u753B\u7B14</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u8BBE\u7F6E\u753B\u7B14\u7684\u989C\u8272</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//\u7528\u753B\u7B14\u753B\u4E00\u4E2A\u77E9\u5F62</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></details><h4 id="b-canvas-2d-\u548C-webgl-\u7ED8\u56FE\u7684\u5DEE\u5F02" tabindex="-1"><a class="header-anchor" href="#b-canvas-2d-\u548C-webgl-\u7ED8\u56FE\u7684\u5DEE\u5F02" aria-hidden="true">#</a> b. canvas 2d \u548C webgl \u7ED8\u56FE\u7684\u5DEE\u5F02</h4><blockquote><p>\u6D4F\u89C8\u5668\u6709\u4E09\u5927\u7EBF\u7A0B\uFF1A js \u5F15\u64CE\u7EBF\u7A0B\u3001GUI \u6E32\u67D3\u7EBF\u7A0B\u3001\u6D4F\u89C8\u5668\u4E8B\u4EF6\u89E6\u53D1\u7EBF\u7A0B<br> GUI \u6E32\u67D3\u7EBF\u7A0B\u5C31\u662F\u7528\u4E8E\u6E32\u56FE\u7684\uFF0C\u5728\u8FD9\u4E2A\u6E32\u67D3\u7EBF\u7A0B\u91CC\uFF0C\u6709\u8D1F\u8D23\u4E0D\u540C\u6E32\u67D3\u5DE5\u4F5C\u7684\u5DE5\u4EBA\u3002\u6BD4\u5982\u6709\u8D1F\u8D23\u6E32\u67D3 HTML+css \u7684\u5DE5\u4EBA\uFF0C\u6709\u8D1F\u8D23\u6E32\u67D3\u4E8C\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA\uFF0C\u6709\u8D1F\u8D23\u6E32\u67D3\u4E09\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA<br> \u6E32\u67D3\u4E8C\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA\u8BF4\u7684\u662F js \u8BED\u8A00<br> \u6E32\u67D3\u4E09\u7EF4\u56FE\u5F62\u7684\u5DE5\u4EBA\u8BF4\u7684\u662F GLSL ES \u8BED\u8A00<br> GLSL ES &lt;=&gt; \u7A0B\u5E8F\u5BF9\u8C61\uFF08\u7FFB\u8BD1\u5B98\uFF09 &lt;=&gt; js</p></blockquote><h4 id="c-webgl-\u7684\u7ED8\u56FE\u601D\u8DEF\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#c-webgl-\u7684\u7ED8\u56FE\u601D\u8DEF\u6B65\u9AA4" aria-hidden="true">#</a> c. webgl \u7684\u7ED8\u56FE\u601D\u8DEF\u6B65\u9AA4</h4><ol><li>\u627E\u4E00\u53F0\u7535\u8111 - \u6D4F\u89C8\u5668\u91CC\u5185\u7F6E\u7684 webgl \u6E32\u67D3\u5F15\u64CE\uFF0C\u8D1F\u8D23\u6E32\u67D3 webgl \u56FE\u5F62\uFF0C\u53EA\u8BA4 GLSL ES \u8BED\u8A00</li><li>\u627E\u4E00\u5757\u624B\u7ED8\u677F - \u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u627F\u8F7D GLSL ES \u8BED\u8A00\uFF0C\u7FFB\u8BD1 GLSL ES \u8BED\u8A00\u548C js \u8BED\u8A00\uFF0C\u4F7F\u4E24\u8005\u53EF\u4EE5\u76F8\u4E92\u901A\u4FE1</li><li>\u627E\u4E00\u652F\u89E6\u63A7\u7B14 - \u901A\u8FC7 canvas \u83B7\u53D6\u7684 webgl \u7C7B\u578B\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u5411\u624B\u7ED8\u677F\u4F20\u9012\u7ED8\u56FE\u547D\u4EE4\uFF0C\u5E76\u63A5\u6536\u624B\u7ED8\u677F\u7684\u72B6\u6001\u4FE1\u606F</li><li>\u5F00\u59CB\u753B\u753B - \u901A\u8FC7 webgl \u7C7B\u578B\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u7528 js \u753B\u753B</li></ol><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u70B9\u4F4D</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5C3A\u5BF8</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7247\u5143\u989C\u8272</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    
    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">initShaders</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u521B\u5EFA\u7A0B\u5E8F\u5BF9\u8C61</span>
        <span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5EFA\u7ACB\u9876\u70B9\u7740\u8272\u5668\u548C\u7247\u5143\u7740\u8272\u5668\u5BF9\u8C61\uFF0C\u4E8C\u8005\u53EF\u4EE5\u5206\u5DE5\u5408\u4F5C\uFF0C</span>
        <span class="token comment">//js\u89E3\u6790\u4E3A\u8BA1\u7B97\u673A\u8BED\u8A00(GLSL ES)\uFF0C\u518D\u8BA9\u8BA1\u7B97\u673A(\u6D4F\u89C8\u5668\u7684webgl \u6E32\u67D3\u5F15\u64CE)\u8BC6\u522B\u663E\u793A</span>
        <span class="token keyword">const</span> vertexShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> fragmentShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5C06\u9876\u70B9\u7740\u8272\u5668\u5BF9\u8C61\u548C\u7247\u5143\u7740\u8272\u5668\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8FDE\u63A5webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\u548C\u7A0B\u5E8F\u5BF9\u8C61</span>
        gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u542F\u52A8\u7A0B\u5E8F\u5BF9\u8C61</span>
        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5C06\u7A0B\u5E8F\u5BF9\u8C61\u6302\u5230\u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A</span>
        gl<span class="token punctuation">.</span>program <span class="token operator">=</span> program<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u6839\u636E\u7740\u8272\u7C7B\u578B\uFF0C\u5EFA\u7ACB\u7740\u8272\u5668\u5BF9\u8C61</span>
        <span class="token keyword">const</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5C06\u7740\u8272\u5668\u6E90\u6587\u4EF6\u4F20\u5165\u7740\u8272\u5668\u5BF9\u8C61\u4E2D</span>
        gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u7F16\u8BD1\u7740\u8272\u5668\u5BF9\u8C61</span>
        gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8FD4\u56DE\u7740\u8272\u5668\u5BF9\u8C61</span>
        <span class="token keyword">return</span> shader<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+l+'" alt=""></p></details><h5 id="_1-\u7740\u8272\u5668" tabindex="-1"><a class="header-anchor" href="#_1-\u7740\u8272\u5668" aria-hidden="true">#</a> 1\uFF09 \u7740\u8272\u5668</h5><p>\u8981\u4F7F\u7528WebGL\u8FDB\u884C\u7ED8\u56FE\u5C31\u5FC5\u987B\u4F7F\u7528\u7740\u8272\u5668\uFF0C\u4EE3\u7801\u4E2D\u7740\u8272\u5668\u662F\u4EE5\u5B57\u7B26\u4E32\u7684\u5F62\u5F0F\u201C\u5D4C\u5165\u201D\u5728JavaScript\u6587\u4EF6\u4E2D\u7684\uFF0C\u5728\u7A0B\u5E8F\u771F\u6B63\u5F00\u59CB\u8FD0\u884C\u524D\u5B83\u5C31\u5DF2\u7ECF\u8BBE\u7F6E\u597D\u4E86\u3002</p><ul><li>\u9876\u70B9\u7740\u8272\u5668\uFF08Vertex shader\uFF09\uFF1A\u63CF\u8FF0\u9876\u70B9\u7684\u7279\u5F81\uFF0C\u5982\u4F4D\u7F6E\u3001\u989C\u8272\u7B49</li><li>\u7247\u5143\u7740\u8272\u5668\uFF08Fragment shader\uFF09\uFF1A\u8FDB\u884C\u9010\u7247\u5143\u5904\u7406\u8FC7\u7A0B\uFF0C\u5982\u5149\u7167</li></ul><blockquote><p>\u4E24\u70B9\u51B3\u5B9A\u4E00\u6761\u76F4\u7EBF\uFF0C\u9876\u70B9\u7740\u8272\u5668\u91CC\u7684\u9876\u70B9\u5C31\u662F\u51B3\u5B9A\u8FD9\u4E00\u6761\u76F4\u7EBF\u7684\u4E24\u4E2A\u70B9\uFF0C\u7247\u5143\u7740\u8272\u5668\u91CC\u7684\u7247\u5143\u5C31\u662F\u628A\u76F4\u7EBF\u753B\u5230\u753B\u5E03\u4E0A\u540E\uFF0C\u8FD9\u4E24\u4E2A\u70B9\u4E4B\u95F4\u6784\u6210\u76F4\u7EBF\u7684\u6BCF\u4E2A\u50CF\u7D20</p></blockquote><p>\u5728\u6D4F\u89C8\u5668\u4E0A\u7684\u7ED8\u5236\u8FC7\u7A0B\uFF1A</p><ol><li>\u8FD0\u884CJavaScript\uFF0C\u8C03\u7528WebGL\u76F8\u5173\u65B9\u6CD5</li><li>\u9876\u70B9\u548C\u7247\u5143\u7740\u8272\u5668\u6267\u884C\uFF0C\u5728\u989C\u8272\u7F13\u51B2\u533A\u5185\u8FDB\u884C\u7ED8\u5236\uFF0C\u6E05\u7A7A\u7ED8\u56FE\u533A</li><li>\u989C\u8272\u7F13\u51B2\u533A\u7684\u5185\u5BB9\u81EA\u52A8\u5728\u6D4F\u89C8\u5668\u7684&lt;canvas&gt;\u4E0A\u663E\u793A\u51FA\u6765<br><img src="'+L+'" alt=""></li></ol><h5 id="_2-initshaders" tabindex="-1"><a class="header-anchor" href="#_2-initshaders" aria-hidden="true">#</a> 2\uFF09 initShaders()</h5><p><img src="'+O+'" alt=""></p><h5 id="_3-gl-drawarrays-mode-first-count" tabindex="-1"><a class="header-anchor" href="#_3-gl-drawarrays-mode-first-count" aria-hidden="true">#</a> 3\uFF09 gl.drawArrays(mode,first,count)</h5><p><img src="'+u+`" alt=""></p><h2 id="\u4E09\u3001js\u4E0E\u7740\u8272\u5668\u95F4\u7684\u6570\u636E\u4F20\u8F93" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001js\u4E0E\u7740\u8272\u5668\u95F4\u7684\u6570\u636E\u4F20\u8F93" aria-hidden="true">#</a> \u4E09\u3001js\u4E0E\u7740\u8272\u5668\u95F4\u7684\u6570\u636E\u4F20\u8F93</h2><h3 id="_1-js\u63A7\u5236\u9876\u70B9\u4F4D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_1-js\u63A7\u5236\u9876\u70B9\u4F4D\u7F6E" aria-hidden="true">#</a> 1.js\u63A7\u5236\u9876\u70B9\u4F4D\u7F6E</h3><blockquote><p>attribute \u53D8\u91CF\u662F\u53EA\u6709\u9876\u70B9\u7740\u8272\u5668\u624D\u80FD\u4F7F\u7528\u5B83\u7684<br> js \u53EF\u4EE5\u901A\u8FC7 attribute \u53D8\u91CF\u5411\u9876\u70B9\u7740\u8272\u5668\u4F20\u9012\u4E0E\u9876\u70B9\u76F8\u5173\u7684\u6570\u636E</p></blockquote><details class="custom-container details"><summary>\u4F7F\u7528attribute\u53D8\u91CF</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u70B9\u4F4D</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5C3A\u5BF8</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7247\u5143\u7684\u989C\u8272</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

<span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF a_Position \u7684\u5B58\u50A8\u4F4D\u7F6E</span>
<span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5C06\u9876\u70B9\u4F4D\u7F6E\u4F20\u9012\u7ED9 attribute \u53D8\u91CF</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u4E5F\u53EF\u8FD9\u6837\u5199</span>
<span class="token comment">// const position = new Float32Array([0.0, 0.0, 0.0,1.0]);</span>
<span class="token comment">// gl.vertexAttrib4fv(a_Position,position)</span>

gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">initShaders</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u521B\u5EFA\u7A0B\u5E8F\u5BF9\u8C61</span>
    <span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5EFA\u7ACB\u9876\u70B9\u7740\u8272\u5668\u5BF9\u8C61\u548C\u7247\u5143\u7740\u8272\u5668\u5BF9\u8C61\uFF0C\u4E8C\u8005\u53EF\u4EE5\u5206\u5DE5\u5408\u4F5C</span>
    <span class="token comment">//js\u89E3\u6790\u4E3A\u8BA1\u7B97\u673A\u8BED\u8A00(GLSL ES)\uFF0C\u7136\u540E\u8BA9\u8BA1\u7B97\u673A(\u6D4F\u89C8\u5668\u7684webgl \u6E32\u67D3\u5F15\u64CE)\u8BC6\u522B\u663E\u793A</span>
    <span class="token keyword">const</span> vertexShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> fragmentShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u9876\u70B9\u7740\u8272\u5668\u5BF9\u8C61\u548C\u7247\u5143\u7740\u8272\u5668\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8FDE\u63A5webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\u548C\u7A0B\u5E8F\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u542F\u52A8\u7A0B\u5E8F\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u7A0B\u5E8F\u5BF9\u8C61\u6302\u5230\u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A</span>
    gl<span class="token punctuation">.</span>program <span class="token operator">=</span> program<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u6839\u636E\u7740\u8272\u7C7B\u578B\uFF0C\u5EFA\u7ACB\u7740\u8272\u5668\u5BF9\u8C61</span>
    <span class="token keyword">const</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u7740\u8272\u5668\u6E90\u6587\u4EF6\u4F20\u5165\u7740\u8272\u5668\u5BF9\u8C61\u4E2D</span>
    gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u7F16\u8BD1\u7740\u8272\u5668\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8FD4\u56DE\u7740\u8272\u5668\u5BF9\u8C61</span>
    <span class="token keyword">return</span> shader<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+l+'" alt=""></p><p>\u6CE8\u610F\uFF1A<br><img src="'+D+'" alt=""></p><p><img src="'+z+'" alt=""></p><p>\u540C\u65CF\u51FD\u6570\uFF1A<br><img src="'+U+'" alt=""><br> \u51FD\u6570\u547D\u540D\u89C4\u8303\uFF1A<br><img src="'+V+`" alt=""></p></details><h3 id="_2-webgl\u540C\u6B65\u7ED8\u56FE\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_2-webgl\u540C\u6B65\u7ED8\u56FE\u539F\u7406" aria-hidden="true">#</a> 2.webgl\u540C\u6B65\u7ED8\u56FE\u539F\u7406</h3><blockquote><p>gl.drawArrays(gl.POINTS, 0, 1) \u65B9\u6CD5\u548C canvas 2d \u91CC\u7684 ctx.draw() \u65B9\u6CD5\u662F\u4E0D\u4E00\u6837\u7684\uFF0Cctx.draw() \u771F\u7684\u50CF\u753B\u753B\u4E00\u6837\uFF0C\u4E00\u5C42\u4E00\u5C42\u7684\u8986\u76D6\u56FE\u50CF<br> gl.drawArrays() \u65B9\u6CD5\u53EA\u4F1A\u540C\u6B65\u7ED8\u56FE\uFF0C\u8D70\u5B8C\u4E86 js \u4E3B\u7EBF\u7A0B\u540E\uFF0C\u518D\u6B21\u7ED8\u56FE\u65F6\uFF0C\u5C31\u4F1A\u4ECE\u5934\u518D\u6765\u3002\u4E5F\u5C31\u8BF4\uFF0C\u5F02\u6B65\u6267\u884C\u7684 drawArrays() \u65B9\u6CD5\u4F1A\u628A\u753B\u5E03\u4E0A\u7684\u56FE\u50CF\u90FD\u5237\u6389\uFF08 webgl \u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u662F\u5148\u5728\u989C\u8272\u7F13\u51B2\u533A\u4E2D\u753B\u51FA\u6765\uFF0C\u989C\u8272\u7F13\u51B2\u533A\u4E2D\u5B58\u50A8\u7684\u56FE\u50CF\uFF0C\u53EA\u5728\u5F53\u524D\u7EBF\u7A0B\u6709\u6548\u3002\u6BD4\u5982\u6211\u4EEC\u5148\u5728 js \u4E3B\u7EBF\u7A0B\u4E2D\u7ED8\u56FE\uFF0C\u4E3B\u7EBF\u7A0B\u7ED3\u675F\u540E\uFF0C\u4F1A\u518D\u53BB\u6267\u884C\u4FE1\u606F\u961F\u5217\u91CC\u7684\u5F02\u6B65\u7EBF\u7A0B\u3002\u5728\u6267\u884C\u5F02\u6B65\u7EBF\u7A0B\u65F6\uFF0C\u989C\u8272\u7F13\u51B2\u533A\u5C31\u4F1A\u88AB webgl \u7CFB\u7EDF\u91CD\u7F6E \uFF09</p></blockquote><details class="custom-container details"><summary>\u4EE3\u7801\u793A\u4F8B1</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u70B9\u4F4D</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5C3A\u5BF8</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7247\u5143\u7684\u989C\u8272</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

<span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF a_Position \u7684\u5B58\u50A8\u4F4D\u7F6E</span>
<span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5C06\u9876\u70B9\u4F4D\u7F6E\u4F20\u9012\u7ED9 attribute \u53D8\u91CF</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+N+`" alt=""></p></details><details class="custom-container details"><summary>\u4EE3\u7801\u793A\u4F8B2</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u70B9\u4F4D</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5C3A\u5BF8</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7247\u5143\u7684\u989C\u8272</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

<span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF a_Position \u7684\u5B58\u50A8\u4F4D\u7F6E</span>
<span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5C06\u9876\u70B9\u4F4D\u7F6E\u4F20\u9012\u7ED9 attribute \u53D8\u91CF</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5B58\u50A8\u9876\u70B9\u6570\u636E\u7684\u6570\u7EC4</span>
<span class="token keyword">const</span> a_points <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    a_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+G+`" alt=""></p></details><h3 id="_3-\u9F20\u6807\u63A7\u5236\u70B9\u4F4D" tabindex="-1"><a class="header-anchor" href="#_3-\u9F20\u6807\u63A7\u5236\u70B9\u4F4D" aria-hidden="true">#</a> 3.\u9F20\u6807\u63A7\u5236\u70B9\u4F4D</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u70B9\u4F4D</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5C3A\u5BF8</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// \u7247\u5143\u7684\u989C\u8272</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
<span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

<span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

<span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF a_Position \u7684\u5B58\u50A8\u4F4D\u7F6E</span>
<span class="token keyword">var</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u5C06\u9876\u70B9\u4F4D\u7F6E\u4F20\u9012\u7ED9 attribute \u53D8\u91CF</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u83B7\u5F97 canvas \u4E0B\u7684\u5750\u6807</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u83B7\u53D6 canvas \u7684\u4E2D\u5FC3\u70B9</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5C06 canvas \u539F\u70B9\u5E73\u79FB\u5230\u4E2D\u5FC3\u70B9</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u89E3\u51B3 y \u65B9\u5411\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
    <span class="token comment">// \u89E3\u51B3\u5750\u6807\u57FA\u5E95\u7684\u5DEE\u5F02</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>\u6D4F\u89C8\u5668\u4E0Ecanvas\u5750\u6807\uFF1A<br><img src="`+W+`" alt=""></p></details><h3 id="_4-js\u4FEE\u6539\u9876\u70B9\u989C\u8272" tabindex="-1"><a class="header-anchor" href="#_4-js\u4FEE\u6539\u9876\u70B9\u989C\u8272" aria-hidden="true">#</a> 4.js\u4FEE\u6539\u9876\u70B9\u989C\u8272</h3><details class="custom-container details"><summary>\u4F7F\u7528uniform\u53D8\u91CF</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

    <span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF a_Position \u7684\u5B58\u50A8\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u83B7\u53D6 uniform \u53D8\u91CF u_FragColor \u7684\u5B58\u50A8\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5C06\u9876\u70B9\u4F4D\u7F6E\u4F20\u9012\u7ED9 attribute \u53D8\u91CF</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttrib3f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u4FEE\u6539uniform \u53D8\u91CF</span>
    gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></details><h3 id="_5-\u9F20\u6807\u7ED8\u5236\u968F\u673A\u989C\u8272\u7684\u70B9" tabindex="-1"><a class="header-anchor" href="#_5-\u9F20\u6807\u7ED8\u5236\u968F\u673A\u989C\u8272\u7684\u70B9" aria-hidden="true">#</a> 5.\u9F20\u6807\u7ED8\u5236\u968F\u673A\u989C\u8272\u7684\u70B9</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute float a_PointSize<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> a_PointSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

    <span class="token comment">// \u83B7\u53D6 attribute \u548C uniform \u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_points <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">r</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> size <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> n <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">r</span><span class="token operator">:</span> n<span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> n<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      a_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      a_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div></details><h3 id="_6-\u7ED8\u5236\u5706\u70B9" tabindex="-1"><a class="header-anchor" href="#_6-\u7ED8\u5236\u5706\u70B9" aria-hidden="true">#</a> 6.\u7ED8\u5236\u5706\u70B9</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>webgl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute float a_PointSize<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> a_PointSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_FragColor<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      float dist <span class="token operator">=</span> <span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dist <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        discard<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9876\u70B9\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">VSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u7247\u5143\u5B57\u7B26\u4E32</span>
    <span class="token keyword">const</span> <span class="token constant">FSHADER_SOURCE</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token constant">VSHADER_SOURCE</span><span class="token punctuation">,</span> <span class="token constant">FSHADER_SOURCE</span><span class="token punctuation">)</span>

    <span class="token comment">// \u83B7\u53D6 attribute \u548C uniform \u53D8\u91CF\u5B58\u50A8\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_PointSize <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_PointSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_points <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">r</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>cssX<span class="token punctuation">,</span> cssY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>clientX <span class="token operator">-</span> left<span class="token punctuation">,</span> clientY <span class="token operator">-</span> top<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>halfWidth<span class="token punctuation">,</span> halfHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>xBaseCenter<span class="token punctuation">,</span> yBaseCenter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>cssX <span class="token operator">-</span> halfWidth<span class="token punctuation">,</span> cssY <span class="token operator">-</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> yBaseCenterTop <span class="token operator">=</span> <span class="token operator">-</span>yBaseCenter<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>xBaseCenter <span class="token operator">/</span> halfWidth<span class="token punctuation">,</span> yBaseCenterTop <span class="token operator">/</span> halfHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> size <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> n <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">r</span><span class="token operator">:</span> n<span class="token punctuation">,</span> <span class="token literal-property property">g</span><span class="token operator">:</span> n<span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      a_points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> color <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      a_points<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib2f</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttrib1f</span><span class="token punctuation">(</span>a_PointSize<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br></div></div></details><h2 id="\u56DB\u3001\u7ED8\u5236\u56FE\u5F62" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001\u7ED8\u5236\u56FE\u5F62" aria-hidden="true">#</a> \u56DB\u3001\u7ED8\u5236\u56FE\u5F62</h2><h3 id="_1-\u4E09\u7EF4\u6A21\u578B\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-\u4E09\u7EF4\u6A21\u578B\u7ED8\u56FE" aria-hidden="true">#</a> 1.\u4E09\u7EF4\u6A21\u578B\u7ED8\u56FE</h3><p>\u6784\u6210\u4E09\u7EF4\u6A21\u578B\u7684\u57FA\u672C\u5355\u4F4D\u662F\u4E09\u89D2\u5F62\uFF0C\u5982\u4E0B\u56FE\u7684\u9752\u86D9\uFF0C\u5C31\u662F\u7531\u53F3\u56FE\u6240\u793A\u7684\u8BB8\u591A\u4E2A\u4E09\u89D2\u5F62\u4EE5\u53CA\u8FD9\u4E9B\u4E09\u89D2\u5F62\u7684\u9876\u70B9\u6784\u6210\u7684\u3002\u4E0D\u7BA1\u4E09\u7EF4\u6A21\u578B\u7684\u5F62\u72B6\u591A\u4E48\u590D\u6742\uFF0C\u5176\u57FA\u672C\u7EC4\u6210\u90E8\u5206\u90FD\u662F\u4E09\u89D2\u5F62\uFF0C\u53EA\u4E0D\u8FC7\u590D\u6742\u7684\u6A21\u578B\u7531\u66F4\u591A\u7684\u4E09\u89D2\u5F62\u6784\u6210\u800C\u5DF2\u3002</p><p><img src="`+H+`" alt=""></p><h3 id="_2-\u7ED8\u5236\u591A\u4E2A\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-\u7ED8\u5236\u591A\u4E2A\u70B9" aria-hidden="true">#</a> 2.\u7ED8\u5236\u591A\u4E2A\u70B9</h3><p>WebGL\u63D0\u4F9B\u4E86\u4E00\u79CD\u5F88\u65B9\u4FBF\u7684\u673A\u5236\uFF0C\u5373<code>\u7F13\u51B2\u533A\u5BF9\u8C61</code>\uFF0C\u5979\u53EF\u4EE5\u4E00\u6B21\u6027\u5730\u5411\u7740\u8272\u5668\u4F20\u5165\u591A\u4E2A\u9876\u70B9\u7684\u6570\u636E\u3002\u7F13\u51B2\u533A\u5BF9\u8C61\u662FWebGL\u7CFB\u7EDF\u4E2D\u7684\u4E00\u5757\u5185\u5B58\u533A\u57DF\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4E00\u6B21\u6027\u5730\u5411\u7F13\u51B2\u533A\u5BF9\u8C61\u4E2D\u586B\u5145\u5927\u91CF\u7684\u9876\u70B9\u6570\u636E\uFF0C\u7136\u540E\u5C06\u8FD9\u4E9B\u6570\u636E\u4FDD\u5B58\u5176\u4E2D\uFF0C\u4F9B\u9876\u70B9\u7740\u8272\u5668\u4F7F\u7528\u3002</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u9876\u70B9\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5237\u5E95\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7ED8\u5236 n \u4E2A\u70B9</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9876\u70B9\u6570\u636E</span>
        <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
            <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>
            <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u9876\u70B9\u6570\u91CF</span>
        <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token comment">// 1.\u521B\u5EFA\u7F13\u51B2\u533A\u5BF9\u8C61</span>
        <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.\u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u7ED1\u5B9A\u5230\u76EE\u6807</span>
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.\u5411\u7F13\u51B2\u533A\u5BF9\u8C61\u4E2D\u5199\u5165\u6570\u636E</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        <span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF</span>
        <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">// 4.\u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u5206\u914D\u7ED9 a_Position \u53D8\u91CF</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// 5.\u8FDE\u63A5 a_Position \u53D8\u91CF\u4E0E\u7F13\u51B2\u533A\u5BF9\u8C61</span>
        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Y+'" alt=""></p><p>\u4E94\u4E2A\u6B65\u9AA4\uFF1A<br><img src="'+X+'" alt=""></p><p>\u521B\u5EFA\u7F13\u51B2\u533A\uFF1A<br><img src="'+K+'" alt=""></p><p>\u5220\u9664\u7F13\u51B2\u533A\uFF1A<br><img src="'+Z+'" alt=""></p><p>\u7ED1\u5B9A\u7F13\u51B2\u533A\uFF1A<br><img src="'+Q+'" alt=""></p><p>\u5199\u5165\u6570\u636E\u5230\u7F13\u51B2\u533A\uFF1A<br><img src="'+$+'" alt=""></p><p>\u7C7B\u578B\u5316\u6570\u7EC4\uFF1A<br> \u4E0D\u652F\u6301push()\u548Cpop()\u65B9\u6CD5\uFF0C\u6027\u80FD\u66F4\u597D\u3002<br><img src="'+J+'" alt=""><img src="'+nn+'" alt=""></p><p>\u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u5206\u914D\u7ED9attribute\u53D8\u91CF\uFF1A<br><img src="'+sn+'" alt=""></p><p>\u5F00\u542Fattribute\u53D8\u91CF\uFF1A<br> \u51FD\u6570\u540D\u770B\u662F\u7528\u6765\u5904\u7406\u201C\u9876\u70B9\u6570\u7EC4\u201D\u7684\uFF0C\u5B9E\u9645\u4E0A\u662F\u5904\u7406\u7F13\u51B2\u533A\u5BF9\u8C61\uFF0C\u5386\u53F2\u539F\u56E0\uFF08OpenGL\u4E2D\u7EE7\u627F\u7684\uFF09\u3002<br><img src="'+an+'" alt=""></p><p>\u5173\u95ED\u5206\u914D\uFF1A<br><img src="'+pn+'" alt=""></p><p>gl.drawArrays()\u7684\u7B2C2\u4E2A\u53C2\u6570\u548C\u7B2C3\u4E2A\u53C2\u6570\uFF1A<br><img src="'+u+'" alt=""></p><p>\u7ED8\u5236\u8FC7\u7A0B\uFF1A<br><img src="'+tn+'" alt=""></p></details><h3 id="_3-\u7ED8\u5236\u56FE\u5F62" tabindex="-1"><a class="header-anchor" href="#_3-\u7ED8\u5236\u56FE\u5F62" aria-hidden="true">#</a> 3.\u7ED8\u5236\u56FE\u5F62</h3><p>gl.drawArrays(mode,first,count) \u65B9\u6CD5\u53EF\u4EE5\u7ED8\u5236\u4EE5\u4E0B\u56FE\u5F62\uFF08\uFF09\uFF1A</p><ol><li>POINTS \u53EF\u89C6\u7684\u70B9</li><li>LINES \u5355\u72EC\u7EBF\u6BB5</li><li>LINE_STRIP \u7EBF\u6761</li><li>LINE_LOOP \u95ED\u5408\u7EBF\u6761</li><li>TRIANGLES \u5355\u72EC\u4E09\u89D2\u5F62</li><li>TRIANGLE_STRIP \u4E09\u89D2\u5E26</li><li>TRIANGLE_FAN \u4E09\u89D2\u6247</li></ol><p><img src="'+en+'" alt=""></p><p><img src="'+on+`" alt=""></p><p>\u6CE8\u610F\uFF1A<br><code>TRIANGLE_STRIP \u4E09\u89D2\u5E26\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1A</code><br> v0&gt;v1&gt;v2<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E8C\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E8C\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> v2&gt;v1&gt;v3<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> v2&gt;v3&gt;v4<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E8C\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E8C\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> v4&gt;v3&gt;v5<br><code>\u89C4\u5F8B\uFF1A</code><br> \u7B2C\u5076\u6570\u4E2A\u4E09\u89D2\u5F62\uFF1A\u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E8C\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E8C\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u7B2C\u5947\u6570\u4E2A\u4E09\u89D2\u5F62\uFF1A\u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u4EE5\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u65B9\u5411\u7ED8\u5236\u4E09\u89D2\u5F62</p><p><code>TRIANGLE_FAN \u4E09\u89D2\u6247\u7684\u7ED8\u5236\u987A\u5E8F\u662F\uFF1A</code><br> \u200B v0&gt;v1&gt;v2<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u6309\u7167\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u987A\u5E8F\uFF0C\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u200B v0&gt;v2&gt;v3<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u6309\u7167\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u987A\u5E8F\uFF0C\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u200B v0&gt;v3&gt;v4<br> \u4EE5\u4E0A\u4E00\u4E2A\u4E09\u89D2\u5F62\u7684\u7B2C\u4E09\u6761\u8FB9+\u4E0B\u4E00\u4E2A\u70B9\u4E3A\u57FA\u7840\uFF0C\u6309\u7167\u548C\u7B2C\u4E09\u6761\u8FB9\u76F8\u53CD\u7684\u987A\u5E8F\uFF0C\u7ED8\u5236\u4E09\u89D2\u5F62<br> \u200B v0&gt;v4&gt;v5</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINE_LOOP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_FAN</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details><h3 id="_4-\u7ED8\u5236\u77E9\u5F62" tabindex="-1"><a class="header-anchor" href="#_4-\u7ED8\u5236\u77E9\u5F62" aria-hidden="true">#</a> 4.\u7ED8\u5236\u77E9\u5F62</h3><p>\u9996\u5148\uFF0Cwebgl \u53EF\u4EE5\u7ED8\u5236\u7684\u9762\u53EA\u6709\u4E09\u89D2\u9762\uFF0C\u6240\u4EE5\u8981\u7ED8\u5236\u77E9\u5F62\u9762\u7684\u8BDD\uFF0C\u53EA\u80FD\u7528\u4E24\u4E2A\u4E09\u89D2\u5F62\u53BB\u62FC\u3002</p><p>\u65B9\u6CD51\uFF1A TRIANGLE_STRIP \u4E09\u89D2\u5E26\u62FC\u77E9\u5F62</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u9876\u70B9\u4F4D\u7F6E</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5237\u5E95\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7ED8\u5236 n \u4E2A\u70B9</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9876\u70B9\u6570\u636E</span>
        <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
            <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>
            <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
            <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u9876\u70B9\u6570\u91CF</span>
        <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token comment">// \u521B\u5EFA\u7F13\u51B2\u533A\u5BF9\u8C61</span>
        <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u7ED1\u5B9A\u5230\u76EE\u6807</span>
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5411\u7F13\u51B2\u533A\u5BF9\u8C61\u4E2D\u5199\u5165\u6570\u636E</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        <span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF</span>
        <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">// \u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u5206\u914D\u7ED9 a_Position \u53D8\u91CF</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// \u8FDE\u63A5 a_Position \u53D8\u91CF\u4E0E\u7F13\u51B2\u533A\u5BF9\u8C61</span>
        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>

        <span class="token keyword">return</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+cn+'" alt=""><img src="'+ln+'" alt=""></p><p>\u82E5 gl.drawArrays(gl.TRIANGLE_STRIP, 0, n) =&gt; gl.drawArrays(gl.TRIANGLE_FAN, 0, n) <img src="'+un+`" alt=""></p></details><h3 id="_5-buffer\u7F13\u51B2\u533A\u5F02\u6B65\u7ED8\u5236" tabindex="-1"><a class="header-anchor" href="#_5-buffer\u7F13\u51B2\u533A\u5F02\u6B65\u7ED8\u5236" aria-hidden="true">#</a> 5.Buffer\u7F13\u51B2\u533A\u5F02\u6B65\u7ED8\u5236</h3><blockquote><p>\u5F53\u7F13\u51B2\u533A\u88AB\u7ED1\u5B9A\u5728\u4E86 webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A\u540E\uFF0C\u5728\u5F02\u6B65\u65B9\u6CD5\u91CC\u76F4\u63A5\u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u5373\u53EF\uFF0C\u9876\u70B9\u7740\u8272\u5668\u5728\u7ED8\u56FE\u7684\u65F6\u5019\u4F1A\u81EA\u52A8\u4ECE\u5176\u4E2D\u8C03\u7528\u6570\u636E\u3002<br> WebGL Buffer\u7F13\u51B2\u533A\u4E2D\u7684\u6570\u636E\u5728\u5F02\u6B65\u65B9\u6CD5\u91CC\u4E0D\u4F1A\u88AB\u91CD\u65B0\u7F6E\u7A7A\u3002</p></blockquote><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
attribute vec4 a_Position<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u9876\u70B9\u4F4D\u7F6E</span>
    <span class="token keyword">let</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5237\u5E95\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u7ED8\u5236 n \u4E2A\u70B9</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1s\u540E\uFF0C\u9876\u70B9\u4E2D\u518D\u6DFB\u52A0\u7684\u4E00\u4E2A\u9876\u70B9\uFF0C\u4FEE\u6539\u7F13\u51B2\u533A\u6570\u636E\uFF0C\u6E05\u7406\u753B\u5E03\uFF0C\u7ED8\u5236\u9876\u70B9</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2s\u540E\uFF0C\u6E05\u7406\u753B\u5E03\uFF0C\u7ED8\u5236\u9876\u70B9\uFF0C\u7ED8\u5236\u7EBF\u6761</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">initVertexBuffers</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u9876\u70B9\u6570\u636E</span>
        vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// \u9876\u70B9\u6570\u91CF</span>
        <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">// \u521B\u5EFA\u7F13\u51B2\u533A\u5BF9\u8C61</span>
        <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u7ED1\u5B9A\u5230\u76EE\u6807</span>
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5411\u7F13\u51B2\u533A\u5BF9\u8C61\u4E2D\u5199\u5165\u6570\u636E</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        <span class="token comment">// \u83B7\u53D6 attribute \u53D8\u91CF</span>
        <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span>
        <span class="token comment">// \u5C06\u7F13\u51B2\u533A\u5BF9\u8C61\u5206\u914D\u7ED9 a_Position \u53D8\u91CF</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// \u8FDE\u63A5 a_Position \u53D8\u91CF\u4E0E\u7F13\u51B2\u533A\u5BF9\u8C61</span>
        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>

        <span class="token keyword">return</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+rn+`" alt=""></p></details><h3 id="_6-\u5C01\u88C5\u591A\u8FB9\u5F62\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_6-\u5C01\u88C5\u591A\u8FB9\u5F62\u5BF9\u8C61" aria-hidden="true">#</a> 6.\u5C01\u88C5\u591A\u8FB9\u5F62\u5BF9\u8C61</h3><p>Poly.js</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">gl</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">vertices</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">geoData</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">attrName</span><span class="token operator">:</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">uniName</span><span class="token operator">:</span> <span class="token string">&#39;u_IsPOINTS&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">circleDot</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_IsPOINTS</span><span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Poly</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> attrName<span class="token punctuation">,</span> size<span class="token punctuation">,</span> gl<span class="token punctuation">,</span> circleDot <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token comment">// \u521B\u5EFA\u7F13\u51B2\u533A\u5BF9\u8C61</span>
    <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u7ED1\u5B9A\u7F13\u51B2\u533A\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5199\u5165\u6570\u636E</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6attribute \u53D8\u91CF</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> attrName<span class="token punctuation">)</span>
    <span class="token comment">// \u4FEE\u6539attribute \u53D8\u91CF</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> size<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment">// \u8D4B\u80FD\uFF0C\u6279\u5904\u7406</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>
    <span class="token comment">// \u5982\u679C\u662F\u5706\u70B9\uFF0C\u5C31\u83B7\u53D6\u4E00\u4E0Buniform \u53D8\u91CF</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>circleDot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>u_IsPOINTS <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_IsPOINTS&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">updateBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span> vertices <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size
  <span class="token punctuation">}</span>
  <span class="token function">addVertice</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">popVertice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> vertices<span class="token punctuation">.</span>length
    vertices<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>len <span class="token operator">-</span> size<span class="token punctuation">,</span> len<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">setVertice</span><span class="token punctuation">(</span><span class="token parameter">ind<span class="token punctuation">,</span> <span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> ind <span class="token operator">*</span> size
    params<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">,</span> paramInd</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> paramInd<span class="token punctuation">]</span> <span class="token operator">=</span> param
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateVertices</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> geoData <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    geoData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      params<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> vertices
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token parameter">types <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>types</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> circleDot<span class="token punctuation">,</span> u_IsPOINTS <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> type <span class="token keyword">of</span> types<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      circleDot <span class="token operator">&amp;&amp;</span> gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>u_IsPOINTS<span class="token punctuation">,</span> type <span class="token operator">===</span> <span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">)</span>
      gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p>\u5C5E\u6027\uFF1A</p><ul><li>gl webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61</li><li>vertices \u9876\u70B9\u6570\u636E\u96C6\u5408\uFF0C\u5728\u88AB\u8D4B\u503C\u7684\u65F6\u5019\u4F1A\u505A\u4E24\u4EF6\u4E8B <ul><li>\u66F4\u65B0count \u9876\u70B9\u6570\u91CF\uFF0C\u6570\u636E\u8FD0\u7B97\u5C3D\u91CF\u4E0D\u653E\u6E32\u67D3\u65B9\u6CD5\u91CC</li><li>\u5411\u7F13\u51B2\u533A\u5185\u5199\u5165\u9876\u70B9\u6570\u636E</li></ul></li><li>geoData \u6A21\u578B\u6570\u636E\uFF0C\u5BF9\u8C61\u6570\u7EC4\uFF0C\u53EF\u89E3\u6790\u51FAvertices \u9876\u70B9\u6570\u636E</li><li>size \u9876\u70B9\u5206\u91CF\u7684\u6570\u76EE</li><li>positionName \u4EE3\u8868\u9876\u70B9\u4F4D\u7F6E\u7684attribute \u53D8\u91CF\u540D</li><li>count \u9876\u70B9\u6570\u91CF</li><li>types \u7ED8\u56FE\u65B9\u5F0F\uFF0C\u53EF\u4EE5\u7528\u591A\u79CD\u65B9\u5F0F\u7ED8\u56FE</li></ul><p>\u65B9\u6CD5\uFF1A</p><ul><li>init() \u521D\u59CB\u5316\u65B9\u6CD5\uFF0C\u5EFA\u7ACB\u7F13\u51B2\u5BF9\u8C61\uFF0C\u5E76\u5C06\u5176\u7ED1\u5B9A\u5230webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A\uFF0C\u7136\u540E\u5411\u5176\u4E2D\u5199\u5165\u9876\u70B9\u6570\u636E\u3002\u5C06\u7F13\u51B2\u5BF9\u8C61\u4EA4\u7ED9attribute\u53D8\u91CF\uFF0C\u5E76\u5F00\u542Fattribute \u53D8\u91CF\u7684\u6279\u5904\u7406\u529F\u80FD\u3002</li><li>addVertice() \u6DFB\u52A0\u9876\u70B9</li><li>popVertice() \u5220\u9664\u6700\u540E\u4E00\u4E2A\u9876\u70B9</li><li>setVertice() \u6839\u636E\u7D22\u5F15\u4F4D\u7F6E\u8BBE\u7F6E\u9876\u70B9</li><li>updateBuffer() \u66F4\u65B0\u7F13\u51B2\u533A\u6570\u636E\uFF0C\u540C\u65F6\u66F4\u65B0\u9876\u70B9\u6570\u91CF</li><li>updateCount() \u66F4\u65B0\u9876\u70B9\u6570\u91CF</li><li>updateVertices() \u57FA\u4E8EgeoData \u89E3\u6790\u51FAvetices \u6570\u636E</li><li>draw() \u7ED8\u56FE\u65B9\u6CD5</li></ul></details><h3 id="_7-\u9F20\u6807\u753B\u7EBF" tabindex="-1"><a class="header-anchor" href="#_7-\u9F20\u6807\u753B\u7EBF" aria-hidden="true">#</a> 7.\u9F20\u6807\u753B\u7EBF</h3><p>\u573A\u666F\uFF1A\u9F20\u6807\u5DE6\u51FB\u7ED8\u5236\u7EBF\u6761</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      attribute vec4 a_Position<span class="token punctuation">;</span>
      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
          gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      precision mediump float<span class="token punctuation">;</span>
      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          float dist<span class="token operator">=</span><span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              discard<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders<span class="token punctuation">,</span> getMousePosInWebgl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Poly.js&quot;</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

      <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
      <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
      <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

      <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
      <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
      <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
      gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u5237\u5E95\u8272</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u5B9E\u4F8B\u5316\u591A\u8FB9\u5F62</span>
      <span class="token keyword">const</span> poly <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          gl<span class="token punctuation">,</span>
          <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;LINE_STRIP&#39;</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
      canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMousePosInWebgl</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
          poly<span class="token punctuation">.</span><span class="token function">addVertice</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
          gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          poly<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+kn+`" alt=""></p></details><h3 id="_8-\u9F20\u6807\u753B\u591A\u7EBF" tabindex="-1"><a class="header-anchor" href="#_8-\u9F20\u6807\u753B\u591A\u7EBF" aria-hidden="true">#</a> 8.\u9F20\u6807\u753B\u591A\u7EBF</h3><p>\u573A\u666F\uFF1A\u9F20\u6807\u70B9\u51FB\u753B\u5E03\uFF0C\u7ED8\u5236\u591A\u8FB9\u5F62\u8DEF\u5F84\u3002\u9F20\u6807\u53F3\u51FB\uFF0C\u53D6\u6D88\u7ED8\u5236\u3002\u9F20\u6807\u518D\u6B21\u70B9\u51FB\uFF0C\u7ED8\u5236\u65B0\u7684\u591A\u8FB9\u5F62\u3002</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><p>Sky.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sky</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>gl<span class="token operator">=</span>gl
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>gl<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>gl
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateVertices</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      ele<span class="token punctuation">.</span><span class="token function">updateVertices</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      ele<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      ele<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
\u5C5E\u6027\uFF1A
<span class="token operator">-</span> gl webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61
<span class="token operator">-</span> children \u5B50\u7EA7

\u65B9\u6CD5\uFF1A
<span class="token operator">-</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \u6DFB\u52A0\u5B50\u5BF9\u8C61
<span class="token operator">-</span> <span class="token function">updateVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \u66F4\u65B0\u5B50\u5BF9\u8C61\u7684\u9876\u70B9\u6570\u636E
<span class="token operator">-</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \u904D\u5386\u5B50\u5BF9\u8C61\u7ED8\u56FE\uFF0C\u6BCF\u4E2A\u5B50\u5BF9\u8C61\u5BF9\u5E94\u4E00\u4E2Abuffer \u5BF9\u8C61\uFF0C
\u6240\u4EE5\u5728\u5B50\u5BF9\u8C61\u7ED8\u56FE\u4E4B\u524D\u8981\u5148\u521D\u59CB\u5316\u3002
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      attribute vec4 a_Position<span class="token punctuation">;</span>
      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
          gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      precision mediump float<span class="token punctuation">;</span>
      uniform bool u_IsPOINTS<span class="token punctuation">;</span>
      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// \u4FEE\u590Dbug\uFF1A\u7EBF\u6761\u5728mac\u7535\u8111\u4E2D\u662F\u65AD\u7684\uFF1A</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>u_IsPOINTS<span class="token punctuation">)</span><span class="token punctuation">{</span>
              float dist<span class="token operator">=</span><span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  discard<span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders<span class="token punctuation">,</span> getMousePosInWebgl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Poly.js&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">import</span> Sky <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Sky.js&quot;</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

      <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
      <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
      <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

      <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
      <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
      <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
      gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u5237\u5E95\u8272</span>
      gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u591C\u7A7A</span>
      <span class="token keyword">const</span> sky <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sky</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u5F53\u524D\u6B63\u5728\u7ED8\u5236\u7684\u591A\u8FB9\u5F62</span>
      <span class="token keyword">let</span> poly <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

      <span class="token comment">// \u53D6\u6D88\u53F3\u51FB\u63D0\u793A</span>
      canvas<span class="token punctuation">.</span><span class="token function-variable function">oncontextmenu</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// \u9F20\u6807\u70B9\u51FB\u4E8B\u4EF6</span>
      canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>button <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">popVertice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMousePosInWebgl</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  poly<span class="token punctuation">.</span><span class="token function">addVertice</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  <span class="token function">crtPoly</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u6700\u540E\u4E00\u4E2A\u70B9\u8DDF\u968F\u9F20\u6807\u79FB\u52A8</span>
      canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMousePosInWebgl</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
              poly<span class="token punctuation">.</span><span class="token function">setVertice</span><span class="token punctuation">(</span>poly<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
              <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// \u5220\u9664\u6700\u540E\u4E00\u4E2A\u9876\u70B9</span>
      <span class="token keyword">function</span> <span class="token function">popVertice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          poly<span class="token punctuation">.</span><span class="token function">popVertice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          poly <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// \u521B\u5EFA\u591A\u8FB9\u5F62</span>
      <span class="token keyword">function</span> <span class="token function">crtPoly</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          poly <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">vertices</span><span class="token operator">:</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;LINE_STRIP&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token literal-property property">circleDot</span><span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          sky<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>poly<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// \u6E32\u67D3\u65B9\u6CD5</span>
      <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span>
          sky<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+bn+'" alt=""></p></details><h3 id="_9-\u56FE\u5F62\u8F6C\u9762" tabindex="-1"><a class="header-anchor" href="#_9-\u56FE\u5F62\u8F6C\u9762" aria-hidden="true">#</a> 9.\u56FE\u5F62\u8F6C\u9762</h3><h4 id="_1-webgl\u4E09\u79CD\u9762\u7684\u9002\u5E94\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_1-webgl\u4E09\u79CD\u9762\u7684\u9002\u5E94\u573A\u666F" aria-hidden="true">#</a> 1-webgl\u4E09\u79CD\u9762\u7684\u9002\u5E94\u573A\u666F</h4><p>\u4E4B\u524D\u8BF4\u8FC7\uFF0Cwebgl \u53EF\u4EE5\u7ED8\u5236\u4E09\u79CD\u9762\uFF1A</p><ul><li>TRIANGLES \u5355\u72EC\u4E09\u89D2\u5F62</li><li>TRIANGLE_STRIP \u4E09\u89D2\u5E26</li><li>TRIANGLE_FAN \u4E09\u89D2\u6247</li></ul><p>\u5728\u5B9E\u9645\u7684\u5F15\u64CE\u5F00\u53D1\u4E2D\uFF0CTRIANGLES \u7528\u5F97\u6700\u591A\u7684\u3002\u5B83\u7684\u4F18\u52BF\u662F\u53EF\u4EE5\u7ED8\u5236\u4EFB\u610F\u6A21\u578B\uFF0C\u7F3A\u70B9\u662F\u6BD4\u8F83\u8D39\u70B9\u3002</p><p>\u9002\u5408 TRIANGLES \u5355\u72EC\u4E09\u89D2\u5F62\u7684\u7684\u6A21\u578B\uFF1A<br><img src="'+mn+'" alt=""></p><p>TRIANGLE_STRIP \u548C TRIANGLE_FAN \u4F18\u70B9\u662F\u76F8\u90BB\u7684\u4E09\u89D2\u5F62\u53EF\u4EE5\u5171\u7528\u4E00\u6761\u8FB9\uFF0C\u7701\u70B9\uFF0C\u5176\u7F3A\u70B9\u4E5F\u592A\u660E\u663E\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u53EA\u9002\u5408\u7ED8\u5236\u5177\u5907\u76F8\u5E94\u7279\u70B9\u7684\u6A21\u578B\u3002</p><p>\u9002\u5408 TRIANGLE_STRIP \u4E09\u89D2\u5E26\u7684\u6A21\u578B\uFF1A<br><img src="'+dn+'" alt=""></p><p>\u9002\u5408 TRIANGLE_FAN \u4E09\u89D2\u6247\u7684\u6A21\u578B\uFF1A<br><img src="'+gn+`" alt=""></p><p>three.js \u4F7F\u7528\u7684\u7ED8\u5236\u9762\u7684\u65B9\u5F0F\u5C31\u662FTRIANGLES\uFF0C\u53EF\u4EE5\u5728\u5176WebGLRenderer \u5BF9\u8C61\u7684\u6E90\u7801\u7684renderBufferImmediate \u65B9\u6CD5\u4E2D\u627E\u5230\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>_gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span> _gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>count <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_2-\u56FE\u5F62\u8F6C\u9762\u7684\u57FA\u672C\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_2-\u56FE\u5F62\u8F6C\u9762\u7684\u57FA\u672C\u6B65\u9AA4" aria-hidden="true">#</a> 2-\u56FE\u5F62\u8F6C\u9762\u7684\u57FA\u672C\u6B65\u9AA4</h4>`,96),ip=n("\u5728three.js \u91CC\u6709\u4E00\u4E2A\u56FE\u5F62\u51E0\u4F55\u4F53"),kp={href:"https://threejs.org/docs/index.html#api/en/geometries/ShapeGeometry",target:"_blank",rel:"noopener noreferrer"},bp=n("ShapeGeometry"),mp=n("\uFF0C\u53EF\u4EE5\u628A\u56FE\u5F62\u53D8\u6210\u9762\u3002"),dp=s("br",null,null,-1),gp=s("img",{src:vn,alt:""},null,-1),vp=a('<p>\u53EA\u8981\u6709\u6570\u5B66\u652F\u6491\uFF0C\u4E5F\u53EF\u4EE5\u5B9E\u73B0\u8FD9\u79CD\u6548\u679C\u3002</p><p>\u63A5\u4E0B\u6765\u5C31\u4F7F\u7528TRIANGLES \u72EC\u7ACB\u4E09\u89D2\u5F62\u7684\u65B9\u5F0F\uFF0C\u5C06\u56FE\u5F62\u8F6C\u6210\u9762\u3002</p><p><strong>\u4F7F\u7528\u7684\u65B9\u6CD5\u53EB\u505A\u201C\u780D\u89D2\u201D\uFF08\u65B9\u6CD5\u4E0D\u552F\u4E00\uFF09\uFF0C\u5176\u539F\u7406\u5C31\u662F\u4ECE\u8D77\u70B9\u5C06\u591A\u8FB9\u5F62\u4E2D\u7B26\u5408\u7279\u5B9A\u6761\u4EF6\u7684\u89D2\u9010\u4E2A\u780D\u6389\uFF0C\u7136\u540E\u4FDD\u5B58\u5230\u4E00\u4E2A\u96C6\u5408\u91CC\uFF0C\u76F4\u5230\u628A\u591A\u8FB9\u5F62\u780D\u5F97\u53EA\u5269\u4E0B\u4E00\u4E2A\u4E09\u89D2\u5F62\u4E3A\u6B62\u3002\u8FD9\u65F6\u5019\u96C6\u5408\u91CC\u7684\u6240\u6709\u4E09\u89D2\u5F62\u5C31\u662F\u6211\u4EEC\u60F3\u8981\u7684\u72EC\u7ACB\u4E09\u89D2\u5F62\u3002</strong></p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A<br><img src="'+yn+'" alt=""></p><p>\u5DF2\u77E5\uFF1A\u9006\u65F6\u9488\u7ED8\u56FE\u7684\u8DEF\u5F84G<br> \u6C42\uFF1A\u5C06\u5176\u53D8\u6210\u4E0B\u65B9\u7F51\u683C\u7684\u65B9\u6CD5<br><img src="'+fn+`" alt=""></p><p>\u89E3\uFF1A</p><ol><li>\u5BFB\u627E\u6EE1\u8DB3\u4EE5\u4E0B\u6761\u4EF6\u7684\u25B2ABC\uFF1A</li></ol><ul><li>\u25B2ABC\u7684\u9876\u70B9\u7D22\u5F15\u4F4D\u7F6E\u8FDE\u7EED\uFF0C\u5982012,123\u3001234</li><li>\u70B9C\u5728\u5411\u91CFAB\u7684\u6B63\u5F00\u534A\u5E73\u9762\u91CC\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3A\u4F60\u7AD9\u5728A\u70B9\uFF0C\u9762\u671DB\u70B9\uFF0C\u70B9C\u8981\u5728\u4F60\u7684\u5DE6\u624B\u8FB9</li><li>\u25B2ABC\u4E2D\u6CA1\u6709\u5305\u542B\u8DEF\u5F84G \u4E2D\u7684\u5176\u5B83\u9876\u70B9</li></ul><ol start="2"><li>\u5F53\u627E\u5230\u25B2ABC \u540E\uFF0C\u5C31\u5C06\u70B9B\u4ECE\u8DEF\u5F84\u7684\u9876\u70B9\u96C6\u5408\u4E2D\u5220\u6389\uFF0C\u7136\u540E\u7EE7\u7EED\u5F80\u540E\u627E\u3002</li><li>\u5F53\u8DEF\u5F84\u7684\u5B9A\u70B9\u96C6\u5408\u53EA\u5269\u4E0B3\u4E2A\u70B9\u65F6\uFF0C\u5C31\u7ED3\u675F\u3002</li><li>\u7531\u6240\u6709\u6EE1\u8DB3\u6761\u4EF6\u7684\u25B2ABC\u6784\u6210\u7684\u96C6\u5408\u5C31\u662F\u6211\u4EEC\u8981\u6C42\u7684\u72EC\u7ACB\u4E09\u89D2\u5F62\u96C6\u5408\u3002</li></ol><h4 id="_3-\u7ED8\u5236\u8DEF\u5F84g" tabindex="-1"><a class="header-anchor" href="#_3-\u7ED8\u5236\u8DEF\u5F84g" aria-hidden="true">#</a> 3-\u7ED8\u5236\u8DEF\u5F84G</h4><ol><li>\u8DEF\u5F84G\u7684\u9876\u70B9\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pathData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span>
      <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span>
      <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span>
      <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span>
      <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span>
      <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span>
      <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span>
      <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
      <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">0</span>
 <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>\u5728pathData\u91CC\u4E24\u4E2A\u6570\u5B57\u4E3A\u4E00\u7EC4\uFF0C\u5206\u522B\u4EE3\u8868\u9876\u70B9\u7684\uFF58\u4F4D\u548C\uFF59\u4F4D\u3002<br> pathData\u91CC\u7684\u6570\u636E\u662F\u4EE5\u50CF\u7D20\u4E3A\u5355\u4F4D\u753B\u51FA\u6765\u7684\uFF0C\u5728\u5B9E\u9645\u9879\u76EE\u534F\u4F5C\u4E2D\uFF0CUI\u7ED9\u6211\u4EEC\u7684svg\u6587\u4EF6\u53EF\u80FD\u4E5F\u662F\u4EE5\u50CF\u7D20\u4E3A\u5355\u4F4D\u753B\u51FA\u6765\u7684\u3002<br> \u56E0\u4E3A\uFF0Cwebgl\u753B\u5E03\u7684\u5BBD\u548C\u9AD8\u6C38\u8FDC\u90FD\u662F\u4E24\u4E2A\u5355\u4F4D\u3002<br> \u6240\u4EE5\uFF0C\u8981\u5C06\u4E0A\u9762\u7684\u70B9\u753B\u5230 webgl \u753B\u5E03\u4E2D\uFF0C\u5C31\u9700\u8981\u505A\u4E00\u4E2A\u6570\u636E\u6620\u5C04\u3002</p><ol start="2"><li>\u5728webgl \u4E2D\u7ED8\u5236\u6B63\u65B9\u5F62\u3002</li></ol><p>\u4ECEpathData \u6570\u636E\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u8DEF\u5F84G\u7684\u5BBD\u9AD8\u90FD\u662F600\uFF0C\u662F\u4E00\u4E2A\u6B63\u65B9\u5F62\u3002<br> \u6240\u4EE5\uFF0C\u53EF\u4EE5\u5C06\u8DEF\u5F84G\u6620\u5C04\u5230 webgl \u753B\u5E03\u7684\u4E00\u4E2A\u6B63\u65B9\u5F62\u4E2D\u3002<br> \u8FD9\u4E2A\u6B63\u65B9\u5F62\u7684\u9AD8\u5EA6\u53EF\u4EE5\u6682\u4E14\u5B9A\u4E3A1\uFF0C\u90A3\u4E48\u5176\u5BBD\u5EA6\u5C31\u5E94\u8BE5\u662F\u9AD8\u5EA6\u9664\u4EE5canvas\u753B\u5E03\u7684\u5BBD\u9AD8\u6BD4\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5BBD\u9AD8\u6BD4</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token comment">// \u6B63\u65B9\u5F62\u9AD8\u5EA6</span>
<span class="token keyword">const</span> rectH <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
<span class="token comment">// \u6B63\u65B9\u5F62\u5BBD\u5EA6</span>
<span class="token keyword">const</span> rectW <span class="token operator">=</span> rectH <span class="token operator">/</span> ratio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>\u6B63\u65B9\u5F62\u7684\u5B9A\u4F4D\uFF0C\u628A\u6B63\u65B9\u5F62\u653E\u5728webgl\u753B\u5E03\u7684\u4E2D\u5FC3\u3002</li></ol><p>\u83B7\u53D6\u6B63\u65B9\u5F62\u5C3A\u5BF8\u7684\u4E00\u534A\uFF0C\u7136\u540E\u6C42\u51FA\u5176x\u3001y\u65B9\u5411\u7684\u4E24\u4E2A\u6781\u503C\u5373\u53EF\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6B63\u65B9\u5F62\u5BBD\u9AD8\u7684\u4E00\u534A</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>halfRectW<span class="token punctuation">,</span> halfRectH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>rectW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> rectH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// \u4E24\u4E2A\u6781\u70B9</span>
<span class="token keyword">const</span> minX <span class="token operator">=</span> <span class="token operator">-</span>halfRectW<span class="token punctuation">;</span>
<span class="token keyword">const</span> minY <span class="token operator">=</span> <span class="token operator">-</span>halfRectH<span class="token punctuation">;</span>
<span class="token keyword">const</span> maxX <span class="token operator">=</span> halfRectW<span class="token punctuation">;</span>
<span class="token keyword">const</span> maxY <span class="token operator">=</span> halfRectH<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>\u5229\u7528\u4E4B\u524D\u7684Poly\u5BF9\u8C61\u7ED8\u5236\u6B63\u65B9\u5F62\uFF0C\u6D4B\u8BD5\u4E00\u4E0B\u6548\u679C\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">vertices</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        minX<span class="token punctuation">,</span> maxY<span class="token punctuation">,</span>
        minX<span class="token punctuation">,</span> minY<span class="token punctuation">,</span>
        maxX<span class="token punctuation">,</span> minY<span class="token punctuation">,</span> 
        maxX<span class="token punctuation">,</span> maxY<span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rect<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5148\u753B\u4E864\u4E2A\u70B9\uFF0C\u6548\u679C\u6CA1\u95EE\u9898\u3002<br><img src="`+hn+`" alt=""></p><ol start="5"><li>\u5EFA\u7ACBx\u8F74\u548Cy\u8F74\u6BD4\u4F8B\u5C3A\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> scaleX <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> minX<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> maxX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> scaleY <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> minY<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> maxY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span><span class="token parameter">ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> bx<span class="token punctuation">,</span> by</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> delta <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> bx <span class="token operator">-</span> ax<span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> by <span class="token operator">-</span> ay<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> k <span class="token operator">=</span> delta<span class="token punctuation">.</span>y <span class="token operator">/</span> delta<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> ay <span class="token operator">-</span> ax <span class="token operator">*</span> k<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> k <span class="token operator">*</span> x <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ScaleLinear(ax, ay, bx, by) \u65B9\u6CD5\u4F7F\u7528\u7684\u5C31\u662F\u70B9\u659C\u5F0F\uFF0C\u7528\u4E8E\u5C06x\u8F74\u548Cy\u8F74\u4E0A\u7684\u6570\u636E\u50CF\u7D20\u6570\u636E\u6620\u5C04\u6210 webgl\u6570\u636E</p><ul><li>ax \u50CF\u7D20\u6570\u636E\u7684\u6781\u5C0F\u503C</li><li>ay webgl\u6570\u636E\u7684\u6781\u5C0F\u503C</li><li>bx \u50CF\u7D20\u6570\u636E\u7684\u6781\u5927\u503C</li><li>by webgl\u6570\u636E\u7684\u6781\u5927\u503C</li></ul><ol start="6"><li>\u5C06\u8DEF\u5F84G\u4E2D\u7684\u50CF\u7D20\u6570\u636E\u89E3\u6790\u4E3A webgl \u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> glData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pathData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    glData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">scaleX</span><span class="token punctuation">(</span>pathData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>pathData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u753B\u4E00\u4E0B\u770B\u770B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">vertices</span><span class="token operator">:</span> glData<span class="token punctuation">,</span>
    <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;POINTS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LINE_LOOP&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
path<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="`+wn+`" alt=""></p><h4 id="_4-\u5C06\u56FE\u5F62\u7F51\u683C\u5316" tabindex="-1"><a class="header-anchor" href="#_4-\u5C06\u56FE\u5F62\u7F51\u683C\u5316" aria-hidden="true">#</a> 4.\u5C06\u56FE\u5F62\u7F51\u683C\u5316</h4><ol><li>\u5EFA\u7ACB\u4E86\u4E00\u4E2AShapeGeo \u5BF9\u8C61\uFF0C\u7528\u4E8E\u5C06\u56FE\u5F62\u7F51\u683C\u5316\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> shapeGeo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShapeGeo</span><span class="token punctuation">(</span>glData<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><details class="custom-container details"><summary>ShapeGeo</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ShapeGeo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">pathData<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pathData <span class="token operator">=</span> pathData<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>geoData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>triangles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parsePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>triangles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findTriangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">upadateVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">parsePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>geoData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> pathData<span class="token punctuation">,</span> geoData <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pathData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      geoData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> pathData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> pathData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">findTriangle</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> geoData<span class="token punctuation">,</span> triangles <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> geoData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>geoData<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      triangles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>geoData<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>i0<span class="token punctuation">,</span> i1<span class="token punctuation">,</span> i2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        i <span class="token operator">%</span> len<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> len<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> len
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token punctuation">[</span>
        geoData<span class="token punctuation">[</span>i0<span class="token punctuation">]</span><span class="token punctuation">,</span>
        geoData<span class="token punctuation">[</span>i1<span class="token punctuation">]</span><span class="token punctuation">,</span>
        geoData<span class="token punctuation">[</span>i2<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>triangle<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">includePoint</span><span class="token punctuation">(</span>triangle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        triangles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>triangle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        geoData<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findTriangle</span><span class="token punctuation">(</span>i1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">includePoint</span><span class="token punctuation">(</span><span class="token parameter">triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> ele <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>geoData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>triangle<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">inTriangle</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> triangle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">inTriangle</span><span class="token punctuation">(</span><span class="token parameter">p0<span class="token punctuation">,</span> triangle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> inPoly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> j <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>triangle<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> triangle<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inPoly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> inPoly<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> bx<span class="token punctuation">,</span> by<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p0<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p0<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
      p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p0<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p0<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ax <span class="token operator">*</span> by <span class="token operator">-</span> bx <span class="token operator">*</span> ay<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">upadateVertices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>triangles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">triangle</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token keyword">of</span> triangle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> arr
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div></details><p>\u5C5E\u6027\uFF1A</p><ul><li>pathData \u5E73\u5C55\u5F00\u7684\u8DEF\u5F84\u6570\u636E</li><li>geoData \u7531\u8DEF\u5F84\u6570\u636EpathData \u8F6C\u6210\u7684\u5BF9\u8C61\u578B\u6570\u7EC4</li><li>triangles \u4E09\u89D2\u5F62\u96C6\u5408\uFF0C\u5BF9\u8C61\u578B\u6570\u7EC4</li><li>vertices \u5E73\u5C55\u5F00\u7684\u5BF9\u7ACB\u4E09\u89D2\u5F62\u9876\u70B9\u96C6\u5408</li></ul><p>\u65B9\u6CD5\uFF1A</p><ul><li>update() \u66F4\u65B0\u65B9\u6CD5\uFF0C\u57FA\u4E8EpathData \u751F\u6210vertices</li><li>parsePath() \u57FA\u4E8E\u8DEF\u5F84\u6570\u636EpathData \u8F6C\u6210\u5BF9\u8C61\u578B\u6570\u7EC4</li><li>findTriangle(i) \u5BFB\u627E\u7B26\u5408\u6761\u4EF6\u7684\u4E09\u89D2\u5F62 <ul><li>i \u9876\u70B9\u5728geoData \u4E2D\u7684\u7D22\u5F15\u4F4D\u7F6E\uFF0C\u8868\u793A\u4ECE\u54EA\u91CC\u5F00\u59CB\u5BFB\u627E\u4E09\u89D2\u5F62</li></ul></li><li>includePoint(triangle) \u5224\u65AD\u4E09\u89D2\u5F62\u4E2D\u662F\u5426\u6709\u5176\u5B83\u9876\u70B9</li><li>inTriangle(p0, triangle) \u5224\u65AD\u4E00\u4E2A\u9876\u70B9\u662F\u5426\u5728\u4E09\u89D2\u5F62\u4E2D</li><li>cross([p0, p1, p2]) \u4EE5p0\u4E3A\u57FA\u70B9\uFF0C\u5BF9\u4E8C\u7EF4\u5411\u91CFp0p1\u3001p0p2\u505A\u53C9\u4E58\u8FD0\u7B97</li><li>upadateVertices() \u57FA\u4E8E\u5BF9\u8C61\u6570\u7EC4geoData \u751F\u6210\u5E73\u5C55\u5F00\u7684vertices \u6570\u636E</li></ul><ol start="2"><li>\u7ED8\u5236G\u5F62\u9762</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> face <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">vertices</span><span class="token operator">:</span> shapeGeo<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
    <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
face<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+xn+`" alt=""></p><details class="custom-container details"><summary>\u56FE\u5F62\u8F6C\u9762</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
        gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders<span class="token punctuation">,</span> ScaleLinear <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Poly.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> ShapeGeo <span class="token keyword">from</span> <span class="token string">&quot;../jsm/ShapeGeo.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5237\u5E95\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8DEF\u5F84G-\u9006\u65F6\u9488</span>
    <span class="token keyword">const</span> pathData <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span>
        <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span>
        <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span>
        <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span>
        <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span>
        <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span>
        <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span>
        <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span>
        <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span>
        <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5BBD\u9AD8\u6BD4</span>
    <span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
    <span class="token comment">// \u6B63\u65B9\u5F62\u9AD8\u5EA6</span>
    <span class="token keyword">const</span> rectH <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token comment">// \u6B63\u65B9\u5F62\u5BBD\u5EA6</span>
    <span class="token keyword">const</span> rectW <span class="token operator">=</span> rectH <span class="token operator">/</span> ratio<span class="token punctuation">;</span>
    <span class="token comment">// \u6B63\u65B9\u5F62\u5BBD\u9AD8\u7684\u4E00\u534A</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>halfRectW<span class="token punctuation">,</span> halfRectH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>rectW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> rectH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// \u4E24\u4E2A\u6781\u70B9</span>
    <span class="token keyword">const</span> minX <span class="token operator">=</span> <span class="token operator">-</span>halfRectW<span class="token punctuation">;</span>
    <span class="token keyword">const</span> minY <span class="token operator">=</span> <span class="token operator">-</span>halfRectH<span class="token punctuation">;</span>
    <span class="token keyword">const</span> maxX <span class="token operator">=</span> halfRectW<span class="token punctuation">;</span>
    <span class="token keyword">const</span> maxY <span class="token operator">=</span> halfRectH<span class="token punctuation">;</span>
    <span class="token comment">// \u6B63\u65B9\u5F62</span>
    <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        <span class="token literal-property property">vertices</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            minX<span class="token punctuation">,</span> maxY<span class="token punctuation">,</span>
            minX<span class="token punctuation">,</span> minY<span class="token punctuation">,</span>
            maxX<span class="token punctuation">,</span> minY<span class="token punctuation">,</span>
            maxX<span class="token punctuation">,</span> maxY<span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rect<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5EFA\u7ACB\u6BD4\u4F8B\u5C3A</span>
    <span class="token keyword">const</span> scaleX <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>
        <span class="token number">0</span><span class="token punctuation">,</span> minX<span class="token punctuation">,</span>
        <span class="token number">600</span><span class="token punctuation">,</span> maxX
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> scaleY <span class="token operator">=</span> <span class="token function">ScaleLinear</span><span class="token punctuation">(</span>
        <span class="token number">0</span><span class="token punctuation">,</span> maxY<span class="token punctuation">,</span>
        <span class="token number">600</span><span class="token punctuation">,</span> minY
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5C06\u8DEF\u5F84G\u4E2D\u7684\u50CF\u7D20\u6570\u636E\u89E3\u6790\u4E3Awebgl\u6570\u636E</span>
    <span class="token keyword">const</span> glData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pathData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        glData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">scaleX</span><span class="token punctuation">(</span>pathData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>pathData<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        <span class="token literal-property property">vertices</span><span class="token operator">:</span> glData<span class="token punctuation">,</span>
        <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;POINTS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LINE_LOOP&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    path<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> shapeGeo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShapeGeo</span><span class="token punctuation">(</span>glData<span class="token punctuation">)</span>
    <span class="token keyword">const</span> face <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        <span class="token literal-property property">vertices</span><span class="token operator">:</span> shapeGeo<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
        <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    face<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div></details><details class="custom-container details"><summary>\u9F20\u6807\u8F6C\u9762</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
        gl_PointSize <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders<span class="token punctuation">,</span> getMousePosInWebgl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Poly.js&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> ShapeGeo <span class="token keyword">from</span> <span class="token string">&quot;../jsm/ShapeGeo.js&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6\u7740\u8272\u5668\u6587\u672C</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>

    <span class="token comment">// \u83B7\u53D6WebGL\u4E0A\u4E0B\u6587</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u521D\u59CB\u5316\u7740\u8272\u5668</span>
    <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u8BBE\u7F6E\u80CC\u666F\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5237\u5E95\u8272</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> poly <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;LINE_STRIP&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> face <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;POINTS&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousedown&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getMousePosInWebgl</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

        face<span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShapeGeo</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span>vertices
        face<span class="token punctuation">.</span><span class="token function">updateBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        face<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div></details><h2 id="\u4E94\u3001\u77E9\u9635\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001\u77E9\u9635\u53D8\u6362" aria-hidden="true">#</a> \u4E94\u3001\u77E9\u9635\u53D8\u6362</h2><p>\u53D8\u6362\u6709\u4E09\u79CD\u72B6\u6001\uFF1A\u5E73\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u3002</p><p>\u5F53\u53D8\u6362\u4E00\u4E2A\u56FE\u5F62\u65F6\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F\u5728\u79FB\u52A8\u8FD9\u4E2A\u56FE\u5F62\u7684\u6240\u6709\u9876\u70B9\u3002</p><h3 id="_1-\u5E73\u79FB" tabindex="-1"><a class="header-anchor" href="#_1-\u5E73\u79FB" aria-hidden="true">#</a> 1.\u5E73\u79FB</h3><p>\u5BF9\u56FE\u5F62\u7684\u5E73\u79FB\u5C31\u662F\u5BF9\u56FE\u5F62\u6240\u6709\u9876\u70B9\u7684\u5E73\u79FB</p><p><img src="`+_n+`" alt=""></p><p>\u5728\u5B9E\u9645\u4EE3\u7801\u4E2D\uFF0C\u8981\u6709\u4E00\u4E2A\u5411\u91CF\u7684\u6982\u5FF5\uFF0C\u6BD4\u5982 (x,y,z) \uFF0C\u6211\u4EEC\u65E2\u53EF\u4EE5\u8BF4\u5B83\u662F\u4E00\u4E2A\u9876\u70B9\u4F4D\u7F6E\uFF0C\u4E5F\u53EF\u4EE5\u8BF4\u5B83\u662F\u4E00\u4E2A\u5411\u91CF\uFF0C\u9876\u70B9\u7684\u4F4D\u79FB\u5176\u5B9E\u5C31\u662F\u5411\u91CF\u7684\u52A0\u6CD5\u3002</p><p>GLSL ES \u8BED\u8A00\u91CC\u7684\u5411\u91CF\u8FD0\u7B97</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>attribute vec4 a_Position<span class="token punctuation">;</span>
vec4 translation <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position <span class="token operator">+</span> translation<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>a_Position \u662F\u539F\u59CB\u70B9\u4F4D\uFF0C\u5C5E\u4E8E attribute \u53D8\u91CF</li><li>translation \u662F\u9876\u70B9\u7740\u8272\u5668\u91CC\u7684\u79C1\u6709\u53D8\u91CF\uFF0C\u6CA1\u6709\u5411\u5916\u90E8\u66B4\u9732\uFF0C\u5C5E\u4E8E 4 \u7EF4\u5411\u91CF</li><li>a_Position+translation \u4FBF\u662F\u7740\u8272\u5668\u5185\u7684\u5411\u91CF\u52A0\u6CD5\uFF0C\u8FD9\u91CC\u662F\u5BF9\u539F\u59CB\u70B9\u4F4D\u8FDB\u884C\u4F4D\u79FB</li></ul><h3 id="_2-\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-\u65CB\u8F6C" aria-hidden="true">#</a> 2.\u65CB\u8F6C</h3><p>\u7269\u4F53\u7684\u65CB\u8F6C\u65B9\u5411\u662F\u6709\u6B63\u8D1F\u4E4B\u5206\u7684\uFF0C\u5728 webgl \u4E2D\uFF0C\u9664\u88C1\u526A\u7A7A\u95F4\u4E4B\u5916\u7684\u5927\u90E8\u5206\u529F\u80FD\u90FD\u4F7F\u7528\u4E86\u53F3\u624B\u5750\u6807\u7CFB\u3002</p><p><img src="`+jn+'" alt=""></p><ul><li>\u5F53\u7269\u4F53\u7ED5 z \u8F74\uFF0C\u4ECE x \u8F74\u6B63\u534A\u8F74\u5411 y \u8F74\u6B63\u534A\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u662F\u6B63\u5411\u65CB\u8F6C\uFF0C\u53CD\u4E4B\u4E3A\u8D1F\u3002</li><li>\u5F53\u7269\u4F53\u7ED5 x \u8F74\uFF0C\u4ECE y \u8F74\u6B63\u534A\u8F74\u5411 z \u8F74\u6B63\u534A\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u662F\u6B63\u5411\u65CB\u8F6C\uFF0C\u53CD\u4E4B\u4E3A\u8D1F\u3002</li><li>\u5F53\u7269\u4F53\u7ED5 y \u8F74\uFF0C\u4ECE z \u8F74\u6B63\u534A\u8F74\u5411 x \u8F74\u6B63\u534A\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u662F\u6B63\u5411\u65CB\u8F6C\uFF0C\u53CD\u4E4B\u4E3A\u8D1F\u3002</li></ul><p>\u65CB\u8F6C\u516C\u5F0F:</p><p>\u7531\u4E00\u4E2A\u8BA9\u9876\u70B9\u56F4\u7ED5 z \u8F74\u65CB\u8F6C\u7684\u4F8B\u5B50\u5F15\u51FA</p><p><img src="'+qn+`" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u70B9 A \u7684\u4F4D\u7F6E\u662F(ax,ay,az)</li><li>\u70B9 A \u8981\u56F4\u7ED5 z \u8F74\u65CB\u8F6C \u03B2 \u5EA6\uFF0C\u8F6C\u5230\u70B9 B \u7684\u4F4D\u7F6E</li></ul><p>\u6C42\uFF1A\u70B9 A \u65CB\u8F6C\u540E\u7684 bx\u3001by \u4F4D\u7F6E</p><p>\u56E0\u4E3A \u2220\u03B2 \u662F\u5DF2\u77E5\u7684\uFF0C\u2220\u03B1 \u53EF\u4EE5\u901A\u8FC7\u70B9 A \u5F97\u51FA:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u2220xOB<span class="token operator">=</span>\u03B1<span class="token operator">+</span>\u03B2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E09\u89D2\u51FD\u6570\u5C31\u53EF\u4EE5\u63A8\u51FA bx\u3001by</p><p>\u8BBE \u2220xOB=\u03B8\uFF0C\u5219\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx<span class="token operator">=</span>cos\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
by<span class="token operator">=</span>sin\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>|OA|\u662F\u70B9 O \u5230\u70B9 A \u7684\u8DDD\u79BB\uFF0C\u53EF\u4EE5\u76F4\u63A5\u7528\u70B9 A \u6C42\u51FA:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|=</span>Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>ax<span class="token operator">*</span>ax<span class="token operator">+</span>ay<span class="token operator">*</span>ay<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u53EA\u9700\u8981\u77E5\u9053 cos\u03B8 \u548C sin\u03B8 \u7684\u503C\u5373\u53EF\uFF0C\u56E0\u4E3A\uFF1A\u03B8=\u03B1+\u03B2<br> \u6240\u4EE5\u53EF\u4EE5\u5229\u7528\u548C\u89D2\u516C\u5F0F\u6C42 cos\u03B8 \u548C sin\u03B8 \u7684\u503C\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B8 <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>\u03B1 <span class="token operator">+</span> \u03B2<span class="token punctuation">)</span><span class="token punctuation">;</span>
cos\u03B8 <span class="token operator">=</span> cos\u03B1 <span class="token operator">*</span> cos\u03B2 <span class="token operator">-</span> sin\u03B1 <span class="token operator">*</span> sin\u03B2<span class="token punctuation">;</span>

sin\u03B8 <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>\u03B1 <span class="token operator">+</span> \u03B2<span class="token punctuation">)</span><span class="token punctuation">;</span>
sin\u03B8 <span class="token operator">=</span> cos\u03B2 <span class="token operator">*</span> sin\u03B1 <span class="token operator">+</span> sin\u03B2 <span class="token operator">*</span> cos\u03B1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6240\u4EE5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx<span class="token operator">=</span>cos\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
bx<span class="token operator">=</span><span class="token punctuation">(</span>cos\u03B1<span class="token operator">*</span>cos\u03B2<span class="token operator">-</span>sin\u03B1<span class="token operator">*</span>sin\u03B2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
bx<span class="token operator">=</span>cos\u03B1<span class="token operator">*</span>cos\u03B2<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span><span class="token operator">-</span>sin\u03B1<span class="token operator">*</span>sin\u03B2<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>

by<span class="token operator">=</span>sin\u03B8<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
by<span class="token operator">=</span><span class="token punctuation">(</span>cos\u03B2<span class="token operator">*</span>sin\u03B1<span class="token operator">+</span>sin\u03B2<span class="token operator">*</span>cos\u03B1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
by<span class="token operator">=</span>cos\u03B2<span class="token operator">*</span>sin\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span><span class="token operator">+</span>sin\u03B2<span class="token operator">*</span>cos\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u56E0\u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|=</span>ax
sin\u03B1<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">OA</span><span class="token operator">|=</span>ay
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7B80\u5316\u5F97\u5230 bx\u3001by \u7684\u516C\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx <span class="token operator">=</span> ax <span class="token operator">*</span> cos\u03B2 <span class="token operator">-</span> ay <span class="token operator">*</span> sin\u03B2<span class="token punctuation">;</span>
by <span class="token operator">=</span> ay <span class="token operator">*</span> cos\u03B2 <span class="token operator">+</span> ax <span class="token operator">*</span> sin\u03B2<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u5728\u7740\u8272\u5668\u4E2D\u65CB\u8F6C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    float angle <span class="token operator">=</span> <span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">80.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float sinB <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float cosB <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_Position<span class="token punctuation">.</span>x <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>x<span class="token operator">*</span>cosB <span class="token operator">-</span> a_Position<span class="token punctuation">.</span>y<span class="token operator">*</span>sinB<span class="token punctuation">;</span>
        gl_Position<span class="token punctuation">.</span>y <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>y<span class="token operator">*</span>cosB <span class="token operator">+</span> a_Position<span class="token punctuation">.</span>x<span class="token operator">*</span>sinB<span class="token punctuation">;</span>
        gl_Position<span class="token punctuation">.</span>z <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
        gl_Position<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>radians(float degree) \u5C06\u89D2\u5EA6\u8F6C\u5F27\u5EA6</li><li>sin(float angle) \u6B63\u5F26</li><li>cos(float angle) \u4F59\u5F26</li></ul><h3 id="_3-\u7F29\u653E" tabindex="-1"><a class="header-anchor" href="#_3-\u7F29\u653E" aria-hidden="true">#</a> 3.\u7F29\u653E</h3><p>\u7F29\u653E\u53EF\u4EE5\u7406\u89E3\u4E3A\u5BF9\u5411\u91CF\u957F\u5EA6\u7684\u6539\u53D8\uFF0C\u6216\u8005\u5BF9\u5411\u91CF\u5750\u6807\u5206\u91CF\u7684\u540C\u6B65\u7F29\u653E</p><p><img src="`+Pn+`" alt=""></p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u70B9 A \u7684\u4F4D\u7F6E\u662F(ax,ay,az)</li><li>\u70B9 A \u57FA\u4E8E\u539F\u70B9\u5167\u7F29\u4E86\u4E00\u534A</li></ul><p>\u6C42\uFF1A\u70B9 A \u5167\u7F29\u4E86\u4E00\u534A\u540E\u7684 bx\u3001by\u3001bz \u4F4D\u7F6E</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bx <span class="token operator">=</span> ax <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
by <span class="token operator">=</span> ay <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
bz <span class="token operator">=</span> az <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u5728\u7740\u8272\u5668\u4E2D\u7F29\u653E</p><p>\u5BF9 gl_Position \u7684 x\u3001y\u3001z \u4F9D\u6B21\u7F29\u653E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
attribute vec4 a_Position<span class="token punctuation">;</span>
float scale <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	gl_Position<span class="token punctuation">.</span>x <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>x<span class="token operator">*</span>scale<span class="token punctuation">;</span>
	gl_Position<span class="token punctuation">.</span>y <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>y<span class="token operator">*</span>scale<span class="token punctuation">;</span>
	gl_Position<span class="token punctuation">.</span>z <span class="token operator">=</span> a_Position<span class="token punctuation">.</span>z<span class="token operator">*</span>scale<span class="token punctuation">;</span>
	gl_Position<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>a_Position \u4E2D\u62BD\u79BB\u51FA\u7531 x\u3001y\u3001z \u7EC4\u6210\u7684\u4E09\u7EF4\u5411\u91CF\uFF0C\u5BF9\u5176\u8FDB\u884C\u4E00\u6B21\u6027\u7F29\u653E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
attribute vec4 a_Position<span class="token punctuation">;</span>
float scale<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	gl_Position<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token operator">*</span>scale<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-\u77E9\u9635" aria-hidden="true">#</a> 4.\u77E9\u9635</h3><p>\u77E9\u9635\uFF08Matrix\uFF09\u662F\u4E00\u4E2A\u6309\u7167\u77E9\u5F62\u7EB5\u6A2A\u6392\u5217\u7684\u590D\u6570\u96C6\u5408<br> \u5728\u77E9\u9635\u4E2D\u7684\u6BCF\u4E00\u884C\uFF0C\u6216\u8005\u6BCF\u4E00\u5217\u6570\u5B57\u6784\u6210\u7684\u96C6\u5408\uFF0C\u53EF\u4EE5\u89C6\u4E4B\u4E3A\u5411\u91CF</p><ol><li>\u5411\u91CF</li></ol><p>\u5411\u91CF\uFF0C\u53C8\u53EB\u77E2\u91CF\uFF0C\u6307\u5177\u6709\u5927\u5C0F\uFF08magnitude\uFF09\u548C\u65B9\u5411\u7684\u91CF<br> webgl \u91CC\u7684\u5411\u91CF\u6709 1 \u7EF4\u5411\u91CF\u30012 \u7EF4\u5411\u91CF\u30013 \u7EF4\u5411\u91CF\u548C 4 \u7EF4\u5411\u91CF\uFF1A</p><ul><li>\u7EF4\u5411\u91CF\u4E2D\u6709 1 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F\u5355\u8F74\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\u3002</li><li>2 \u7EF4\u5411\u91CF\u4E2D\u6709 2 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F 2 \u7EF4\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\u3002</li><li>3 \u7EF4\u5411\u91CF\u4E2D\u6709 3 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F 3 \u7EF4\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\u3002</li><li>4 \u7EF4\u5411\u91CF\u4E2D\u6709 4 \u4E2A\u6570\u5B57\uFF0C\u5BF9\u5E94\u7684\u662F 3 \u7EF4\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\uFF0C\u5916\u52A0\u4E00\u4E2A\u9644\u52A0\u6570\u636E\uFF0C\u81F3\u4E8E\u8FD9\u4E2A\u6570\u636E\u662F\u4EC0\u4E48\uFF0C\u8981\u770B\u9879\u76EE\u9700\u6C42\u3002</li></ul><ol start="2"><li>\u77E9\u9635\u548C\u5411\u91CF\u7684\u4E58\u6CD5</li></ol><p><img src="`+Sn+'" alt=""></p><p>\u7528\u4E13\u4E1A\u672F\u8BED\u6765\u8BF4\uFF1A</p><ul><li>\u6A2A\u7740\u7684\u4E24\u7EC4\u9075\u5FAA\u7684\u89C4\u5219\u662F\u884C\u4E3B\u5E8F\uFF0C\u5373\u5C06\u77E9\u9635\u4E2D\u7684\u4E00\u884C\u6570\u636E\u89C6\u4E4B\u4E3A\u4E00\u4E2A\u5411\u91CF\u3002</li><li>\u7AD6\u7740\u7684\u4E24\u7EC4\u9075\u5FAA\u7684\u89C4\u5219\u662F\u5217\u4E3B\u5E8F\uFF0C\u5373\u5C06\u77E9\u9635\u4E2D\u7684\u4E00\u5217\u6570\u636E\u89C6\u4E4B\u4E3A\u4E00\u4E2A\u5411\u91CF\u3002</li></ul><p>\u81F3\u4E8E\u662F\u4F7F\u7528\u884C\u4E3B\u5E8F\uFF0C\u8FD8\u662F\u5217\u4E3B\u5E8F\uFF0C\u8FD9\u5C31\u5F97\u770B\u89C4\u5219\u7684\u5B9A\u5236\u8005\u4E86\u3002<br> \u5728 webgl \u91CC\uFF0C\u77E9\u9635\u5143\u7D20\u7684\u6392\u5217\u89C4\u5219\u662F\u5217\u4E3B\u5E8F\u3002<br> \u6570\u5B66\u4E2D\u5E38\u7528\u7684\u5199\u6CD5\u662F\u884C\u4E3B\u5E8F</p><p>\u53EF\u4EE5\u7528\u77E9\u9635\u4E58\u4EE5\u5411\u91CF\u7684\u65B9\u5F0F\u8BA9\u70B9 p \u65CB\u8F6C \u03B2 \u5EA6\uFF1A</p><p><img src="'+En+`" alt=""></p><ol start="3"><li>\u5728\u7740\u8272\u5668\u4E2D\u5199\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    float angle <span class="token operator">=</span> <span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">40.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float sinB <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float cosB <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mat2 m2 <span class="token operator">=</span> <span class="token function">mat2</span><span class="token punctuation">(</span>
      cosB<span class="token punctuation">,</span> sinB<span class="token punctuation">,</span>
      <span class="token operator">-</span>sinB<span class="token punctuation">,</span>cosB
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>m2<span class="token operator">*</span><span class="token function">vec2</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">,</span> a_Position<span class="token punctuation">.</span>z<span class="token punctuation">,</span> a_Position<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="4"><li>\u56DB\u7EF4\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    float angle<span class="token operator">=</span><span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float cosB<span class="token operator">=</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float sinB<span class="token operator">=</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u5217\u4E3B\u5E8F</span>
    mat4 m4<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      cosB<span class="token punctuation">,</span> sinB<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span>sinB<span class="token punctuation">,</span>cosB<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> m4<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="5"><li>\u77E9\u9635\u5E73\u79FB</li></ol><p>\u8BA9\u9876\u70B9\u7684 x \u79FB\u52A8 0.1\uFF0Cy \u79FB\u52A8 0.2\uFF0Cz \u79FB\u52A8 0.3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5217\u4E3B\u5E8F</span>
    mat4 m4<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> m4<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="6"><li>\u77E9\u9635\u7F29\u653E</li></ol><p>\u9876\u70B9\u5728 x \u8F74\u5411\u7F29\u653E 2\uFF0Cy \u8F74\u5411\u7F29\u653E 3\uFF0C\u8F74\u5411\u7F29\u653E 4\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u5217\u4E3B\u5E8F</span>
    mat4 m4<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
      <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> m4<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="7"><li>\u77E9\u9635\u5E93</li></ol><p>three.js \u7684 Matrix3 \u548C Matrix4 \u5BF9\u8C61\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 1.\u5F15\u5165Matrix4\u5BF9\u8C61</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Matrix4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 2.\u5B9E\u4F8B\u5316\u77E9\u9635\u5BF9\u8C61\uFF0C\u5728\u5176\u4E2D\u5199\u5165\u65CB\u8F6C\u4FE1\u606F</span>
<span class="token keyword">const</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matrix<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3.\u57FA\u4E8Ematrix \u5BF9\u8C61\u7684elements \u5C5E\u6027\uFF0C\u4FEE\u6539uniform \u53D8\u91CF</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="\u516D\u3001-\u77E9\u9635\u590D\u5408\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001-\u77E9\u9635\u590D\u5408\u53D8\u6362" aria-hidden="true">#</a> \u516D\u3001 \u77E9\u9635\u590D\u5408\u53D8\u6362</h2><h3 id="_1-\u77E9\u9635\u76F8\u4E58" tabindex="-1"><a class="header-anchor" href="#_1-\u77E9\u9635\u76F8\u4E58" aria-hidden="true">#</a> 1.\u77E9\u9635\u76F8\u4E58</h3><p>\u77E9\u9635\u76F8\u4E58\u53EF\u4EE5\u5B9E\u73B0\u590D\u5408\u53D8\u6362\uFF0C\u5C31\u6BD4\u5982\u5148\u4F4D\u79FB\u518D\u65CB\u8F6C\u3001\u5148\u65CB\u8F6C\u5728\u4F4D\u79FB\uFF0C\u6216\u7740\u8FDE\u7EED\u4F4D\u79FB\u3002</p><p><img src="`+Mn+'" alt=""><img src="'+Rn+`" alt=""></p><h3 id="_2-\u53D8\u6362\u89C4\u5F8B" tabindex="-1"><a class="header-anchor" href="#_2-\u53D8\u6362\u89C4\u5F8B" aria-hidden="true">#</a> 2.\u53D8\u6362\u89C4\u5F8B</h3><ol><li>\u4F7F\u7528 three.js \u7684 Matrix4 \u5BF9\u8C61\u5EFA\u7ACB\u77E9\u9635</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>const a = new Matrix4().set(
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span>
    <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span>
)
const b = new Matrix4().set(
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span>
    <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span>
    <span class="token number">120</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token number">150</span>
)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u6CE8\uFF1Aset()\u65B9\u6CD5\u91CC\u8F93\u5165\u7684\u77E9\u9635\u662F\u884C\u4E3B\u5E8F\u7684\uFF0C\u4F46 elements \u8F93\u51FA\u7684\u77E9\u9635\u662F\u5217\u4E3B\u5E8F\u7684\u3002</p><ol start="2"><li>\u4F4D\u79FB\u52A0\u4F4D\u79FB</li></ol><p>\u4F8B\u5B50\uFF1A\u8BA9\u4E00\u4E2A\u7269\u4F53\u6CBF x \u8F74\u4F4D\u79FB ax\uFF0C\u6CBF y \u8F74\u4F4D\u79FB ay \u540E\uFF0C\u518D\u6CBF x \u8F74\u4F4D\u79FB bx\uFF0C\u6CBF y \u8F74\u4F4D\u79FB by\u3002</p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u521D\u59CB\u70B9\u4F4D A(ax,ay,az,1.0)</li><li>\u521D\u6B21\u4F4D\u79FB\uFF1A\u6CBF x \u8F74\u4F4D\u79FB bx\uFF0C\u6CBF y \u8F74\u4F4D\u79FB by</li><li>\u7B2C\u4E8C\u6B21\u4F4D\u79FB\uFF1A\u6CBF x \u8F74\u4F4D\u79FB cx\uFF0C\u6CBF y \u8F74\u4F4D\u79FB cy</li></ul><p>\u6C42\uFF1A\u53D8\u6362\u540E\u7684\u4F4D\u7F6E F(fx,fy,fz,fw)</p><p>\u89E3\uFF1A</p><p>1.\u8BBE\u521D\u6B21\u53D8\u6362\u77E9\u9635\u4E3A bm(\u884C\u4E3B\u5E8F)\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>bm
<span class="token punctuation">[</span>
	<span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>bx<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>by<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5219\u521D\u6B21\u53D8\u6362\u540E\u7684\u70B9 F \u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">F</span> <span class="token operator">=</span> bm <span class="token operator">*</span> <span class="token constant">A</span><span class="token punctuation">;</span>
fx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> ax <span class="token operator">+</span> bx<span class="token punctuation">;</span>
fy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> by<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> ay <span class="token operator">+</span> by<span class="token punctuation">;</span>
fz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> az<span class="token punctuation">;</span>
fw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2.\u8BBE\u7B2C\u4E8C\u6B21\u53D8\u6362\u77E9\u9635\u4E3A cm(\u884C\u4E3B\u5E8F)\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cm
<span class="token punctuation">[</span>
	<span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>cx<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>cy<span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>
	<span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5219\u7B2C\u4E8C\u6B21\u53D8\u6362\u540E\u7684\u70B9 F \u4E3A\u7B2C\u4E8C\u6B21\u53D8\u6362\u77E9\u9635\u4E58\u4EE5\u4E0A\u4E00\u6B21\u53D8\u6362\u540E\u7684\u70B9 F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">F</span> <span class="token operator">=</span> cm <span class="token operator">*</span> <span class="token constant">F</span><span class="token punctuation">;</span>
fx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> cx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> fx <span class="token operator">+</span> cx<span class="token punctuation">;</span>
fy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> cy<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> fy <span class="token operator">+</span> cy<span class="token punctuation">;</span>
fz <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> fz<span class="token punctuation">;</span>
fw <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> fz<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6240\u4EE5\u7406\u89E3\u6700\u7EC8\u7684\u70B9 F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fx <span class="token operator">=</span> ax <span class="token operator">+</span> bx <span class="token operator">+</span> cx<span class="token punctuation">;</span>
fy <span class="token operator">=</span> ay <span class="token operator">+</span> by <span class="token operator">+</span> cy<span class="token punctuation">;</span>
fz <span class="token operator">=</span> az<span class="token punctuation">;</span>
fw <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u4E0A\u9762\u7684\u70B9 F \u8FD8\u53EF\u4EE5\u8FD9\u4E48\u7406\u89E3\uFF1A\uFF08\u77E9\u9635\u4E58\u4EE5\u77E9\u9635\uFF09</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">F</span> <span class="token operator">=</span> cm <span class="token operator">*</span> bm <span class="token operator">*</span> <span class="token constant">A</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8BBE cm*bm \u7684\u7ED3\u679C\u4E3A\u77E9\u9635 dm(\u884C\u4E3B\u5E8F)\uFF0C\u53C2\u7167 dm \u4E2D\u5143\u7D20\u7684\u7D22\u5F15\u4F4D\u7F6E\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cm
<span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
	<span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span>
	<span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5219 dm \u4E2D\u7684\u7B2C\u4E00\u884C\u5143\u7D20\u4E3A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>dm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
dm<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
dm<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
dm<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> cx <span class="token operator">+</span> bx<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u901A\u8FC7 dm \u77E9\u9635\u7684\u7B2C\u4E00\u884C\u5143\u7D20\u6211\u4EEC\u5C31\u53EF\u4EE5\u5F97\u5230\u70B9 F \u7684 fx \u503C\u4E86\uFF0C\u9A8C\u8BC1\u4E00\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> cx <span class="token operator">+</span> bx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">=</span> ax <span class="token operator">+</span> cx <span class="token operator">+</span> bx<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u548C\u4E4B\u524D\u4E24\u6B21\u77E9\u9635\u4E58\u4EE5\u5411\u91CF\u5F97\u5230\u7684\u7ED3\u679C\u662F\u4E00\u6837\u7684\u3002</p><p><code>\u5148\u4F4D\u79FBbm\u518D\u4F4D\u79FBcm\uFF1A</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>bx<span class="token punctuation">,</span> by<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>cx<span class="token punctuation">,</span> cy<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> bm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bx<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> by<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> cm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cx<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cy<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> matrix <span class="token operator">=</span> cm<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>bm<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ol start="3"><li>\u5148\u79FB\u52A8\u540E\u65CB\u8F6C</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mt<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> mr<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>mr.multiply(mt) \u4FBF\u662F\u5148\u4F4D\u79FB\u518D\u65CB\u8F6C\uFF1A<br><img src="`+Tn+`" alt=""></p><ol start="4"><li>\u5148\u65CB\u8F6C\u540E\u79FB\u52A8</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mt<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> mt<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>mt.multiply(mr)\u4FBF\u662F\u5148\u65CB\u8F6C\u518D\u4F4D\u79FB\uFF1A<br><img src="`+An+`" alt=""></p><ol start="5"><li>\u5176\u5B83\u53D8\u6362\u65B9\u5F0F</li></ol><p>1)\u65CB\u8F6C\u548C\u7F29\u653E</p><ul><li>\u5148\u65CB\u8F6C\u540E\u7F29\u653E</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>\u5148\u7F29\u653E\u540E\u65CB\u8F6C</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matrix <span class="token operator">=</span> mr<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5728\u6B64\u8981\u6CE8\u610F\u4E00\u4E2A\u6027\u8D28\uFF1A\u5F53\u7F29\u653E\u56E0\u5B50\u4E00\u81F4\u65F6\uFF0C\u65CB\u8F6C\u548C\u7F29\u653E\u6CA1\u6709\u5148\u540E\u4E4B\u5206\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6B64\u662F\u4E0B\u9762\u7684\u4E24\u79CD\u53D8\u6362\u7ED3\u679C\u90FD\u662F\u4E00\u6837\u7684:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matrix <span class="token operator">=</span> ms<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> matrix <span class="token operator">=</span> mr<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2)\u7EFC\u5408\u53D8\u6362</p><p>Matrix4 \u8FD8\u6709\u4E00\u4E2A compose \u7EFC\u5408\u53D8\u6362\u65B9\u6CD5\uFF0C\u5B83\u53EF\u4EE5\u5C06\u6240\u6709\u53D8\u6362\u4FE1\u606F\u90FD\u5199\u8FDB\u53BB\uFF0C\u5176\u53D8\u6362\u987A\u5E8F\u5C31\u662F <code>\u5148\u7F29\u653E\uFF0C\u518D\u65CB\u8F6C\uFF0C\u6700\u540E\u4F4D\u79FB</code>\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u4F4D\u79FB</span>
<span class="token keyword">const</span> pos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u65CB\u8F6C</span>
<span class="token keyword">const</span> rot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rot<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u7F29\u653E</span>
<span class="token keyword">const</span> scale <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
matrix<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> rot<span class="token punctuation">,</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>compose ( position : Vector3, quaternion : Quaternion, scale : Vector3 )</p><ul><li>position \u4F4D\u7F6E</li><li>quaternion \u7528\u56DB\u5143\u6570\u5B58\u50A8\u7684\u65CB\u8F6C\u6570\u636E</li><li>scale \u7F29\u653E</li></ul><p>compose() \u65B9\u6CD5\u5206\u89E3\u5F00\u6765\uFF0C\u5C31\u662F\u8FD9\u6837\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mt<span class="token punctuation">.</span><span class="token function">makeTranslation</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mr<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> matrix <span class="token operator">=</span> mt<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_Matrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Matrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_Matrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_3-\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> 3.\u89C6\u56FE\u77E9\u9635</h3><p>\u89C6\u56FE\u77E9\u9635\u662F\u7528\u4E8E\u786E\u5B9A\u76F8\u673A\u89D2\u5EA6\u548C\u4F4D\u7F6E\u7684\u77E9\u9635\u3002<br> \u80FD\u4E0D\u80FD\u5728\u6CA1\u6709\u89C6\u56FE\u77E9\u9635\u7684\u60C5\u51B5\u4E0B\uFF0C\u770B\u89C1\u7269\u4F53\u7684\u53E6\u4E00\u4E2A\u89D2\u5EA6\u5462\uFF1F<br> \u7B54\u6848\u80AF\u5B9A\u662F\u53EF\u4EE5\uFF0C\u6211\u4EEC\u81EA\u5DF1\u7528\u6A21\u578B\u77E9\u9635\u628A\u7269\u4F53\u8F6C\u4E00\u4E0B\u5C31\u53EF\u4EE5\u4E86\u3002<br> \u56E0\u6B64\uFF0C\u89C6\u56FE\u77E9\u9635\u7684\u672C\u8D28\u662F\u5BF9\u7269\u4F53\u7684\u65CB\u8F6C\u53D8\u6362\u3002<br> \u800C\u7269\u4F53\u53D8\u6362\u7684\u672C\u8D28\u5219\u662F\u5BF9\u7269\u4F53\u9876\u70B9\u7684\u4F4D\u79FB\u3002</p><h4 id="_1-\u76F8\u673A\u7684\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#_1-\u76F8\u673A\u7684\u5B9A\u4E49" aria-hidden="true">#</a> 1.\u76F8\u673A\u7684\u5B9A\u4E49</h4><p><img src="`+Bn+'" alt=""></p><ul><li>\u89C6\u70B9\uFF1A\u76F8\u673A\u7684\u4F4D\u7F6E</li><li>\u89C6\u7EBF\u65B9\u5411\uFF1A\u76F8\u673A\u6240\u770B\u7684\u65B9\u5411</li><li>\u4E0A\u65B9\u5411\uFF1A\u76F8\u673A\u7ED5\u89C6\u7EBF\u8F6C\u52A8\u7684\u65B9\u5411</li></ul><h4 id="_2-\u76F8\u5BF9\u8FD0\u52A8" tabindex="-1"><a class="header-anchor" href="#_2-\u76F8\u5BF9\u8FD0\u52A8" aria-hidden="true">#</a> 2.\u76F8\u5BF9\u8FD0\u52A8</h4><p>\u5F53\u76F8\u673A\u4E0E\u5B83\u6240\u62CD\u6444\u7684\u7269\u4F53\u540C\u65F6\u8FD0\u52A8\u7684\u65F6\u5019\uFF0C\u76F8\u673A\u6240\u62CD\u6444\u7684\u753B\u9762\u4E0D\u4F1A\u6709\u4EFB\u4F55\u6539\u53D8</p><p><img src="'+Fn+'" alt=""></p><p>\u56E0\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u9ED8\u8BA4\u76F8\u673A\u7684\u89C6\u70B9\u5C31\u5728\u96F6\u70B9\uFF0C\u76F8\u673A\u770B\u5411-z \u65B9\u5411\uFF0C\u5176\u4E0A\u65B9\u5411\u5C31\u662F y \u8F74\u3002<br> \u5F53\u6211\u6211\u4EEC\u6539\u53D8\u7684\u76F8\u673A\u7684\u89C6\u70B9\u3001\u89C6\u7EBF\u548C\u4E0A\u65B9\u5411\u7684\u65F6\u5019\uFF0C\u53EA\u8981\u76F8\u5BF9\u7684\u53BB\u6539\u53D8\u573A\u666F\u4E2D\u7684\u7269\u4F53\u5373\u53EF\u3002<br> \u800C\u8FD9\u4E2A\u76F8\u5BF9\u7684\u53BB\u6539\u53D8\u573A\u666F\u4E2D\u7684\u7269\u4F53\u7684\u77E9\u9635\uFF0C\u5C31\u662F\u89C6\u56FE\u77E9\u9635\u3002</p><p><img src="'+Cn+'" alt=""></p><p>\u901A\u8FC7\u4E0A\u9762\u539F\u7406\u53EF\u4EE5\u77E5\u9053\uFF0C\u60F3\u8981\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635\uFF0C\u8BA9\u5176\u6EE1\u8DB3\u4EE5\u4E0B\u6761\u4EF6\u5373\u53EF\uFF1A</p><ol><li>\u628A\u89C6\u70B9 e(ex,ey,ez)\u5BF9\u9F50\u5230 O \u70B9\u4E0A</li><li>\u628A\u89C6\u7EBF c(cx,cy,cz) \u65CB\u8F6C\u5230-z \u8F74\u4E0A</li><li>\u628A\u4E0A\u65B9\u5411 b(bx,by,bz) \u65CB\u8F6C\u5230 y \u8F74\u4E0A</li><li>\u628A c \u4E0E b \u7684\u5782\u7EBF a(ax,ay,az) \u65CB\u8F6C\u5230 x \u8F74\u4E0A</li></ol><h4 id="_3-\u6B63\u4EA4\u77E9\u9635\u7684\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_3-\u6B63\u4EA4\u77E9\u9635\u7684\u65CB\u8F6C" aria-hidden="true">#</a> 3.\u6B63\u4EA4\u77E9\u9635\u7684\u65CB\u8F6C</h4><p>\u4E3A\u4E86\u7406\u89E3\u89C6\u56FE\u77E9\u9635\u7684\u8FD0\u7B97\uFF0C\u4ECE\u51E0\u4E2A\u4F8B\u9898\u8BF4\u8D77\u3002</p><p>\u9898 1<br> \u5DF2\u77E5\uFF1A\u70B9 A(1,0,0)<br> \u6C42\uFF1A\u628A\u70B9 A \u7ED5 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 30\xB0\uFF0C\u65CB\u8F6C\u5230 B \u70B9\u7684\u884C\u4E3B\u5E8F\u77E9\u9635 m1<br><img src="'+In+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m1<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token constant">B</span><span class="token operator">=</span>m1<span class="token operator">*</span><span class="token constant">A</span>
<span class="token constant">B</span><span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token punctuation">(</span>cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">\xB7</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>cos30\xB0
<span class="token constant">B</span><span class="token punctuation">.</span>y<span class="token operator">=</span><span class="token punctuation">(</span>sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">\xB7</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span>sin30\xB0
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u9898 2<br> \u7EE7\u9898 1 \u7684\u5DF2\u77E5\u6761\u4EF6<br> \u6C42\uFF1A\u628A\u70B9 B \u7ED5 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C-30\xB0\uFF0C\u65CB\u8F6C\u5230 A \u70B9\u7684\u5217\u884C\u5E8F\u77E9\u9635 m2</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m2<span class="token operator">=</span><span class="token punctuation">[</span>
	cos<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span>cos<span class="token operator">-</span><span class="token number">30</span>\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
m2<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span> sin30\xB0<span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u89C2\u5BDF\u9898 1\u3001\u9898 2\uFF0C\u6211\u4EEC\u53EF\u4EE5\u53D1\u73B0\u4E24\u4E2A\u89C4\u5F8B\uFF1A</p><ul><li>m2 \u662F m1 \u7684\u9006\u77E9\u9635</li><li>m2 \u4E5F\u662F m1 \u7684\u8F6C\u7F6E\u77E9\u9635</li></ul><p>\u7531\u6B64\u6211\u4EEC\u53EF\u4EE5\u5F97\u5230\u4E00\u4E2A\u7ED3\u8BBA\uFF1A<strong>\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u5C31\u662F\u5176\u8F6C\u7F6E\u77E9\u9635</strong>\u3002</p><p>\u9898 3<br> \u5DF2\u77E5\uFF1A</p><ul><li><p>\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u7CFB m1\uFF0C\u5176\u57FA\u5411\u91CF\u662F\uFF1A</p><ul><li>x(1,0,0)</li><li>y(0,1,0)</li><li>z(0,0,1)</li></ul></li><li><p>\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u7CFB m2\uFF0C\u5176\u57FA\u5411\u91CF\u662F\uFF1A</p><ul><li>x(cos30\xB0, sin30\xB0,0)</li><li>y(-sin30\xB0,cos30\xB0,0)</li><li>z(0, 0, 1)</li></ul></li></ul><p>\u6C42\uFF1A\u5C06 m1 \u4E2D\u7684\u57FA\u5411\u91CF\u5BF9\u9F50\u5230 m2 \u7684\u884C\u4E3B\u5E8F\u77E9\u9635 m3<br><img src="`+r+`" alt=""></p><p>\u89E3\uFF1A</p><p>\u5C06 m2 \u7684\u57FA\u5411\u91CF x,y,z \u4E2D\u7684 x \u5206\u91CF\u5199\u5165 m3 \u7B2C 1 \u884C;<br> \u5C06 m2 \u7684\u57FA\u5411\u91CF x,y,z \u4E2D\u7684 y \u5206\u91CF\u5199\u5165 m3 \u7B2C 2 \u884C;<br> \u5C06 m2 \u7684\u57FA\u5411\u91CF x,y,z \u4E2D\u7684 z \u5206\u91CF\u5199\u5165 m3 \u7B2C 3 \u884C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m3<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u9898 4<br> \u7EE7\u9898 3 \u7684\u5DF2\u77E5\u6761\u4EF6<br> \u6C42\uFF1A\u5C06 m2 \u4E2D\u7684\u57FA\u5411\u91CF\u5BF9\u9F50\u5230 m1 \u7684\u884C\u4E3B\u5E8F\u77E9\u9635 m4</p><p>\u89E3\uFF1A<br> \u7531\u9898 3 \u5DF2\u77E5\uFF1A\u5C06 m1 \u4E2D\u7684\u57FA\u5411\u91CF\u5BF9\u9F50\u5230 m2 \u7684\u884C\u4E3B\u5E8F\u77E9\u9635\u662F m3<br> \u7531\u9898 4 \u7684\u95EE\u9898\u53EF\u77E5\uFF1Am4 \u5C31\u662F m3 \u7684\u9006\u77E9\u9635<br> \u56E0\u4E3A\uFF1A\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u5C31\u662F\u5176\u8F6C\u7F6E\u77E9\u9635<br> \u6240\u4EE5\uFF1Am4 \u5C31\u662F m3 \u7684\u8F6C\u7F6E\u77E9\u9635</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m3<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span><span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
m4<span class="token operator">=</span><span class="token punctuation">[</span>
	cos30\xB0<span class="token punctuation">,</span>sin30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token operator">-</span>sin30\xB0<span class="token punctuation">,</span>cos30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_4-\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> 4.\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635</h4><p><img src="`+r+`" alt=""></p><ol><li>\u5148\u4F4D\u79FB\uFF1A\u5199\u51FA\u628A\u89C6\u70B9 e(ex,ey,ez) \u5BF9\u9F50\u5230 O \u70B9\u4E0A\u7684\u884C\u4E3B\u5E8F\u4F4D\u79FB\u77E9\u9635 mt</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mt
mt=<span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>-ex<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>-ey<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>-ez<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>\u5199\u51FA\u628A{o;x,y,-z} \u5BF9\u9F50\u5230{e;a,b,c} \u7684\u884C\u4E3B\u5E8F\u65CB\u8F6C\u77E9\u9635 mr1</li></ol><p>\u628A a,b,-c \u7684 x \u5206\u91CF\u5199\u5165 mr1 \u7684\u7B2C 1 \u884C\uFF1B<br> \u200B \u628A a,b,-c \u7684 y \u5206\u91CF\u5199\u5165 mr1 \u7684\u7B2C 2 \u884C\uFF1B<br> \u200B \u628A a,b,-c \u7684 z \u5206\u91CF\u5199\u5165 mr1 \u7684\u7B2C 3 \u884C\uFF1B</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mr1
mr1=<span class="token punctuation">[</span>
	 ax<span class="token punctuation">,</span> bx<span class="token punctuation">,</span> -cx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 ay<span class="token punctuation">,</span> by<span class="token punctuation">,</span> -cy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 az<span class="token punctuation">,</span> bz<span class="token punctuation">,</span> -cz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>\u8BA1\u7B97 mr1 \u7684\u9006\u77E9\u9635 mr2\u3002</li></ol><p>\u56E0\u4E3A\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u5C31\u662F\u5176\u8F6C\u7F6E\u77E9\u9635\uFF0C\u6240\u4EE5 mr2 \u5C31\u662F mr1 \u7684\u8F6C\u7F6E\u77E9\u9635\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mr2
mr2=<span class="token punctuation">[</span>
	 ax<span class="token punctuation">,</span> ay<span class="token punctuation">,</span> az<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 bx<span class="token punctuation">,</span> by<span class="token punctuation">,</span> bz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	-cx<span class="token punctuation">,</span>-cy<span class="token punctuation">,</span>-cz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	 <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>\u89C6\u56FE\u6295\u5F71\u77E9\u9635=mr2*mt</li></ol><h4 id="_5-\u89C6\u56FE\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-\u89C6\u56FE\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 5.\u89C6\u56FE\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0</h4><p><img src="`+Ln+`" alt=""></p><p>\u57FA\u4E8E\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u751F\u6210\u89C6\u56FE\u77E9\u9635\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>getViewMatrix \u76F8\u5F53\u4E8E threeJS \u7684 lookAt \u65B9\u6CD5
function getViewMatrix(e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> u) <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u5411\u91CFc\uFF0C\u89C6\u7EBF</span>
  const c = new Vector3().subVectors(e<span class="token punctuation">,</span> t).normalize()
  <span class="token comment">//\u57FA\u5411\u91CFa\uFF0C\u89C6\u7EBF\u548C\u4E0A\u65B9\u5411\u7684\u5782\u7EBF</span>
  const a = new Vector3().crossVectors(u<span class="token punctuation">,</span> c).normalize()
  <span class="token comment">//\u57FA\u5411\u91CFb\uFF0C\u4FEE\u6B63\u4E0A\u65B9\u5411</span>
  const b = new Vector3().crossVectors(c<span class="token punctuation">,</span> a).normalize()
  <span class="token comment">//\u6B63\u4EA4\u65CB\u8F6C\u77E9\u9635</span>
  const mr = new Matrix4().set(
    ...a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    ...b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    -c.x<span class="token punctuation">,</span> -c.y<span class="token punctuation">,</span> -c.z<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
  )
  <span class="token comment">//\u4F4D\u79FB\u77E9\u9635</span>
  const mt = new Matrix4().set(
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> -e.x<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> -e.y<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> -e.z<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
  )
  return mr.multiply(mt).elements
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>getViewMatrix \u65B9\u6CD5\u5C31\u662F\u4ECE\u4E00\u4E2A\u65B0\u7684\u89D2\u5EA6\u53BB\u770B\u67D0\u4E00\u4E2A\u4E1C\u897F\u7684\u610F\u601D</p><ul><li>e \u89C6\u70B9</li><li>t \u76EE\u6807\u70B9</li><li>u \u4E0A\u65B9\u5411</li></ul><p>\u5728\u5176\u4E2D\u6211\u501F\u52A9\u4E86 Three.js \u7684 Vector3 \u5BF9\u8C61</p><ul><li>subVectors(e, t) \u5411\u91CF e \u51CF\u5411\u91CF t</li><li>normalize() \u5411\u91CF\u7684\u5F52\u4E00\u5316</li><li>crossVectors(u, d) \u5411\u91CF u \u548C\u5411\u91CF d \u7684\u53C9\u4E58</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">crossVectors</span><span class="token punctuation">(</span> <span class="token parameter">a<span class="token punctuation">,</span> b</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ax <span class="token operator">=</span> a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> ay <span class="token operator">=</span> a<span class="token punctuation">.</span>y<span class="token punctuation">,</span> az <span class="token operator">=</span> a<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
  <span class="token keyword">const</span> bx <span class="token operator">=</span> b<span class="token punctuation">.</span>x<span class="token punctuation">,</span> by <span class="token operator">=</span> b<span class="token punctuation">.</span>y<span class="token punctuation">,</span> bz <span class="token operator">=</span> b<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> ay <span class="token operator">*</span> bz <span class="token operator">-</span> az <span class="token operator">*</span> by<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> az <span class="token operator">*</span> bx <span class="token operator">-</span> ax <span class="token operator">*</span> bz<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token operator">=</span> ax <span class="token operator">*</span> by <span class="token operator">-</span> ay <span class="token operator">*</span> bx<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u57FA\u5411\u91CF a,b,c \u7684\u8FD0\u7B97\u539F\u7406\uFF0C\u4EE5\u4E0B\u56FE\u4E3A\u4F8B\uFF1A</p><p><img src="`+On+`" alt=""></p><p>\u89C6\u7EBF c \u4E4B\u6240\u4EE5\u662F\u89C6\u70B9 e \u51CF\u76EE\u6807\u70B9 t\uFF0C\u662F\u4E3A\u4E86\u53D6\u4E00\u4E2A\u6B63\u5411\u7684\u57FA\u5411\u91CF\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>c<span class="token operator">=</span><span class="token punctuation">(</span>e<span class="token operator">-</span>t<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">|</span>e<span class="token operator">-</span>t<span class="token operator">|</span>
c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u57FA\u5411\u91CF a \u662F\u4E0A\u65B9\u5411 u \u548C\u5411\u91CF c \u7684\u53C9\u4E58</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a<span class="token operator">=</span>u<span class="token operator">^</span>c<span class="token operator">/</span><span class="token operator">|</span>u<span class="token operator">^</span>c<span class="token operator">|</span>
a<span class="token operator">=</span><span class="token punctuation">(</span>cos30\xB0<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>cos30\xB0
a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u57FA\u5411\u91CF b \u662F\u5411\u91CF c \u548C\u5411\u91CF a \u7684\u53C9\u4E58\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3A\u628A\u4E0A\u65B9\u5411\u6446\u6B63</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>b<span class="token operator">=</span>c<span class="token operator">^</span>a<span class="token operator">/</span><span class="token operator">|</span>c<span class="token operator">^</span>a<span class="token operator">|</span>
b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1</span>
b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_6-\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_6-\u6D4B\u8BD5" aria-hidden="true">#</a> 6.\u6D4B\u8BD5</h4><ol><li>\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u89C6\u56FE\u77E9\u9635</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u89C6\u56FE\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token function">getViewMatrix</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u6CE8\uFF1A</p><p>three.js \u91CC\u7684 lookAt() \u65B9\u6CD5\u4FBF\u53EF\u4EE5\u5B9E\u73B0\u77E9\u9635\u7684\u6B63\u4EA4\u65CB\u8F6C\uFF0C\u5176\u53C2\u6570\u4E5F\u662F\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\uFF0C\u5B83\u7684\u5B9E\u73B0\u539F\u7406\u4E0A\u9762\u8BF4\u7684\u662F\u4E00\u6837\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-\u6A21\u578B\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-\u6A21\u578B\u77E9\u9635" aria-hidden="true">#</a> 4.\u6A21\u578B\u77E9\u9635</h3><p>\u4E00\u4E2A\u6A21\u578B\u53EF\u80FD\u7ECF\u8FC7\u4E86\u591A\u6B21\u53D8\u6362\uFF0C\u5C06\u8FD9\u4E9B\u53D8\u6362\u590D\u5408\u6210\u4E00\u4E2A\u7B49\u6548\u7684\u53D8\u6362\uFF0C\u5C31\u5F97\u5230\u4E86<strong>\u6A21\u578B\u53D8\u6362</strong>\uFF0C\u76F8\u5E94\u7684\u6A21\u578B\u53D8\u6362\u7684\u77E9\u9635\u79F0\u4E3A<strong>\u6A21\u578B\u77E9\u9635</strong>\uFF08\u53EF\u4EE5\u5BF9\u7269\u4F53\u8FDB\u884C\u4F4D\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u53D8\u6362\uFF09\u3002</p><p>\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><ol><li>\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u6DFB\u52A0\u4E00\u4E2A\u6A21\u578B\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token comment">//\u6A21\u578B\u77E9\u9635</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    <span class="token comment">//\u89C6\u56FE\u77E9\u9635</span>
    uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ViewMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>\u5728 js \u4E2D\u5EFA\u7ACB\u6A21\u578B\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ModelMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_ViewMatrix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="3"><li>\u6DFB\u52A0\u4E00\u4E2A\u65CB\u8F6C\u52A8\u753B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  angle <span class="token operator">+=</span> <span class="token number">0.02</span><span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>\u8FD8\u53EF\u4EE5\u6765\u4E2A\u5F39\u6027\u52A8\u753B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> minY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> maxY <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> y <span class="token operator">=</span> maxY<span class="token punctuation">;</span>
<span class="token keyword">let</span> vy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ay <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.001</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bounce <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  angle <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>
  vy <span class="token operator">+=</span> ay<span class="token punctuation">;</span>
  y <span class="token operator">+=</span> vy<span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> minY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    y <span class="token operator">=</span> minY<span class="token punctuation">;</span>
    vy <span class="token operator">*=</span> <span class="token operator">-</span>bounce<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="\u4E03\u3001\u989C\u8272\u4E0E\u7EB9\u7406" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001\u989C\u8272\u4E0E\u7EB9\u7406" aria-hidden="true">#</a> \u4E03\u3001\u989C\u8272\u4E0E\u7EB9\u7406</h2><h3 id="_1-\u591A-attribute-\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_1-\u591A-attribute-\u53D8\u91CF" aria-hidden="true">#</a> 1.\u591A attribute \u53D8\u91CF</h3><p>\u5982\u4F55\u4E00\u6B21\u6027\u7ED8\u5236\u4E09\u4E2A\u4E0D\u540C\u989C\u8272\u7684\u70B9\uFF1F</p><ol><li>\u591A\u70B9\u540C\u8272</li></ol><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">50.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_FragColor<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> u_FragColor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u9876\u70B9\u6570\u636E</span>
  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> u_FragColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_FragColor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>u_FragColor<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Dn+`" alt=""></p><p>\u6CE8\u610F\uFF1A<br> \u8FD9\u79CD\u65B9\u5F0F\u53EA\u4F1A\u7ED8\u5236\u4E09\u4E2A\u540C\u6837\u989C\u8272\u7684\u70B9\u3002<br> \u82E5\u60F3\u7ED9\u8FD9\u4E09\u4E2A\u70B9\u4E0D\u540C\u7684\u989C\u8272\uFF0C\u5C31\u9700\u8981\u518D\u5EFA\u7ACB\u4E00\u4E2A\u63A5\u6536\u989C\u8272\u6570\u636E\u7684 attribute \u53D8\u91CF\u3002</p></details><ol start="2"><li>\u591A\u70B9\u5F02\u8272</li></ol><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec4 a_Color<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">50.0</span><span class="token punctuation">;</span>
      v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u9876\u70B9\u6570\u636E</span>
  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>

  <span class="token comment">// \u989C\u8272\u6570\u636E</span>
  <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colors<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Color&#39;</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span>

  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><div class="highlight-line">\xA0</div><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+i+`" alt=""></p><p>\u6CE8\u610F\uFF1A</p><ol><li>\u8FD9\u91CC\u4F7F\u7528<strong>varying\u53D8\u91CF</strong>\u5411\u7247\u5143\u7740\u8272\u5668\u4F20\u5165\u6570\u636E\uFF0C\u5B9E\u9645\u4E0A\uFF0Cvarying\u53D8\u91CF\u7684\u4F5C\u7528\u662F\u4ECE\u9876\u70B9\u7740\u8272\u5668\u5411\u7247\u5143\u7740\u8272\u5668\u4F20\u8F93\u6570\u636E</li><li>\u5EFA\u7ACB\u4E86\u4E24\u4EFD attribute \u6570\u636E\uFF0C\u4E00\u4EFD\u662F\u9876\u70B9\u4F4D\u7F6E\u6570\u636E\uFF0C\u4E00\u4EFD\u662F\u9876\u70B9\u989C\u8272\u6570\u636E</li></ol></details><ol start="3"><li>\u591A attribute \u6570\u636E\u5408\u4E00</li></ol><p>\u6570\u636E\u5408\u4E00\uFF0C\u70B9\u4F4D\u6570\u636E\u548C\u989C\u8272\u6570\u636E\u653E\u4E00\u4E2A\u96C6\u5408\u91CC\uFF0C\u8BA9 attribute \u53D8\u91CF\u6309\u7167\u67D0\u79CD\u89C4\u5F8B\u4ECE\u5176\u4E2D\u5BFB\u627E\u6570\u636E</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec4 a_Color<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">50.0</span><span class="token punctuation">;</span>
      v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6570\u636E\u6E90</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> elementBytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> verticeSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorSize <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> categorySize <span class="token operator">=</span> verticeSize <span class="token operator">+</span> colorSize<span class="token punctuation">;</span>
  <span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes<span class="token punctuation">;</span>
  <span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
  <span class="token keyword">const</span> verticeByteIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorByteIndex <span class="token operator">=</span> verticeSize <span class="token operator">*</span> elementBytes<span class="token punctuation">;</span>
  <span class="token comment">//\u9876\u70B9\u603B\u6570</span>
  <span class="token keyword">const</span> sourceSize <span class="token operator">=</span> source<span class="token punctuation">.</span>length <span class="token operator">/</span> categorySize<span class="token punctuation">;</span>

  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sourceBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Position<span class="token punctuation">,</span>
    verticeSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    verticeByteIndex
  <span class="token punctuation">)</span>
  <span class="token comment">//\u8D4B\u80FD</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>

  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Color&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Color<span class="token punctuation">,</span>
    colorSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    colorByteIndex
  <span class="token punctuation">)</span>
  <span class="token comment">//\u8D4B\u80FD</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span>

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+i+'" alt=""></p><p>\u5BF9\u5E94\u4E0A\u9762\u7684\u6570\u636E\uFF0C\u5148\u6709\u4EE5\u4E0B\u6982\u5FF5\uFF1A</p><ul><li>\u6570\u636E\u6E90\uFF1A\u6574\u4E2A\u5408\u800C\u4E3A\u4E00\u7684\u6570\u636E source</li><li>\u5143\u7D20\u5B57\u8282\u6570\uFF1A32 \u4F4D\u6D6E\u70B9\u96C6\u5408\u4E2D\u6BCF\u4E2A\u5143\u7D20\u7684\u5B57\u8282\u6570</li><li>\u7C7B\u76EE\uFF1A\u4E00\u4E2A\u9876\u70B9\u5BF9\u5E94\u4E00\u4E2A\u7C7B\u76EE\uFF0C\u4E5F\u5C31\u662F\u4E0A\u9762 source \u4E2D\u7684\u6BCF\u4E00\u884C</li><li>\u7CFB\u5217\uFF1A\u4E00\u4E2A\u7C7B\u76EE\u4E2D\u6240\u5305\u542B\u7684\u6BCF\u4E00\u79CD\u6570\u636E\uFF0C\u6BD4\u5982\u9876\u70B9\u4F4D\u7F6E\u6570\u636E\u3001\u9876\u70B9\u989C\u8272\u6570\u636E</li><li>\u7CFB\u5217\u5C3A\u5BF8\uFF1A\u4E00\u4E2A\u7CFB\u5217\u6240\u5BF9\u5E94\u7684\u5411\u91CF\u7684\u5206\u91CF\u6570\u76EE</li><li>\u7C7B\u76EE\u5C3A\u5BF8\uFF1A\u4E00\u4E2A\u7C7B\u76EE\u4E2D\u6240\u6709\u7CFB\u5217\u5C3A\u5BF8\u7684\u603B\u548C</li><li>\u7C7B\u76EE\u5B57\u8282\u6570\uFF1A\u4E00\u4E2A\u7C7B\u76EE\u7684\u6240\u6709\u5B57\u8282\u6570\u91CF</li><li>\u7CFB\u5217\u5143\u7D20\u7D22\u5F15\u4F4D\u7F6E\uFF1A\u4E00\u4E2A\u7CFB\u5217\u5728\u4E00\u4E2A\u7C7B\u76EE\u4E2D\uFF0C\u4EE5\u96C6\u5408\u5143\u7D20\u4E3A\u5355\u4F4D\u7684\u7D22\u5F15\u4F4D\u7F6E</li><li>\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E\uFF1A\u4E00\u4E2A\u7CFB\u5217\u5728\u4E00\u4E2A\u7C7B\u76EE\u4E2D\uFF0C\u4EE5\u5B57\u8282\u4E3A\u5355\u4F4D\u7684\u7D22\u5F15\u4F4D\u7F6E</li><li>\u9876\u70B9\u603B\u6570\uFF1A\u6570\u636E\u6E90\u4E2D\u7684\u9876\u70B9\u603B\u6570</li></ul><p>gl.vertexAttribPointer() \u65B9\u6CD5\u73A9\u8F6C\u6570\u636E\u6E90\uFF1A</p><ul><li>\u4EE5\u524D\u5728\u8BF4 vertexAttribPointer() \u7684\u65F6\u5019\uFF0C\u8BF4\u8FC7\u5B83\u7684\u529F\u80FD\u5C31\u662F\u8BA9 gl \u4FEE\u6539 attribute \u4E0A\u4E0B\u6587\u5BF9\u8C61\u7684\u3002</li><li>\u5176\u5B9E\u5177\u4F53\u800C\u8A00\uFF0C\u5B83\u662F\u5728\u544A\u8BC9\u9876\u70B9\u7740\u8272\u5668\u4E2D\u7684 attribute \u53D8\u91CF\u4EE5\u600E\u6837\u7684\u65B9\u5F0F\u4ECE\u9876\u70B9\u7740\u8272\u5668\u4E2D\u5BFB\u627E\u5B83\u6240\u9700\u8981\u7684\u6570\u636E\u3002</li><li>\u6BD4\u5982\uFF0C\u6211\u60F3\u8BA9\u9876\u70B9\u7740\u8272\u5668\u4E2D\uFF0C\u540D\u53EB a_Position \u7684 attribute \u7684\u53D8\u91CF\u4ECE\u6570\u636E\u6E90\u4E2D\uFF0C\u5BFB\u627E\u5B83\u6240\u9700\u8981\u7684\u6570\u636E\u3002</li></ul><p>gl.vertexAttribPointer(index, size, type, normalized, stride, offset) \uFF1A</p><ul><li>index\uFF1Aattribute \u53D8\u91CF\uFF0C\u5177\u4F53\u800C\u8A00\u662F\u6307\u5411\u5B58\u50A8 attribute \u53D8\u91CF\u7684\u7A7A\u95F4\u7684\u6307\u9488</li><li>size\uFF1A\u7CFB\u5217\u5C3A\u5BF8</li><li>type\uFF1A\u5143\u7D20\u7684\u6570\u636E\u7C7B\u578B</li><li>normalized\uFF1A\u662F\u5426\u5F52\u4E00\u5316</li><li>stride\uFF1A\u7C7B\u76EE\u5B57\u8282\u6570</li><li>offset\uFF1A\u7CFB\u5217\u7D22\u5F15\u4F4D\u7F6E</li></ul><p><img src="'+zn+'" alt=""><img src="'+Un+`" alt=""></p></details><h3 id="_2-\u5F69\u8272\u4E09\u89D2\u5F62" tabindex="-1"><a class="header-anchor" href="#_2-\u5F69\u8272\u4E09\u89D2\u5F62" aria-hidden="true">#</a> 2.\u5F69\u8272\u4E09\u89D2\u5F62</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec4 a_Color<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      gl_PointSize <span class="token operator">=</span> <span class="token number">50.0</span><span class="token punctuation">;</span>
      v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6570\u636E\u6E90</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> elementBytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span>
  <span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> verticeSize <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token keyword">const</span> colorSize <span class="token operator">=</span> <span class="token number">4</span>
  <span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> categorySize <span class="token operator">=</span> verticeSize <span class="token operator">+</span> colorSize
  <span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes
  <span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
  <span class="token keyword">const</span> verticeByteIndex <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> colorByteIndex <span class="token operator">=</span> verticeSize <span class="token operator">*</span> elementBytes
  <span class="token comment">//\u9876\u70B9\u603B\u6570</span>
  <span class="token keyword">const</span> sourceSize <span class="token operator">=</span> source<span class="token punctuation">.</span>length <span class="token operator">/</span> categorySize

  <span class="token comment">//\u7F13\u51B2\u5BF9\u8C61</span>
  <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED1\u5B9A\u7F13\u51B2\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sourceBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5199\u5165\u6570\u636E</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Position<span class="token punctuation">,</span>
    verticeSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    verticeByteIndex
  <span class="token punctuation">)</span>
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span>

  <span class="token comment">//\u83B7\u53D6attribute \u53D8\u91CF</span>
  <span class="token keyword">const</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Color&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">//\u4FEE\u6539attribute \u53D8\u91CF</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Color<span class="token punctuation">,</span>
    colorSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    colorByteIndex
  <span class="token punctuation">)</span>
  <span class="token comment">//\u8D4B\u80FD-\u6279\u5904\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span>

  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED8\u5236\u9876\u70B9</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Vn+'" alt=""></p><p>\u539F\u7406\uFF1A<br> \u4E09\u89D2\u5F62\u7684\u4E09\u4E2A\u9876\u70B9\u7ED1\u5B9A\u4E86\u4E09\u79CD\u989C\u8272\uFF0C\u5728\u4E09\u4E2A\u70B9\u4E4B\u95F4\u505A\u7EBF\u6027\u8865\u95F4\uFF0C\u5C06\u8865\u95F4\u5F97\u51FA\u7684\u989C\u8272\u586B\u5145\u5230\u4E09\u89D2\u5F62\u6240\u56F4\u6210\u7684\u6BCF\u4E2A\u7247\u5143\u4E4B\u4E2D\u3002<br><img src="'+Nn+'" alt=""></p><p>\u9876\u70B9\u7740\u8272\u5668\u548C\u7247\u5143\u7740\u8272\u5668\u4E4B\u95F4\u7684\u56FE\u5F62\u88C5\u914D\u548C\u5149\u6805\u5316\uFF1A<br><strong>\u56FE\u5F62\u88C5\u914D</strong>\uFF1A\u5C06\u5B64\u7ACB\u7684\u9876\u70B9\u5750\u6807\u88C5\u914D\u6210\u51E0\u4F55\u56FE\u5F62\u3002\u51E0\u4F55\u56FE\u5F62\u7684\u7C7B\u522B\u7531gl.drawArrays()\u51FD\u6570\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570\u51B3\u5B9A\u3002</p><p><strong>\u5149\u6805\u5316</strong>\u8FC7\u7A0B\uFF1A\u5C06\u88C5\u914D\u597D\u7684\u51E0\u4F55\u56FE\u5F62\u8F6C\u5316\u4E3A\u7247\u5143\u3002 <img src="'+Gn+'" alt=""></p><p>\u6CE8\u610F\uFF1A</p><ol><li>gl.Position\u5B9E\u9645\u4E0A\u662F<strong>\u51E0\u4F55\u56FE\u5F62\u88C5\u914D</strong>\u9636\u6BB5\u7684\u8F93\u5165\u6570\u636E</li><li>\u51E0\u4F55\u56FE\u5F62\u88C5\u914D\u8FC7\u7A0B\u53C8\u88AB\u79F0\u4E3A<strong>\u56FE\u5143\u88C5\u914D\u8FC7\u7A0B</strong></li><li>\u88AB\u88C5\u914D\u8FC7\u7684\u56FE\u5F62(\u70B9\u3001\u7EBF\u3001\u9762)\u53C8\u79F0\u4E3A<strong>\u56FE\u5143</strong></li><li>\u663E\u793A\u5728\u5C4F\u5E55\u4E0A\u7684\u4E09\u89D2\u5F62\u662F\u7531\u7247\u5143(\u50CF\u7D20)\u7EC4\u6210\u7684\uFF0C\u6240\u4EE5\u8FD8\u9700\u8981\u5C06\u56FE\u5F62\u8F6C\u5316\u4E3A\u7247\u5143\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u79F0\u4E3A<strong>\u5149\u6805\u5316</strong></li></ol><p><img src="'+Wn+`" alt=""></p></details><h3 id="_3-\u7EB9\u7406" tabindex="-1"><a class="header-anchor" href="#_3-\u7EB9\u7406" aria-hidden="true">#</a> 3.\u7EB9\u7406</h3><p>\u7EB9\u7406\uFF0C\u901A\u5E38\u6307\u7684\u5C31\u662F\u4E8C\u7EF4\u7684\u6805\u683C\u56FE\u50CF\uFF0C\u53EF\u4EE5\u5C06\u5176\u4F5C\u4E3A webgl \u56FE\u5F62\u7684\u8D34\u56FE\u3002<br> \u800C\u5728 webgl \u91CC\uFF0C\u8FD8\u6709\u4E00\u4E2A\u7EB9\u7406\u5BF9\u8C61\u7684\u6982\u5FF5\uFF0C\u5B83\u662F\u5BF9\u56FE\u50CF\u53C8\u505A\u4E86\u4E00\u5C42\u5C01\u88C5\u3002</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6570\u636E\u6E90</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> elementBytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span>
  <span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> posSize <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token keyword">const</span> pinSize <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> categorySize <span class="token operator">=</span> posSize <span class="token operator">+</span> pinSize
  <span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes
  <span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
  <span class="token keyword">const</span> posByteIndex <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> pinByteIndex <span class="token operator">=</span> posSize <span class="token operator">*</span> elementBytes
  <span class="token comment">//\u9876\u70B9\u603B\u6570</span>
  <span class="token keyword">const</span> sourceSize <span class="token operator">=</span> source<span class="token punctuation">.</span>length <span class="token operator">/</span> categorySize

  <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sourceBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Position<span class="token punctuation">,</span>
    posSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    posByteIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> a_Pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Pin<span class="token punctuation">,</span>
    pinSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    pinByteIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* \u56FE\u50CF\u9884\u5904\u7406 */</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u51C6\u5907\u4E09\u4E2A\u89D2\u8272 */</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/erha.jpg&#39;</span>
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
      image
    <span class="token punctuation">)</span>

    gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//\u6E32\u67D3</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><div class="highlight-line">\xA0</div><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+k+'" alt=""></p><p>\u6B65\u9AA4\uFF1A</p><ol><li>\u51C6\u5907\u597D\u6620\u5C04\u5230\u51E0\u4F55\u56FE\u5F62\u4E0A\u7684\u7EB9\u7406\u56FE\u50CF</li><li>\u4E3A\u51E0\u4F55\u56FE\u5F62\u914D\u7F6E\u7EB9\u7406\u6620\u5C04\u65B9\u5F0F</li><li>\u52A0\u8F7D\u7EB9\u7406\u56FE\u50CF\uFF0C\u5BF9\u5176\u8FDB\u884C\u914D\u7F6E\uFF0C\u4EE5\u5728WebGL\u4E2D\u4F7F\u7528\u5B83</li><li>\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5956\u76F8\u5E94\u7684\u7EB9\u7D20\u4ECE\u7EB9\u7406\u4E2D\u62BD\u53D6\u51FA\u6765\uFF0C\u5E76\u5C06\u7EB9\u7D20\u7684\u989C\u8272\u8D4B\u7ED9\u7247\u5143</li></ol></details><h4 id="_1-\u57FA\u7840\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u7840\u6982\u5FF5" aria-hidden="true">#</a> 1.\u57FA\u7840\u6982\u5FF5</h4><ol><li>\u6805\u683C\u7CFB\u7EDF</li></ol><p>\u5728\u8BF4\u56FE\u50CF\u7684\u65F6\u5019\uFF0C\u5F80\u5F80\u90FD\u662F\u6307\u70B9\u9635\u56FE\u3001\u6805\u683C\u56FE\u3001\u4F4D\u56FE\uFF0C\u800C\u4E0E\u5176\u76F8\u5BF9\u5E94\u7684\u662F\u56FE\u5F62\uFF0C\u4E5F\u505A\u77E2\u91CF\u56FE\u3002<br> \u7EB9\u7406\uFF0C\u5C31\u662F\u5C5E\u4E8E\u56FE\u50CF\uFF0C\u5176\u56FE\u50CF\u7684\u5EFA\u7ACB\u548C\u663E\u793A\u4F1A\u9075\u5FAA\u6805\u683C\u7CFB\u7EDF\u91CC\u7684\u89C4\u8303\u3002<br> \u6240\u6709\u56FE\u50CF\u90FD\u662F\u7531\u50CF\u7D20\u7EC4\u6210\u7684\uFF0C\u5728 webgl \u91CC\u6211\u4EEC\u628A\u50CF\u7D20\u79F0\u4E3A\u7247\u5143\uFF0C\u50CF\u7D20\u662F\u6309\u7167\u76F8\u4E92\u5782\u76F4\u7684\u884C\u5217\u6392\u5217\u7684\u3002</p><p>\u5982\u4E0B\u56FE\uFF1A<br><img src="'+Hn+'" alt=""></p><p>\u5C06\u5176\u653E\u5927\u540E\u5C31\u53EF\u4EE5\u770B\u89C1\u5176\u4E2D\u7684\u6805\u683C\uFF1A<br><img src="'+Yn+'" alt=""></p><p>\u56FE\u50CF\u4E2D\u7684\u6BCF\u4E2A\u50CF\u7D20\u90FD\u53EF\u4EE5\u901A\u8FC7\u884C\u6570 y \u548C\u5217\u6570 x \u6765\u627E\u5230\uFF0C\u7531(x, y) \u6784\u6210\u7684\u70B9\u4F4D\uFF0C\u5C31\u662F\u56FE\u50CF\u7684\u50CF\u7D20\u5750\u6807\u3002</p><p>\u56E0\u4E3A canvas \u753B\u5E03\u4E5F\u662F\u4E00\u5F20\u56FE\u50CF\uFF0C\u6240\u4EE5\u56FE\u50CF\u7684\u6805\u683C\u5750\u6807\u7CFB\u548C\u6211\u4EEC\u4E4B\u524D\u8BF4\u8FC7\u7684 canvas2d \u7684\u5750\u6807\u7CFB\u662F\u4E00\u6837\u7684\uFF1A<br><img src="'+c+'" alt=""></p><p>\u6805\u683C\u5750\u6807\u7CFB\u7684\u539F\u70B9\u5728\u5DE6\u4E0A\u89D2\u3002<br> \u6805\u683C\u5750\u6807\u7CFB\u7684 y \u8F74\u65B9\u5411\u662F\u671D\u4E0B\u7684\u3002<br> \u6805\u683C\u5750\u6807\u7CFB\u7684\u5750\u6807\u57FA\u5E95\u7531\u4E24\u4E2A\u5206\u91CF\u7EC4\u6210\uFF0C\u5206\u522B\u662F\u4E00\u4E2A\u50CF\u7D20\u7684\u5BBD\u548C\u4E00\u4E2A\u50CF\u7D20\u7684\u9AD8\u3002</p><ol start="2"><li>\u56FE\u9489\uFF08WebGL\u7EB9\u7406\u5750\u6807\uFF09</li></ol><p>\u56FE\u9489\u662F\u6211\u81EA\u5DF1\u5199\u7684\u6982\u5FF5\uFF0C\u6E90\u81EA\u4E8E photoshop \u4E2D\u56FE\u50CF\u7684\u64CD\u63A7\u53D8\u5F62\u529F\u80FD\uFF0C\u8FD9\u79CD\u79F0\u547C\u5F88\u5F62\u8C61\u3002<br><img src="'+Xn+'" alt=""></p><p>webgl \u4E2D\uFF0C\u56FE\u9489\u7684\u4F4D\u7F6E\u662F\u901A\u8FC7 uv \uFF08st\uFF09\u5750\u6807\u6765\u63A7\u5236\u7684\uFF0C\u56FE\u9489\u7684 uv \u5750\u6807\u548C\u9876\u70B9\u7684 webgl \u5750\u6807\u662F\u4E24\u79CD\u4E0D\u540C\u7684\u5750\u6807\u7CFB\u7EDF\uFF0C\u4E4B\u540E\u4F1A\u5C06\u5176\u76F8\u4E92\u6620\u5C04\uFF0C\u4ECE\u800C\u5C06\u56FE\u50CF\u7279\u5B9A\u7684\u4E00\u5757\u533A\u57DF\u8D34\u5230 webgl \u56FE\u5F62\u4E2D\u3002</p><p>\u4F8B\u5982\uFF1A<br><img src="'+Kn+'" alt=""></p><ol start="3"><li>uv \u5750\u6807\u7CFB</li></ol><p><img src="'+Zn+`" alt=""> uv \u5750\u6807\u7CFB\uFF0C\u4E5F\u53EB st \u5750\u6807\u7CFB\uFF0C\u5750\u6807\u539F\u70B9\u5728\u56FE\u50CF\u7684\u5DE6\u4E0B\u89D2\uFF0Cu \u8F74\u5728\u53F3\uFF0Cv \u8F74\u5728\u4E0A<br> u \u8F74\u4E0A\u7684 1 \u4E2A\u5355\u4F4D\u662F\u56FE\u50CF\u7684\u5BBD\uFF1B<br> v \u8F74\u4E0A\u7684\u4E00\u4E2A\u5355\u4F4D\u662F\u56FE\u50CF\u7684\u9AD8\u3002</p><ol start="4"><li>\u91C7\u6837\u5668</li></ol><p>\u91C7\u6837\u5668\u662F\u6309\u7167\u56FE\u9489\u4F4D\u7F6E\u4ECE\u56FE\u50CF\u4E2D\u83B7\u53D6\u7247\u5143\u7684\u65B9\u5F0F\u3002</p><p>\u5728\u56FE\u50CF\u4E2D\u6240\u6253\u7684\u56FE\u9489\u4F4D\u7F6E\uFF0C\u5E76\u4E0D\u662F\u56FE\u50CF\u4E2D\u67D0\u4E00\u4E2A\u7247\u5143\u7684\u4F4D\u7F6E\uFF0C\u56E0\u4E3A\u7247\u5143\u4F4D\u7F6E\u8D70\u7684\u662F\u6805\u683C\u5750\u6807\u7CFB\u3002</p><p>\u9700\u8981\u4E00\u4E2A\u91C7\u6837\u5668\u53BB\u5BF9\u56FE\u9489\u7684 uv \u5750\u6807\u7CFB\u548C\u50CF\u7D20\u7684\u6805\u683C\u5750\u6807\u7CFB\u505A\u6620\u5C04\uFF0C\u4ECE\u800C\u53BB\u91C7\u96C6\u56FE\u50CF\u4E2D\u56FE\u9489\u6240\u5BF9\u5E94\u7684\u7247\u5143\u3002</p><p>\u7740\u8272\u5668\u57FA\u4E8E\u4E00\u5F20\u56FE\u50CF\u53EF\u4EE5\u5EFA\u7ACB\u4E00\u4E2A\u6216\u591A\u4E2A\u91C7\u6837\u5668\uFF0C\u4E0D\u540C\u7684\u91C7\u6837\u5668\u53EF\u4EE5\u5B9A\u4E49\u4E0D\u540C\u7684\u89C4\u5219\u53BB\u83B7\u53D6\u56FE\u50CF\u4E2D\u7684\u7247\u5143\u3002</p><p>\u91C7\u6837\u5668\u5728\u7740\u8272\u5668\u4E2D\u662F\u4E00\u79CD\u53D8\u91CF\u7C7B\u578B\uFF0C\u5199\u505A sampler2D\uFF0C\u5B83\u5C31\u50CF\u4E4B\u524D\u5199\u8FC7\u7684 vec4 \u7C7B\u578B\u4E00\u6837\uFF0C\u53EF\u4EE5\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u901A\u8FC7 uniform \u53D8\u91CF\u66B4\u9732\u7ED9 js\uFF0C\u8BA9 js \u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u3002</p><ol start="5"><li>\u7EB9\u7406\u5BF9\u8C61</li></ol><p>\u7740\u8272\u5668\u4F7F\u7528\u4E00\u4E2A\u7EB9\u7406\u5BF9\u8C61\uFF0C\u5C31\u53EF\u4EE5\u5EFA\u7ACB\u4E00\u4E2A\u91C7\u6837\u5668\u3002</p><p>\u7EB9\u7406\u5BF9\u8C61\u7684\u5EFA\u7ACB\u9700\u8981\u4E00\u4E2A\u56FE\u50CF\u6E90\uFF0C\u6BD4\u5982 Image \u5BF9\u8C61\u3002</p><p>\u540C\u65F6\uFF0C\u8FD8\u9700\u8981\u8BBE\u7F6E\u7EB9\u7406\u5BF9\u8C61\u548C\u56FE\u9489\u8FDB\u884C\u6570\u636E\u6620\u5C04\u7684\u65B9\u5F0F\u3002</p><p>js =&gt; \u7EB9\u7406\u5BF9\u8C61\uFF0Cwebgl =&gt; \u7F13\u51B2\u533A<br> \u7F13\u5B58\u533A\u7528\u4E8E\u5B58\u653E\u7EB9\u7406\u5BF9\u8C61\u7684\u78C1\u76D8\u7A7A\u95F4\uFF0C\u8FD9\u5757\u7A7A\u95F4\u53EF\u4EE5\u5C06\u7EB9\u7406\u5BF9\u8C61\u7FFB\u8BD1\u6210\u7740\u8272\u5668\u53EF\u4EE5\u8BFB\u61C2\u7684\u6570\u636E\u3002<br> \u4E4B\u540E\u4F1A\u628A\u8FD9\u4E2A\u7A7A\u95F4\u7684\u7D22\u5F15\u4F4D\u7F6E\u4F20\u7ED9\u7740\u8272\u5668\uFF0C\u8BA9\u7740\u8272\u5668\u57FA\u4E8E\u8FD9\u4E2A\u7A7A\u95F4\u7684\u7D22\u5F15\u4F4D\u7F6E\uFF0C\u627E\u5230\u8FD9\u4E2A\u7A7A\u95F4\uFF0C\u7136\u540E\u518D\u4ECE\u7A7A\u95F4\u4E2D\u627E\u5230\u7EB9\u7406\u5BF9\u8C61\uFF0C\u6700\u540E\u901A\u8FC7\u7EB9\u7406\u5BF9\u8C61\u5EFA\u7ACB\u91C7\u6837\u5668\u3002</p><ol start="6"><li>\u7EB9\u7406\u5355\u5143</li></ol><p>\u7EB9\u7406\u5355\u5143\u662F\u4E00\u79CD\u4E13\u95E8\u7528\u6765\u5B58\u653E\u7EB9\u7406\u5BF9\u8C61\u7684\u7F13\u51B2\u533A\uFF0C\u5C31\u50CF\u6211\u4EEC\u4E4B\u524D\u7528 createBuffer()\u65B9\u6CD5\u5EFA\u7ACB\u7684\u7528\u4E8E\u5B58\u50A8\u6570\u636E\u6E90\u7684\u7F13\u51B2\u533A\u4E00\u6837\u3002</p><p>webgl=&gt; \u7EB9\u7406\u5355\u5143\uFF0C\u5982 TEXTURE0|1|2|3|4|5|6|7|</p><p>\u7EB9\u7406\u5355\u5143\u867D\u7136\u65E0\u9700\u6211\u4EEC\u81EA\u5DF1\u5EFA\u7ACB\uFF0C\u4F46\u9700\u8981\u6211\u4EEC\u81EA\u5DF1\u6FC0\u6D3B\uFF0C\u8BA9\u5176\u8FDB\u5165\u4F7F\u7528\u72B6\u6001</p><h4 id="_2-\u6574\u4F53\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_2-\u6574\u4F53\u4EE3\u7801" aria-hidden="true">#</a> 2.\u6574\u4F53\u4EE3\u7801</h4><ol><li>\u9876\u70B9\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;vertexShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-vertex&quot;</span><span class="token operator">&gt;</span>
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span> <span class="token comment">// \u56FE\u9489\u4F4D\u7F6E</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>\u7247\u5143\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// sampler2D \u662F uniform \u53D8\u91CF\u7684\u7C7B\u578B\uFF0C\u53EB\u505A\u4E8C\u7EF4\u53D6\u6837\u5668</span>
<span class="token comment">// texture2D() \u57FA\u4E8E\u56FE\u9489\u4ECE\u53D6\u6837\u5668\u4E2D\u83B7\u53D6\u7247\u5143\u989C\u8272</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>\u521D\u59CB\u5316\u7740\u8272\u5668</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="4"><li>\u5EFA\u7ACB\u6570\u636E\u6E90\uFF0C\u5E76\u8BA1\u7B97\u76F8\u5E94\u5C3A\u5BF8</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u6570\u636E\u6E90 (\u9876\u70B9\u4F4D\u7F6E\u7CFB\u5217 \u548C \u56FE\u9489\u4F4D\u7F6E)</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
<span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
<span class="token keyword">const</span> elementBytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span>
<span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
<span class="token keyword">const</span> posSize <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">const</span> PinSize <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
<span class="token keyword">const</span> categorySize <span class="token operator">=</span> posSize <span class="token operator">+</span> PinSize
<span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
<span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes
<span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
<span class="token keyword">const</span> posByteIndex <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> pinByteIndex <span class="token operator">=</span> posSize <span class="token operator">*</span> elementBytes
<span class="token comment">//\u9876\u70B9\u603B\u6570</span>
<span class="token keyword">const</span> sourceSize <span class="token operator">=</span> source<span class="token punctuation">.</span>length <span class="token operator">/</span> categorySize
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ol start="5"><li>\u5C06\u6570\u636E\u6E90\u5199\u5165\u5230\u7F13\u51B2\u533A\uFF0C\u8BA9 attribute \u53D8\u91CF\u4ECE\u5176\u4E2D\u5BFB\u627E\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sourceBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
  a_Position<span class="token punctuation">,</span>
  posSize<span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  categoryBytes<span class="token punctuation">,</span>
  posByteIndex
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> a_Pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;a_Pin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
  a_Pin<span class="token punctuation">,</span>
  pinSize<span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span><span class="token punctuation">,</span>
  categoryBytes<span class="token punctuation">,</span>
  pinByteIndex
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ol start="6"><li>\u5EFA\u7ACB Image \u56FE\u50CF\u4F5C\u4E3A\u56FE\u50CF\u6E90\uFF0C\u5F53\u56FE\u50CF\u6E90\u52A0\u8F7D\u6210\u529F\u540E\u518D\u8D34\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5BF9\u7EB9\u7406\u56FE\u50CF\u5782\u76F4\u7FFB\u8F6C</span>
gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6FC0\u6D3B 0 \u53F7\u7EB9\u7406\u5355\u5143</span>
gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7EB9\u7406\u5BF9\u8C61</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u628A\u7EB9\u7406\u5BF9\u8C61\u88C5\u8FDB\u7EB9\u7406\u5355\u5143\u91CC</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//image \u5BF9\u8C61</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha2.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">showMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//\u8D34\u56FE</span>
<span class="token keyword">function</span> <span class="token function">showMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u914D\u7F6E\u7EB9\u7406\u56FE\u50CF</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u914D\u7F6E\u7EB9\u7406\u53C2\u6570</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u83B7\u53D6u_Sampler</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5C060\u53F7\u7EB9\u7406\u5206\u914D\u7ED9\u7740\u8272\u5668\uFF0C0 \u662F\u7EB9\u7406\u5355\u5143\u7F16\u53F7</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="_3-\u8D34\u56FE\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#_3-\u8D34\u56FE\u8BE6\u89E3" aria-hidden="true">#</a> 3.\u8D34\u56FE\u8BE6\u89E3</h4><ol><li>\u51C6\u5907\u4E09\u4E2A\u89D2\u8272</li></ol><ul><li>Image \u56FE\u50CF</li><li>\u7EB9\u7406\u5BF9\u8C61</li><li>\u7EB9\u7406\u5355\u5143</li></ul><p><img src="`+Qn+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6FC0\u6D3B0\u53F7\u7EB9\u7406\u5355\u5143</span>
gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7EB9\u7406\u5BF9\u8C61</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//image \u5BF9\u8C61</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>\u628A\u7EB9\u7406\u5BF9\u8C61\u88C5\u8FDB\u5F53\u524D\u5DF2\u88AB\u6FC0\u6D3B\u7684\u7EB9\u7406\u5355\u5143\u91CC</li></ol><p><img src="`+$n+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>TEXTURE_2D \u7EB9\u7406\u5BF9\u8C61\u7684\u7C7B\u578B</li></ul><ol start="3"><li>\u5F53 Image \u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u628A\u56FE\u50CF\u88C5\u8FDB\u5F53\u524D\u7EB9\u7406\u5355\u5143\u7684\u7EB9\u7406\u5BF9\u8C61\u91CC</li></ol><p><img src="`+Jn+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>texImage2D(type, level, internalformat, format, type, pixels)</p><ul><li>type \u7EB9\u7406\u7C7B\u578B</li><li>level \u57FA\u672C\u56FE\u50CF\u7B49\u7EA7</li><li>internalformat \u7EB9\u7406\u4E2D\u7684\u989C\u8272\u7EC4\u4EF6</li><li>format \u7EB9\u7406\u6570\u636E\u683C\u5F0F\uFF0C\u5FC5\u987B\u548C internalformat \u4E00\u6837</li><li>type \u7EB9\u7406\u6570\u636E\u7684\u6570\u636E\u7C7B\u578B <ul><li>UNSIGNED_BYTE \u65E0\u7B26\u53F7\u5B57\u8282</li></ul></li><li>pixels \u56FE\u50CF\u6E90</li></ul><ol start="4"><li>\u7EB9\u7406\u5BF9\u8C61\u8FD8\u6709\u4E00\u4E9B\u76F8\u5E94\u53C2\u6570\u9700\u8981\u8BBE\u7F6E\u4E00\u4E0B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>texParameteri(type, pname, param)</p><ul><li>type \u7EB9\u7406\u7C7B\u578B <ul><li>TEXTURE_2D \u4E8C\u7EF4\u7EB9\u7406</li></ul></li><li>pname \u7EB9\u7406\u53C2\u6570\u7684\u540D\u79F0 <ul><li>TEXTURE_MIN_FILTER \u7EB9\u7406\u7F29\u5C0F\u6EE4\u6CE2\u5668</li></ul></li><li>param \u4E0E pname \u76F8\u5BF9\u5E94\u7684\u7EB9\u7406\u53C2\u6570\u503C <ul><li>gl.LINEAR \u7EBF\u6027</li></ul></li></ul><ol start="5"><li>\u5728 js \u4E2D\u83B7\u53D6\u91C7\u6837\u5668\u5BF9\u5E94\u7684 Uniform \u53D8\u91CF,\u544A\u8BC9\u7247\u5143\u7740\u8272\u5668\u4E2D\u7684\u91C7\u6837\u5668\uFF0C\u7EB9\u7406\u5BF9\u8C61\u5728\u54EA\u4E2A\u5355\u5143\u91CC\u3002\u4E4B\u540E\u91C7\u6837\u5668\u4FBF\u4F1A\u6839\u636E\u5355\u5143\u53F7\u53BB\u5355\u5143\u5BF9\u8C61\u4E2D\u5BFB\u627E\u7EB9\u7406\u5BF9\u8C61</li></ol><p><img src="`+ns+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="6"><li>\u6E32\u67D3</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+ss+`" alt=""></p><p>\u8FD9\u65F6\u5019\u7684\u56FE\u50CF\u662F\u5012\u7ACB\u7684\uFF0C\u8FD9\u662F\u7531\u4E8E Image \u5BF9\u8C61\u9075\u5B88\u7684\u662F\u6805\u683C\u5750\u6807\u7CFB\uFF0C\u6805\u683C\u5750\u6807\u7CFB\u7684 y \u8F74\u671D\u4E0B\uFF0C\u800C uv \u5750\u6807\u7CFB\u7684 y \u671D\u4E0A\uFF0C\u4E24\u8005\u76F8\u53CD\uFF0C\u6240\u4EE5\u753B\u51FA\u7684\u56FE\u5F62\u53CD\u4E86\u3002</p><ol start="7"><li>\u5BF9\u56FE\u50CF\u8FDB\u884C\u9884\u5904\u7406\uFF0C\u5C06\u56FE\u50CF\u5782\u76F4\u7FFB\u8F6C</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>pixelStorei(pname, param) \u56FE\u50CF\u9884\u5904\u7406</p><ul><li>pname \u53C2\u6570\u540D <ul><li>gl.UNPACK_FLIP_Y_WEBGL \u662F\u5426\u5782\u76F4\u7FFB\uFF0C\u5E03\u5C14\u503C\uFF0C1|0</li></ul></li><li>param \u53C2\u6570\u503C</li></ul><p><img src="`+k+`" alt=""></p><h4 id="_4-\u7EB9\u7406\u5BB9\u5668" tabindex="-1"><a class="header-anchor" href="#_4-\u7EB9\u7406\u5BB9\u5668" aria-hidden="true">#</a> 4.\u7EB9\u7406\u5BB9\u5668</h4><p>\u5728\u8D34\u56FE\u7684\u65F6\u5019\uFF0C\u9ED8\u8BA4\u56FE\u50CF\u6E90\u7684\u5C3A\u5BF8\u53EA\u80FD\u662F 2 \u7684 n \u6B21\u65B9\uFF0C\u6BD4\u5982 2\u30014\u30018\u300116\u3001\u2026\u2026\u3001256\u3001512 \u7B49\uFF0C\u5982\u679C\u6211\u4EEC\u628A\u56FE\u50CF\u7684\u5C3A\u5BF8\u6539\u6210\u975E 2 \u6B21\u5E42\u5C3A\u5BF8\uFF0C\u5982 300*300\uFF0C\u90A3\u8D34\u56FE\u5C31\u65E0\u6CD5\u663E\u793A\u3002</p><p>\u8981\u60F3\u89E3\u51B3\u8FD9\u79CD\u95EE\u9898\uFF0C\u5C31\u5F97\u8BBE\u7F6E\u4E00\u4E0B\u7EB9\u7406\u7684\u5BB9\u5668\uFF0C\u5728\u56FE\u50CF\u4E0A\u6253\u56FE\u9489\u7684\u65F6\u5019\uFF0C\u5F62\u6210\u4E00\u5757 uv \u533A\u57DF\uFF0C\u8FD9\u5757\u533A\u57DF\u53EF\u4EE5\u7406\u89E3\u4E3A\u7EB9\u7406\u5BB9\u5668\u3002\u7EB9\u7406\u5BB9\u5668\u53EF\u4EE5\u5B9A\u4E49\u56FE\u9489\u533A\u57DF\u7684\u7EB9\u7406\u5982\u4F55\u663E\u793A\u5728 webgl \u56FE\u5F62\u4E2D\u3002\u901A\u8FC7\u5BF9\u7EB9\u7406\u5BB9\u5668\u7684\u8BBE\u7F6E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5B9E\u73B0\u4EE5\u4E0B\u529F\u80FD\uFF1A</p><ul><li>\u975E\u4E8C\u6B21\u5E42\u56FE\u50CF\u6E90\u7684\u663E\u793A</li><li>\u7EB9\u7406\u7684\u590D\u5236</li><li>\u7EB9\u7406\u7684\u955C\u50CF</li></ul><ol><li>\u975E\u4E8C\u6B21\u5E42\u56FE\u50CF\u6E90\u7684\u663E\u793A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>TEXTURE_WRAP_S \u548C TEXTURE_WRAP_T \u5C31\u662F\u7EB9\u7406\u5BB9\u5668\u5728 s \u65B9\u5411\u548C t \u65B9\u5411\u7684\u5C3A\u5BF8\uFF0C\u8FD9\u91CC\u7684 s\u3001t \u5C31\u662F st \u5750\u6807\u7CFB\u91CC\u7684 s\u3001t\uFF0Cst \u5750\u6807\u7CFB\u548C uv \u5750\u6807\u7CFB\u662F\u4E00\u56DE\u4E8B\u3002</p><p>CLAMP_TO_EDGE \u7FFB\u8BD1\u8FC7\u6765\u5C31\u662F\u8FB9\u7F18\u5939\u7D27\u7684\u610F\u601D\uFF0C\u53EF\u4EE5\u7406\u89E3\u4E3A\u4EFB\u610F\u5C3A\u5BF8\u7684\u56FE\u50CF\u6E90\u90FD\u53EF\u4EE5\u88AB\u5BBD\u9AD8\u4E3A 1 \u7684 uv \u5C3A\u5BF8\u5939\u7D27\u3002</p><p>\u6CE8\uFF1A\u53EA\u6709 CLAMP_TO_EDGE \u624D\u80FD\u5B9E\u73B0\u975E\u4E8C\u6B21\u5E42\u56FE\u50CF\u6E90\u7684\u663E\u793A\uFF0C\u5176\u5B83\u7684\u53C2\u6570\u90FD\u4E0D\u53EF\u4EE5\u3002</p><ol start="2"><li>\u7EB9\u7406\u7684\u590D\u5236</li></ol><p>uv \u5750\u6807\u7CFB\u7684\u5750\u6807\u57FA\u5E95\u5206\u522B\u662F 1 \u4E2A\u56FE\u7247\u7684\u5BBD\u548C 1 \u4E2A\u56FE\u7247\u7684\u9AD8\uFF0C\u53EF\u662F\u5982\u679C\u6211\u4EEC\u5C06 2 \u4E2A\u56FE\u7247\u7684\u5BBD\u9AD8\u6620\u5C04\u5230\u4E86\u56FE\u5F62\u4E0A\u4F1A\u662F\u4EC0\u4E48\u7ED3\u679C\u5462\uFF1F</p><p>\u9ED8\u8BA4\u662F\u8FD9\u6837\u7684\uFF1A<br><img src="`+as+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>REPEAT \u5C31\u662F\u7EB9\u7406\u91CD\u590D\u7684\u610F\u601D</p><ol start="3"><li>\u7EB9\u7406\u7684\u955C\u50CF\u590D\u5236 \u7EB9\u7406\u7684\u955C\u50CF\u590D\u5236\u53EF\u4EE5\u5B9E\u73B0\u7EB9\u7406\u7684\u6C34\u5E73\u3001\u5782\u76F4\u7FFB\u8F6C\u548C\u590D\u5236\u3002</li></ol><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+ps+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">MIRRORED_REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">MIRRORED_REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>MIRRORED_REPEAT \u5C31\u662F\u955C\u50CF\u590D\u5236\u7684\u610F\u601D\u3002</p><p>\u4E5F\u53EF\u4EE5\u901A\u8FC7\u4F7F\u7528 CLAMP_TO_EDGE \u53EA\u5BF9\u67D0\u4E00\u4E2A\u65B9\u5411\u7EB9\u7406\u955C\u50CF\u590D\u5236</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">MIRRORED_REPEAT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+ts+'" alt=""></p><h4 id="_5-\u5206\u5B50\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_5-\u5206\u5B50\u8D34\u56FE" aria-hidden="true">#</a> 5.\u5206\u5B50\u8D34\u56FE</h4><p>\u5206\u5B50\u8D34\u56FE mipmap \u662F\u4E00\u79CD\u7EB9\u7406\u6620\u5C04\u6280\u672F\u3002</p><p>\u6BD4\u5982\uFF1A</p><p>webgl \u4E2D\u6709\u4E00\u4E2A\u6B63\u65B9\u5F62\uFF0C\u5B83\u5728 canvas \u753B\u5E03\u4E2D\u663E\u793A\u7684\u65F6\u5019\uFF0C\u5360\u636E\u4E86 2*2 \u4E2A\u50CF\u7D20\uFF0C\u6211\u4EEC\u8981\u5C06\u4E00\u4E2A 8*8 \u7684\u56FE\u50CF\u6E90\u8D34\u4E0A\u53BB\u3002</p><p>\u6B63\u65B9\u5F62\u4E2D\u80AF\u5B9A\u4E0D\u80FD\u663E\u793A\u56FE\u50CF\u6E90\u4E2D\u7684\u6240\u6709\u50CF\u7D20\uFF0C\u56E0\u4E3A\u5B83\u53EA\u6709 2*2=4 \u4E2A\u50CF\u7D20\u3002</p><p>\u5728 Photoshop \u4E2D\uFF0C\u4F1A\u5C06\u56FE\u50CF\u6E90\u5207\u5272\u6210 2 \u884C\u30012 \u5217\u7684\u8272\u5757\uFF0C\u7136\u540E\u5C06\u6BCF\u4E2A\u8272\u5757\u7684\u5747\u503C\u4EA4\u4E2A\u6B63\u65B9\u5F62\u3002</p><p>\u5728 webgl \u4E2D\u4E5F\u6709\u7C7B\u4F3C\u7684\u65B9\u6CD5\uFF0C\u5E76\u4E14\u5B83\u8FD8\u6709\u4E00\u5C42\u6E32\u67D3\u6027\u80FD\u7684\u4F18\u5316\uFF08Photoshop \u5E95\u5C42\u662F\u5426\u6709\u8FD9\u5C42\u4F18\u5316\u6211\u5C1A\u4E14\u4E0D\u77E5\uFF09\u3002</p><p>\u63A5\u4E0B\u6765\u54B1\u4EEC\u5C31\u8BF4\u4E00\u4E0B\u8FD9\u5C42\u4F18\u5316\u4F18\u5316\u7684\u662F\u4EC0\u4E48\u3002</p><p>\u5148\u60F3\u8C61\u4E00\u4E2A\u573A\u666F\uFF0C\u6211\u8981\u628A 1024*1024 \u7684\u56FE\u50CF\u6E90\u6620\u5C04\u5230 canvas \u753B\u5E03\u4E0A 2*2 \u7684\u6B63\u65B9\u5F62\u4E2D\uFF0C\u82E5\u628A\u56FE\u50CF\u6E90\u5206\u5272\u6C42\u5747\u503C\u4F1A\u4EA7\u751F\u5E9E\u5927\u7684\u6570\u636E\u8FD0\u7B97\uFF0C\u6211\u4EEC\u9700\u8981\u60F3\u529E\u6CD5\u628A\u548C\u6B63\u65B9\u5F62\u76F8\u6620\u5C04\u7684\u56FE\u50CF\u6E90\u7684\u5C3A\u5BF8\u964D\u5230\u6700\u5C0F\uFF0C\u6BD4\u5982\u5C31\u662F 2*2 \u7684\u3002</p>',372),yp=n("\u56E0\u6B64\uFF0C\u6211\u4EEC\u5C31\u9700\u8981"),fp={href:"https://baike.baidu.com/item/Mipmap/3722136?fr=aladdin",target:"_blank",rel:"noopener noreferrer"},hp=n("\u5206\u5B50\u8D34\u56FE"),wp=n("\u4E86\u3002"),xp=a('<p>\u5206\u5B50\u8D34\u56FE\u662F\u4E00\u4E2A\u57FA\u4E8E\u5206\u8FA8\u7387\u7B49\u6BD4\u6392\u5217\u7684\u56FE\u50CF\u96C6\u5408\uFF0C\u96C6\u5408\u4E2D\u6BCF\u4E00\u9879\u7684\u5BBD\u9AD8\u4E0E\u5176\u524D\u4E00\u9879\u5BBD\u9AD8\u7684\u6BD4\u503C\u90FD\u662F 1/2\u3002</p><p>\u5982\u4E0B\u56FE\uFF1A</p><p><img src="'+es+`" alt=""></p><p>\u5728 webgl \u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528 gl.generateMipmap() \u65B9\u6CD5\u4E3A\u56FE\u50CF\u6E90\u521B\u5EFA\u5206\u5B50\u8D34\u56FE\uFF0C</p><p>\u6709\u4E86\u5206\u5B50\u8D34\u56FE\u540E\uFF0C\u4E4B\u524D 2*2 \u7684\u6B63\u65B9\u5F62\u4FBF\u4F1A\u4ECE\u5206\u5B50\u96C6\u5408\u4E2D\u5BFB\u627E\u4E0E\u5176\u5206\u8FA8\u7387\u6700\u63A5\u8FD1\u7684\u5206\u5B50\u56FE\u50CF\u3002</p><p>\u5728\u627E\u5230\u5206\u5B50\u56FE\u50CF\u540E\uFF0C\u5C31\u9700\u8981\u57FA\u4E8E webgl \u56FE\u5F62\u7684\u7247\u5143\u5C3A\u5BF8\u5BF9\u5176\u5206\u5272\u53D6\u8272\u4E86\u3002</p><p>\u5BF9\u4E8E\u53D6\u8272\u7684\u65B9\u6CD5\uFF0C\u54B1\u4EEC\u4E4B\u524D\u8BF4\u4E00\u4E2A\u5747\u503C\u7B97\u6CD5\uFF0C\u5176\u5B9E\u8FD8\u6709\u5176\u5B83\u7B97\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u521B\u5EFA\u5206\u5B50\u8D34\u56FE</span>
gl<span class="token punctuation">.</span><span class="token function">generateMipmap</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u5B9A\u4E49\u4ECE\u5206\u5B50\u56FE\u50CF\u4E2D\u53D6\u8272\u7684\u65B9\u6CD5</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>gl.texParameteri()\u65B9\u6CD5\u4E2D\u7684\u7B2C 2 \u4E2A\u53C2\u6570\u548C\u7B2C 3 \u4E2A\u53C2\u6570\u662F\u952E\u503C\u5BF9\u7684\u5173\u7CFB\u3002</p><p>TEXTURE_MAG_FILTER \u548C TEXTURE_MIN_FILTER\uFF0C\u5BF9\u5E94\u7684\u662F\u7EB9\u7406\u5728 webgl \u56FE\u5F62\u4E2D\u7684\u7F29\u653E\u60C5\u51B5\u3002</p><ul><li>TEXTURE_MAG_FILTER \u7EB9\u7406\u653E\u5927\u6EE4\u6CE2\u5668\uFF0C\u662F\u7EB9\u7406\u5728 webgl \u56FE\u5F62\u4E2D\u88AB\u653E\u5927\u7684\u60C5\u51B5\u3002</li><li>TEXTURE_MIN_FILTER \u7EB9\u7406\u7F29\u5C0F\u6EE4\u6CE2\u5668\uFF0C\u662F\u7EB9\u7406\u5728 webgl \u56FE\u5F62\u4E2D\u88AB\u7F29\u5C0F\u7684\u60C5\u51B5\u3002</li></ul><p>TEXTURE_MAG_FILTER \u5177\u5907\u4EE5\u4E0B\u53C2\u6570\uFF1A</p><ul><li>LINEAR (\u9ED8\u8BA4\u503C) \uFF0C\u7EBF\u6027\u6EE4\u955C\uFF0C \u83B7\u53D6\u7EB9\u7406\u5750\u6807\u70B9\u9644\u8FD1 4 \u4E2A\u50CF\u7D20\u7684\u52A0\u6743\u5E73\u5747\u503C\uFF0C\u6548\u679C\u5E73\u6ED1</li><li>NEAREST \u6700\u8FD1\u6EE4\u955C\uFF0C \u83B7\u5F97\u6700\u9760\u8FD1\u7EB9\u7406\u5750\u6807\u70B9\u7684\u50CF\u7D20 \uFF0C\u6548\u679C\u9510\u5229</li></ul><p>TEXTURE_MIN_FILTER \u5177\u5907\u4EE5\u4E0B\u53C2\u6570\uFF1A</p><ul><li>LINEAR \u7EBF\u6027\u6EE4\u955C\uFF0C\u83B7\u53D6\u7EB9\u7406\u5750\u6807\u70B9\u9644\u8FD1 4 \u4E2A\u50CF\u7D20\u7684\u52A0\u6743\u5E73\u5747\u503C\uFF0C\u6548\u679C\u5E73\u6ED1</li><li>NEAREST \u6700\u8FD1\u6EE4\u955C\uFF0C \u83B7\u5F97\u6700\u9760\u8FD1\u7EB9\u7406\u5750\u6807\u70B9\u7684\u50CF\u7D20\uFF0C\u6548\u679C\u9510\u5229</li><li>NEAREST_MIPMAP_NEAREST Select the nearest mip level and perform nearest neighbor filtering .</li><li>NEAREST_MIPMAP_LINEAR (\u9ED8\u8BA4\u503C) Perform a linear interpolation between mip levels and perform nearest neighbor filtering within each .</li><li>LINEAR_MIPMAP_NEAREST Select the nearest mip level and perform linear filtering within it .</li><li>LINEAR_MIPMAP_LINEAR Perform a linear interpolation between mip levels and perform linear filtering : also called trilinear filtering .</li></ul><p>\u6CE8\uFF1A\u540E\u9762\u8FD9 4 \u4E2A\u4E0E\u5206\u5B50\u8D34\u56FE\u76F8\u5173\u7684\u53C2\u6570\u9002\u5408\u6BD4\u8F83\u5927\u7684\u8D34\u56FE\uFF0C\u82E5\u662F\u6BD4\u8F83\u5C0F\u7684\u8D34\u56FE\uFF0C\u4F7F\u7528 LINEAR \u6216 NEAREST \u5C31\u597D\u3002</p><p>\u6CE8\uFF1A\u7F29\u5C0F\u6EE4\u6CE2\u5668\u7684\u9ED8\u8BA4\u503C\u53D6\u8272\u65B9\u6CD5\u662F NEAREST_MIPMAP_LINEAR \uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u4ECE\u5206\u5B50\u8D34\u56FE\u91CC\u627E\u5206\u5B50\u56FE\u50CF\uFF0C\u7136\u540E\u4ECE\u5176\u4E2D\u53D6\u8272\uFF0C\u7136\u800C\u5F53\u6211\u4EEC\u6CA1\u6709\u4F7F\u7528 gl.generateMipmap()\u65B9\u6CD5\u5EFA\u7ACB\u5206\u5B50\u8D34\u56FE\u7684\u65F6\u5019\uFF0C\u5C31\u5F97\u7ED9\u5B83\u4E00\u4E2A\u4E0D\u9700\u8981\u4ECE\u5206\u5B50\u8D34\u56FE\u4E2D\u53BB\u8272\u7684\u65B9\u6CD5\uFF0C\u5982 LINEAR \u6216 NEAREST\u3002</p><h4 id="_6-\u591A\u7EB9\u7406\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_6-\u591A\u7EB9\u7406\u6A21\u578B" aria-hidden="true">#</a> 6.\u591A\u7EB9\u7406\u6A21\u578B</h4><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u7ECF\u5E38\u4F1A\u9047\u5230\u4E00\u4E2A\u6A21\u578B\uFF0C\u591A\u4E2A\u7EB9\u7406\u7684\u7684\u60C5\u51B5\u3002</p><p>\u6BD4\u5982\u8FD9\u4E2A\u9B54\u65B9\uFF1A</p><p><img src="`+os+'" alt=""></p><p>\u6709\u65F6\u5019\u4F1A\u5F88\u81EA\u7136\u7684\u60F3\u5230\u4E00\u4E2A\u9762\u7ED9\u5B83\u4E00\u4E2A\u8D34\u56FE\uFF0C\u800C\u5B9E\u9645\u4E0A\uFF0C\u6700\u9AD8\u6548\u7684\u65B9\u5F0F\u662F\u4E00\u4E2A\u7269\u4F53\u7ED9\u5B83\u4E00\u4E2A\u8D34\u56FE\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><p><img src="'+cs+`" alt=""></p><p>\u8FD9\u6837\u53EA\u9700\u8981\u52A0\u8F7D\u4E00\u6B21\u56FE\u7247\uFF0C\u5EFA\u7ACB\u4E00\u4E2A\u7EB9\u7406\u5BF9\u8C61\uFF0C\u505A\u4E00\u6B21\u7EB9\u7406\u548C\u9876\u70B9\u6570\u636E\u7684\u6620\u5C04\u5C31\u53EF\u4EE5\u4E86\u3002</p><p>\u8FD9\u91CC\u9762\u6CA1\u6709\u6D89\u53CA\u4EFB\u4F55\u65B0\u7684\u77E5\u8BC6\u70B9\uFF0C\u4F46\u8FD9\u662F\u4E00\u79CD\u5F88\u91CD\u8981\u7684\u9879\u76EE\u5F00\u53D1\u7ECF\u9A8C\u3002</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> Matrix4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">CULL_FACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6570\u636E\u6E90</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>

    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>

    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> elementBytes <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span>
  <span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> posSize <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token keyword">const</span> pinSize <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> categorySize <span class="token operator">=</span> posSize <span class="token operator">+</span> pinSize
  <span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes
  <span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
  <span class="token keyword">const</span> posByteIndex <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> pinByteIndex <span class="token operator">=</span> posSize <span class="token operator">*</span> elementBytes
  <span class="token comment">//\u9876\u70B9\u603B\u6570</span>
  <span class="token keyword">const</span> sourceSize <span class="token operator">=</span> source<span class="token punctuation">.</span>length <span class="token operator">/</span> categorySize

  <span class="token keyword">const</span> sourceBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> sourceBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Position<span class="token punctuation">,</span>
    posSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    posByteIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> a_Pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Pin<span class="token punctuation">,</span>
    pinSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    pinByteIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6A21\u578B\u77E9\u9635</span>
  <span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span>

  <span class="token comment">/* \u56FE\u50CF\u9884\u5904\u7406 */</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u51C6\u5907\u4E09\u4E2A\u89D2\u8272 */</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>

  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/mf.jpg&#39;</span>
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
      image
    <span class="token punctuation">)</span>

    gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//\u6E32\u67D3</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u8FDE\u7EED\u6E32\u67D3</span>
  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modelMatrix<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mx<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br></div></div></details><h3 id="_4-\u7EB9\u7406\u5408\u6210" tabindex="-1"><a class="header-anchor" href="#_4-\u7EB9\u7406\u5408\u6210" aria-hidden="true">#</a> 4.\u7EB9\u7406\u5408\u6210</h3><p>\u7EB9\u7406\u5408\u6210\u5C31\u662F\u6309\u7167\u67D0\u79CD\u89C4\u5219\u5C06\u591A\u5F20\u56FE\u7247\u5408\u5728\u4E00\u8D77\u3002</p><h4 id="_4-1-\u591A\u56FE\u52A0\u8F7D" tabindex="-1"><a class="header-anchor" href="#_4-1-\u591A\u56FE\u52A0\u8F7D" aria-hidden="true">#</a> 4-1 \u591A\u56FE\u52A0\u8F7D</h4><p>\u7EB9\u7406\u5408\u6210\u662F\u9700\u8981\u591A\u5F20\u56FE\u50CF\u6E90\u7684\uFF0C\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u591A\u5F20\u56FE\u50CF\u6E90\u90FD\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u518D\u53BB\u5408\u6210\u7EB9\u7406\u3002</p><ol><li>\u5C06\u56FE\u50CF\u7684\u52A0\u8F7D\u65B9\u6CD5\u5C01\u88C5\u8FDB\u4E00\u4E2A Promise \u4E2D\uFF0C\u7B49\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u518D resolve\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">imgPromise</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u591A\u4E2A Image \u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> originImg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
originImg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/dress.jpg&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pattern<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/pattern1.jpg&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>\u5229\u7528 Promise.all \u76D1\u542C\u6240\u6709\u56FE\u7247\u7684\u8BB0\u8F7D\u6210\u529F</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">imgPromise</span><span class="token punctuation">(</span>originImg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">imgPromise</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rect<span class="token punctuation">.</span>maps <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> originImg <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_Pattern</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> pattern <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  rect<span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u7B49\u6240\u6709\u7684\u56FE\u7247\u90FD\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u4F1A\u5F80 rect \u7684 maps \u96C6\u5408\u91CC\u5199\u5165\u8D34\u56FE\uFF0C\u7136\u540E\u5BF9\u5176\u66F4\u65B0\u548C\u6E32\u67D3\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u770B\u4E00\u4E0B\u7EB9\u7406\u5408\u6210\u6700\u6838\u5FC3\u7684\u5730\u65B9\uFF0C\u7247\u5143\u7740\u8272\u5668\u3002</p><h4 id="_4-2-\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5408\u6210\u7EB9\u7406" tabindex="-1"><a class="header-anchor" href="#_4-2-\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5408\u6210\u7EB9\u7406" aria-hidden="true">#</a> 4-2 \u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\u5408\u6210\u7EB9\u7406</h4><p>\u7247\u5143\u7740\u8272\u5668\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>  
  precision mediump float<span class="token punctuation">;</span>  
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>  
  uniform sampler2D u_Pattern<span class="token punctuation">;</span>  
  varying vec2 v_Pin<span class="token punctuation">;</span>  
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    vec4 o <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    vec4 p <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    gl_FragColor <span class="token operator">=</span> p<span class="token operator">*</span>o<span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>u_Sampler \u662F\u539F\u59CB\u56FE\u7247\u91C7\u6837\u5668\uFF0C\u5BF9\u5E94\u4E0B\u56FE\uFF1A</li></ul><p><img src="`+ls+'" alt=""></p><ul><li>u_Pattern \u662F\u7EB9\u7406\u56FE\u6848\u91C7\u6837\u5668\uFF0C\u5BF9\u5E94\u4E0B\u56FE\uFF1A</li></ul><p><img src="'+us+`" alt=""></p><p>\u4E4B\u540E\uFF0C\u901A\u8FC7\u91C7\u6837\u5668\u627E\u5230\u539F\u59CB\u56FE\u7247\u548C\u7EB9\u7406\u56FE\u6848\u7684\u7247\u5143\u540E\uFF0C\u4FBF\u53EF\u4EE5\u5BF9\u5176\u8FDB\u884C\u8FD0\u7B97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 o <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 p <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl_FragColor <span class="token operator">=</span> p<span class="token operator">*</span>o<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4E0A\u9762\u7684 p*o \u4FBF\u662F\u5728\u5BF9\u7247\u5143\u505A\u5206\u91CF\u76F8\u4E58\u7684\u8FD0\u7B97\uFF0C\u8FD9\u79CD\u7B97\u6CD5\u4F1A\u8BA9\u539F\u59CB\u56FE\u7247\u7684\u4EAE\u5EA6\u53D8\u6697\uFF0C\u6709\u70B9\u7C7B\u4F3C\u4E8E ps \u91CC\u7684\u6B63\u7247\u53E0\u5E95\u3002</p><p><img src="`+rs+`" alt=""></p><p>\u4E3E\u4E2A\u4F8B\u5B50\u8BF4\u4E00\u4E0B\u7247\u5143\u76F8\u4E58\u7684\u903B\u8F91\u3002</p><p>\u5DF2\u77E5\uFF1A</p><ul><li>\u539F\u59CB\u56FE\u50CF\u7247\u5143 o(ox,oy,oz,ow)</li><li>\u7EB9\u7406\u56FE\u6848\u7247\u5143 p(px,py,pz,pw)</li></ul><p>\u6C42\uFF1Ap*o</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>p <span class="token operator">*</span> o <span class="token operator">=</span> <span class="token punctuation">(</span>px <span class="token operator">*</span> ox<span class="token punctuation">,</span> py <span class="token operator">*</span> oy<span class="token punctuation">,</span> pz <span class="token operator">*</span> oz<span class="token punctuation">,</span> pw <span class="token operator">*</span> ow<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u901A\u8FC7\u6B64\u4F8B\u53EF\u77E5\uFF1A\u56E0\u4E3A\u7247\u5143\u5206\u91CF\u7684\u503C\u57DF\u4E3A[0,1]\uFF0C\u6240\u4EE5 p*o \u7684\u4EAE\u5EA6\u5C0F\u4E8E\u7B49\u4E8E p \u548C o</p><ul><li>\u5F53 p=(1,1,1,1) \u65F6\uFF0Cp*o=o</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>p <span class="token operator">*</span> o <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> ox<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> oy<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> oz<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">*</span> ow<span class="token punctuation">)</span><span class="token punctuation">;</span>
p <span class="token operator">*</span> o <span class="token operator">=</span> <span class="token punctuation">(</span>ox<span class="token punctuation">,</span> oy<span class="token punctuation">,</span> oz<span class="token punctuation">,</span> ow<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>\u5F53 p=(0,0,0,0) \u65F6\uFF0Cp*o=(0,0,0,0)</li></ul><h4 id="_4-3-\u7EB9\u7406\u6DF7\u5408" tabindex="-1"><a class="header-anchor" href="#_4-3-\u7EB9\u7406\u6DF7\u5408" aria-hidden="true">#</a> 4-3 \u7EB9\u7406\u6DF7\u5408</h4><p>\u7EB9\u7406\u6DF7\u5408\u5C31\u662F\u6309\u7167\u4E00\u5B9A\u6BD4\u4F8B\uFF0C\u5C06\u7B2C\u4E00\u5F20\u56FE\u50CF\u5408\u5230\u53E6\u4E00\u5F20\u56FE\u50CF\u4E0A\uFF0C\u8FD9\u7C7B\u4F3C\u4E8E ps \u91CC\u7684\u900F\u660E\u5EA6\u5408\u6210\u3002</p><p>\u76F4\u63A5\u770B\u4E00\u4E0B\u7EB9\u7406\u5728\u7247\u5143\u7740\u8272\u91CC\u7684\u5408\u6210\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fragmentShader&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>  
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  uniform sampler2D u_Pattern<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec4 o <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 p <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Pattern<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u4E0A\u9762\u7684 mix() \u65B9\u6CD5\u4FBF\u662F\u6309\u7167\u6BD4\u4F8B\u5BF9\u4E24\u4E2A\u7EB9\u7406\u7684\u5408\u6210\u65B9\u6CD5\u3002</p><p>mix() \u65B9\u6CD5\u7684\u8FD4\u56DE\u6570\u636E\u7C7B\u578B\u4F1A\u56E0\u5176\u5408\u6210\u5BF9\u8C61\u7684\u4E0D\u540C\u800C\u4E0D\u540C\u3002</p><p>\u5176\u89C4\u5219\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> m <span class="token operator">+</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> m<span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4F8B 1\uFF1A</p><ul><li>m=3</li><li>n=5</li><li>a=0.5</li></ul><p>\u6C42\uFF1Amix(m,n,a)</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
<span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4F8B 2\uFF1A</p><ul><li>m=(1,2,3)</li><li>n=(3,4,5)</li><li>a=0.5</li></ul><p>\u6C42\uFF1Amix(m,n,a)</p><p>\u89E3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mix</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7B80\u5355\u603B\u7ED3\u4E00\u4E0B mix(m,n,a) \u65B9\u6CD5\u7684\u7279\u6027\uFF1A</p><ul><li>\u5F53 a=0 \u65F6\uFF0Cmix(m,n,a)=m</li><li>\u5F53 a=1 \u65F6\uFF0Cmix(m,n,a)=n</li></ul><p>\u53C2\u8003\u5730\u5740\uFF1Ahttps://www.khronos.org/registry/OpenGL-Refpages/gl4/</p><p>\u5229\u7528\u7EB9\u7406\u6DF7\u5408\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5B9E\u73B0\u8F6C\u573A\u52A8\u753B\u3002</p><h3 id="_5-\u8DE8\u57DF\u56FE\u50CF\u505A\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_5-\u8DE8\u57DF\u56FE\u50CF\u505A\u8D34\u56FE" aria-hidden="true">#</a> 5.\u8DE8\u57DF\u56FE\u50CF\u505A\u8D34\u56FE</h3><p>\u8FD9\u91CC\u8981\u8BF4\u7684\u8DE8\u57DF\u56FE\u50CF\u95EE\u9898\uFF0C\u5E76\u4E0D\u5355\u662F webgl \u95EE\u9898\uFF0C\u4E5F\u662F canvas 2d \u91CC\u7684\u95EE\u9898\u3002</p><ol><li>img \u6807\u7B7E\u4E0E\u8DE8\u57DF\u56FE\u50CF</li></ol><p>\u7528 img \u6807\u7B7E\u663E\u793A\u8DE8\u57DF\u56FE\u50CF\u7684\u65F6\u5019\uFF0C\u53EA\u80FD\u5C06\u56FE\u50CF\u5C55\u793A\u7ED9\u7528\u6237\uFF0C\u4F46\u5E76\u4E0D\u80FD\u83B7\u53D6\u56FE\u50CF\u4E2D\u7684\u6570\u636E\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;https://xxx/xxx.png&#39;&quot;</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0D\u80FD\u901A\u8FC7 img \u6807\u7B7E\u83B7\u53D6\u56FE\u50CF\u6570\u636E\uFF0C\u662F\u6D4F\u89C8\u5668\u51FA\u4E8E\u5B89\u5168\u8003\u8651\u7684\uFF0C\u56E0\u4E3A\u6709\u7684\u56FE\u50CF\u91CC\u53EF\u80FD\u4F1A\u542B\u6709\u9A8C\u8BC1\u7801\u3001\u7B7E\u540D\u3001\u6216\u8005\u5176\u5B83\u4E0D\u53EF\u544A\u4EBA\u7684\u4E1C\u4E1C\uFF0C\u8FD9\u79CD\u6570\u636E\u662F\u4E0D\u80FD\u968F\u610F\u88AB\u522B\u4EBA\u83B7\u53D6\u7684\u3002</p><ol start="2"><li>\u83B7\u53D6\u56FE\u50CF\u6570\u636E</li></ol><p>\u82E5\u56FE\u50CF\u662F\u540C\u57DF\u7684\uFF0C\u4E0B\u9762\u7684\u65B9\u6CD5\u662F\u6CA1\u95EE\u9898\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx.png&quot;</span><span class="token punctuation">;</span>

img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u82E5\u56FE\u50CF\u662F\u8DE8\u57DF\u7684\uFF0C\u90A3\u5C31\u4F1A\u62A5\u9519\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Failed to execute <span class="token string">&#39;getImageData&#39;</span> on <span class="token string">&#39;CanvasRenderingContext2D&#39;</span><span class="token operator">:</span> The canvas has been tainted by cross<span class="token operator">-</span>origin data<span class="token punctuation">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7528 webgl \u83B7\u53D6\u8DE8\u57DF\u56FE\u50CF\u6570\u636E\u65F6\uFF0C\u4E5F\u4F1A\u62A5\u9519\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx.png&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u9519\u8BEF\u4FE1\u606F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Failed to execute <span class="token string">&#39;texImage2D&#39;</span> on <span class="token string">&#39;WebGLRenderingContext&#39;</span><span class="token operator">:</span> The image element contains cross<span class="token operator">-</span>origin data<span class="token punctuation">,</span> and may not be loaded<span class="token punctuation">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>CORS \u8DE8\u57DF</li></ol><p>CORS \u662F Cross Origin Resource Sharing \u7684\u7B80\u5199\uFF0C\u8BD1\u4F5C\u8DE8\u57DF\u8D44\u6E90\u5171\u4EAB\u3002</p><p>CORS \u662F\u4E00\u79CD\u7F51\u9875\u5411\u56FE\u50CF\u670D\u52A1\u5668\u8BF7\u6C42\u4F7F\u7528\u56FE\u50CF\u8BB8\u53EF\u7684\u65B9\u5F0F\u3002</p><p>CORS \u7684\u5B9E\u73B0\u8FC7\u7A0B\u5982\u4E0B\uFF1A</p><p>1.\u5148\u8BA9\u670D\u52A1\u5668\u5411\u5176\u5B83\u57DF\u540D\u653E\u6743\uFF0C\u6BD4\u5982 Apache \u670D\u52A1\u5668\u9700\u8981\u8FD9\u6837\u8BBE\u7F6E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Header <span class="token keyword">set</span> Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin <span class="token string">&quot;*&quot;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0A\u9762\u4EE3\u7801\u7684\u610F\u601D\u5C31\u662F\u5141\u8BB8\u5176\u5B83\u57DF\u540D\u7684\u7F51\u9875\u8DE8\u57DF\u83B7\u53D6\u81EA\u5DF1\u670D\u52A1\u7AEF\u7684\u8D44\u6E90\u3002</p><p>\u4E0A\u9762\u7684* \u662F\u5141\u8BB8\u6240\u6709\u57DF\u540D\u83B7\u53D6\u5176\u670D\u52A1\u7AEF\u8D44\u6E90\u3002</p><p>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u5199\u5177\u4F53\u7684\u57DF\u540D\uFF0C\u4ECE\u800C\u5141\u8BB8\u7279\u5B9A\u57DF\u540D\u83B7\u53D6\u5176\u670D\u52A1\u7AEF\u8D44\u6E90\u3002</p><p>2.\u5728\u7F51\u9875\u91CC\uFF0C\u901A\u8FC7\u7279\u5B9A\u7684\u65B9\u6CD5\u544A\u8BC9\u670D\u52A1\u7AEF\uFF0C\u6211\u9700\u8981\u8DE8\u57DF\u83B7\u53D6\u4F60\u7684\u8D44\u6E90\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx.png&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;crossOrigin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6709\u4E86\u4E0A\u9762 crossOrigin \u5C5E\u6027\u7684\u8BBE\u7F6E\uFF0C\u65E0\u8BBA\u662F\u5728 canvas 2d \u91CC\u4F7F\u7528\u6B64\u56FE\u50CF\u6E90\uFF0C\u8FD8\u662F\u5728 webgl \u91CC\u4F7F\u7528\u6B64\u56FE\u50CF\u6E90\uFF0C\u90FD\u4E0D\u4F1A\u62A5\u9519\u3002</p><p>crossOrigin \u63A5\u6536\u7684\u503C\u6709\u4E09\u79CD\uFF1A</p><ul><li>undefined \u662F\u9ED8\u8BA4\u503C\uFF0C\u8868\u793A\u4E0D\u9700\u8981\u5411\u5176\u5B83\u57DF\u540D\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u5171\u4EAB</li><li>anonymous \u5411\u5176\u5B83\u57DF\u540D\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u5171\u4EAB\uFF0C\u4F46\u4E0D\u9700\u8981\u5411\u5176\u53D1\u9001\u4EFB\u4F55\u4FE1\u606F</li><li>use-credentials \u5411\u5176\u5B83\u57DF\u540D\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u8D44\u6E90\u5171\u4EAB\uFF0C\u5E76\u53D1\u9001 cookies \u7B49\u4FE1\u606F\uFF0C\u670D\u52A1\u5668\u4F1A\u901A\u8FC7\u8FD9\u4E9B\u4FE1\u606F\u51B3\u5B9A\u662F\u5426\u6388\u6743</li></ul><h3 id="_6-\u89C6\u9891\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_6-\u89C6\u9891\u8D34\u56FE" aria-hidden="true">#</a> 6.\u89C6\u9891\u8D34\u56FE</h3><p>\u4E4B\u524D\u4F7F\u7528 texImage2D \u65B9\u6CD5\u5C06 Image \u56FE\u50CF\u6E90\u88C5\u8FDB\u4E86\u7EB9\u7406\u5BF9\u8C61\u91CC\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E5F\u53EF\u4EE5\u628A\u4E0A\u9762\u7684 image \u6362\u6210 video \u5BF9\u8C61</p><ol><li>\u6B63\u5E38\u5EFA\u7ACB\u7EB9\u7406\u5BF9\u8C61\uFF0C\u5E76\u8BBE\u7F6E\u5176\u76F8\u5173\u5C5E\u6027</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>\u83B7\u53D6\u91C7\u6837\u5668\u5BF9\u5E94\u7684 uniform \u53D8\u91CF\uFF0C\u5E76\u5C06\u7EB9\u7406\u5355\u5143\u53F7\u8D4B\u7ED9\u5B83</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>\u5EFA\u7ACB video \u5BF9\u8C61\uFF0C\u5E76\u64AD\u653E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://img.yxyy.name/ripples.mp4&quot;</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>autoplay <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>muted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span>loop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;crossOrigin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;playing&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>\u5728 video \u5BF9\u8C61\u64AD\u653E\u65F6\uFF0C\u5411\u7EB9\u7406\u5BF9\u8C61\u8FDE\u7EED\u5199\u5165 video</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> video<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourceSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="\u516B\u3001\u4E16\u754C\u5750\u6807\u548C\u672C\u5730\u5750\u6807" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001\u4E16\u754C\u5750\u6807\u548C\u672C\u5730\u5750\u6807" aria-hidden="true">#</a> \u516B\u3001\u4E16\u754C\u5750\u6807\u548C\u672C\u5730\u5750\u6807</h2><h3 id="_1-\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> 1.\u57FA\u672C\u6982\u5FF5</h3><p>3D\u7A7A\u95F4\u62E5\u6709\u4E00\u4E2A\u4E16\u754C\u5750\u6807\u7CFB\uFF0C3D\u5C4F\u5E55\u4E2D\u7684\u6240\u6709\u7269\u4F53\u90FD\u53EF\u4EE5\u5728\u8BE5\u5750\u6807\u7CFB\u7CFB\u7EDF\u4E0B\u79FB\u52A8\u548C\u65CB\u8F6C\uFF0C\u5BF9\u4E8E\u5C4F\u5E55\u4E0A\u7684\u6240\u6709\u7269\u4F53\u6765\u8BF4\uFF0C\u8FD9\u4E2A\u5750\u6807\u7CFB\u7CFB\u7EDF\u90FD\u662F\u76F8\u540C\u7684\uFF0C\u5E76\u4E14\u5B83\u4E0D\u4F1A\u6539\u53D8\u3002\u7528\u6237\u9ED8\u8BA4\u7684\u89C2\u5BDF\u89C6\u89D2\u662F\u6CBF\u7740Z\u8F74\u7684\u8D1F\u534A\u8F74\u65B9\u5411</p><p>\u9664\u4E86\u4E16\u754C\u5750\u6807\u7CFB\u5916\uFF0C\u6BCF\u4E2A\u7269\u4F53\u90FD\u6709\u4E00\u4E2A\u672C\u5730\u5750\u6807\u7CFB\uFF0C\u5982\u56FE\uFF1A<br><img src="`+is+'" alt=""></p><p>\u5F53\u7269\u4F53\u65CB\u8F6C\u65F6\uFF0C\u672C\u5730\u5750\u6807\u7CFB\u7EDF\u4E5F\u4F1A\u8DDF\u7740\u7269\u4F53\u4E00\u8D77\u65CB\u8F6C\uFF0C\u5982\u56FE\uFF1A<br><img src="'+ks+`" alt=""></p><h3 id="_2-\u4E16\u754C\u5750\u6807\u7CFB\u548C\u672C\u5730\u5750\u6807\u7CFB\u70B9\u4F4D\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_2-\u4E16\u754C\u5750\u6807\u7CFB\u548C\u672C\u5730\u5750\u6807\u7CFB\u70B9\u4F4D\u5173\u7CFB" aria-hidden="true">#</a> 2.\u4E16\u754C\u5750\u6807\u7CFB\u548C\u672C\u5730\u5750\u6807\u7CFB\u70B9\u4F4D\u5173\u7CFB</h3><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]</li><li>\u70B9 P</li><li>\u70B9 P \u6240\u5904\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O2;i2,j2,k2]</li><li>\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]\u220B \u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]</li></ul><p><code>\u5206\u6790</code>\uFF1A</p><p>[O;i,j,k]\u4E2D\uFF1A</p><ul><li>O \u662F\u5750\u6807\u539F\u70B9</li><li>i,j,k \u662F\u5750\u6807\u5411\u91CF</li></ul><p>\u8FD9\u662F\u7A7A\u95F4\u76F4\u89D2\u5750\u6807\u7CFB\u7684\u4E66\u5199\u65B9\u5F0F\uFF0C\u53EF\u5728\u9AD8\u4E2D\u6570\u5B66\u7684\u7A7A\u95F4\u51E0\u4F55\u90E8\u5206\u627E\u5230</p><p><code>\u63D0\u95EE 1</code>\uFF1A</p><p>\u70B9 P \u7684\u5750\u6807\u4F4D\u662F(x,y,z)\uFF0C\u53EF\u5426\u627E\u5230\u70B9 P\uFF1F</p><p>\u7B54\uFF1A\u4E0D\u53EF\u3002</p><p>\u56E0\u4E3A\u6CA1\u8BF4(x,y,z) \u662F\u5728\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]\u91CC\u7684\u4F4D\u7F6E\uFF0C\u8FD8\u662F\u5728\u672C\u5730\u5750\u6807\u7CFB\u662F[O2;i2,j2,k2]\u91CC\u7684\u4F4D\u7F6E\u3002</p><p><code>\u63D0\u95EE 2</code>\uFF1A</p><p>\u70B9 P \u7684\u4E16\u754C\u5750\u6807\u4F4D\u662F(x,y,z)\uFF0C\u53EF\u5426\u627E\u5230\u70B9 P\uFF1F</p><p>\u7B54\uFF1A\u53EF</p><p><code>\u63D0\u95EE 3</code>\uFF1A</p><p>\u70B9 P \u7684\u672C\u5730\u5750\u6807\u4F4D\u662F(x,y,z)\uFF0C\u53EF\u5426\u627E\u5230\u70B9 P\uFF1F\u82E5\u53EF\u4EE5\uFF0C\u6C42\u70B9 P \u7684\u4E16\u754C\u4F4D\u3002</p><p>\u7B54\uFF1A\u53EF</p><p><code>\u89E3</code>\uFF1A</p><p>\u6839\u636E\u7A7A\u95F4\u5411\u91CF\u5206\u89E3\u5B9A\u7406\u3002</p><p>\u7531\u4E16\u754C\u5750\u6807\u7CFB[O1;i1,j1,k1]\u53EF\u89E3\u6790\u51FA\u56DB\u7EF4\u77E9\u9635 m1\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	i1.x, j1.x, k1.x, 0,
	i1.y, j1.y, k1.y, 0,
	i1.z, j1.z, k1.z, 0,
	O1.x, O1.y, O1.z, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u540C\u7406\uFF0C\u7531\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u53EF\u89E3\u6790\u51FA\u56DB\u7EF4\u77E9\u9635 m2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	i2.x, j2.x, k2.x, 0,
	i2.y, j2.y, k2.y, 0,
	i2.z, j2.z, k2.z, 0,
	O2.x, O2.y, O2.z, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u70B9 P \u7684\u4E16\u754C\u4F4D\u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="\u4E5D\u3001\u6DF1\u5165\u8BA4\u77E5\u4E09\u7EF4\u4E16\u754C" tabindex="-1"><a class="header-anchor" href="#\u4E5D\u3001\u6DF1\u5165\u8BA4\u77E5\u4E09\u7EF4\u4E16\u754C" aria-hidden="true">#</a> \u4E5D\u3001\u6DF1\u5165\u8BA4\u77E5\u4E09\u7EF4\u4E16\u754C</h2><h3 id="_1-\u7528\u4F4D\u79FB\u77E9\u9635\u505A\u5B9E\u9A8C" tabindex="-1"><a class="header-anchor" href="#_1-\u7528\u4F4D\u79FB\u77E9\u9635\u505A\u5B9E\u9A8C" aria-hidden="true">#</a> 1.\u7528\u4F4D\u79FB\u77E9\u9635\u505A\u5B9E\u9A8C</h3><h4 id="_1-1\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_1-1\u793A\u4F8B" aria-hidden="true">#</a> 1.1\u793A\u4F8B</h4><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u5B87\u5B99 universe</li><li>\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O1;i1,j1,k1] <ul><li>O1(0,0,0)</li><li>i1(1,0,0)</li><li>j1(0,1,0)</li><li>k1(0,0,1)</li></ul></li><li>\u5B87\u5B99\u5305\u542B\u4E07\u7269\uFF0C\u5176\u672C\u5730\u5750\u6807\u7CFB\u5C31\u662F\u4E07\u7269\u7684\u4E16\u754C\u5750\u6807\u7CFB</li><li>\u94F6\u6CB3\u7CFB galaxy</li><li>\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O2;i2,j2,k2] <ul><li>O2(1,2,3)</li><li>i2(1,0,0)</li><li>j2(0,1,0)</li><li>k2(0,0,1)</li></ul></li><li>\u592A\u9633 sun</li><li>\u592A\u9633\u5728\u94F6\u6CB3\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D\u662F P2(4,5,6)</li><li>\u592A\u9633 \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</li></ul><p>\u6C42\uFF1A\u592A\u9633\u7684\u4E16\u754C\u4F4D P1</p><p><code>\u89E3</code>\uFF1A</p><p>\u7531\u5B87\u5B99\u5750\u6807\u7CFB[O1;i1,j1,k1]\u89E3\u77E9\u9635 m1\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, 0,
	0, 1, 0, 0,
	0, 0, 1, 0,
	0, 0, 0, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u94F6\u6CB3\u7CFB[O2;i2,j2,k2]\u89E3\u77E9\u9635 m2:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, 0,
	0, 1, 0, 0,
	0, 0, 1, 0,
	1, 2, 3, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u70B9 P \u7684\u4E16\u754C\u5750\u6807\u4F4D\u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-2\u7528-three-js-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_1-2\u7528-three-js-\u9A8C\u8BC1" aria-hidden="true">#</a> 1.2\u7528 three.js \u9A8C\u8BC1</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">import</span> <span class="token punctuation">{</span> 
    Group<span class="token punctuation">,</span> 
    Matrix4<span class="token punctuation">,</span> 
    Object3D<span class="token punctuation">,</span> 
    Scene<span class="token punctuation">,</span> 
    Vector3 
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span>

  <span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
  <span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  m1<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>

  <span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
  <span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  m2<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>

  <span class="token comment">//\u592A\u9633\u5728\u94F6\u6CB3\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D</span>
  <span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>

  <span class="token comment">//\u521B\u9020\u5B87\u5B99</span>
  <span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span>

  <span class="token comment">//\u521B\u9020\u94F6\u6CB3\u7CFB</span>
  <span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span>

  <span class="token comment">//\u521B\u9020\u592A\u9633</span>
  <span class="token keyword">const</span> sun <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  sun<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P2</span><span class="token punctuation">)</span>

  <span class="token comment">//\u94F6\u6CB3\u7CFB\u5305\u542B\u592A\u9633</span>
  galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sun<span class="token punctuation">)</span>

  <span class="token comment">//\u5B87\u5B99\u5305\u542B\u94F6\u6CB3\u7CFB</span>
  universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span>

  <span class="token comment">//\u6C42\u592A\u9633\u5728\u5B87\u5B99\u4E2D\u7684\u4E16\u754C\u4F4D</span>
  <span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  sun<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span>  <span class="token comment">// {x: 5, y: 7, z: 9}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></details><h3 id="_2-\u4F4D\u79FB\u6CD5\u5219" tabindex="-1"><a class="header-anchor" href="#_2-\u4F4D\u79FB\u6CD5\u5219" aria-hidden="true">#</a> 2.\u4F4D\u79FB\u6CD5\u5219</h3><p>\u82E5\u4E0D\u60F3\u6C42\u592A\u9633\u7684\u4F4D\u7F6E\uFF0C\u60F3\u6C42\u592A\u9633\u7CFB\u5185\u7684\u5730\u7403\u7684\u4F4D\u7F6E\uFF0C\u662F\u5426\u8FD8\u53EF\u6309\u7167\u4E4B\u524D\u7684\u601D\u8DEF\u6765\u6C42\u89E3\uFF1F\u7B54\u6848\u662F\u80AF\u5B9A\u7684\u3002</p><h4 id="_2-1\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_2-1\u793A\u4F8B" aria-hidden="true">#</a> 2.1\u793A\u4F8B</h4><p>\u8C03\u6574\u4E00\u4E0B\u4E4B\u524D\u7684\u5DF2\u77E5\u6761\u4EF6\u3002</p><ul><li><p>\u628A\u592A\u9633\u6539\u6210\u592A\u9633\u7CFB solar</p></li><li><p>\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F[O3;i3,j3,k3]</p><ul><li>O3(4,5,6)</li><li>i3(1,0,0)</li><li>j3(0,1,0)</li><li>k3(0,0,1)</li></ul></li><li><p>\u5730\u7403 earth</p></li><li><p>\u5730\u7403\u5728\u592A\u9633\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D\u662F P3(7,8,9)</p></li><li><p>\u5730\u7403 \u2208 \u592A\u9633\u7CFB \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</p></li></ul><p>\u6C42\uFF1A\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1</p><p><code>\u89E3</code>\uFF1A</p><p>\u7531\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, 0,
    4, 5, 6, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6C42\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-2\u7528-three-js\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_2-2\u7528-three-js\u9A8C\u8BC1" aria-hidden="true">#</a> 2.2\u7528 three.js\u9A8C\u8BC1</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> 
  Group<span class="token punctuation">,</span> 
  Matrix4<span class="token punctuation">,</span> 
  Object3D<span class="token punctuation">,</span> 
  Scene<span class="token punctuation">,</span> 
  Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m1<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m2<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m3<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u4F4D-\u5730\u7403</span>
<span class="token keyword">const</span> <span class="token constant">P3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>

<span class="token comment">//\u5B87\u5B99(\u4E16\u754C\u5750\u6807\u7CFB\u662F\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB)</span>
<span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span>

<span class="token comment">//\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span>

<span class="token comment">//\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> solar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
solar<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span>

<span class="token comment">//\u5730\u7403</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
earth<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P3</span><span class="token punctuation">)</span>

<span class="token comment">//\u5305\u542B\u5173\u7CFB</span>
solar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span>
galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solar<span class="token punctuation">)</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span>

<span class="token comment">//\u70B9P\u7684\u4E16\u754C\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
earth<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//{x: 12, y: 15, z: 18}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div></details><h4 id="_2-3\u63A8\u7406" tabindex="-1"><a class="header-anchor" href="#_2-3\u63A8\u7406" aria-hidden="true">#</a> 2.3\u63A8\u7406</h4><p>\u53EF\u4EE5\u4ECE\u4E0A\u9762\u7684\u7ED3\u8BBA\u4E2D\u5F97\u5230\u4E00\u4E2A\u89C4\u5F8B\uFF1A</p><p>\u5F53\u4E00\u70B9 P \u548C\u5B87\u5B99\u4E4B\u95F4\u5B58\u5728 n \u5C42\u5D4C\u5957<br> \u70B9 P \u7684\u672C\u5730\u5750\u6807\u4F4D\u662F Pn<br> \u7B2C n \u5C42\u4E16\u754C\u7684\u672C\u5730\u5750\u6807\u7CFB\u6240\u5BF9\u5E94\u7684\u77E9\u9635\u662F mn<br> \u5219\u70B9 P \u7684\u4E16\u754C\u4F4D P1 \u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> \u2026\u2026 <span class="token operator">*</span> mn <span class="token operator">*</span> pn
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E0A\u9762\u7684\u516C\u5F0F\uFF0C\u5C31\u6682\u4E14\u53EB\u5B83\u201C<strong>\u672C\u5730\u5750\u6807\u8F6C\u4E16\u754C\u5750\u6807\u516C\u5F0F</strong>\u201D\u3002</p><h3 id="_3-\u7F29\u653E\u6CD5\u5219" tabindex="-1"><a class="header-anchor" href="#_3-\u7F29\u653E\u6CD5\u5219" aria-hidden="true">#</a> 3.\u7F29\u653E\u6CD5\u5219</h3><h4 id="_3-1\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-1\u793A\u4F8B" aria-hidden="true">#</a> 3.1\u793A\u4F8B</h4><p>\u4FEE\u6539\u4E4B\u524D\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li><p>\u5728\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u4E2D\uFF0C\u8BA9 j2 \u662F\u5355\u4F4D\u5411\u91CF\u7684 2 \u500D\uFF1A</p><ul><li>O2(1, 2, 3)</li><li>i2(1, 0, 0)</li><li>j2(0, 2, 0)</li><li>k2(0, 0, 1)</li></ul></li><li><p>\u5728\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O3;i3,j3,k3]\uFF0C\u8BA9 k3 \u662F\u5355\u4F4D\u5411\u91CF\u7684 3 \u500D\uFF1A</p><ul><li>O3(4, 5, 6)</li><li>i3(1, 0, 0)</li><li>j3(0, 1, 0)</li><li>k3(0, 0, 3)</li></ul></li></ul><p>\u6C42\uFF1A\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1</p><p><code>\u89E3</code>\uFF1A</p><p>\u7531\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
   1, 0, 0, 0,
   0, 2, 0, 0,
   0, 0, 1, 0,
   1, 2, 3, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
   1, 0, 0, 0,
   0, 1, 0, 0,
   0, 0, 3, 0,
   4, 5, 6, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6C42\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3 <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span>
    <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span>
    <span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">5</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">]</span>
m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3<span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
<span class="token constant">P1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token constant">P1</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-2\u7528-three-js\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_3-2\u7528-three-js\u9A8C\u8BC1" aria-hidden="true">#</a> 3.2\u7528 three.js\u9A8C\u8BC1</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> 
  Group<span class="token punctuation">,</span> 
  Matrix4<span class="token punctuation">,</span> 
  Object3D<span class="token punctuation">,</span> 
  Scene<span class="token punctuation">,</span> 
  Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m1<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m2<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m3<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment">//\u5730\u7403\u5728\u592A\u9633\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>

<span class="token comment">//\u521B\u9020\u5B87\u5B99</span>
<span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span>

<span class="token comment">//\u521B\u9020\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span>

<span class="token comment">//\u521B\u9020\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> solar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
solar<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span>

<span class="token comment">//\u521B\u9020\u5730\u7403</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
earth<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P3</span><span class="token punctuation">)</span>

<span class="token comment">//\u592A\u9633\u7CFB\u5305\u542B\u5730\u7403</span>
solar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span>

<span class="token comment">//\u94F6\u6CB3\u7CFB\u5305\u542B\u592A\u9633</span>
galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solar<span class="token punctuation">)</span>

<span class="token comment">//\u5B87\u5B99\u5305\u542B\u94F6\u6CB3\u7CFB</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span>

<span class="token comment">//\u6C42\u592A\u9633\u5728\u5B87\u5B99\u4E2D\u7684\u4E16\u754C\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
earth<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// {x: 12, y: 28, z: 36}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div></details><h3 id="_4-\u65CB\u8F6C\u6CD5\u5219" tabindex="-1"><a class="header-anchor" href="#_4-\u65CB\u8F6C\u6CD5\u5219" aria-hidden="true">#</a> 4.\u65CB\u8F6C\u6CD5\u5219</h3><h4 id="_4-1\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_4-1\u793A\u4F8B" aria-hidden="true">#</a> 4.1\u793A\u4F8B</h4><p>\u4FEE\u6539\u4E4B\u524D\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li><p>\u8BA9\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u7ED5 j2 \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 20\xB0\u3002</p><p>\u8BBE\uFF1Ac2 = cos(-20\xB0)\uFF0Cs2 = sin(-20\xB0)</p><p>\u5219\uFF1A</p><ul><li>O2(1, 2, 3)</li><li>i2(c2, 0, -s2)</li><li>j2(0, 1, 0)</li><li>k2(s2, 0, c2)</li></ul></li><li><p>\u8BA9\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O3;i3,j3,k3]\u7ED5 k3 \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 30\xB0</p><p>\u8BBE\uFF1Ac3 = cos(30\xB0)\uFF0Cs3 = sin(30\xB0)</p><p>\u5219\uFF1A</p><ul><li>O3(4, 5, 6)</li><li>i3(c3, -s3, 0)</li><li>j3(s3, c3, 0)</li><li>k3(0, 0, 1)</li></ul></li></ul><p>\u6C42\uFF1A\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1</p><p><code>\u89E3</code>\uFF1A</p><p>\u7531\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m2\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	c2, 0, s2, 0,
    0,  1, 0,  0,
    -s2,0, c2, 0,
    1,  2, 3,  1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7531\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB\u53EF\u5F97\u77E9\u9635 m3\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	c3,  s3, 0, 0,
    -s3, c3, 0, 0,
    0,   0,  1, 0,
    4,   5,  6, 1
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6C42\u5730\u7403\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P1</span> <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3 <span class="token operator">=</span> <span class="token punctuation">[</span>
    c2<span class="token operator">*</span>c3<span class="token punctuation">,</span>      s3<span class="token punctuation">,</span>   s2<span class="token operator">*</span>c3<span class="token punctuation">,</span>      <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>c2<span class="token operator">*</span>s3<span class="token punctuation">,</span>     c3<span class="token punctuation">,</span>   <span class="token operator">-</span>s2<span class="token operator">*</span>s3<span class="token punctuation">,</span>     <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>s2<span class="token punctuation">,</span>        <span class="token number">0</span><span class="token punctuation">,</span>    c2<span class="token punctuation">,</span>         <span class="token number">0</span><span class="token punctuation">,</span>
    c2<span class="token operator">*</span><span class="token number">4</span><span class="token operator">-</span>s2<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">,</span>s2<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>c2<span class="token operator">*</span><span class="token number">6</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">]</span>
<span class="token constant">P1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">11.826885919330648</span><span class="token punctuation">,</span> <span class="token number">17.428203230275507</span><span class="token punctuation">,</span> <span class="token number">15.02200238270646</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u6CE8\u610F\uFF0C\u4E0A\u5F0F\u5F88\u96BE\u50CF\u4E4B\u524D\u90A3\u6837\u5FC3\u7B97\uFF0C\u53EF\u4EE5\u76F4\u63A5\u7528\u8BA1\u7B97\u673A\u7B97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u8BA9\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O2;i2,j2,k2]\u7ED5j2\u8F74\u9006\u65F6\u9488\u65CB\u8F6C20\xB0</span>
<span class="token keyword">const</span> ang2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">20</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token keyword">const</span> c2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ang2<span class="token punctuation">)</span>
<span class="token keyword">const</span> s2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang2<span class="token punctuation">)</span>

<span class="token comment">//\u8BA9\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB[O3;i3,j3,k3]\u7ED5k3\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token keyword">const</span> ang3 <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token keyword">const</span> c3 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ang3<span class="token punctuation">)</span>
<span class="token keyword">const</span> s3 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang3<span class="token punctuation">)</span>

<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
    c2 <span class="token operator">*</span> c3<span class="token punctuation">,</span> s3<span class="token punctuation">,</span> s2 <span class="token operator">*</span> c3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>c2 <span class="token operator">*</span> s3<span class="token punctuation">,</span> c3<span class="token punctuation">,</span> <span class="token operator">-</span>s2 <span class="token operator">*</span> s3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>s2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    c2 <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">-</span> s2 <span class="token operator">*</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> s2 <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> c2 <span class="token operator">*</span> <span class="token number">6</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token constant">P3</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span>
<span class="token comment">// {x: 11.826885919330648, y: 17.428203230275507, z: 15.02200238270646}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-2\u7528-three-js-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_4-2\u7528-three-js-\u9A8C\u8BC1" aria-hidden="true">#</a> 4.2\u7528 three.js \u9A8C\u8BC1</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Group<span class="token punctuation">,</span>
  Matrix4<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  Scene<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//\u4E16\u754C\u5750\u6807\u7CFB-\u5B87\u5B99</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m1<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> ang2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m2<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>ang2<span class="token punctuation">)</span><span class="token punctuation">;</span>
m2<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m2<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u672C\u5730\u5750\u6807\u7CFB-\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> ang3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m3<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>ang3<span class="token punctuation">)</span><span class="token punctuation">;</span>
m3<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5730\u7403\u5728\u592A\u9633\u7CFB\u5185\u7684\u672C\u5730\u5750\u6807\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P3</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u5B87\u5B99</span>
<span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> solar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
solar<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u521B\u9020\u5730\u7403</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
earth<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u592A\u9633\u7CFB\u5305\u542B\u5730\u7403</span>
solar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u94F6\u6CB3\u7CFB\u5305\u542B\u592A\u9633</span>
galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solar<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5B87\u5B99\u5305\u542B\u94F6\u6CB3\u7CFB</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6C42\u592A\u9633\u5728\u5B87\u5B99\u4E2D\u7684\u4E16\u754C\u4F4D</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
earth<span class="token punctuation">.</span><span class="token function">getWorldPosition</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">)</span>
<span class="token comment">// {x: 11.826885919330648, y: 17.428203230275507, z: 15.02200238270646}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div></details><h2 id="\u5341\u3001\u65CB\u8F6C\u6CD5\u5219\u6DF1\u5EA6\u63A2\u7D22" tabindex="-1"><a class="header-anchor" href="#\u5341\u3001\u65CB\u8F6C\u6CD5\u5219\u6DF1\u5EA6\u63A2\u7D22" aria-hidden="true">#</a> \u5341\u3001\u65CB\u8F6C\u6CD5\u5219\u6DF1\u5EA6\u63A2\u7D22</h2><p>\u7269\u4F53\u65CB\u8F6C\u7684\u590D\u6742\u7A0B\u5EA6\u662F\u4F4D\u79FB\u548C\u7F29\u653E\u7684 n \u591A\u500D\u3002<br> \u4EE5\u524D\u5728\u65CB\u8F6C\u7269\u4F53\u65F6\uFF0C\u53EA\u662F\u8BA9\u5176\u7ED5\u5750\u6807\u8F74 x|y|z \u65CB\u8F6C\u3002<br> \u7136\u800C\uFF0C\u5728\u5B9E\u9645\u9879\u76EE\u5F00\u53D1\u4E2D\uFF0C\u4F1A\u6709\u5176\u5B83\u7684\u65CB\u8F6C\u9700\u6C42\u3002</p><p>\u6BD4\u5982\uFF1A</p><ul><li><p>\u6B27\u62C9 Euler\uFF1A\u8BA9\u7269\u4F53\u57FA\u4E8E\u4E16\u754C\u5750\u6807\u7CFB\u7ED5 x \u8F74\u65CB\u8F6C a\xB0\uFF0C\u7136\u540E\u7ED5\u672C\u5730\u5750\u6807\u7CFB y \u8F74\u65CB\u8F6C b\xB0\uFF0C\u6700\u540E\u7ED5\u672C\u5730\u5750\u6807\u7CFB z \u8F74\u65CB\u8F6C c\xB0\u3002</p></li><li><p>\u56DB\u5143\u6570 Quaternion\uFF1A\u8BA9\u7269\u4F53\u7ED5\u4EFB\u610F\u4E00\u8F74\u65CB\u8F6C a\xB0\u3002</p></li></ul><h3 id="_1-\u9876\u70B9\u7ED5\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_1-\u9876\u70B9\u7ED5\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C" aria-hidden="true">#</a> 1.\u9876\u70B9\u7ED5\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C</h3><p><img src="`+bs+`" alt=""></p><p>\u5728\u53F3\u624B\u5750\u6807\u7CFB\u7684\u9006\u65F6\u9488\u65CB\u8F6C\u91CC\uFF0C\u7ED5 y \u8F74\u7684\u9006\u65F6\u9488\u65CB\u8F6C\u6709\u70B9\u7279\u522B\u3002</p><p>\u7ED5 y \u8F74\u65CB\u8F6C\u65F6\uFF0Cx \u8F74\u6B63\u534A\u8F74\u662F\u8D77\u59CB\u8F74\uFF0C\u5373 x \u8F74\u6B63\u534A\u8F74\u7684\u5F27\u5EA6\u4E3A 0\u3002<br> \u4E00\u9876\u70B9\u7ED5 y \u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\uFF0C\u5F27\u5EA6\u503C\u8D8A\u5C0F\u3002</p><p>\u800C\u7ED5\u5176\u5B83\u4E24\u4E2A\u8F74\u65CB\u8F6C\u65F6\uFF0C\u5219\u4E0E\u5176\u76F8\u53CD\uFF1A<br> \u4E00\u9876\u70B9\u7ED5 x \u8F74\u6216 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u65F6\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\uFF0C\u5F27\u5EA6\u503C\u8D8A\u5927\u3002</p><p>\u6240\u4EE5\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB [O2;i2,j2,k2] \u7ED5 j2 \u8F74\u9006\u65F6\u9488\u65CB\u8F6C 20\xB0 \u65F6\uFF0C\u662F\u901A\u8FC7-20\xB0 \u53D6\u7684 sin \u503C\u548C cos \u503C\u3002</p><details class="custom-container details"><summary>three.js\u9A8C\u8BC1</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ang <span class="token operator">=</span> <span class="token number">30</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token comment">//three.js\u56DB\u7EF4\u77E9\u9635\u5BF9\u8C61</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//\u7ED5x\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token punctuation">{</span>
    <span class="token comment">//three.js \u65CB\u8F6C</span>
    m<span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>m<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u624B\u52A8\u65CB\u8F6C</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    <span class="token keyword">const</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u7ED5y\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token punctuation">{</span>
    <span class="token comment">//three.js \u65CB\u8F6C</span>
    m<span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>m<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u624B\u52A8\u65CB\u8F6C</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span>ang<span class="token punctuation">)</span>
    <span class="token keyword">const</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span>ang<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u7ED5z\u8F74\u9006\u65F6\u9488\u65CB\u8F6C30\xB0</span>
<span class="token punctuation">{</span>
    <span class="token comment">//three.js \u65CB\u8F6C</span>
    m<span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>m<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u624B\u52A8\u65CB\u8F6C</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    <span class="token keyword">const</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div></details><h3 id="_2-\u6B27\u62C9\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-\u6B27\u62C9\u65CB\u8F6C" aria-hidden="true">#</a> 2.\u6B27\u62C9\u65CB\u8F6C</h3><p>\u6B27\u62C9\u65CB\u8F6C\u5C31\u662F\u7ED5\u5355\u8F74\u591A\u6B21\u9006\u65F6\u9488\u65CB\u8F6C\uFF0C\u7B2C\u4E00\u6B21\u662F\u7ED5\u4E16\u754C\u5750\u6807\u7CFB\u7684\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\uFF0C\u4E4B\u540E\u5219\u662F\u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684\u5355\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u3002</p><h4 id="_2-1\u793A\u4F8B-1" tabindex="-1"><a class="header-anchor" href="#_2-1\u793A\u4F8B-1" aria-hidden="true">#</a> 2.1\u793A\u4F8B</h4><p><code>\u5DF2\u77E5</code>\uFF1A</p><p>\u4E16\u754C\u5750\u6807\u7CFB m1<br> \u70B9 P \u5728\u4E16\u754C\u5750\u6807\u7CFB\u5185<br> \u70B9 P \u7684\u4E16\u754C\u5750\u6807\u4F4D P1(x, y, z)</p><p><code>\u6C42</code>\uFF1A</p><p>\u70B9 P \u7ED5\u4E16\u754C\u5750\u6807\u7CFB\u7684 x \u8F74\u9006\u65F6\u9488\u65CB\u8F6C angX \u5EA6\uFF0C<br> \u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684 y \u8F74\u9006\u65F6\u9488\u65CB\u8F6C angY \u5EA6\uFF0C<br> \u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684 z \u8F74\u9006\u65F6\u9488\u65CB\u8F6C angZ \u5EA6\u540E\u7684\u4E16\u754C\u4F4D P2\u3002</p><p><code>\u89E3</code>\uFF1A</p><p>\u5206\u522B\u57FA\u4E8E angX, angY, angZ \u5EFA\u7ACB\u4E09\u4E2A\u77E9\u9635 mx,my,mz<br> \u70B9 P \u7684\u4E16\u754C\u4F4D\u662F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P2</span> <span class="token operator">=</span> mx <span class="token operator">*</span> my <span class="token operator">*</span> mz <span class="token operator">*</span> <span class="token constant">P1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_2-3\u7528-three-js-\u9A8C\u8BC1" tabindex="-1"><a class="header-anchor" href="#_2-3\u7528-three-js-\u9A8C\u8BC1" aria-hidden="true">#</a> 2.3\u7528 three.js \u9A8C\u8BC1</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Group<span class="token punctuation">,</span>
  Matrix4<span class="token punctuation">,</span>
  Object3D<span class="token punctuation">,</span>
  Scene<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Euler<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>angX<span class="token punctuation">,</span> angY<span class="token punctuation">,</span> angZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">P1</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7528\u77E9\u9635\u4E58\u6CD5\u5B9E\u73B0\u9876\u70B9\u7ED5\u5355\u8F74\u591A\u6B21\u9006\u65F6\u9488\u65CB\u8F6C</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span>angX<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span>angY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>angZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//P2=mx*my*mz*P1</span>
  <span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u7528\u6B27\u62C9\u5B9E\u73B0\u9876\u70B9\u7ED5\u5355\u8F74\u591A\u6B21\u9006\u65F6\u9488\u65CB\u8F6C</span>
<span class="token punctuation">{</span>
  <span class="token keyword">const</span> euler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Euler</span><span class="token punctuation">(</span>angX<span class="token punctuation">,</span> angY<span class="token punctuation">,</span> angZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m<span class="token punctuation">.</span><span class="token function">makeRotationFromEuler</span><span class="token punctuation">(</span>euler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>\u4E0A\u9762 P2 \u7684\u4E24\u4E2A\u8F93\u51FA\u7ED3\u679C\u90FD\u662F\u4E00\u6837\u7684\u3002</p><h4 id="_2-4\u8BB2\u4E2A\u6545\u4E8B\u7406\u89E3\u6B27\u62C9" tabindex="-1"><a class="header-anchor" href="#_2-4\u8BB2\u4E2A\u6545\u4E8B\u7406\u89E3\u6B27\u62C9" aria-hidden="true">#</a> 2.4\u8BB2\u4E2A\u6545\u4E8B\u7406\u89E3\u6B27\u62C9</h4><p>\u901A\u8FC7\u4E4B\u524D\u7684\u4EE3\u7801\uFF0C\u53EF\u4EE5\u53D1\u73B0\u6B27\u62C9\u65CB\u8F6C\u548C\u4E4B\u524D\u8BF4\u8FC7\u7684\u4E16\u754C\u5750\u6807\u7CFB\u3001\u672C\u5730\u5750\u6807\u7CFB\u7684\u547C\u5E94\u89C4\u5F8B\u3002</p><p>\u53EF\u4EE5\u5373\u6B64\u7F16\u4E00\u4E2A\u5173\u4E8E\u738B\u8005\u8363\u8000\u6545\u4E8B\uFF1A</p><ul><li>\u5B87\u5B99\uFF0C\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB\u662F\u4E07\u7269\u7684\u4E16\u754C\u5750\u6807\u7CFB\uFF0C\u6B64\u5750\u6807\u7CFB\u4E3A\u5355\u4F4D\u77E9\u9635</li><li>mx\uFF1A\u94F6\u6CB3\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB</li><li>my\uFF1A\u592A\u9633\u7CFB\u7684\u672C\u5730\u5750\u6807\u7CFB</li><li>mz\uFF1A\u51E1\u95F4\u754C\u7684\u672C\u5730\u5750\u6807\u7CFB</li><li>P1\uFF1A\u7476\u5728\u6B27\u62C9\u65CB\u8F6C\u524D\u7684\u4E16\u754C\u4F4D</li><li>\u5B87\u5B99 \u220B \u94F6\u6CB3\u7CFB \u220B \u592A\u9633\u7CFB \u220B \u51E1\u95F4\u754C \u220B \u7476</li></ul><p>\u6C42\uFF1A\u7476\u6B27\u62C9\u65CB\u8F6C(angX,angY,angZ) \u540E\u7684\u4E16\u754C\u4F4D P2\uFF0C\u65CB\u8F6C\u987A\u5E8F\u4E3A xyz</p><p><code>\u89E3</code>\uFF1A</p><ol><li><p>\u8BA9\u7476\u5760\u843D\u51E1\u95F4\u754C\u3002</p><p>\u5F53\u524D\u5B87\u5B99\u4E07\u754C\u7684\u672C\u5730\u5750\u6807\u7CFB\u90FD\u662F\u5355\u4F4D\u77E9\u9635\uFF0C\u6240\u4EE5\u7476\u7684\u4E16\u754C\u5750\u6807\u4F4D P1\uFF0C\u4E5F\u662F\u7476\u5728\u4E07\u754C\u4E2D\u7684\u672C\u5730\u5750\u6807\u4F4D\u3002</p><p>\u4E0B\u9762\u7684 P1 \u4E5F\u5C31\u53EF\u4EE5\u7406\u89E3\u4E3A\u7476\u5728\u51E1\u95F4\u754C\u7684\u672C\u5730\u5750\u6807\u4F4D\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const P1 = new Vector3(1, 1, 1)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>\u5C06\u94F6\u6CB3\u7CFB\u3001\u592A\u9633\u7CFB\u3001\u51E1\u95F4\u754C\u5206\u522B\u6CBF x \u8F74\u3001y \u8F74\u3001z \u8F74\u65CB\u8F6C angX\u3001angY\u3001angZ \u5EA6\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const mx = new Matrix4().makeRotationX(angX)
const my = new Matrix4().makeRotationY(angY)
const mz = new Matrix4().makeRotationZ(angZ)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>\u8BA9\u7476\u8DF3\u51FA\u4E09\u754C\u4E4B\u5916\uFF0C\u6C42\u5176\u4E16\u754C\u4F4D</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//P2=mx*my*mz*P1</span>
<span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><h3 id="_3-\u56DB\u5143\u6570" tabindex="-1"><a class="header-anchor" href="#_3-\u56DB\u5143\u6570" aria-hidden="true">#</a> 3.\u56DB\u5143\u6570</h3><p>\u56DB\u5143\u6570 Quaternion\uFF1A\u8BA9\u7269\u4F53\u7ED5\u4EFB\u610F\u8F74\u65CB\u8F6C a\xB0\u3002</p><p><img src="`+ms+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u8F74 OC2</li><li>\u5F27\u5EA6 ang</li><li>\u70B9 P1(x,y,z)</li></ul><div class="language-j ext-j line-numbers-mode"><pre class="language-j"><code>const OC2 <span class="token verb keyword">=</span> new Vector3<span class="token punctuation">(</span><span class="token number">3</span><span class="token verb keyword">,</span> <span class="token number">2</span><span class="token verb keyword">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token conjunction variable">.</span>normalize<span class="token punctuation">(</span><span class="token punctuation">)</span>
const ang <span class="token verb keyword">=</span> <span class="token number">2</span>
const P1 <span class="token verb keyword">=</span> new Vector3<span class="token punctuation">(</span><span class="token number">1</span><span class="token verb keyword">,</span> <span class="token number">2</span><span class="token verb keyword">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>\u6C42</code>\uFF1A\u70B9 P1 \u7ED5 OC2 \u9006\u65F6\u9488\u65CB\u8F6C ang \u5EA6\u540E\u7684\u4F4D\u7F6E P2</p><p><code>\u89E3</code>\uFF1A</p><p><code>\u63A5\u4E0B\u6765\u8981\u628A OC2 \u8F6C\u5F97\u4E0E z \u8F74\u540C\u5411</code>\u3002</p><ol><li>\u8BA1\u7B97\u7ED5 x \u8F74\u628A OC2 \u65CB\u8F6C\u5230\u5E73\u9762 Ozx \u4E0A\u7684\u65CB\u8F6C\u77E9\u9635 mx1\u3002</li></ol><p>\u65CB\u8F6C\u7684\u5EA6\u6570\u662F OC2 \u5728\u5E73\u9762 Oyz \u4E0A\u7684\u6B63\u5C04\u5F71 OB2 \u4E0E z \u8F74\u7684\u5939\u89D2\uFF0C\u5373 \u2220B2OB1\u3002</p><p><img src="`+ds+`" alt=""></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">B2OB1</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token constant">OC2</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token constant">OC2</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mx1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span><span class="token constant">B2OB1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>\u987A\u4FBF\u518D\u6C42\u51FA\u7ED5 x \u8F74\u53CD\u5411\u65CB\u8F6C \u2220B2OB1 \u7684\u77E9\u9635 mx2\uFF0C\u4EE5\u5907\u540E\u7528\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mx2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationX</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token constant">B2OB1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>\u57FA\u4E8E\u77E9\u9635 mx1 \u65CB\u8F6C OC2\uFF0C\u65CB\u8F6C\u5230 OC3 \u7684\u4F4D\u7F6E\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//OC3 = m1*OC2</span>
<span class="token keyword">const</span> <span class="token constant">OC3</span> <span class="token operator">=</span> <span class="token constant">OC2</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">OC3</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>\u8BA1\u7B97\u7ED5 y \u8F74\u628A OC3 \u65CB\u8F6C\u5230 z \u8F74\u4E0A\u7684\u65CB\u8F6C\u77E9\u9635 my1\u3002</li></ol><p>\u65CB\u8F6C\u7684\u5EA6\u6570\u662F OC3 \u4E0E z \u8F74\u7684\u5939\u89D2\uFF0C\u5373 \u2220C3OB1\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">C3OB1</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token constant">OC3</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token constant">OC3</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span>
<span class="token keyword">const</span> my1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token constant">C3OB1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u200B \u81F3\u4E8E\u65CB\u8F6C\u540E OC3 \u5728\u54EA\u91CC\uFF0C\u5C31\u4E0D\u91CD\u8981\u4E86\uFF0C\u53EA\u8981\u77E5\u9053\u4E86\u5176\u65CB\u8F6C\u4E86\u591A\u5C11\u5EA6\uFF0C\u4EE5\u53CA\u5176\u6700\u540E\u4F1A\u548C z \u8F74\u540C\u5411\u5C31\u591F\u4E86\u3002</p><ol start="5"><li>\u987A\u4FBF\u518D\u6C42\u51FA\u7ED5 y \u8F74\u53CD\u5411\u65CB\u8F6C \u2220C3OB1 \u7684\u77E9\u9635 my2\uFF0C\u4EE5\u5907\u540E\u7528\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> my2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span><span class="token constant">C3OB1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="6"><li>\u5728 OC2 \u8F6C\u5230 z \u8F74\u4E0A\u7684\u65F6\u5019\uFF0C\u4E5F\u8BA9\u70B9 P1 \u505A\u7B49\u91CF\u7684\u65CB\u8F6C\uFF0C\u5F97 P2 \u70B9</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//P2 =my1*mx1*P1</span>
<span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>my1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="7"><li>\u8BA1\u7B97\u7ED5 z \u8F74\u65CB\u8F6C ang \u5EA6\u7684\u77E9\u9635 mz</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationZ</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="8"><li>\u8BA9\u70B9 P2 \u7ED5 z \u8F74\u65CB\u8F6C ang \u5EA6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="9"><li>\u8BA9\u70B9 P2 \u6309\u7167\u4E4B\u524D OC2 \u7684\u65CB\u8F6C\u91CF\u518D\u9006\u5411\u8F6C\u56DE\u53BB\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>my2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>mx2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E5F\u53EF\u4EE5\u628A\u6240\u6709\u7684\u77E9\u9635\u5408\u4E00\u4E0B\uFF0C\u518D\u4E58\u4EE5 P2</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">P2</span> <span class="token operator">=</span> <span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> mx2<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mz<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>my1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>mx1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">P2</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="10"><li>\u9A8C\u8BC1</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> quaternion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
quaternion<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span><span class="token constant">OC2</span><span class="token punctuation">,</span> ang<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">makeRotationFromQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">P1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u56DB\u5143\u6570\u65CB\u8F6C\u7684<code>\u5B9E\u73B0\u539F\u7406</code>\uFF1A</p><ol><li>\u5C06\u65CB\u8F6C\u8F74\u5E26\u7740\u9876\u70B9\u4E00\u8D77\u65CB\u8F6C\uFF0C\u8BA9\u65CB\u8F6C\u8F74\u4E0E xyz \u4E2D\u7684\u67D0\u4E00\u4E2A\u8F74\u540C\u5411\uFF0C\u6BD4\u5982 z \u8F74\u3002</li><li>\u8BA9\u9876\u70B9\u7ED5 z \u8F74\u65CB\u8F6C\u76F8\u5E94\u7684\u5EA6\u6570\u3002</li><li>\u8BA9\u9876\u70B9\u6309\u7167\u4E4B\u524D\u65CB\u8F6C\u8F74\u7684\u65CB\u8F6C\u91CF\u9006\u5411\u8F6C\u56DE\u53BB\u3002</li></ol><h2 id="\u5341\u4E00\u3001\u6B63\u4EA4\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E00\u3001\u6B63\u4EA4\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> \u5341\u4E00\u3001\u6B63\u4EA4\u6295\u5F71\u77E9\u9635</h2><p>WebGL \u662F\u4E00\u4E2A\u5149\u6805\u5F15\u64CE\uFF0C\u5176\u672C\u8EAB\u5E76\u4E0D\u4F1A\u5B9E\u73B0\u4E09\u7EF4\u6548\u679C\uFF0C\u90A3\u8981\u5728\u5176\u4E2D\u5B9E\u73B0\u4E09\u7EF4\u6548\u679C\u7684\u5173\u952E\u5C31\u5728\u4E8E\u7B97\u6CD5\uFF1A<br><strong><code>\u9876\u70B9\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u4F4D\u7F6E = \u6295\u5F71\u77E9\u9635 * \u89C6\u56FE\u77E9\u9635 * \u6A21\u578B\u77E9\u9635 * \u9876\u70B9\u7684\u521D\u59CB\u70B9\u4F4D</code></strong></p><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u662F\u6295\u5F71\u77E9\u9635\u7684\u4E00\u79CD\uFF0C\u5148\u4ECE\u5B83\u8BF4\u8D77\u3002\u5728\u8BF4\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u4E4B\u524D\uFF0C\u8FD8\u9700\u8981\u5BF9\u88C1\u526A\u7A7A\u95F4\u6709\u4E00\u4E2A\u6E05\u6670\u7684\u8BA4\u77E5\u3002</p><h3 id="_1-\u88C1\u526A\u7A7A\u95F4" tabindex="-1"><a class="header-anchor" href="#_1-\u88C1\u526A\u7A7A\u95F4" aria-hidden="true">#</a> 1.\u88C1\u526A\u7A7A\u95F4</h3><p>\u88C1\u526A\u7A7A\u95F4\uFF08\u5DE6\u624B\u5750\u6807\u7CFB\uFF09\u662F\u7528\u4E8E\u663E\u793A webgl \u56FE\u5F62\u7684\u7A7A\u95F4\uFF0C\u6B64\u7A7A\u95F4\u662F\u4E00\u4E2A\u5BBD\u3001\u9AD8\u3001\u6DF1\u7686\u4E3A 2 \u7684\u76D2\u5B50\u3002\u5176\u5750\u6807\u7CFB\u7684\u539F\u70B9\u5728 canvas \u753B\u5E03\u7684\u4E2D\u5FC3\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><p><img src="`+gs+'" alt=""></p><p>\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF1A</p><ul><li>x \u8F74\u4E0A-1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u5DE6\u8FB9\u754C\uFF0C1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u53F3\u8FB9\u754C</li><li>y \u8F74\u4E0A-1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u4E0B\u8FB9\u754C\uFF0C1 \u7684\u4F4D\u7F6E\u5BF9\u5E94 canvas \u753B\u5E03\u7684\u4E0A\u8FB9\u754C</li><li>y \u8F74\u4E0A-1 \u7684\u4F4D\u7F6E\u671D\u5411\u5C4F\u5E55\u5916\u90E8\uFF0C1 \u7684\u4F4D\u7F6E\u671D\u5411\u5C4F\u5E55\u5185\u90E8\uFF0C\u5982\u4E0B\u56FE\uFF1A</li></ul><p><img src="'+vs+'" alt=""></p><h3 id="_2-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_2-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 2.\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u5B9E\u73B0\u539F\u7406</h3><p><img src="'+b+'" alt=""></p><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635 orthographic projection\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u77E9\u5F62\u533A\u57DF(\u6B63\u4EA4\u76F8\u673A\u7684\u53EF\u89C6\u533A\u57DF)\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7684\u7269\u4F53\u4E0D\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219\u3002</p><p><img src="'+ys+'" alt=""></p><p><code>\u95EE</code>\uFF1A\u8981\u5C06\u4E00\u4E2A\u4EFB\u610F\u5C3A\u5BF8\u7684\u957F\u65B9\u4F53\u585E\u8FDB\u88C1\u526A\u7A7A\u95F4\u91CC\uFF0C\u5206\u51E0\u6B65\uFF1F</p><p><code>\u7B54</code>\uFF1A\u5148\u4F4D\u79FB\uFF0C\u518D\u7F29\u653E</p><p><img src="'+fs+`" alt=""></p><p>\u8BBE\uFF1A\u6B63\u4EA4\u76F8\u673A\u53EF\u89C6\u533A\u57DF\u7684\u4E0A\u3001\u4E0B\u3001\u5DE6\u3001\u53F3\u3001\u524D\u3001\u540E\u7684\u8FB9\u754C\u5206\u522B\u662F t\u3001b\u3001l\u3001r\u3001n\u3001f</p><p>1.\u4F4D\u79FB\u77E9\u9635</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	1, 0, 0, -(r+l)/2,
	0, 1, 0, -(t+b)/2,
	0, 0, 1, -(f+n)/2,
	0, 0, 0, 1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2.\u7F29\u653E\u77E9\u9635</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	2/(r-l), 0,       0,        0,
	0,       2/(t-b), 0,        0,
	0,       0,       2/(f-n), 0,
	0,       0,       0,        1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635 = \u7F29\u653E\u77E9\u9635*\u4F4D\u79FB\u77E9\u9635</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	2/(r-l), 0,       0,        -(r+l)/(r-l),
	0,       2/(t-b), 0,        -(t+b)/(t-b),
	0,       0,       2/(f-n),  -(f+n)/(f-n),
	0,       0,       0,        1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u82E5 n\u3001f \u662F\u4E00\u4E2A\u8DDD\u79BB\u91CF\uFF0C\u800C\u4E0D\u662F\u5728 z \u8F74\u4E0A\u7684\u523B\u5EA6\u503C\uFF0C\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u5728 z \u8F74\u4E0A\u7684\u7F29\u653E\u56E0\u5B50\u9700\u8981\u53D6\u53CD\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[
	2/(r-l), 0,       0,         -(r+l)/(r-l),
	0,       2/(t-b), 0,         -(t+b)/(t-b),
	0,       0,       -2/(f-n),  -(f+n)/(f-n),
	0,       0,       0,         1,
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 3.\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0</h3><p>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u7684\u4EE3\u7801\u5B9E\u73B0\u5F88\u7B80\u5355\uFF0C\u53EF\u4EE5\u76F4\u63A5\u4ECE three.js \u7684 Matrix4 \u5BF9\u8C61\u7684 makeOrthographic() \u65B9\u6CD5\u4E2D\u627E\u5230\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">makeOrthographic</span><span class="token punctuation">(</span> <span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> te <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">;</span>
    <span class="token keyword">const</span> w <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span> right <span class="token operator">-</span> left <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span> top <span class="token operator">-</span> bottom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span> far <span class="token operator">-</span> near <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">(</span> right <span class="token operator">+</span> left <span class="token punctuation">)</span> <span class="token operator">*</span> w<span class="token punctuation">;</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token punctuation">(</span> top <span class="token operator">+</span> bottom <span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">;</span>
    <span class="token keyword">const</span> z <span class="token operator">=</span> <span class="token punctuation">(</span> far <span class="token operator">+</span> near <span class="token punctuation">)</span> <span class="token operator">*</span> p<span class="token punctuation">;</span>

    te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> w<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> x<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> h<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> y<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> p<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> z<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u4EE5\u524D\u5728\u7ED8\u5236 webgl \u56FE\u5F62\u7684\u65F6\u5019\uFF0C\u5B83\u4EEC\u4F1A\u968F canvas \u753B\u5E03\u7684\u5927\u5C0F\u53D1\u751F\u62C9\u4F38\uFF0C\u5BF9\u4E8E\u8FD9\u4E2A\u95EE\u9898\uFF0C\u4FBF\u53EF\u4EE5\u7528\u6295\u5F71\u77E9\u9635\u6765\u89E3\u51B3\u3002</p><h3 id="_4-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u89E3\u51B3-webgl-\u56FE\u5F62\u62C9\u4F38\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_4-\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u89E3\u51B3-webgl-\u56FE\u5F62\u62C9\u4F38\u95EE\u9898" aria-hidden="true">#</a> 4.\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u89E3\u51B3 webgl \u56FE\u5F62\u62C9\u4F38\u95EE\u9898</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    uniform mat4 u_ProjectionMatrix<span class="token punctuation">;</span> <span class="token comment">// \u6B63\u4EA4\u6295\u5F71\u77E9\u9635</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_ProjectionMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7247\u5143\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform vec4 u_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> u_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> 
    Matrix4<span class="token punctuation">,</span> 
    OrthographicCamera 
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u6B63\u4EA4\u6295\u5F71\u77E9\u9635</span>
  <span class="token keyword">const</span> projectionMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u5B9A\u4E49\u76F8\u673A\u4E16\u754C\u9AD8\u5EA6\u5C3A\u5BF8\u7684\u4E00\u534A</span>
  <span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token comment">//\u8BA1\u7B97\u753B\u5E03\u7684\u5BBD\u9AD8\u6BD4</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
  <span class="token comment">//\u57FA\u4E8EhalfH\u548C\u753B\u5E03\u5BBD\u9AD8\u6BD4\u8BA1\u7B97\u76F8\u673A\u4E16\u754C\u5BBD\u5EA6\u5C3A\u5BF8\u7684\u4E00\u534A</span>
  <span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
  <span class="token comment">//\u5B9A\u4E49\u76F8\u673A\u4E16\u754C\u76846\u4E2A\u8FB9\u754C</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span>
  <span class="token punctuation">]</span>
  <span class="token comment">//\u83B7\u53D6\u6B63\u4EA4\u6295\u5F71\u77E9\u9635</span>
  projectionMatrix<span class="token punctuation">.</span><span class="token function">makeOrthographic</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
      <span class="token operator">-</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
      <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform4fv&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ProjectionMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> projectionMatrix<span class="token punctuation">.</span>elements
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    triangle<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div></details><p>\u5229\u7528\u6295\u5F71\u77E9\u9635\u5C06\u73B0\u5B9E\u4E16\u754C\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u540E\uFF0C\u5F80\u5F80\u8FD8\u4F1A\u5BF9\u88C1\u526A\u7A7A\u95F4\u4E2D\u89C6\u56FE\u8FDB\u884C\u4F4D\u79FB\u6216\u65CB\u8F6C\uFF0C\u8FD9\u65F6\u5019\u5C31\u9700\u8981\u89C6\u56FE\u77E9\u9635\u4E86\u3002</p><h2 id="\u5341\u4E8C\u3001\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E8C\u3001\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> \u5341\u4E8C\u3001\u89C6\u56FE\u77E9\u9635</h2><p>\u4E4B\u524D\u5728\u8BF4\u89C6\u56FE\u53D8\u6362\u7684\u65F6\u5019\u8BF4\u8FC7\u89C6\u56FE\u77E9\u9635\uFF0C\u8FD9\u91CC\u5C31\u901A\u8FC7 three.js \u91CC\u7684\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61\uFF0C\u66F4\u52A0\u5F62\u8C61\u7684\u8BA4\u8BC6\u4E00\u4E0B\u89C6\u56FE\u77E9\u9635\u3002</p><h3 id="_1-\u89C6\u56FE\u4F4D\u79FB" tabindex="-1"><a class="header-anchor" href="#_1-\u89C6\u56FE\u4F4D\u79FB" aria-hidden="true">#</a> 1.\u89C6\u56FE\u4F4D\u79FB</h3><p>1.\u57FA\u4E8E\u4E4B\u524D\u7684\u4EE3\u7801\uFF0C\u518D\u7ED8\u5236\u4E00\u4E2A\u4E09\u89D2\u5F62</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
        <span class="token operator">-</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        gl<span class="token punctuation">,</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform4fv&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> color
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">u_ProjectionMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> projectionMatrix<span class="token punctuation">.</span>elements
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>\u8FD9\u662F\u4E00\u524D\u4E00\u540E\u4E24\u4E2A\u4E09\u89D2\u5F62\u3002<br> \u524D\u9762\u7684\u662F\u9EC4\u8272\u4E09\u89D2\u5F62\uFF0C\u6DF1\u5EA6\u4E3A 0.2\uFF1B<br> \u540E\u9762\u7684\u662F\u7EA2\u8272\u4E09\u89D2\u5F62\uFF0C\u6DF1\u5EA6\u4E3A-0.2\uFF0C\u88AB\u524D\u9762\u7684\u4E09\u89D2\u5F62\u6321\u4F4F\u4E86\uFF0C\u6240\u4EE5\u770B\u4E0D\u89C1\u3002</p><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+hs+`" alt=""></p><p>2.\u4ECE three.js \u91CC\u5F15\u5165\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61 OrthographicCamera</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  OrthographicCamera<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>3.\u5EFA\u7ACB\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>4.\u8BBE\u7F6E\u76F8\u673A\u4F4D\u7F6E position</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u8BBE\u7F6E\u5B8C\u76F8\u673A\u4F4D\u7F6E\u540E\uFF0C\u8981\u4F7F\u7528 updateWorldMatrix() \u65B9\u6CD5\u66F4\u65B0\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u3002<br> updateWorldMatrix() \u65B9\u6CD5\u4E3B\u8981\u662F\u8003\u8651\u5230\u4E86\u76F8\u673A\u5B58\u5728\u7236\u7EA7\u7684\u60C5\u51B5\u3002<br> updateWorldMatrix() \u65B9\u6CD5\u4F1A\u628A\u66F4\u65B0\u540E\u7684\u4E16\u754C\u5750\u6807\u7CFB\u5199\u8FDB\u5199\u8FDB\u76F8\u673A\u7684 matrixWorld \u5C5E\u6027\u91CC\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrixWorld<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>5.\u5C06\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635\u548C\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u7684\u9006\u77E9\u9635\u5408\u4E00\u4E0B\uFF0C\u5408\u4E00\u4E2A\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>a.multiplyMatrices(b,c) \u76F8\u5F53\u4E8E\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a <span class="token operator">=</span> b <span class="token operator">*</span> c<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>camera.projectionMatrix \u53EF\u4EE5\u76F4\u63A5\u83B7\u53D6\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635</li><li>matrixWorldInverse \u662F matrixWorld \u7684\u9006\u77E9\u9635\uFF0C\u8FD9\u662F\u56E0\u4E3A\u76F8\u673A\u7684\u79FB\u52A8\u65B9\u5411\u548C\u73B0\u5B9E\u4E2D\u7684\u7269\u4F53\u76F8\u53CD\u3002</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>console.log(camera.matrixWorldInverse);
 <span class="token number">1</span>   <span class="token number">0</span>  <span class="token number">0</span>  <span class="token number">0</span>
 <span class="token number">0</span>   <span class="token number">1</span>  <span class="token number">0</span>  <span class="token number">0</span>
 <span class="token number">0</span>   <span class="token number">0</span>  <span class="token number">1</span>  <span class="token number">0</span>
<span class="token number">-1</span>  <span class="token number">-1</span> <span class="token number">-3</span>  <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>7.\u628A\u4E4B\u524D\u7684 projectionMatrix \u6539\u6210 pvMatrix</p><ul><li>\u9876\u70B9\u7740\u8272\u5668</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>js \u4EE3\u7801</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="\u6269\u5C55-matrixworld-\u8BE6\u89E3" tabindex="-1"><a class="header-anchor" href="#\u6269\u5C55-matrixworld-\u8BE6\u89E3" aria-hidden="true">#</a> \u6269\u5C55-matrixWorld \u8BE6\u89E3</h3><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li><p>\u5B87\u5B99 universe</p><ul><li>\u672C\u5730\u5750\u6807\u7CFB\u662F m1</li><li>m1 \u4E5F\u662F\u5B87\u5B99\u4E07\u754C\u7684\u4E16\u754C\u5750\u6807\u7CFB</li></ul></li><li><p>\u94F6\u6CB3\u7CFB galaxy</p><ul><li>\u672C\u5730\u5750\u6807\u7CFB\u662F m2</li></ul></li><li><p>\u592A\u9633\u7CFB solar</p><ul><li>\u672C\u5730\u5750\u6807\u7CFB\u662F m3</li></ul></li><li><p>\u592A\u9633\u7CFB \u2208 \u94F6\u6CB3\u7CFB \u2208 \u5B87\u5B99</p></li></ul><p>\u6C42\uFF1A\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB matrixWorld</p><p><code>\u89E3</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>matrixWorld <span class="token operator">=</span> m1 <span class="token operator">*</span> m2 <span class="token operator">*</span> m3<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7B54\u6848\u5C31\u8FD9\u4E48\u7B80\u5355\uFF0C\u62FF\u4EE3\u7801\u6D4B\u4E00\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u5B87\u5B99(\u4E16\u754C\u5750\u6807\u7CFB\u662F\u5B87\u5B99\u7684\u672C\u5730\u5750\u6807\u7CFB)</span>
<span class="token keyword">const</span> universe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u94F6\u6CB3\u7CFB</span>
<span class="token keyword">const</span> galaxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u592A\u9633\u7CFB</span>
<span class="token keyword">const</span> solar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
solar<span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5730\u7403</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
earth<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token constant">P3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5305\u542B\u5173\u7CFB</span>
solar<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>earth<span class="token punctuation">)</span><span class="token punctuation">;</span>
galaxy<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>solar<span class="token punctuation">)</span><span class="token punctuation">;</span>
universe<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>galaxy<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u66F4\u65B0\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB</span>
solar<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>solar<span class="token punctuation">.</span>matrixWorld<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u624B\u52A8\u8BA1\u7B97\u592A\u9633\u7CFB\u7684\u4E16\u754C\u5750\u6807\u7CFB</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">...</span>m1<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="\u6269\u5C55-\u9006\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u6269\u5C55-\u9006\u77E9\u9635" aria-hidden="true">#</a> \u6269\u5C55-\u9006\u77E9\u9635</h3><p>\u4E4B\u524D\u5728\u8BF4 matrixWorldInverse \u7684\u65F6\u5019\u8BF4\u8FC7\uFF0C\u5B83\u662F matrixWorld \u7684\u9006\u77E9\u9635\u3002<br> \u9006\u77E9\u9635\u5728\u56FE\u5F62\u9879\u76EE\u7684\u5E94\u7528\u5F88\u5E7F\uFF0C\u6240\u4EE5\u63A5\u4E0B\u6765\u5C31\u7CFB\u7EDF\u8BF4\u4E00\u4E0B\u9006\u77E9\u9635\u7684\u6982\u5FF5\u3002</p><h4 id="_1-\u9006\u77E9\u9635\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u9006\u77E9\u9635\u7684\u6982\u5FF5" aria-hidden="true">#</a> 1.\u9006\u77E9\u9635\u7684\u6982\u5FF5</h4><p>\u9006\u77E9\u9635\u5C31\u597D\u6BD4\u5B66\u4E60\u9664\u6CD5\u7684\u65F6\u5019\uFF0C\u4E00\u4E2A\u5B9E\u6570\u7684\u5012\u6570\u3002</p><p><code>\u5982</code>\uFF1A</p><p>2 \u7684\u5012\u6570\u662F 1/2\u3002<br> \u90A3\u4E48\uFF0C\u77E9\u9635 m \u7684\u5012\u6570\u5C31\u662F 1/m\u3002<br> \u53EA\u4E0D\u8FC7\uFF0C1/m \u4E0D\u53EB\u505A\u77E9\u9635 m \u7684\u5012\u6570\uFF0C\u800C\u662F\u53EB\u505A\u77E9\u9635 m \u7684\u9006\u77E9\u9635\u3002<br> \u7531\u4E0A\uFF0C\u53EF\u4EE5\u63A8\u5BFC\u51FA\u7684\u4E00\u4E9B\u7279\u6027\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u77E9\u9635 m</li><li>\u77E9\u9635 n</li></ul><p><code>\u53EF\u5F97</code>\uFF1A</p><p>1.\u77E9\u9635\u4E0E\u5176\u9006\u77E9\u9635\u7684\u76F8\u4E58\u7ED3\u679C\u4E3A\u5355\u4F4D\u77E9\u9635</p><p><code>\u56E0\u4E3A</code>\uFF1A</p><p>2*1/2=1</p><p><code>\u6240\u4EE5</code>\uFF1A</p><p>m*1/m=\u5355\u4F4D\u77E9\u9635</p><p>2.\u77E9\u9635 m \u9664\u4EE5\u77E9\u9635 n \u5C31\u7B49\u4E8E\u77E9\u9635 m \u4E58\u4EE5\u77E9\u9635 n \u7684\u9006\u77E9\u9635</p><p><code>\u56E0\u4E3A</code>\uFF1A</p><p>3/2=3*1/2</p><p><code>\u6240\u4EE5</code>\uFF1A</p><p>m/n=m*1/n</p><h4 id="_2-\u77E9\u9635\u8F6C\u9006\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_2-\u77E9\u9635\u8F6C\u9006\u77E9\u9635" aria-hidden="true">#</a> 2.\u77E9\u9635\u8F6C\u9006\u77E9\u9635</h4><ol><li>\u4F4D\u79FB\u77E9\u9635\u7684\u9006\u77E9\u9635\u662F\u53D6\u4F4D\u79FB\u56E0\u5B50\u7684\u76F8\u53CD\u6570</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> m<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span>elements<span class="token operator">=</span><span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u6253\u5370\u7ED3\u679C</span>
<span class="token punctuation">[</span>
  <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="2"><li>\u7F29\u653E\u77E9\u9635\u7684\u9006\u77E9\u9635\u662F\u53D6\u7F29\u653E\u56E0\u5B50\u7684\u5012\u6570</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token keyword">const</span> m<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  m<span class="token punctuation">.</span>elements<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u6253\u5370\u7ED3\u679C</span>
<span class="token punctuation">[</span>
  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.125</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>3.\u65CB\u8F6C\u77E9\u9635\u7684\u9006\u77E9\u9635\u662F\u57FA\u4E8E\u65CB\u8F6C\u5F27\u5EA6\u53CD\u5411\u65CB\u8F6C</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token keyword">const</span> ang<span class="token operator">=</span><span class="token number">30</span><span class="token operator">*</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">180</span>
  <span class="token keyword">const</span> c<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
  <span class="token keyword">const</span> s<span class="token operator">=</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ang<span class="token punctuation">)</span>
  <span class="token keyword">const</span> m<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  m<span class="token punctuation">.</span>elements<span class="token operator">=</span><span class="token punctuation">[</span>
    c<span class="token punctuation">,</span>s<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>s<span class="token punctuation">,</span>c<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u6253\u5370\u7ED3\u679C</span>
<span class="token punctuation">[</span>
  <span class="token number">0.866</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0.866</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>\u5173\u4E8E\u5373\u65CB\u8F6C\u53C8\u7F29\u653E\u8FD8\u4F4D\u79FB\u7684\u590D\u5408\u77E9\u9635\uFF0C\u4E5F\u662F\u6309\u7167\u7C7B\u4F3C\u7684\u539F\u7406\u8F6C\u9006\u77E9\u9635\u7684\uFF0C\u53EA\u4E0D\u8FC7\u8FC7\u7A0B\u8981\u66F4\u590D\u6742\u4E00\u4E9B\u3002</p><p>three.js \u7684 Matrix4 \u5BF9\u8C61\u7684 invert() \u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm</span>
  <span class="token keyword">const</span> te <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>

        n11 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n21 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n31 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n41 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        n12 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n22 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n32 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n42 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        n13 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n23 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n33 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n43 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
        n14 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n24 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n34 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> n44 <span class="token operator">=</span> te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>

        t11 <span class="token operator">=</span> n23 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">-</span> n24 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">+</span> n24 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token operator">-</span> n22 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">-</span> n23 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token operator">+</span> n22 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44<span class="token punctuation">,</span>
        t12 <span class="token operator">=</span> n14 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">-</span> n13 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">-</span> n14 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token operator">+</span> n12 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">+</span> n13 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token operator">-</span> n12 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44<span class="token punctuation">,</span>
        t13 <span class="token operator">=</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n42 <span class="token operator">-</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n42 <span class="token operator">+</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n43 <span class="token operator">-</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n43 <span class="token operator">-</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n44 <span class="token operator">+</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n44<span class="token punctuation">,</span>
        t14 <span class="token operator">=</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n32 <span class="token operator">-</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n32 <span class="token operator">-</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n33 <span class="token operator">+</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n33 <span class="token operator">+</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n34 <span class="token operator">-</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n34<span class="token punctuation">;</span>

  <span class="token keyword">const</span> det <span class="token operator">=</span> n11 <span class="token operator">*</span> t11 <span class="token operator">+</span> n21 <span class="token operator">*</span> t12 <span class="token operator">+</span> n31 <span class="token operator">*</span> t13 <span class="token operator">+</span> n41 <span class="token operator">*</span> t14<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> det <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> detInv <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> det<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t11 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n24 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">-</span> n23 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n24 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">+</span> n21 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">+</span> n23 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">-</span> n21 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n22 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n24 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">+</span> n24 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">-</span> n21 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">-</span> n22 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">+</span> n21 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n23 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">-</span> n22 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">-</span> n23 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">+</span> n21 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">+</span> n22 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">-</span> n21 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t12 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n13 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">+</span> n14 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">-</span> n11 <span class="token operator">*</span> n34 <span class="token operator">*</span> n43 <span class="token operator">-</span> n13 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">+</span> n11 <span class="token operator">*</span> n33 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n14 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">-</span> n12 <span class="token operator">*</span> n34 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">+</span> n11 <span class="token operator">*</span> n34 <span class="token operator">*</span> n42 <span class="token operator">+</span> n12 <span class="token operator">*</span> n31 <span class="token operator">*</span> n44 <span class="token operator">-</span> n11 <span class="token operator">*</span> n32 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n12 <span class="token operator">*</span> n33 <span class="token operator">*</span> n41 <span class="token operator">-</span> n13 <span class="token operator">*</span> n32 <span class="token operator">*</span> n41 <span class="token operator">+</span> n13 <span class="token operator">*</span> n31 <span class="token operator">*</span> n42 <span class="token operator">-</span> n11 <span class="token operator">*</span> n33 <span class="token operator">*</span> n42 <span class="token operator">-</span> n12 <span class="token operator">*</span> n31 <span class="token operator">*</span> n43 <span class="token operator">+</span> n11 <span class="token operator">*</span> n32 <span class="token operator">*</span> n43 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t13 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n41 <span class="token operator">-</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n43 <span class="token operator">+</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n43 <span class="token operator">+</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n44 <span class="token operator">-</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n41 <span class="token operator">-</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n41 <span class="token operator">+</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n42 <span class="token operator">-</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n42 <span class="token operator">-</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n44 <span class="token operator">+</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n44 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n41 <span class="token operator">-</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n41 <span class="token operator">-</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n42 <span class="token operator">+</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n42 <span class="token operator">+</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n43 <span class="token operator">-</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n43 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> t14 <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n13 <span class="token operator">*</span> n24 <span class="token operator">*</span> n31 <span class="token operator">-</span> n14 <span class="token operator">*</span> n23 <span class="token operator">*</span> n31 <span class="token operator">+</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n33 <span class="token operator">-</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n33 <span class="token operator">-</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n34 <span class="token operator">+</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n34 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n14 <span class="token operator">*</span> n22 <span class="token operator">*</span> n31 <span class="token operator">-</span> n12 <span class="token operator">*</span> n24 <span class="token operator">*</span> n31 <span class="token operator">-</span> n14 <span class="token operator">*</span> n21 <span class="token operator">*</span> n32 <span class="token operator">+</span> n11 <span class="token operator">*</span> n24 <span class="token operator">*</span> n32 <span class="token operator">+</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n34 <span class="token operator">-</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n34 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>
  te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span> n12 <span class="token operator">*</span> n23 <span class="token operator">*</span> n31 <span class="token operator">-</span> n13 <span class="token operator">*</span> n22 <span class="token operator">*</span> n31 <span class="token operator">+</span> n13 <span class="token operator">*</span> n21 <span class="token operator">*</span> n32 <span class="token operator">-</span> n11 <span class="token operator">*</span> n23 <span class="token operator">*</span> n32 <span class="token operator">-</span> n12 <span class="token operator">*</span> n21 <span class="token operator">*</span> n33 <span class="token operator">+</span> n11 <span class="token operator">*</span> n22 <span class="token operator">*</span> n33 <span class="token punctuation">)</span> <span class="token operator">*</span> detInv<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="_2-\u89C6\u56FE\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-\u89C6\u56FE\u65CB\u8F6C" aria-hidden="true">#</a> 2.\u89C6\u56FE\u65CB\u8F6C</h3><p>\u4E4B\u524D\u5B9E\u73B0\u4E86\u89C6\u56FE\u7684\u79FB\u52A8\u6548\u679C\uFF0C\u7136\u800C\u6709\u65F6\u5019\u5F53\u9047\u5230\u4E00\u4E2A\u597D\u73A9\u7684\u7269\u4F53\u65F6\uFF0C\u9700\u8981\u5728\u4E0D\u79FB\u52A8\u76F8\u673A\u7684\u524D\u63D0\u4E0B\u770B\u5411\u5B83\u3002<br> \u8FD9\u4E2A\u65F6\u5019\uFF0C\u5C31\u9700\u8981\u65CB\u8F6C\u89C6\u56FE\u4E86\u3002</p><h4 id="_2-1\u7528-three-js-\u7684-lookat-\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_2-1\u7528-three-js-\u7684-lookat-\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C" aria-hidden="true">#</a> 2.1\u7528 three.js \u7684 lookAt()\u5B9E\u73B0\u89C6\u56FE\u65CB\u8F6C</h4><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u6B63\u4EA4\u76F8\u673A\u7684\u8FB9\u754C left, right, top, bottom, near, far</li><li>\u6B63\u4EA4\u76F8\u673A\u7684\u89C6\u70B9\u4F4D\u7F6E eye</li><li>\u6B63\u4EA4\u76F8\u673A\u7684\u76EE\u6807\u70B9 target</li><li>\u6B63\u4EA4\u76F8\u673A\u4ECE eye \u770B\u5411 target \u65F6\u7684\u4E0A\u65B9\u5411 up</li></ul><p><code>\u6C42</code>\uFF1A\u4ECE\u89C6\u70B9\u770B\u5411\u76EE\u6807\u70B9\u65F6\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635 pvMatrix</p><p><code>\u89E3</code>\uFF1A</p><p>1.\u58F0\u660E\u5DF2\u77E5\u6761\u4EF6</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">-</span>halfW<span class="token punctuation">,</span>
  halfW<span class="token punctuation">,</span>
  halfH<span class="token punctuation">,</span>
  <span class="token operator">-</span>halfH<span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>2.\u5EFA\u7ACB\u6B63\u4EA4\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>3.\u8BBE\u7F6E\u76F8\u673A\u7684\u4F4D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>4.\u4F7F\u7528 lookAt()\u65B9\u6CD5\uFF0C\u8BA9\u76F8\u673A\u770B\u5411\u76EE\u6807\u70B9\uFF0C\u5E76\u66F4\u65B0\u4E00\u4E0B\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E0A\u9762\u7684 lookAt() \u65B9\u6CD5\u5B9E\u9645\u4E0A\u5C31\u662F\u5728\u8BA9\u76F8\u673A\u4E16\u754C\u8FDB\u884C\u65CB\u8F6C\u3002<br> \u4E4B\u540E\uFF0C\u73B0\u5B9E\u4E16\u754C\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\u663E\u793A\u7684\u65F6\u5019\uFF0C\u4FBF\u4F1A\u57FA\u4E8E\u6B64\u65CB\u8F6C\u91CF\u9006\u5411\u65CB\u8F6C\u3002</p><p>5.\u901A\u8FC7\u76F8\u673A\u8BA1\u7B97\u6295\u5F71\u89C6\u56FE\u77E9\u9635 pvMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+ws+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u5BF9 lookAt \u529F\u80FD\u8FDB\u884C\u4E00\u4E0B\u6DF1\u5EA6\u5256\u6790\u3002</p><h4 id="_2-2\u6DF1\u5EA6\u5256\u6790-lookat-\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#_2-2\u6DF1\u5EA6\u5256\u6790-lookat-\u529F\u80FD" aria-hidden="true">#</a> 2.2\u6DF1\u5EA6\u5256\u6790 lookAt \u529F\u80FD</h4><p>\u5148\u4E0D\u8003\u8651\u76F8\u673A\u5B58\u5728\u7236\u7EA7\u60C5\u51B5\u3002<br> \u53EF\u4EE5\u4ECE\u4E4B\u524D\u7684\u6B63\u4EA4\u76F8\u673A\u91CC\u5206\u89E3\u51FA\u4EE5\u4E0B\u77E9\u9635\uFF1A</p><ul><li>\u89C6\u56FE\u77E9\u9635 viewMatrix\uFF1A\u76F8\u673A\u4F4D\u79FB\u77E9\u9635\u4E58\u4EE5\u65CB\u8F6C\u77E9\u9635\u540E\u7684\u9006\u77E9\u9635\uFF0C\u5373\u76F8\u673A\u7684\u4E16\u754C\u77E9\u9635\u7684\u9006\u77E9\u9635 <ul><li>\u4F4D\u79FB\u77E9\u9635 positionMatrix\uFF1A\u7531\u89C6\u70B9\u4F4D\u7F6E\u5F97\u51FA</li><li>\u65CB\u8F6C\u77E9\u9635 rotationMatrix\uFF1A\u7531\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u5F97\u51FA</li></ul></li><li>\u6295\u5F71\u77E9\u9635 projectionMatrix\uFF1A\u7531\u6B63\u4EA4\u76F8\u673A\u7684 6 \u4E2A\u8FB9\u754C\u5F97\u51FA</li><li>\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF1A\u6295\u5F71\u77E9\u9635\u4E58\u4EE5\u89C6\u56FE\u77E9\u9635</li></ul><p>\u63A5\u4E0B\u6765\u5C31\u57FA\u4E8E\u4E4B\u524D\u7684\u4EE3\u7801\u505A\u4E00\u4E0B\u5206\u89E3\uFF1A</p><p>1.\u7531\u89C6\u70B9\u4F4D\u7F6E\u5F97\u51FA\u4F4D\u79FB\u77E9\u9635 positionMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> positionMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>2.\u7531\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u5F97\u51FA\u65CB\u8F6C\u77E9\u9635 rotationMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rotationMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>eye<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>3.\u57FA\u4E8E\u4F4D\u79FB\u77E9\u9635\u548C\u65CB\u8F6C\u77E9\u9635\u8BA1\u7B97\u89C6\u56FE\u77E9\u9635 viewMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>positionMatrix<span class="token punctuation">,</span> rotationMatrix<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>4.\u7531\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61\u63D0\u53D6\u6295\u5F71\u77E9\u9635 projectionMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> projectionMatrix <span class="token operator">=</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>5.\u7531\u6295\u5F71\u77E9\u9635\u548C\u89C6\u56FE\u77E9\u9635\u7684\u76F8\u4E58\u5F97\u5230\u6295\u5F71\u89C6\u56FE\u77E9\u9635 pvMatrix</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>6.\u6700\u540E\u5728\u9876\u70B9\u7740\u8272\u5668\u91CC\u8BA9 pvMatrix \u4E58\u4EE5\u9876\u70B9\u70B9\u4F4D\u5373\u53EF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>attribute vec4 a_Position<span class="token punctuation">;</span>
uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6CE8\uFF1A\u82E5\u76F8\u673A\u5BF9\u8C61\u5B58\u5728\u7236\u7EA7\uFF0C\u5C31\u9700\u8981\u57FA\u4E8E\u76F8\u673A\u7684\u4E16\u754C\u5750\u6807\u7CFB\u505A\u76F8\u5E94\u8FD0\u7B97\u4E86\u3002</p><h2 id="\u5341\u4E09\u3001\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E09\u3001\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> \u5341\u4E09\u3001\u900F\u89C6\u6295\u5F71\u77E9\u9635</h2><p>\u900F\u89C6\u6295\u5F71\u77E9\u9635\u53EF\u4EE5\u5C06\u73B0\u5B9E\u4E16\u754C\u66F4\u771F\u5B9E\u7684\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u3002</p><h3 id="_1-\u57FA\u7840\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#_1-\u57FA\u7840\u77E5\u8BC6" aria-hidden="true">#</a> 1.\u57FA\u7840\u77E5\u8BC6</h3><h4 id="_1-1\u9F50\u6B21\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_1-1\u9F50\u6B21\u5750\u6807\u7CFB" aria-hidden="true">#</a> 1.1\u9F50\u6B21\u5750\u6807\u7CFB</h4><p>\u5728\u9F50\u6B21\u5750\u6807\u7CFB\u4E2D\u4EE5\u4E0B\u7B49\u5F0F\u662F\u6210\u7ACB\u7684\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> k <span class="token operator">=</span> <span class="token punctuation">(</span>kx<span class="token punctuation">,</span> ky<span class="token punctuation">,</span> kz<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token function">k\u22600</span>
<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> z <span class="token operator">=</span> <span class="token punctuation">(</span>zx<span class="token punctuation">,</span> zy<span class="token punctuation">,</span> z\xB2<span class="token punctuation">,</span> z<span class="token punctuation">)</span> z\u2260<span class="token number">0</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6BD4\u5982\uFF1A<br> (1, 0, 0, 1) \u548C (2, 0, 0, 2) \u90FD\u4EE3\u8868\u540C\u4E00\u4E2A\u4E09\u7EF4\u70B9\u4F4D(1, 0 ,0)</p><h4 id="_1-2\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97" tabindex="-1"><a class="header-anchor" href="#_1-2\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97" aria-hidden="true">#</a> 1.2\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97</h4><p>\u4E4B\u524D\u8BF4\u8FC7\u70B9\u659C\u5F0F y = kx + b\uFF0C\u5B83\u5C31\u662F\u7EBF\u6027\u8865\u95F4\u8FD0\u7B97\u7684\u516C\u5F0F\u3002<br> \u9664\u4E86\u70B9\u659C\u5F0F\uFF0C\u4E24\u79CD\u6570\u636E\u95F4\u7684\u7EBF\u6027\u6620\u5C04\u5173\u7CFB\u8FD8\u53EF\u4EE5\u7528\u5176\u5B83\u65B9\u6CD5\u6765\u8868\u793A\u3002</p><p><img src="`+xs+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>N \u7C7B\u578B\u7684\u6570\u636E\u6781\u503C\u662F[minN,maxN]</li><li>M \u7C7B\u578B\u7684\u6570\u636E\u6781\u503C\u662F[minM,maxM]</li><li>x \u5C5E\u4E8E N</li><li>\u5C06 x \u6620\u5C04\u5230 M \u7684\u4E2D\u7684\u503C\u4E3A y</li></ul><p>\u5219 x,y \u7684\u5173\u7CFB\u53EF\u4EE5\u7528\u4E24\u4E2A\u7B49\u5F0F\u8868\u793A\uFF1A</p><ol><li>\u6BD4\u4F8B\u5F0F\uFF1A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>x <span class="token operator">-</span> minN<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>maxN <span class="token operator">-</span> minN<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> minM<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>maxM <span class="token operator">-</span> minM<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>\u70B9\u659C\u5F0F</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>k <span class="token operator">=</span> <span class="token punctuation">(</span>maxM <span class="token operator">-</span> minM<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>maxN <span class="token operator">-</span> minN<span class="token punctuation">)</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> minM <span class="token operator">-</span> minN <span class="token operator">*</span> k<span class="token punctuation">;</span>
y <span class="token operator">=</span> kx <span class="token operator">+</span> b<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u901A\u8FC7\u7EBF\u6027\u63D2\u503C\u7684\u7279\u6027\uFF1A</p><p>[minN,maxN] \u4E2D\u7684\u6BCF\u4E2A\u70B9\u90FD\u4E0E [minM,maxM] \u4E2D\u7684\u552F\u4E00\u70B9\u76F8\u5BF9\u5E94\uFF0C\u7531\u4E00\u4E2A x \u4FBF\u53EF\u4EE5\u6C42\u51FA\u552F\u4E00\u4E00\u4E2A y</p><h3 id="_2-\u8BA4\u8BC6\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_2-\u8BA4\u8BC6\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> 2.\u8BA4\u8BC6\u900F\u89C6\u6295\u5F71\u77E9\u9635</h3><p>\u900F\u89C6\u6295\u5F71\u77E9\u9635 perspective projection\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u56DB\u68F1\u53F0\u5F62\u7684\u533A\u57DF\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7684\u7269\u4F53\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219\u3002</p><p><img src="`+_s+'" alt=""></p><p><img src="'+m+'" alt=""></p><p>\u900F\u89C6\u76F8\u673A\u7684\u5EFA\u7ACB\u9700\u8981\u4EE5\u4E0B\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li>fov\uFF1A\u6444\u50CF\u673A\u89C6\u9525\u4F53\u5782\u76F4\u89C6\u91CE\u89D2\u5EA6</li><li>aspect\uFF1A\u6444\u50CF\u673A\u89C6\u9525\u4F53\u5BBD\u9AD8\u6BD4(\u8FD1\u88C1\u526A\u9762)</li><li>near\uFF1A\u6444\u50CF\u673A\u8FD1\u88C1\u526A\u9762\u5230\u89C6\u70B9\u7684\u8DDD\u79BB</li><li>far\uFF1A\u6444\u50CF\u673A\u8FDC\u88C1\u526A\u9762\u5230\u89C6\u70B9\u7684\u8DDD\u79BB</li></ul><p><img src="'+d+'" alt=""></p><p><code>\u95EE</code>\uFF1A\u8981\u5C06\u4E00\u4E2A\u4EFB\u610F\u5C3A\u5BF8\u7684\u6B63\u56DB\u68F1\u53F0\u585E\u8FDB\u88C1\u526A\u7A7A\u95F4\u91CC\uFF0C\u5206\u51E0\u6B65\uFF1F</p><p><code>\u7B54</code>\uFF1A\u4ECE\u900F\u89C6\u5230\u6B63\u4EA4</p><ol><li>\u6536\u7F29\u8FDC\u88C1\u526A\u9762\uFF0C\u5C06\u539F\u6765\u7684\u6B63\u56DB\u68F1\u53F0\u53D8\u6210\u957F\u65B9\u4F53</li><li>\u50CF\u4E4B\u524D\u7684\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\u4E00\u6837\uFF0C\u5C06\u957F\u65B9\u4F53\u5148\u4F4D\u79FB\uFF0C\u518D\u7F29\u653E</li></ol><h3 id="_3-\u8BA1\u7B97\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_3-\u8BA1\u7B97\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> 3.\u8BA1\u7B97\u900F\u89C6\u6295\u5F71\u77E9\u9635</h3><ol><li>\u57FA\u4E8E fov\u3001aspect\u3001n(near)\u3001f(far)\u8BA1\u7B97\u8FD1\u88C1\u526A\u9762\u8FB9\u754C\u3002</li></ol><p><img src="'+m+`" alt=""></p><p>\u4E0A\u4E0B\u5DE6\u53F3\u56DB\u4E2A\u8FB9\u754C\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>t <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token function">tan</span><span class="token punctuation">(</span>fov<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token operator">-</span>t
r <span class="token operator">=</span> t <span class="token operator">*</span> aspect
l <span class="token operator">=</span> <span class="token operator">-</span>r
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>\u8BBE\uFF1A\u53EF\u89C6\u533A\u57DF\u4E2D\u4E00\u9876\u70B9\u4E3A P1(x1, y1, z1)</li></ol><p>\u200B<code>\u6C42</code>\uFF1A\u6C42 P1 \u5728\u8FD1\u88C1\u526A\u9762\u4E0A\u7684\u6295\u5F71 P2(x2, y2, z2)</p><p><img src="`+js+`" alt=""></p><p>\u7531\u76F8\u4F3C\u4E09\u89D2\u5F62\u6027\u8D28\u5F97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x1<span class="token operator">/</span>x2 <span class="token operator">=</span> y1<span class="token operator">/</span>y2 <span class="token operator">=</span>z1<span class="token operator">/</span>z2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u56E0\u4E3A</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z2 <span class="token operator">=</span> <span class="token operator">-</span>n
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x2 <span class="token operator">=</span> nx1<span class="token operator">/</span><span class="token operator">-</span>z1
y2 <span class="token operator">=</span> ny1<span class="token operator">/</span><span class="token operator">-</span>z1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u82E5\u628A P1 \u70B9\u7684 x1,y1 \u66FF\u6362\u6210 x2,y2\uFF0C\u5C31\u53EF\u4EE5\u7406\u89E3\u4E3A\u628A\u76F8\u673A\u53EF\u89C6\u533A\u57DF\u585E\u8FDB\u4E86\u4E00\u4E2A\u957F\u65B9\u4F53\u91CC\u3002</p><p><img src="`+qs+'" alt=""></p><ol start="3"><li>\u628A\u957F\u65B9\u4F53\u91CC\u7684\u9876\u70B9\u585E\u8FDB\u88C1\u526A\u7A7A\u95F4\u4E2D\u3002</li></ol><p><img src="'+Ps+`" alt=""></p><p><code>\u8BBE</code>\uFF1AP2 \u6620\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u70B9\u4E3A P3(x3, y3, z3) \u70B9</p><p><code>\u5219</code>\uFF1AP2 \u70B9\u548C P3 \u70B9\u6EE1\u8DB3\u4EE5\u4E0B\u5173\u7CFB\u5F0F\uFF1A</p><ul><li>x \u65B9\u5411</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>x3<span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x2<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
<span class="token punctuation">(</span>x3<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x2<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
<span class="token punctuation">(</span>x3<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">(</span>x2<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
x3 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">(</span>x2<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
x3 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">(</span>x2<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
x3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">(</span>x2<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
x3 <span class="token operator">=</span> <span class="token punctuation">(</span>2x2<span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
x3 <span class="token operator">=</span> 2x2<span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>\u56E0\u4E3A</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x2 <span class="token operator">=</span> nx1 <span class="token operator">/</span> <span class="token operator">-</span>z1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x3 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">(</span>nx1<span class="token operator">/</span><span class="token operator">-</span>z1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
x3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>x1<span class="token operator">/</span><span class="token operator">-</span>z1<span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>y \u65B9\u5411</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>y3<span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y2<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>
y3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>y1<span class="token operator">/</span><span class="token operator">-</span>z1<span class="token operator">-</span><span class="token punctuation">(</span>t<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u89C2\u5BDF\u4E00\u4E0B\u5F53\u524D\u6C42\u51FA\u7684 x3,y3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>x1<span class="token operator">/</span><span class="token operator">-</span>z1<span class="token operator">-</span><span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>
y3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>y1<span class="token operator">/</span><span class="token operator">-</span>z1<span class="token operator">-</span><span class="token punctuation">(</span>t<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u53EA\u8981\u8BA9 x3,y3 \u4E58\u4EE5-z1\uFF0C\u4FBF\u53EF\u4EE5\u5F97\u5230\u4E00\u4E2A\u9F50\u6B21\u5750\u6807 P4(x4, y4, z4, w4)\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>x1<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>z1
y4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>y1<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>z1
z4 <span class="token operator">=</span> <span class="token operator">?</span>
w4<span class="token operator">=</span><span class="token operator">-</span>z1
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u5F53\u524D\u628A\u9876\u70B9\u7684 z \u5206\u91CF\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u65B9\u6CD5\uFF0C\u8FD8\u4E0D\u77E5\u9053\uFF0C\u6240\u4EE5 z4=?</p><p>\u53EF\u4EE5\u5148\u4ECE\u5DF2\u77E5\u6761\u4EF6\u4E2D\u63D0\u53D6\u6295\u5F71\u77E9\u9635(\u884C\u4E3B\u5E8F)\u7684\u77E9\u9635\u56E0\u5B50\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>       <span class="token number">0</span>         <span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>   <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>  <span class="token punctuation">(</span>t<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>   <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token operator">?</span>              <span class="token operator">?</span>          <span class="token operator">?</span>            <span class="token operator">?</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">0</span>          <span class="token operator">-</span><span class="token number">1</span>           <span class="token number">0</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u5C31\u5269\u4E0B z \u8F74\u76F8\u5173\u7684\u77E9\u9635\u56E0\u5B50\u4E86\u3002</p><p>\u56E0\u4E3A\u6574\u4E2A\u6295\u5F71\u77E9\u9635\u59CB\u7EC8\u662F\u5728\u505A\u7EBF\u6027\u53D8\u6362\u7684\uFF0C\u6295\u5F71\u70B9\u7684 z \u503C\u4E0E\u6295\u5F71\u77E9\u9635\u7684 z \u8F74\u5411\u7684 x,y \u5206\u91CF\u65E0\u5173\u3002</p><p>\u6240\u4EE5\u6295\u5F71\u77E9\u9635\u7684 z \u8F74\u5411\u7684 x,y \u5206\u91CF\u53EF\u4EE5\u5199\u505A 0\uFF0Cz \u548C w \u5206\u91CF\u53EF\u4EE5\u8BBE\u4E3A k,b\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>       <span class="token number">0</span>         <span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>   <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>  <span class="token punctuation">(</span>t<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>   <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">0</span>          k            b
  <span class="token number">0</span>              <span class="token number">0</span>          <span class="token operator">-</span><span class="token number">1</span>           <span class="token number">0</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u4E4B\u524D\u8BF4\u4E86\uFF0C\u6574\u4E2A\u6295\u5F71\u77E9\u9635\u59CB\u7EC8\u662F\u5728\u505A\u7EBF\u6027\u53D8\u6362\uFF0C\u6240\u4EE5\u53EF\u4EE5\u7528 k,b \u7EC4\u5408\u4E00\u4E2A\u70B9\u659C\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z4 <span class="token operator">=</span> k<span class="token operator">*</span>z1<span class="token operator">+</span>b
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5F53\u7136\uFF0C\u53EF\u4EE5\u8BA4\u4E3A\u662F\u70B9\u79EF\u7684\u7ED3\u679C\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token function">\xB7</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>z1<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
z4 <span class="token operator">=</span> k<span class="token operator">*</span>z1 <span class="token operator">+</span> b
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u53EA\u8981\u6C42\u51FA\u4E0A\u9762\u7684 k,b,\u5C31\u53EF\u4EE5\u5F97\u5230\u900F\u89C6\u6295\u5F71\u77E9\u9635\u3002</p><p>\u53EF\u4EE5\u7528\u5F53\u524D\u7684\u5DF2\u77E5\u6761\u4EF6\uFF0C\u6784\u5EFA\u4E00\u4E2A\u4E8C\u5143\u4E00\u6B21\u65B9\u7A0B\u7EC4\uFF0C\u6C42\u51FA k,b\uFF1A</p><p><img src="`+d+`" alt=""></p><ul><li>\u5F53 z1=-n \u65F6\uFF0Cz3=-1\uFF0Cz4=-1*-z1 \uFF08\u8FD1\u88C1\u526A\u9762\uFF09\uFF0C\u5373\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z4 <span class="token operator">=</span> k <span class="token operator">*</span> z1 <span class="token operator">+</span> b <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">*</span> n <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token operator">-</span>n <span class="token operator">+</span> b <span class="token operator">-</span> n <span class="token operator">=</span> <span class="token operator">-</span>kn <span class="token operator">+</span> b<span class="token punctuation">;</span>
b <span class="token operator">=</span> kn <span class="token operator">-</span> n<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>\u5F53 z1=-f \u65F6\uFF0Cz3=1\uFF0Cz4=1*-z1\uFF08\u8FDC\u88C1\u526A\u9762\uFF09\uFF0C\u5373\uFF1A</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>z4 <span class="token operator">=</span> k <span class="token operator">*</span> z1 <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token number">1</span> <span class="token operator">*</span> f <span class="token operator">=</span> k <span class="token operator">*</span> <span class="token operator">-</span>f <span class="token operator">+</span> b<span class="token punctuation">;</span>
f <span class="token operator">=</span> <span class="token operator">-</span>kf <span class="token operator">+</span> b<span class="token punctuation">;</span>
kf <span class="token operator">=</span> b <span class="token operator">-</span> f<span class="token punctuation">;</span>
k <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> f<span class="token punctuation">)</span> <span class="token operator">/</span> f<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u7528\u6D88\u5143\u6CD5\u6C42 b\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>b <span class="token operator">=</span> kn<span class="token operator">-</span>n
b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token operator">/</span>f<span class="token punctuation">)</span>n<span class="token operator">-</span>n
b <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span>n<span class="token operator">/</span>f<span class="token operator">-</span>n
fb <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span>n<span class="token operator">-</span>fn
fb <span class="token operator">=</span> bn<span class="token operator">-</span>fn<span class="token operator">-</span>fn
fb<span class="token operator">-</span>bn <span class="token operator">=</span> <span class="token operator">-</span>2fn
<span class="token function">b</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span>2fn
b <span class="token operator">=</span> <span class="token operator">-</span>2fn<span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u518D\u6C42 k\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>k <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token operator">/</span>f
k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>2fn<span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">-</span>f<span class="token punctuation">)</span><span class="token operator">/</span>f
k <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span>
k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2n</span><span class="token operator">-</span>f<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
k <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>f<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6700\u7EC8\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span>
  <span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>       <span class="token number">0</span>         <span class="token punctuation">(</span>r<span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span>   <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">2n</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>  <span class="token punctuation">(</span>t<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>t<span class="token operator">-</span>b<span class="token punctuation">)</span>   <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">0</span>         <span class="token operator">-</span><span class="token punctuation">(</span>f<span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span>  <span class="token operator">-</span>2fn<span class="token operator">/</span><span class="token punctuation">(</span>f<span class="token operator">-</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token number">0</span>              <span class="token number">0</span>         <span class="token operator">-</span><span class="token number">1</span>            <span class="token number">0</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u900F\u89C6\u6295\u5F71\u7684\u5EFA\u7ACB\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u5728 three.js \u7684\u6E90\u7801\u91CC\u627E\u5230\u3002</p><h3 id="_4-three-js-\u91CC\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_4-three-js-\u91CC\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635" aria-hidden="true">#</a> 4.three.js \u91CC\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635</h3><p>three.js \u7684 PerspectiveCamera \u5BF9\u8C61\u7684 updateProjectionMatrix() \u65B9\u6CD5\uFF0C\u4FBF\u662F\u900F\u89C6\u76F8\u673A\u5EFA\u7ACB\u900F\u89C6\u6295\u5F71\u77E9\u9635\u7684\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> near <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>near<span class="token punctuation">;</span>
	  <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u4E0A\u8FB9\u754C</span>
    <span class="token keyword">let</span> top <span class="token operator">=</span> near <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span> MathUtils<span class="token punctuation">.</span><span class="token constant">DEG2RAD</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fov <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoom<span class="token punctuation">;</span>
    <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u9AD8\u5EA6</span>
    <span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> top<span class="token punctuation">;</span>
    <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u5BBD\u5EA6</span>
    <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>aspect <span class="token operator">*</span> height<span class="token punctuation">;</span>
    <span class="token comment">//\u8FD1\u88C1\u526A\u9762\u5DE6\u8FB9\u754C</span>
    <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> width<span class="token punctuation">;</span>
    <span class="token comment">//\u9ED8\u8BA4\u4E3Anull</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>

    <span class="token comment">//\u591A\u89C6\u56FE</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>enabled <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> fullWidth <span class="token operator">=</span> view<span class="token punctuation">.</span>fullWidth<span class="token punctuation">,</span>
              fullHeight <span class="token operator">=</span> view<span class="token punctuation">.</span>fullHeight<span class="token punctuation">;</span>
        left <span class="token operator">+=</span> view<span class="token punctuation">.</span>offsetX <span class="token operator">*</span> width <span class="token operator">/</span> fullWidth<span class="token punctuation">;</span>
        top <span class="token operator">-=</span> view<span class="token punctuation">.</span>offsetY <span class="token operator">*</span> height <span class="token operator">/</span> fullHeight<span class="token punctuation">;</span>
        width <span class="token operator">*=</span> view<span class="token punctuation">.</span>width <span class="token operator">/</span> fullWidth<span class="token punctuation">;</span>
        height <span class="token operator">*=</span> view<span class="token punctuation">.</span>height <span class="token operator">/</span> fullHeight<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//\u504F\u79BB\u503C\uFF0C\u9ED8\u8BA40</span>
    <span class="token keyword">const</span> skew <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>filmOffset<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> skew <span class="token operator">!==</span> <span class="token number">0</span> <span class="token punctuation">)</span> left <span class="token operator">+=</span> near <span class="token operator">*</span> skew <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFilmWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u57FA\u4E8E\u8FD1\u88C1\u526A\u9762\u8FB9\u754C\u3001\u8FD1\u88C1\u526A\u9762\u548C\u8FDC\u88C1\u526A\u9762\u5230\u76F8\u673A\u89C6\u70B9\u7684\u8DDD\u79BB\u8BBE\u7F6E\u6295\u5F71\u77E9\u9635</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">makePerspective</span><span class="token punctuation">(</span> left<span class="token punctuation">,</span> left <span class="token operator">+</span> width<span class="token punctuation">,</span> top<span class="token punctuation">,</span> top <span class="token operator">-</span> height<span class="token punctuation">,</span> near<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>far <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>projectionMatrixInverse<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>projectionMatrix <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li>makePerspective() \u662F Matrix4 \u5BF9\u8C61\u91CC\u7684\u65B9\u6CD5\uFF0C\u4F1A\u57FA\u4E8E\u6295\u5F71\u7A7A\u95F4\u5EFA\u7ACB\u900F\u89C6\u6295\u5F71\u77E9\u9635</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">makePerspective</span><span class="token punctuation">(</span> <span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> te <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>elements<span class="token punctuation">;</span>

    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> near <span class="token operator">/</span> <span class="token punctuation">(</span> right <span class="token operator">-</span> left <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> near <span class="token operator">/</span> <span class="token punctuation">(</span> top <span class="token operator">-</span> bottom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">(</span> right <span class="token operator">+</span> left <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> right <span class="token operator">-</span> left <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">(</span> top <span class="token operator">+</span> bottom <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> top <span class="token operator">-</span> bottom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token operator">-</span> <span class="token punctuation">(</span> far <span class="token operator">+</span> near <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> far <span class="token operator">-</span> near <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> far <span class="token operator">*</span> near <span class="token operator">/</span> <span class="token punctuation">(</span> far <span class="token operator">-</span> near <span class="token punctuation">)</span><span class="token punctuation">;</span>

    te<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">4</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">8</span> <span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">12</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">5</span> <span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">9</span> <span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">13</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">2</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">6</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">10</span> <span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">14</span> <span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>
    te<span class="token punctuation">[</span> <span class="token number">3</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">7</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">11</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>	te<span class="token punctuation">[</span> <span class="token number">15</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_5-\u900F\u89C6\u6295\u5F71\u77E9\u9635\u725B\u5200\u5C0F\u8BD5" tabindex="-1"><a class="header-anchor" href="#_5-\u900F\u89C6\u6295\u5F71\u77E9\u9635\u725B\u5200\u5C0F\u8BD5" aria-hidden="true">#</a> 5.\u900F\u89C6\u6295\u5F71\u77E9\u9635\u725B\u5200\u5C0F\u8BD5</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_ProjectionMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_ProjectionMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    PerspectiveCamera
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5EFA\u7ACB\u900F\u89C6\u76F8\u673A</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">45</span><span class="token punctuation">,</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">20</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>

  <span class="token comment">//\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  <span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
      camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
      camera<span class="token punctuation">.</span>matrixWorldInverse
    <span class="token punctuation">)</span>

  <span class="token comment">// \u524D\u9762\u662F\u4E24\u4E2A\u9EC4\u8272\u4E09\u89D2\u5F62\uFF0C\u540E\u9762\u662F\u4E24\u4E2A\u7EA2\u8272\u4E09\u89D2\u5F62\u3002</span>
  <span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        x<span class="token punctuation">,</span> <span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
        <span class="token operator">-</span> <span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
        <span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> color
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_ProjectionMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Ss+`" alt=""></p></details><h2 id="\u5341\u56DB\u3001\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u548C\u6A21\u578B\u77E9\u9635\u5171\u51B6\u4E00\u7089" tabindex="-1"><a class="header-anchor" href="#\u5341\u56DB\u3001\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u548C\u6A21\u578B\u77E9\u9635\u5171\u51B6\u4E00\u7089" aria-hidden="true">#</a> \u5341\u56DB\u3001\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u548C\u6A21\u578B\u77E9\u9635\u5171\u51B6\u4E00\u7089</h2><p>\u6295\u5F71\u77E9\u9635\u3001\u89C6\u56FE\u77E9\u9635\u3001\u6A21\u578B\u77E9\u9635\u7684\u7ED3\u5408\u65B9\u5F0F\uFF1A<br><strong>\u6700\u7EC8\u7684\u9876\u70B9\u5750\u6807 = \u6295\u5F71\u77E9\u9635 * \u89C6\u56FE\u77E9\u9635 * \u6A21\u578B\u77E9\u9635 * \u521D\u59CB\u9876\u70B9\u5750\u6807</strong></p><p><strong><code>\u6295\u5F71\u77E9\u9635</code></strong>\uFF1A</p><ul><li>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u77E9\u5F62\u533A\u57DF(\u6B63\u4EA4\u76F8\u673A\u7684\u53EF\u89C6\u533A\u57DF)\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7269\u4F53\u4E0D\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219 <code>\u6B63\u4EA4\u6295\u5F71\u77E9\u9635 = \u7F29\u653E\u77E9\u9635*\u4F4D\u79FB\u77E9\u9635</code></li><li>\u900F\u89C6\u6295\u5F71\u77E9\u9635\uFF1A\u5C06\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4E00\u5757\u56DB\u68F1\u53F0\u5F62\u7684\u533A\u57DF\u6295\u5C04\u5230\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u4E0D\u540C\u6DF1\u5EA6\u7684\u7269\u4F53\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u7684\u900F\u89C6\u89C4\u5219</li></ul><p><strong><code>\u89C6\u56FE\u77E9\u9635</code></strong>\uFF1A\u76F8\u673A\u4F4D\u79FB\u77E9\u9635\u4E58\u4EE5\u65CB\u8F6C\u77E9\u9635\u540E\u7684\u9006\u77E9\u9635\uFF0C\u5373\u76F8\u673A\u7684\u4E16\u754C\u77E9\u9635\u7684\u9006\u77E9\u9635</p><ul><li>\u4F4D\u79FB\u77E9\u9635\uFF1A\u7531\u89C6\u70B9\u4F4D\u7F6E\u5F97\u51FA</li><li>\u65CB\u8F6C\u77E9\u9635\uFF1A\u7531\u89C6\u70B9\u3001\u76EE\u6807\u70B9\u3001\u4E0A\u65B9\u5411\u5F97\u51FA</li></ul><p><strong><code>\u6295\u5F71\u89C6\u56FE\u77E9\u9635</code></strong>\uFF1A\u6295\u5F71\u77E9\u9635\u4E58\u4EE5\u89C6\u56FE\u77E9\u9635</p><p><strong><code>\u6A21\u578B\u77E9\u9635</code></strong>\uFF1A\u6A21\u578B\u77E9\u9635\u53EF\u4EE5\u5BF9\u7269\u4F53\u8FDB\u884C\u4F4D\u79FB\u3001\u65CB\u8F6C\u3001\u7F29\u653E\u53D8\u6362\uFF0C\u6BD4\u5982\u8BA9\u7269\u4F53\u6CBF z \u65CB\u8F6C</p><h3 id="_1-\u6295\u5F71\u89C6\u56FE\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_1-\u6295\u5F71\u89C6\u56FE\u77E9\u9635" aria-hidden="true">#</a> 1.\u6295\u5F71\u89C6\u56FE\u77E9\u9635</h3><p>1.\u5728\u9876\u70B9\u7740\u8272\u5668\u91CC\u628A\u6295\u5F71\u77E9\u9635\u53D8\u6210\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>2.\u8BBE\u7F6E\u76F8\u673A\u4F4D\u7F6E\uFF0C\u5E76\u8BA9\u5176\u770B\u5411\u4E00\u70B9</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>3.\u8BA1\u7B97\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF0C\u5373\u8BA9\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635\u4E58\u4EE5\u89C6\u56FE\u77E9\u9635</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4.\u4FEE\u6539\u4E00\u4E0B\u5EFA\u7ACB\u4E09\u89D2\u5F62\u65B9\u6CD5\u91CC\u7684 uniform \u53D8\u91CF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Es+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u518D\u628A\u6A21\u578B\u77E9\u9635\u52A0\u8FDB\u53BB\u3002</p><h3 id="_2-\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u4E58\u4EE5\u6A21\u578B\u77E9\u9635" tabindex="-1"><a class="header-anchor" href="#_2-\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u4E58\u4EE5\u6A21\u578B\u77E9\u9635" aria-hidden="true">#</a> 2.\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u4E58\u4EE5\u6A21\u578B\u77E9\u9635</h3><p>\u4E4B\u524D\u8BBE\u7F6E\u4E09\u89D2\u5F62\u4F4D\u7F6E\u7684\u65F6\u5019\uFF0C\u662F\u76F4\u63A5\u5BF9\u9876\u70B9\u7684\u539F\u59CB\u6570\u636E\u8FDB\u884C\u7684\u4FEE\u6539\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    x<span class="token punctuation">,</span> <span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
    <span class="token number">0.3</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5176\u5B9E\uFF0C\u53EF\u4EE5\u5C06\u4F4D\u79FB\u6570\u636E\u5199\u8FDB\u6A21\u578B\u77E9\u9635\u91CC\u7684\uFF0C\u5F53\u7136\u65CB\u8F6C\u548C\u7F29\u653E\u6570\u636E\u4E5F\u53EF\u4EE5\u5199\u8FDB\u53BB\uFF0C\u7136\u540E\u7528\u6A21\u578B\u77E9\u9635\u4E58\u4EE5\u539F\u59CB\u9876\u70B9\uFF0C\u4ECE\u800C\u5B9E\u73B0\u5BF9\u6A21\u578B\u7684\u53D8\u6362\u3002</p><p>1.\u9876\u70B9\u7740\u8272\u5668</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>attribute vec4 a_Position<span class="token punctuation">;</span>
uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2.\u5728 crtTriangle()\u65B9\u6CD5\u91CC\uFF0C\u628A\u4E09\u89D2\u5F62\u7684\u6570\u636E\u6E90\u5199\u6B7B\uFF0C\u5728 uniforms \u91CC\u6DFB\u52A0\u4E00\u4E2A\u6A21\u578B\u77E9\u9635\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> modelMatrix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    modelMatrix<span class="token punctuation">,</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLES&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> color<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>2.\u5EFA\u7ACB\u56DB\u4E2A\u4E09\u89D2\u5F62</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ms+'" alt=""></p><h2 id="\u5341\u4E94\u3001\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E94\u3001\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" aria-hidden="true">#</a> \u5341\u4E94\u3001\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668</h2>',540),_p=n("\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u53EF\u4EE5\u53D8\u6362\u76F8\u673A\uFF0C\u4ECE\u800C\u7075\u6D3B\u89C2\u5BDF\u7269\u4F53\u3002"),jp=s("br",null,null,-1),qp=n(" three.js \u4E2D\u7684\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u662F\u901A\u8FC7\u4EE5\u4E0B\u4E8B\u4EF6\u53D8\u6362\u76F8\u673A\u7684\uFF1A\uFF08"),Pp={href:"https://threejs.org/examples/?q=orbi#misc_controls_orbit",target:"_blank",rel:"noopener noreferrer"},Sp=n("orbitControls"),Ep=n("\uFF09"),Mp=a(`<ol><li>\u65CB\u8F6C</li></ol><ul><li>\u9F20\u6807\u5DE6\u952E\u62D6\u62FD</li><li>\u5355\u624B\u6307\u79FB\u52A8</li></ul><ol start="2"><li>\u7F29\u653E</li></ol><ul><li>\u9F20\u6807\u6EDA\u8F6E\u6EDA\u52A8</li><li>\u4E24\u4E2A\u624B\u6307\u5C55\u5F00\u6216\u6324\u538B</li></ul><ol start="3"><li>\u5E73\u79FB</li></ol><ul><li>\u9F20\u6807\u53F3\u952E\u62D6\u62FD</li><li>\u9F20\u6807\u5DE6\u952E+ctrl/meta/shiftKey \u62D6\u62FD</li><li>\u7BAD\u5934\u952E</li><li>\u4E24\u4E2A\u624B\u6307\u79FB\u52A8</li></ul><h3 id="_1-\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_1-\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" aria-hidden="true">#</a> 1.\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    Vector2<span class="token punctuation">,</span>
    Vector3<span class="token punctuation">,</span>
    OrthographicCamera
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

  <span class="token comment">/* \u642D\u5EFA\u573A\u666F */</span>
  <span class="token comment">// 1.\u521D\u59CB\u5316\u7740\u8272\u5668 </span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2.\u6B63\u4EA4\u76F8\u673A</span>
  <span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
  <span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
    camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3.\u521B\u5EFA 4 \u4E2A\u4E09\u89D2\u5F62</span>
  <span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> modelMatrix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> color
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>


  <span class="token comment">/* \u58F0\u660E\u57FA\u7840\u6570\u636E */</span>
  <span class="token comment">// 1.\u9F20\u6807\u4E8B\u4EF6\u96C6\u5408</span>
  <span class="token keyword">const</span> mouseButtons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;pan&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u9F20\u6807\u53F3\u952E\u6309\u4E0B\u65F6\u7684event.button\u503C\u4E3A2</span>
  <span class="token comment">//pan\uFF1A\u5E73\u79FB</span>
  <span class="token comment">// 2.\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\uFF0C\u8868\u793A\u63A7\u5236\u5668\u6B63\u5728\u5BF9\u76F8\u673A\u8FDB\u884C\u54EA\u79CD\u53D8\u6362\u3002</span>
  <span class="token comment">// \u6BD4\u5982 state \u7B49\u4E8E pan \u65F6\uFF0C\u4EE3\u8868\u4F4D\u79FB</span>
  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
  <span class="token comment">// 3.\u9F20\u6807\u5728\u5C4F\u5E55\u4E0A\u62D6\u62FD\u65F6\u7684\u8D77\u59CB\u4F4D\u548C\u7ED3\u675F\u4F4D\uFF0C\u4EE5\u50CF\u7D20\u4E3A\u5355\u4F4D</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>dragStart<span class="token punctuation">,</span> dragEnd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 4.\u9F20\u6807\u6BCF\u6B21\u79FB\u52A8\u65F6\u7684\u4F4D\u79FB\u91CF\uFF0Cwebgl \u5750\u6807\u91CF</span>
  <span class="token keyword">const</span> panOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 5.\u9F20\u6807\u5728\u5C4F\u5E55\u4E0A\u5782\u76F4\u62D6\u62FD\u65F6\uFF0C\u662F\u57FA\u4E8E\u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u7684 y \u65B9\u5411\u8FD8\u662F z \u65B9\u5411\u79FB\u52A8\u76F8\u673A</span>
  <span class="token keyword">const</span> screenSpacePanning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token comment">//true\uFF1Ay\u5411\u79FB\u52A8</span>
  <span class="token comment">//false\uFF1Az\u5411\u79FB\u52A8</span>

  <span class="token comment">/* \u5728canvas\u4E0A\u7ED1\u5B9A\u9F20\u6807\u4E8B\u4EF6 */</span>
  <span class="token comment">// 1.\u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2.\u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u6CE8\uFF1A\u6307\u9488\u4E8B\u4EF6\u652F\u6301\u591A\u79CD\u65B9\u5F0F\u7684\u6307\u9488\u9876\u70B9\u8F93\u5165\uFF0C\u5982\u9F20\u6807\u3001\u89E6\u63A7\u7B14\u3001\u89E6\u6478\u5C4F\u7B49\u3002</span>
  <span class="token comment">// 3.\u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;pan&#39;</span><span class="token operator">:</span>
        <span class="token function">handleMouseMovePan</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 4.\u6307\u9488\u62AC\u8D77\u65F6\uFF0C\u6E05\u9664\u63A7\u5236\u5668\u72B6\u6001</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">/* \u76F8\u673A\u5E73\u79FB\u65B9\u6CD5 */</span>
  <span class="token keyword">function</span> <span class="token function">handleMouseMovePan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u6307\u9488\u62D6\u62FD\u7684\u7ED3\u675F\u4F4D(\u50CF\u7D20\u5355\u4F4D)</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u57FA\u4E8E\u62D6\u62FD\u8DDD\u79BB(\u50CF\u7D20\u5355\u4F4D)\u79FB\u52A8\u76F8\u673A</span>
    <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u91CD\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5E73\u79FB\u65B9\u6CD5</span>
  <span class="token keyword">function</span> <span class="token function">pan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> up <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
    <span class="token comment">//\u76F8\u673A\u8FD1\u88C1\u526A\u9762\u5C3A\u5BF8</span>
    <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
    <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom<span class="token punctuation">;</span>
    <span class="token comment">//\u6307\u9488\u62D6\u62FD\u91CF\u5728\u753B\u5E03\u4E2D\u7684\u6BD4\u503C</span>
    <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ratioY <span class="token operator">=</span> y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token comment">//\u5C06\u50CF\u7D20\u5355\u4F4D\u7684\u4F4D\u79FB\u91CF\u8F6C\u6362\u4E3A\u76F8\u673A\u8FD1\u88C1\u526A\u9762\u4E0A\u7684\u4F4D\u79FB\u91CF</span>
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>
    <span class="token comment">//\u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u91CC\u7684x\u8F74(\u7B2C\u4E00\u5217)</span>
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u76F8\u673Ax\u8F74\u5E73\u79FB\u91CF(\u53D6\u53CD =&gt; \u5F80\u53F3\u62D6\u62FD\u573A\u666F\uFF0C\u76F8\u673A\u5F80\u5DE6\u79FB\u52A8)</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u76F8\u673Az|y\u8F74\u5E73\u79FB\u91CF</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//y\u5411(\u7B2C\u4E8C\u5217)</span>
      vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//-z\u5411</span>
      vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u76F8\u673Ay\u5411\u6216-z\u5411\u7684\u5E73\u79FB\u91CF</span>
    vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u6574\u5408\u5E73\u79FB\u91CF</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u66F4\u65B0</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u57FA\u4E8E\u5E73\u79FB\u91CF\uFF0C\u4F4D\u79FB\u76F8\u673A\uFF0C\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
      camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
      camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Rs+'" alt=""></p><p>\u57FA\u4E8E\u62D6\u62FD\u8DDD\u79BB(\u50CF\u7D20\u5355\u4F4D)\u79FB\u52A8\u76F8\u673A\uFF1A<br><img src="'+Ts+'" alt=""></p></details><h3 id="_2-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_2-\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" aria-hidden="true">#</a> 2.\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053</h3><h4 id="_2-1\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_2-1\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u539F\u7406" aria-hidden="true">#</a> 2.1\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u539F\u7406</h4><p>\u76F8\u673A\u7684\u7F29\u653E\u5C31\u662F\u8BA9\u6211\u4EEC\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\u770B\u5230\u7684\u540C\u4E00\u6DF1\u5EA6\u4E0A\u7684\u4E1C\u897F\u66F4\u591A\u6216\u8005\u66F4\u5C11\u3002</p><p>\u901A\u5E38\u5F88\u5BB9\u6613\u7ED3\u5408\u5B9E\u9645\u751F\u6D3B\u6765\u8003\u8651\uFF0C\u6BD4\u5982\u6211\u4EEC\u6B63\u5BF9\u7740\u4E00\u9762\u5899\u58C1\uFF0C\u5899\u58C1\u4E0A\u94FA\u6EE1\u74F7\u7816\u3002<br> \u5F53\u628A\u955C\u5934\u62C9\u8FD1\u65F6\uFF0C\u770B\u5230\u7684\u74F7\u7816\u6570\u91CF\u5C31\u53D8\u5C11\u4E86\uFF0C\u6BCF\u5757\u74F7\u7816\u7684\u5C3A\u5BF8\u4E5F\u53D8\u5927\u4E86\uFF1B<br> \u53CD\u4E4B\uFF0C\u5F53\u6211\u4EEC\u628A\u955C\u5934\u62C9\u8FDC\u65F6\uFF0C\u770B\u5230\u7684\u74F7\u7816\u6570\u91CF\u5C31\u53D8\u591A\u4E86\uFF0C\u6BCF\u5757\u74F7\u7816\u7684\u5C3A\u5BF8\u4E5F\u53D8\u5C0F\u4E86\u3002<br> \u7136\u800C\u8FD9\u79CD\u65B9\u5F0F\u53EA\u9002\u7528\u4E8E\u900F\u89C6\u76F8\u673A\uFF0C\u5E76\u4E0D\u9002\u7528\u4E8E\u6B63\u4EA4\u76F8\u673A\uFF0C\u56E0\u4E3A\u6B63\u4EA4\u76F8\u673A\u4E0D\u5177\u5907\u8FD1\u5927\u8FDC\u5C0F\u89C4\u5219\u3002</p><p>\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\uFF0C\u662F\u76F4\u63A5\u7F29\u653E\u7684\u6295\u5F71\u9762\uFF0C\u8FD9\u4E2A\u6295\u5F71\u9762\u5728 three.js \u91CC\u5C31\u662F\u8FD1\u88C1\u526A\u9762\u3002<br> \u5F53\u6295\u5F71\u9762\u53D8\u5927\u4E86\uFF0C\u90A3\u4E48\u80FD\u6295\u5F71\u7684\u9876\u70B9\u6570\u91CF\u4E5F\u5C31\u53D8\u591A\u4E86\uFF1B<br> \u53CD\u4E4B\uFF0C\u5F53\u6295\u5F71\u9762\u53D8\u5C0F\u4E86\uFF0C\u90A3\u4E48\u80FD\u6295\u5F71\u7684\u9876\u70B9\u6570\u91CF\u4E5F\u5C31\u53D8\u5C11\u4E86\u3002<br><img src="'+b+`" alt=""></p><h4 id="_2-2\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_2-2\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u65B9\u6CD5" aria-hidden="true">#</a> 2.2\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u65B9\u6CD5</h4><p>\u5728 three.js \u91CC\u7684\u6B63\u4EA4\u76F8\u673A\u5BF9\u8C61 OrthographicCamera \u7684 updateProjectionMatrix() \u65B9\u6CD5\u91CC\u53EF\u4EE5\u627E\u5230\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function-variable function">updateProjectionMatrix</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dx <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dy <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottom <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>zoom <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cx <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cy <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottom <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> left <span class="token operator">=</span> cx <span class="token operator">-</span> dx<span class="token punctuation">;</span>
    <span class="token keyword">let</span> right <span class="token operator">=</span> cx <span class="token operator">+</span> dx<span class="token punctuation">;</span>
    <span class="token keyword">let</span> top <span class="token operator">=</span> cy <span class="token operator">+</span> dy<span class="token punctuation">;</span>
    <span class="token keyword">let</span> bottom <span class="token operator">=</span> cy <span class="token operator">-</span> dy<span class="token punctuation">;</span>
    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u53EF\u4EE5\u5C06\u4E0A\u9762\u7684 dx\u3001dy \u5206\u89E3\u4E00\u4E0B\uFF1A</p><ul><li>\u8FD1\u88C1\u526A\u9762\u5BBD\u5EA6\u7684\u4E00\u534A width\uFF1A( this.right - this.left ) / 2</li><li>\u8FD1\u88C1\u526A\u9762\u9AD8\u5EA6\u7684\u4E00\u534A height\uFF1A( this.top - this.bottom ) / 2</li><li>dx=width/zoom</li><li>dy=height/zoom</li></ul><p>\u5728 three.js \u91CC\uFF0Czoom \u7684\u9ED8\u8BA4\u503C\u662F 1\uFF0C\u5373\u4E0D\u505A\u7F29\u653E\u3002</p><p>\u7531\u4E0A\u53EF\u4EE5\u5F97\u5230\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u7684\u6027\u8D28\uFF1A</p><ul><li>zoom \u503C\u548C\u8FD1\u88C1\u526A\u9762\u7684\u5C3A\u5BF8\u6210\u53CD\u6BD4</li><li>\u8FD1\u88C1\u526A\u9762\u7684\u5C3A\u5BF8\u548C\u6211\u4EEC\u5728\u540C\u4E00\u6DF1\u5EA6\u6240\u770B\u7269\u4F53\u7684\u6570\u91CF\u6210\u6B63\u6BD4</li><li>\u8FD1\u88C1\u526A\u9762\u7684\u5C3A\u5BF8\u548C\u6211\u4EEC\u6240\u770B\u7684\u540C\u4E00\u7269\u4F53\u7684\u5C3A\u5BF8\u6210\u53CD\u6BD4</li></ul><h4 id="_2-4\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-4\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u5B9E\u73B0" aria-hidden="true">#</a> 2.4\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u5B9E\u73B0</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span> 
    Vector2<span class="token punctuation">,</span> 
    Vector3<span class="token punctuation">,</span>
    OrthographicCamera
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
  <span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
  <span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
  <span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
    camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span>


  <span class="token comment">/* \u58F0\u660E\u57FA\u7840\u6570\u636E */</span>
  <span class="token keyword">const</span> mouseButtons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;pan&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>dragStart<span class="token punctuation">,</span> dragEnd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>

  <span class="token comment">/* \u5E73\u79FB\u8F68\u9053 */</span>
  <span class="token keyword">const</span> panOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> screenSpacePanning <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token comment">/* \u7F29\u653E\u8F68\u9053 */</span>
  <span class="token comment">// 1.\u5B9A\u4E49\u6EDA\u8F6E\u5728\u6BCF\u6B21\u6EDA\u52A8\u65F6\u7684\u7F29\u653E\u7CFB\u6570</span>
  <span class="token keyword">const</span> zoomScale <span class="token operator">=</span> <span class="token number">0.95</span>

  <span class="token comment">//\u5728canvas\u4E0A\u7ED1\u5B9A\u9F20\u6807\u4E8B\u4EF6</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
    state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;pan&#39;</span><span class="token operator">:</span>
        <span class="token function">handleMouseMovePan</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 2.\u4E3A canvas \u6DFB\u52A0\u6EDA\u8F6E\u4E8B\u4EF6</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> handleMouseWheel<span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">handleMouseWheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;deltaY&#39;</span><span class="token punctuation">,</span> deltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> zoomScale<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">dolly</span><span class="token punctuation">(</span>zoomScale<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5F53 deltaY &lt; 0 \u65F6\uFF0C\u662F\u5411\u4E0A\u6ED1\u52A8\u6EDA\u8F6E\uFF0C\u4F1A\u7F29\u5C0F\u88C1\u526A\u9762\uFF1B</span>
  <span class="token comment">// \u5F53 deltaY &gt; 0 \u65F6\uFF0C\u662F\u5411\u4E0B\u6ED1\u52A8\u6EDA\u8F6E\uFF0C\u4F1A\u653E\u5927\u88C1\u526A\u9762\u3002</span>

  <span class="token comment">// 3.\u901A\u8FC7 dolly()\u65B9\u6CD5\u7F29\u653E\u76F8\u673A</span>
  <span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span>zoom <span class="token operator">*=</span> dollyScale
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">function</span> <span class="token function">handleMouseMovePan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
    <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//\u5E73\u79FB\u65B9\u6CD5</span>
  <span class="token keyword">function</span> <span class="token function">pan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> up <span class="token punctuation">}</span> <span class="token operator">=</span> camera
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas
    <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left
    <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom
    <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth
    <span class="token keyword">const</span> ratioY <span class="token operator">=</span> y <span class="token operator">/</span> clientHeight
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
      camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
      camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> modelMatrix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> color
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+As+'" alt=""></p></details><h3 id="_3-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_3-\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" aria-hidden="true">#</a> 3.\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053</h3><h4 id="_3-1\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_3-1\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u6982\u5FF5" aria-hidden="true">#</a> 3.1\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u6982\u5FF5</h4><p>\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u7684\u5B9E\u73B0\u539F\u7406\u5C31\u662F\u8BA9\u76F8\u673A\u7ED5\u7269\u4F53\u65CB\u8F6C\u3002<br> \u76F8\u673A\u65CB\u8F6C\u8F68\u8FF9\u7684\u96C6\u5408\u662F\u4E00\u4E2A\u7403\u4F53\u3002<br> \u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u5B9E\u73B0\u65B9\u5F0F\u662F\u6709\u8BB8\u591A\u79CD\u7684\uFF0C\u81F3\u4E8E\u5177\u4F53\u7528\u54EA\u79CD\uFF0C\u8FD8\u8981\u770B\u5177\u4F53\u7684\u9879\u76EE\u9700\u6C42\u3002</p><p><strong>\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u65CB\u8F6C\u7684\u76F8\u673A\u65CB\u8F6C\u8F68\u9053</strong>:</p><p><img src="'+e+'" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u4E09\u7EF4\u5750\u6807\u7CFB[O;x,y,z]</li><li>\u6B63\u4EA4\u76F8\u673A <ul><li>\u89C6\u70B9\u4F4D\uFF1A\u70B9 P</li><li>\u76EE\u6807\u4F4D\uFF1A\u70B9 O</li></ul></li><li>\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u7684\u65CB\u8F6C\u8F74\u662F y \u8F74</li></ul><p><code>\u5219</code>\uFF1A</p><p>\u6B63\u4EA4\u76F8\u673A\u5728\u7403\u5750\u6807\u7CFB\u4E2D\u7684\u65CB\u8F6C\u8F68\u9053\u6709\u4E24\u79CD\uFF1A</p><ul><li>\u70B9 P \u7ED5\u65CB\u8F6C\u8F74 y \u8F74\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u5373\u4E0A\u56FE\u7684\u84DD\u8272\u8F68\u9053\u3002</li><li>\u70B9 P \u5728\u5E73\u9762 OPy \u4E2D\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u5373\u4E0A\u56FE\u7684\u7EFF\u8272\u8F68\u8FF9\u3002</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u7ED3\u5408\u6B63\u4EA4\u76F8\u673A\u7684\u5B9E\u9645\u60C5\u51B5\uFF0C\u5982\u4F55\u8BA1\u7B97\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D\u3002</p><h4 id="_3-2\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D" tabindex="-1"><a class="header-anchor" href="#_3-2\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D" aria-hidden="true">#</a> 3.2\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u540E\u7684\u89C6\u70B9\u4F4D</h4><p><img src="'+e+'" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u4E09\u7EF4\u5750\u6807\u7CFB[O;x,y,z]</li><li>\u6B63\u4EA4\u76F8\u673A <ul><li>\u89C6\u70B9\u4F4D\uFF1A\u4E09\u7EF4\u5750\u6807\u70B9 P(x,y,z)</li><li>\u76EE\u6807\u4F4D\uFF1A\u70B9 O</li></ul></li><li>\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u7684\u65CB\u8F6C\u8F74\u662F y \u8F74</li></ul><p><code>\u6C42</code>\uFF1A\u76F8\u673A\u5728\u5E73\u9762 OPy \u4E2D\u65CB\u8F6C a \u5EA6\uFF0C\u7ED5 y \u8F74\u65CB\u8F6C b \u5EA6\u540E\uFF0C\u76F8\u673A\u89C6\u70B9\u7684\u4E09\u7EF4\u7A7A\u95F4\u4F4D P&#39;(x&#39;,y&#39;,z&#39;)</p><p><code>\u89E3</code>\uFF1A</p><ol><li>\u5C06\u70B9 P(x,y,z)\u7684\u4E09\u7EF4\u5750\u6807\u4F4D\u6362\u7B97\u4E3A\u7403\u5750\u6807\u4F4D\uFF0C\u5373 P(r,\u03C6,\u03B8)</li><li>\u8BA1\u7B97\u70B9 P \u5728\u5E73\u9762 OPy \u4E2D\u65CB\u8F6C a \u5EA6\uFF0C\u7ED5 y \u8F74\u65CB\u8F6C b \u5EA6\u540E\u7684\u7403\u5750\u6807\u4F4D\uFF0C\u5373 P(r,\u03C6+a,\u03B8+b)</li><li>\u5C06\u70B9 P \u7684\u7403\u5750\u6807\u4F4D\u8F6C\u6362\u4E3A\u4E09\u7EF4\u5750\u6807\u4F4D</li></ol><p>\u6C42\u89E3\u7684\u601D\u8DEF\u5C31\u8FD9\u4E48\u7B80\u5355\uFF0C\u90A3\u5177\u4F53\u600E\u4E48\u5B9E\u73B0\u5462\uFF1F\u5148\u628A\u4E0A\u9762\u7684\u7403\u5750\u6807\u89E3\u91CA\u4E00\u4E0B\u3002</p><h4 id="_3-3\u7403\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_3-3\u7403\u5750\u6807\u7CFB" aria-hidden="true">#</a> 3.3\u7403\u5750\u6807\u7CFB</h4><p>\u2160 \u7403\u5750\u6807\u7CFB\u7684\u6982\u5FF5</p><p><img src="'+e+'" alt=""></p><p>\u7403\u5750\u6807\u7CFB\uFF08spherical coordinate system\uFF09\u662F\u7528\u7403\u5750\u6807\u8868\u793A\u7A7A\u95F4\u70B9\u4F4D\u7684\u5750\u6807\u7CFB\u3002</p><p>\u7403\u5750\u6807\u7531\u4EE5\u4E0B\u5206\u91CF\u6784\u6210\uFF1A</p><ul><li>\u534A\u5F84(radial distance) r\uFF1AOP \u957F\u5EA6( 0 \u2264 r ) \u3002</li><li>\u6781\u89D2(polar angle) \u03C6\uFF1AOP \u4E0E y \u8F74\u7684\u5939\u89D2(0 \u2264 \u03C6 \u2264 \u03C0)</li><li>\u65B9\u4F4D\u89D2(azimuth angle) \u03B8\uFF1AOP \u5728\u5E73\u9762 Oxz \u4E0A\u7684\u6295\u5F71\u4E0E\u6B63 x \u8F74\u7684\u5939\u89D2( 0 \u2264 \u03B8 &lt; 2\u03C0 )\u3002</li></ul><p><code>\u6CE8</code>\uFF1A</p><ul><li>\u7403\u5750\u6807\u7CFB\u53EF\u89C6\u6781\u5750\u6807\u7CFB\u7684\u4E09\u7EF4\u63A8\u5E7F\u3002</li><li>\u5F53 r=0 \u65F6\uFF0C\u03C6 \u548C \u03B8 \u65E0\u610F\u4E49\u3002</li><li>\u5F53 \u03C6 =0 \u6216 \u03C6 =\u03C0 \u65F6\uFF0C\u03B8 \u65E0\u610F\u4E49\u3002</li></ul><p>\u2161 \u4E09\u7EF4\u5750\u6807\u8F6C\u7403\u5750\u6807</p><p><img src="'+e+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A\u70B9 P \u7684\u4E09\u7EF4\u5750\u6807\u4F4D(x,y,z)</p><p><code>\u6C42</code>\uFF1A\u70B9 P \u7684\u7403\u5750\u6807\u4F4D(r,\u03C6,\u03B8)</p><p><code>\u89E3</code>\uFF1A</p><p>\u6C42\u534A\u5F84 r\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>r <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>x\xB2 <span class="token operator">+</span> y\xB2 <span class="token operator">+</span> z\xB2<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6C42\u6781\u89D2 \u03C6 \u7684\u65B9\u6CD5\u6709\u4E09\u79CD\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03C6 <span class="token operator">=</span> <span class="token function">acos</span><span class="token punctuation">(</span>y<span class="token operator">/</span>r<span class="token punctuation">)</span>
\u03C6 <span class="token operator">=</span> <span class="token function">asin</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x\xB2 <span class="token operator">+</span> z\xB2<span class="token punctuation">)</span><span class="token operator">/</span>r<span class="token punctuation">)</span>
\u03C6 <span class="token operator">=</span> <span class="token function">atan</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x\xB2 <span class="token operator">+</span> z\xB2<span class="token punctuation">)</span><span class="token operator">/</span>y<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u6C42\u65B9\u4F4D\u89D2 \u03B8 \u7684\u65B9\u6CD5\u6709\u4E09\u79CD\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03B8 <span class="token operator">=</span> <span class="token function">acos</span><span class="token punctuation">(</span>x<span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">*</span>sin\u03C6<span class="token punctuation">)</span><span class="token punctuation">)</span>
\u03B8 <span class="token operator">=</span> <span class="token function">asin</span><span class="token punctuation">(</span>z<span class="token operator">/</span><span class="token punctuation">(</span>r<span class="token operator">*</span>sin\u03C6<span class="token punctuation">)</span><span class="token punctuation">)</span>
\u03B8 <span class="token operator">=</span> <span class="token function">atan</span><span class="token punctuation">(</span>z<span class="token operator">/</span>x<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>\u6CE8</code>\uFF1A</p><p>\u5728\u7528\u53CD\u6B63\u5207\u6C42\u89D2\u5EA6\u65F6\uFF0C\u9700\u8981\u6CE8\u610F\u70B9\u95EE\u9898\u3002</p><p>atan()\u8FD4\u56DE\u7684\u503C\u57DF\u662F[-PI/2,PI/2]\uFF0C\u8FD9\u662F\u4E2A\u534A\u5706\uFF0C\u8FD9\u4F1A\u5BFC\u81F4\u5176\u8FD4\u56DE\u7684\u5F27\u5EA6\u5931\u771F\u3002</p><p>\u5982\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">atan</span><span class="token punctuation">(</span>z<span class="token operator">/</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">atan</span><span class="token punctuation">(</span><span class="token operator">-</span>z<span class="token operator">/</span><span class="token operator">-</span>x<span class="token punctuation">)</span>
<span class="token function">atan</span><span class="token punctuation">(</span><span class="token operator">-</span>z<span class="token operator">/</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">atan</span><span class="token punctuation">(</span>z<span class="token operator">/</span><span class="token operator">-</span>x<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6240\u4EE5\uFF0C\u5728 js \u91CC\u7528\u53CD\u6B63\u5207\u8BA1\u7B97\u5F27\u5EA6\u65F6\uFF0C\u8981\u4F7F\u7528 atan2() \u65B9\u6CD5\uFF0C\u5373\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03C6 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x\xB2<span class="token operator">+</span>z\xB2<span class="token punctuation">)</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span>
\u03B8 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span>x<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>atan2()\u8FD4\u56DE\u7684\u503C\u57DF\u662F[-PI,PI]\uFF0C\u8FD9\u662F\u4E00\u4E2A\u6574\u5706\u3002</p><p>atan2()\u65B9\u6CD5\u662F\u5C06 z,x \u5206\u5F00\u5199\u5165\u7684\uFF0C\u5176\u4FDD\u7559\u4E86\u5176\u6700\u539F\u59CB\u7684\u6B63\u8D1F\u7B26\u53F7\uFF0C\u6240\u4EE5\u5176\u8FD4\u56DE\u7684\u5F27\u5EA6\u4E0D\u4F1A\u5931\u771F\u3002</p><p>\u2162 \u7403\u5750\u6807\u8F6C\u4E09\u7EF4\u5750\u6807</p><p><code>\u5DF2\u77E5</code>\uFF1A\u70B9 P \u7684\u7403\u5750\u6807\u4F4D(r,\u03C6,\u03B8)</p><p><code>\u6C42</code>\uFF1A\u70B9 P \u7684\u4E09\u7EF4\u5750\u6807\u4F4D(x,y,z)</p><p><code>\u89E3</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>x <span class="token operator">=</span> r <span class="token operator">*</span> sin\u03C6 <span class="token operator">*</span> cos\u03B8<span class="token punctuation">;</span>
y <span class="token operator">=</span> r <span class="token operator">*</span> cos\u03C6<span class="token punctuation">;</span>
z <span class="token operator">=</span> r <span class="token operator">*</span> sin\u03C6 <span class="token operator">*</span> sin\u03B8<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_3-4\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3-4\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 3.4\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u7684\u4EE3\u7801\u5B9E\u73B0</h4><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u9876\u70B9\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec4 u_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>u_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    Vector2<span class="token punctuation">,</span>
    Vector3<span class="token punctuation">,</span>
    OrthographicCamera<span class="token punctuation">,</span>
    Spherical
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Poly.js&#39;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>viewW<span class="token punctuation">,</span> viewH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">]</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> viewW<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> viewH<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
  <span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
  <span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
  <span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
    camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle1 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> triangle2 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle3 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> triangle4 <span class="token operator">=</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
  <span class="token punctuation">)</span>


  <span class="token comment">/* \u58F0\u660E\u57FA\u7840\u6570\u636E */</span>
  <span class="token comment">//\u9F20\u6807\u4E8B\u4EF6\u96C6\u5408</span>
  <span class="token keyword">const</span> mouseButtons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;rotate&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;pan&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment">//\u8F68\u9053\u72B6\u6001</span>
  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  <span class="token comment">//2PI</span>
  <span class="token keyword">const</span> pi2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span>
  <span class="token comment">//\u9F20\u6807\u62D6\u62FD\u7684\u8D77\u59CB\u4F4D\u548C\u7ED3\u675F\u4F4D\uFF0C\u65E0\u8BBA\u662F\u5DE6\u952E\u6309\u4E0B\u8FD8\u662F\u53F3\u952E\u6309\u4E0B</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>dragStart<span class="token punctuation">,</span> dragEnd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

  <span class="token comment">/* \u5E73\u79FB\u8F68\u9053 */</span>
  <span class="token comment">//\u5E73\u79FB\u91CF</span>
  <span class="token keyword">const</span> panOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u662F\u5426\u6CBF\u76F8\u673Ay\u8F74\u5E73\u79FB\u76F8\u673A</span>
  <span class="token keyword">const</span> screenSpacePanning <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token comment">/* \u7F29\u653E\u8F68\u9053 */</span>
  <span class="token comment">//\u6EDA\u8F6E\u5728\u6BCF\u6B21\u6EDA\u52A8\u65F6\u7684\u7F29\u653E\u7CFB\u6570</span>
  <span class="token keyword">const</span> zoomScale <span class="token operator">=</span> <span class="token number">0.95</span>

  <span class="token comment">/* \u65CB\u8F6C\u8F68\u9053 */</span>
  <span class="token comment">// \u76F8\u673A\u89C6\u70B9\u76F8\u5BF9\u4E8E\u76EE\u6807\u7684\u7403\u5750\u6807</span>
  <span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

  <span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
    state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;pan&#39;</span><span class="token operator">:</span>
        <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&#39;rotate&#39;</span><span class="token operator">:</span>
        <span class="token function">rotate</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//\u6EDA\u8F6E\u4E8B\u4EF6</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> handleMouseWheel<span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">handleMouseWheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;deltaY&#39;</span><span class="token punctuation">,</span> deltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> zoomScale<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">dolly</span><span class="token punctuation">(</span>zoomScale<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span>zoom <span class="token operator">*=</span> dollyScale
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//\u5E73\u79FB\u65B9\u6CD5</span>
  <span class="token keyword">function</span> <span class="token function">pan</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> up <span class="token punctuation">}</span> <span class="token operator">=</span> camera
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas
    <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left
    <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom
    <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth
    <span class="token keyword">const</span> ratioY <span class="token operator">=</span> y <span class="token operator">/</span> clientHeight
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u65CB\u8F6C\u65B9\u6CD5</span>
  <span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas
    spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> pi2 <span class="token operator">*</span> x <span class="token operator">/</span> clientHeight <span class="token comment">// yes, height</span>
    spherical<span class="token punctuation">.</span>phi <span class="token operator">-=</span> pi2 <span class="token operator">*</span> y <span class="token operator">/</span> clientHeight
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>

    <span class="token comment">//\u57FA\u4E8E\u65CB\u8F6C\u91CF\u65CB\u8F6C\u76F8\u673A</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
      target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
      camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
      camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
      camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment">// \u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    triangle1<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    triangle4<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">crtTriangle</span><span class="token punctuation">(</span><span class="token parameter">color<span class="token punctuation">,</span> modelMatrix</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gl<span class="token punctuation">,</span>
      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> color
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrix<span class="token punctuation">.</span>elements
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Bs+`" alt=""></p></details><h4 id="_3-5\u9650\u5236\u65CB\u8F6C\u8F74" tabindex="-1"><a class="header-anchor" href="#_3-5\u9650\u5236\u65CB\u8F6C\u8F74" aria-hidden="true">#</a> 3.5\u9650\u5236\u65CB\u8F6C\u8F74</h4><p>\u5728 three.js \u7684\u8F68\u9053\u63A7\u5236\u5668\u91CC\uFF0C\u65E0\u6CD5\u9650\u5236\u65CB\u8F6C\u8F74\uFF0C\u6BD4\u5982\u53EA\u60F3\u6A2A\u5411\u65CB\u8F6C\u76F8\u673A\uFF0C\u6216\u8005\u7AD6\u5411\u65CB\u8F6C\u76F8\u673A\u3002</p><ol><li>\u58F0\u660E\u4E00\u4E2A\u63A7\u5236\u65CB\u8F6C\u65B9\u5411\u7684\u5C5E\u6027</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rotateDir <span class="token operator">=</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>x\uFF1A\u53EF\u4EE5\u5728 x \u65B9\u5411\u65CB\u8F6C\u76F8\u673A</li><li>y\uFF1A\u53EF\u4EE5\u5728 y \u65B9\u5411\u65CB\u8F6C\u76F8\u673A</li><li>xy\uFF1A\u53EF\u4EE5\u5728 x,y \u65B9\u5411\u65CB\u8F6C\u76F8\u673A</li></ul><ol start="2"><li>\u65CB\u8F6C\u65B9\u6CD5\uFF0C\u57FA\u4E8E rotateDir \u5C5E\u6027\u7EA6\u675F\u65CB\u8F6C\u65B9\u5411</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
  <span class="token keyword">const</span> deltaT <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> deltaP <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    spherical<span class="token punctuation">.</span>phi <span class="token operator">-=</span> deltaP<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-6\u9650\u5236\u6781\u89D2" tabindex="-1"><a class="header-anchor" href="#_3-6\u9650\u5236\u6781\u89D2" aria-hidden="true">#</a> 3.6\u9650\u5236\u6781\u89D2</h4><p>\u4E4B\u524D\u8BF4\u7403\u5750\u6807\u7CFB\u7684\u65F6\u5019\u8BF4\u8FC7\uFF0C\u5176\u6781\u89D2\u7684\u5B9A\u4E49\u57DF\u662F[0,180\xB0]\uFF0C\u6240\u4EE5\u5728\u4EE3\u7801\u91CC\u4E5F\u8981\u5BF9\u5176\u505A\u4E00\u4E0B\u9650\u5236\u3002<br> \u5728 rotate() \u65B9\u6CD5\u91CC\u505A\u4E0B\u8C03\u6574\u5373\u53EF\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u65CB\u8F6C</span>
<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaT <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaP <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> phi <span class="token operator">=</span> spherical<span class="token punctuation">.</span>phi <span class="token operator">-</span> deltaP
        spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u56E0\u4E3A\u5F53\u7403\u5750\u6807\u91CC\u7684\u6781\u89D2\u7B49\u4E8E 0 \u6216 180 \u5EA6\u7684\u65F6\u5019\uFF0C\u65B9\u4F4D\u89D2\u4F1A\u5931\u53BB\u610F\u4E49\uFF0C\u6240\u4EE5\u8FD8\u4E0D\u80FD\u5728\u4EE3\u7801\u771F\u7684\u7ED9\u6781\u89D2 0 \u6216 180 \u5EA6\uFF0C\u4E0D\u7136\u65B9\u4F4D\u89D2\u4F1A\u9ED8\u8BA4\u5F52\u96F6\u3002<br> \u6240\u4EE5\uFF0C\u9700\u8981\u5206\u522B\u7ED9\u6781\u89D2\u91CC\u7684 0 \u548C 180 \u5EA6\u4E00\u4E2A\u8FD1\u4F3C\u503C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99999999</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.00000001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u6211\u4EEC\u5C31\u8BF4\u5230\u8FD9\uFF0C\u5176\u5177\u4F53\u4EE3\u7801\u53EF\u4EE5\u53C2\u8003 three.js \u91CC\u7684 OrbitControls \u5BF9\u8C61\u7684\u6E90\u7801\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u518D\u8BF4\u4E00\u4E2A\u53E6\u4E00\u79CD\u5F62\u5F0F\u7684\u6B63\u4EA4\u76F8\u673A\u65CB\u8F6C\u8F68\u9053\u3002</p><h3 id="_4-\u8F68\u8FF9\u7403\u65CB\u8F6C" tabindex="-1"><a class="header-anchor" href="#_4-\u8F68\u8FF9\u7403\u65CB\u8F6C" aria-hidden="true">#</a> 4.\u8F68\u8FF9\u7403\u65CB\u8F6C</h3><p>\u8F68\u8FF9\u7403\u8FD9\u4E2A\u540D\u5B57\uFF0C\u6765\u81EA three.js \u7684 TrackballControls \u5BF9\u8C61\uFF0C\u5176\u5177\u4F53\u7684\u4EE3\u7801\u5B9E\u73B0\u4FBF\u53EF\u4EE5\u5728\u8FD9\u91CC\u627E\u5230\u3002</p><p>\u8F68\u8FF9\u7403\u4E0D\u50CF\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u65CB\u8F6C\u8F68\u9053\u90A3\u6837\u5177\u6709\u6052\u5B9A\u7684\u4E0A\u65B9\u5411\u3002<br> \u8F68\u8FF9\u7403\u7684\u4E0A\u65B9\u5411\u662F\u4E00\u4E2A\u5782\u76F4\u4E8E\u9F20\u6807\u62D6\u62FD\u65B9\u5411\u548C\u89C6\u7EBF\u7684\u8F74\uFF0C\u76F8\u673A\u89C6\u70B9\u4F1A\u57FA\u4E8E\u6B64\u8F74\u65CB\u8F6C\u3002<br> \u8F68\u8FF9\u7403\u7684\u4E0A\u65B9\u5411\u4F1A\u968F\u9F20\u6807\u62D6\u62FD\u65B9\u5411\u7684\u6539\u53D8\u800C\u6539\u53D8\u3002</p><p>\u5982\u4E0B\u56FE\uFF1A</p><p><img src="`+Fs+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u8BF4\u4E00\u4E0B\u5177\u4F53\u7684\u4EE3\u7801\u5B9E\u73B0\u3002</p><p>\u5728 three.js \u4E2D\uFF0CTrackballControls \u548C OrbitControls \u5BF9\u8C61\u91CC\u7684\u4EE3\u7801\uFF0C\u4E0D\u592A\u50CF\u4E00\u4E2A\u4EBA\u5199\u7684\u3002</p><p>\u56E0\u4E3A\u5B8C\u5168\u53EF\u4EE5\u6CBF\u7528 OrbitControls \u91CC\u7684\u4E00\u90E8\u5206\u4EE3\u7801\u53BB\u5199 TrackballControls\uFF0C\u6BD4\u5982\u9F20\u6807\u5728\u76F8\u673A\u4E16\u754C\u91CC\u7684\u504F\u79FB\u91CF\uFF0C\u800C TrackballControls \u5B8C\u5168\u7528\u4E00\u5957\u98CE\u683C\u8FE5\u5F02\u7684\u4EE3\u7801\u4ECE\u5934\u5199\u4E86\u4E00\u904D\u3002</p><p>\u5F53\u7136\uFF0C\u8FD9\u91CC\u5E76\u4E0D\u662F\u8BF4 TrackballControls \u4E0D\u597D\uFF0C\u5176\u539F\u7406\u548C\u529F\u80FD\u7684\u5B9E\u73B0\u65B9\u6CD5\u4F9D\u65E7\u662F\u5F88\u503C\u5F97\u5B66\u4E60\u3002</p><p>\u53EA\u662F\u5728\u5199\u8F68\u8FF9\u7403\u7684\u65F6\u5019\uFF0C\u5B8C\u5168\u53EF\u4EE5\u57FA\u4E8E TrackballControls \u7684\u5B9E\u73B0\u539F\u7406\uFF0C\u628A OrbitControls \u7ED9\u6539\u4E00\u4E0B\uFF0C\u8FD9\u6837\u53EF\u4EE5\u5C11\u5199\u8BB8\u591A\u4EE3\u7801\u3002</p><p>1.\u5B9A\u4E49\u7528\u4E8E\u6CBF\u67D0\u4E2A\u8F74\u65CB\u8F6C\u76F8\u673A\u89C6\u70B9\u7684\u56DB\u5143\u6570</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> quaternion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>2.\u628A\u4E4B\u524D\u7684 rotate()\u65CB\u8F6C\u65B9\u6CD5\u6539\u4E00\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> position <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>

  <span class="token comment">// \u76F8\u673A\u5BBD\u9AD8</span>
  <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
  <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom<span class="token punctuation">;</span>

  <span class="token comment">// \u9F20\u6807\u4F4D\u79FB\u8DDD\u79BB\u5728\u753B\u5E03\u4E2D\u7684\u5360\u6BD4</span>
  <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth<span class="token punctuation">;</span>
  <span class="token keyword">const</span> ratioY <span class="token operator">=</span> <span class="token operator">-</span>y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u9AD8\u5EA6\u7684x\u4F4D\u7F6E\u6BD4-\u7528\u4E8E\u65CB\u8F6C\u91CF\u7684\u8BA1\u7B97</span>
  <span class="token keyword">const</span> ratioXBaseHeight <span class="token operator">=</span> x <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> ratioLen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>ratioXBaseHeight<span class="token punctuation">,</span> ratioY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u65CB\u8F6C\u91CF</span>
  <span class="token keyword">const</span> angle <span class="token operator">=</span> ratioLen <span class="token operator">*</span> pi2<span class="token punctuation">;</span>

  <span class="token comment">// \u5728\u76F8\u673A\u4E16\u754C\u4E2D\u7684\u4F4D\u79FB\u8DDD\u79BB</span>
  <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>

  <span class="token comment">// \u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u7684x,y\u8F74</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u5C06\u9F20\u6807\u5728\u76F8\u673A\u4E16\u754C\u7684x,y\u8F74\u5411\u7684\u4F4D\u79FB\u91CF\u8F6C\u6362\u4E3A\u4E16\u754C\u5750\u6807\u4F4D</span>
  <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vy <span class="token operator">=</span> my<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u9F20\u6807\u5728s&#39;j&#39;z\u4E2D\u7684\u4F4D\u79FB\u65B9\u5411-x\u8F74</span>
  <span class="token keyword">const</span> moveDir <span class="token operator">=</span> vx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u76EE\u6807\u70B9\u5230\u89C6\u70B9\u7684\u5355\u4F4D\u5411\u91CF-z\u8F74</span>
  <span class="token keyword">const</span> eyeDir <span class="token operator">=</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u4F4D\u79FB\u65B9\u5411\u548C\u89C6\u7EBF\u83B7\u53D6\u65CB\u8F6C\u8F74-\u4E0A\u65B9\u5411y\u8F74</span>
  <span class="token keyword">const</span> axis <span class="token operator">=</span> moveDir<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>eyeDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u65CB\u8F6C\u8F74\u548C\u65CB\u8F6C\u91CF\u5EFA\u7ACB\u56DB\u5143\u6570</span>
  quaternion<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span>axis<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><ol start="3"><li>\u5728 update()\u66F4\u65B0\u65B9\u6CD5\u4E2D\uFF0C\u57FA\u4E8E\u56DB\u5143\u6570\u8BBE\u7F6E\u76F8\u673A\u89C6\u70B9\u4F4D\u7F6E\uFF0C\u5E76\u66F4\u65B0\u76F8\u673A\u4E0A\u65B9\u5411</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u66F4\u65B0\u76F8\u673A\uFF0C\u5E76\u6E32\u67D3 */</span>
<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    \u2026\u2026

    <span class="token comment">//\u65CB\u8F6C\u89C6\u7EBF</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> camera<span class="token punctuation">.</span>position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span>

    <span class="token comment">//\u57FA\u4E8E\u6700\u65B0\u89C6\u7EBF\u8BBE\u7F6E\u76F8\u673A\u4F4D\u7F6E</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
        target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token comment">//\u65CB\u8F6C\u76F8\u673A\u4E0A\u65B9\u5411</span>
    camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span>

    \u2026\u2026

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    quaternion<span class="token punctuation">.</span><span class="token function">setFromRotationMatrix</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>\u4FEE\u6539\u5B8C\u76F8\u673A\u7684\u89C6\u70B9\u4F4D\u548C\u4E0A\u65B9\u540E\uFF0C\u8981\u8BB0\u5F97\u91CD\u7F6E\u56DB\u5143\u6570\uFF0C\u4EE5\u907F\u514D\u5728\u62D6\u62FD\u548C\u7F29\u653E\u65F6\uFF0C\u9020\u6210\u76F8\u673A\u65CB\u8F6C\u3002</p><p><code>\u6CE8</code>\uFF1A<br> \u8F68\u8FF9\u7403\u7684\u64CD\u63A7\u96BE\u5EA6\u662F\u8981\u6BD4\u7403\u5750\u6807\u7CFB\u8F68\u9053\u5927\u7684\uFF0C\u5B83\u5E38\u5E38\u8BA9\u4E0D\u719F\u7EC3\u5176\u7279\u6027\u7684\u64CD\u4F5C\u8005\u627E\u4E0D\u5230\u5317\uFF0C\u6240\u4EE5\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\u8FD8\u662F\u7403\u5750\u6807\u7CFB\u8F68\u9053\u7528\u5F97\u6BD4\u8F83\u591A\u3002</p><h2 id="\u5341\u516D\u3001\u900F\u89C6\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#\u5341\u516D\u3001\u900F\u89C6\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668" aria-hidden="true">#</a> \u5341\u516D\u3001\u900F\u89C6\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668</h2><h3 id="_1-\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_1-\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053" aria-hidden="true">#</a> 1.\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053</h3><p>\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u548C\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u662F\u76F8\u540C\u539F\u7406\u7684\uFF0C\u90FD\u662F\u5BF9\u76F8\u673A\u89C6\u70B9\u548C\u76EE\u6807\u70B9\u7684\u5E73\u79FB\u3002</p><p>1.\u5EFA\u900F\u89C6\u4EA4\u76F8\u673A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateWorldMatrix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>2.\u5728\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u7684\u57FA\u7840\u4E0A\u6539\u4E00\u4E0B pan \u65B9\u6CD5</p><p><img src="`+Cs+`" alt=""></p><ul><li>\u5C06\u9F20\u6807\u5728\u753B\u5E03\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> up <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>

<span class="token comment">//\u89C6\u7EBF\u957F\u5EA6\uFF1A\u76F8\u673A\u89C6\u70B9\u5230\u76EE\u6807\u70B9\u7684\u8DDD\u79BB</span>
<span class="token keyword">const</span> sightLen <span class="token operator">=</span> position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u89C6\u690E\u4F53\u5782\u76F4\u5939\u89D2\u7684\u4E00\u534A(\u5F27\u5EA6) =&gt; (fov/2)*Math.PI/180</span>
<span class="token keyword">const</span> halfFov <span class="token operator">=</span> <span class="token punctuation">(</span>fov <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">;</span>
<span class="token comment">//\u76EE\u6807\u5E73\u9762\u7684\u9AD8\u5EA6</span>
<span class="token keyword">const</span> targetHeight <span class="token operator">=</span> sightLen <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>halfFov<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//\u76EE\u6807\u5E73\u9762\u4E0E\u753B\u5E03\u7684\u9AD8\u5EA6\u6BD4</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> targetHeight <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
<span class="token comment">//\u753B\u5E03\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</span>
<span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> x <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">const</span> distanceUp <span class="token operator">=</span> y <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u6CE8\uFF1A\u76EE\u6807\u5E73\u9762\u662F\u8FC7\u89C6\u70B9\uFF0C\u5E73\u884C\u4E8E\u88C1\u526A\u9762\u7684\u5E73\u9762</p><ul><li>\u5C06\u9F20\u6807\u5728\u76EE\u6807\u5E73\u9762\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u76F8\u673A\u5E73\u79FB\u65B9\u5411</span>
<span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684x\u8F74\u5E73\u79FB\u76F8\u673A</span>
<span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684y\u8F74\uFF0C\u6216\u8005-z\u8F74\u5E73\u79FB\u76F8\u673A</span>
<span class="token keyword">const</span> myOrz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//y\u8F74\uFF0C\u6B63\u4EA4\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
  myOrz<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">//-z\u8F74\uFF0C\u900F\u89C6\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
  myOrz<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807</span>
<span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vy <span class="token operator">=</span> myOrz<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2-\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_2-\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053" aria-hidden="true">#</a> 2.\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053</h3><p>\u900F\u89C6\u76F8\u673A\u7F29\u653E\u662F\u901A\u8FC7\u89C6\u70B9\u6309\u7167\u89C6\u7EBF\u7684\u65B9\u5411\uFF0C\u63A5\u8FD1\u6216\u8005\u8FDC\u79BB\u76EE\u6807\u70B9\u6765\u5B9E\u73B0\u7684\u3002</p><p><img src="`+Is+`" alt=""></p><h4 id="_2-1\u4E3E\u4E2A\u4F8B\u5B50" tabindex="-1"><a class="header-anchor" href="#_2-1\u4E3E\u4E2A\u4F8B\u5B50" aria-hidden="true">#</a> 2.1\u4E3E\u4E2A\u4F8B\u5B50</h4><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u89C6\u70B9 e=5</li><li>\u76EE\u6807\u70B9 t=15</li><li>\uFF08\u89C6\u70B9\u5373\u5C06\u4F4D\u79FB\u7684\u8DDD\u79BB\uFF09/\uFF08\u4F4D\u79FB\u524D\uFF0C\u89C6\u70B9\u4E0E\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09= 0.4</li></ul><p>\u6C42\uFF1A\u89C6\u70B9\u79FB\u52A8 2 \u6B21\u540E\u7684\u4F4D\u7F6E</p><p><code>\u89E3</code>\uFF1A</p><p>\u89C6\u70B9\u7B2C 1 \u6B21\u79FB\u52A8\u540E\u7684\u4F4D\u7F6E\uFF1A5+(15-5)*0.4=9<br> \u89C6\u70B9\u7B2C 2 \u6B21\u79FB\u52A8\u540E\u7684\u4F4D\u7F6E\uFF1A9+(15-9)*0.4= 11.4<br> \u57FA\u672C\u539F\u7406\u5C31\u662F\u8FD9\u6837\uFF0C\u89C6\u70B9\u79FB\u52A8 n \u6B64\u540E\u7684\u4F4D\u7F6E\u90FD\u53EF\u4EE5\u6309\u7167\u4E0A\u9762\u7684\u903B\u8F91\u6765\u8BA1\u7B97\u3002</p><h4 id="_2-2\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-2\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 2.2\u4EE3\u7801\u5B9E\u73B0</h4><p>\u53EF\u4EE5\u76F4\u63A5\u5728\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u57FA\u7840\u4E0A\u505A\u4E00\u4E0B\u4FEE\u6539\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">lerp</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">-</span> dollyScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p>lerp ( v : Vector3, alpha : Float ) \u6309\u6BD4\u4F8B\u53BB\u4E24\u70B9\u4E4B\u95F4\u7684\u63D2\u503C</p><p>\u5176\u6E90\u7801\u5982\u4E0B\uFF1A</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">lerp</span><span class="token punctuation">(</span> <span class="token parameter">v<span class="token punctuation">,</span> alpha</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token punctuation">)</span> <span class="token operator">*</span> alpha<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token punctuation">)</span> <span class="token operator">*</span> alpha<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token operator">+=</span> <span class="token punctuation">(</span> v<span class="token punctuation">.</span>z <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>z <span class="token punctuation">)</span> <span class="token operator">*</span> alpha<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>dollyScale\uFF1A\uFF08\u4F4D\u79FB\u4E4B\u540E\u89C6\u70B9\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09/\uFF08\u4F4D\u79FB\u524D\uFF0C\u89C6\u70B9\u4E0E\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09</p></li><li><p>1-dollyScale\uFF1A\uFF08\u89C6\u70B9\u5373\u5C06\u4F4D\u79FB\u7684\u8DDD\u79BB\uFF09/\uFF08\u4F4D\u79FB\u524D\uFF0C\u89C6\u70B9\u4E8E\u4E0E\u76EE\u6807\u70B9\u7684\u8DDD\u79BB\uFF09</p></li></ul><p>\u6B63\u4EA4\u76F8\u673A\u7F29\u653E\u8F68\u9053\u7684\u57FA\u672C\u5B9E\u73B0\u539F\u7406\u5C31\u662F\u8FD9\u4E48\u7B80\u5355\u3002</p><p>\u7136\u800C\uFF0C\u540E\u9762\u8FD8\u5F97\u7528\u7403\u5750\u6807\u5BF9\u76F8\u673A\u8FDB\u884C\u65CB\u8F6C\uFF0C\u7403\u5750\u6807\u662F\u5DF2\u7ECF\u6DB5\u76D6\u4E86\u76F8\u673A\u89C6\u70B9\u4F4D\u7684\u3002<br> \u56E0\u6B64\uFF0C\u8FD8\u53EF\u4EE5\u76F4\u63A5\u628A\u76F8\u673A\u89C6\u70B9\u4F4D\u5199\u8FDB\u7403\u5750\u6807\u91CC\u3002</p><h4 id="_2-3\u7403\u5750\u6807\u7F29\u653E" tabindex="-1"><a class="header-anchor" href="#_2-3\u7403\u5750\u6807\u7F29\u653E" aria-hidden="true">#</a> 2.3\u7403\u5750\u6807\u7F29\u653E</h4><p>1.\u50CF\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u90A3\u6837\uFF0C\u5B9A\u4E49\u7403\u5750\u6807\u5BF9\u8C61\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2.\u4FEE\u6539\u65CB\u8F6C\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">dolly</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  spherical<span class="token punctuation">.</span>radius <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3.\u66F4\u65B0\u65B9\u6CD5\u4E5F\u548C\u6B63\u4EA4\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u4E00\u6837</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u548C\u65CB\u8F6C\u76F8\u673A</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u91CD\u7F6E\u7403\u5750\u6807\u548C\u5E73\u79FB\u91CF</span>
  spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3-\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" tabindex="-1"><a class="header-anchor" href="#_3-\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053" aria-hidden="true">#</a> 3.\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053</h3><p>\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u548C\u6B63\u4EA4\u76F8\u673A\u7684\u5B9E\u73B0\u539F\u7406\u90FD\u662F\u4E00\u6837\u7684\uFF0C\u53EF\u4EE5\u7528\u7403\u5750\u6807\u7CFB\u5B9E\u73B0\uFF0C\u4E5F\u53EF\u4EE5\u7528\u8F68\u8FF9\u7403\u5B9E\u73B0\u3002</p><ul><li>\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u53EF\u76F4\u63A5\u53C2\u8003\u6B63\u4EA4\u76F8\u673A\u57FA\u4E8E\u7403\u5750\u6807\u7CFB\u7684\u65CB\u8F6C\u8F68\u9053\u6765\u5199\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u65CB\u8F6C\u8F68\u9053 */</span>
<span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">//&#39;xy&#39;,&#39;x&#39;,&#39;y&#39;</span>
<span class="token keyword">const</span> rotateDir <span class="token operator">=</span> <span class="token string">&#39;xy&#39;</span>

\u2026\u2026

<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&#39;pan&#39;</span><span class="token operator">:</span>
            <span class="token function">pan</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">&#39;rotate&#39;</span><span class="token operator">:</span>
            <span class="token function">rotate</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
\u2026\u2026

<span class="token comment">// \u65CB\u8F6C\u65B9\u6CD5</span>
<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas
    <span class="token keyword">const</span> deltaT <span class="token operator">=</span> pi2 <span class="token operator">*</span> x <span class="token operator">/</span> clientHeight
    <span class="token keyword">const</span> deltaP <span class="token operator">=</span> pi2 <span class="token operator">*</span> y <span class="token operator">/</span> clientHeight
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> phi <span class="token operator">=</span> spherical<span class="token punctuation">.</span>phi <span class="token operator">-</span> deltaP
        spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
            Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99999999</span><span class="token punctuation">,</span>
            Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.00000001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span>

    <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u76F8\u673A</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
        target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>
        camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span>
        camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>
        camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment">// \u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><ul><li>\u5BF9\u4E8E\u8F68\u8FF9\u7403\u7684\u65CB\u8F6C\u8F68\u9053\uFF0C\u57FA\u4E8E\u6B63\u4EA4\u76F8\u673A\u8F68\u8FF9\u7403\u65CB\u8F6C\u7684\u4EE3\u7801\u7565\u4F5C\u8C03\u6574\u5373\u53EF\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u65CB\u8F6C\u8F68\u9053 */</span>
<span class="token keyword">const</span> quaternion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Quaternion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> fov <span class="token punctuation">}</span> <span class="token operator">=</span> camera<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> canvas<span class="token punctuation">;</span>

  <span class="token comment">/* 1.\u57FA\u4E8E\u9F20\u6807\u62D6\u62FD\u8DDD\u79BB\u8BA1\u7B97\u65CB\u8F6C\u91CF */</span>
  <span class="token comment">// \u9F20\u6807\u4F4D\u79FB\u8DDD\u79BB\u5728\u753B\u5E03\u4E2D\u7684\u5360\u6BD4</span>
  <span class="token keyword">const</span> ratioY <span class="token operator">=</span> <span class="token operator">-</span>y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u57FA\u4E8E\u9AD8\u5EA6\u7684x\u4F4D\u7F6E\u6BD4-\u7528\u4E8E\u65CB\u8F6C\u91CF\u7684\u8BA1\u7B97</span>
  <span class="token keyword">const</span> ratioBaseHeight <span class="token operator">=</span> x <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> ratioLen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>ratioBaseHeight<span class="token punctuation">,</span> ratioY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u65CB\u8F6C\u91CF</span>
  <span class="token keyword">const</span> angle <span class="token operator">=</span> ratioLen <span class="token operator">*</span> pi2<span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u5C06\u9F20\u6807\u5728\u753B\u5E03\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF */</span>
  <span class="token comment">//\u89C6\u7EBF\u957F\u5EA6\uFF1A\u76F8\u673A\u89C6\u70B9\u5230\u76EE\u6807\u70B9\u7684\u8DDD\u79BB</span>
  <span class="token keyword">const</span> sightLen <span class="token operator">=</span> position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u89C6\u690E\u4F53\u5782\u76F4\u5939\u89D2\u7684\u4E00\u534A(\u5F27\u5EA6)</span>
  <span class="token keyword">const</span> halfFov <span class="token operator">=</span> <span class="token punctuation">(</span>fov <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">;</span>
  <span class="token comment">//\u76EE\u6807\u5E73\u9762\u7684\u9AD8\u5EA6</span>
  <span class="token keyword">const</span> targetHeight <span class="token operator">=</span> sightLen <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>halfFov<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token comment">//\u76EE\u6807\u5E73\u9762\u4E0E\u753B\u5E03\u7684\u9AD8\u5EA6\u6BD4</span>
  <span class="token keyword">const</span> ratio <span class="token operator">=</span> targetHeight <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
  <span class="token comment">//\u753B\u5E03\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</span>
  <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> x <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
  <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> <span class="token operator">-</span>y <span class="token operator">*</span> ratio<span class="token punctuation">;</span>

  <span class="token comment">/* 3.\u5C06\u9F20\u6807\u5728\u76EE\u6807\u5E73\u9762\u4E2D\u7684\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807\uFF0C\u5E76\u4ECE\u4E2D\u63D0\u53D6\u9F20\u6807\u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4F4D\u79FB\u65B9\u5411 */</span>
  <span class="token comment">// \u76F8\u673A\u672C\u5730\u5750\u6807\u7CFB\u7684x,y\u8F74</span>
  <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> my <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5C06\u9F20\u6807\u5728\u76F8\u673A\u4E16\u754C\u7684x,y\u8F74\u5411\u7684\u4F4D\u79FB\u91CF\u8F6C\u6362\u4E3A\u4E16\u754C\u5750\u6807\u4F4D</span>
  <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vy <span class="token operator">=</span> my<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u9F20\u6807\u5728\u4E16\u754C\u5750\u6807\u7CFB\u4E2D\u7684\u4F4D\u79FB\u65B9\u5411-x\u8F74</span>
  <span class="token keyword">const</span> moveDir <span class="token operator">=</span> vx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 4.\u57FA\u4E8E\u4F4D\u79FB\u65B9\u5411\u548C\u89C6\u7EBF\u83B7\u53D6\u65CB\u8F6C\u8F74 */</span>
  <span class="token comment">//\u76EE\u6807\u70B9\u5230\u89C6\u70B9\u7684\u5355\u4F4D\u5411\u91CF-z\u8F74</span>
  <span class="token keyword">const</span> eyeDir <span class="token operator">=</span> position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u57FA\u4E8E\u4F4D\u79FB\u65B9\u5411\u548C\u89C6\u7EBF\u83B7\u53D6\u65CB\u8F6C\u8F74-\u4E0A\u65B9\u5411y\u8F74</span>
  <span class="token keyword">const</span> axis <span class="token operator">=</span> moveDir<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>eyeDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 5.\u57FA\u4E8E\u65CB\u8F6C\u8F74\u548C\u65CB\u8F6C\u91CF\u66F4\u65B0\u56DB\u5143\u6570 */</span>
  quaternion<span class="token punctuation">.</span><span class="token function">setFromAxisAngle</span><span class="token punctuation">(</span>axis<span class="token punctuation">,</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u57FA\u4E8E\u65CB\u8F6C\u91CF\u65CB\u8F6C\u76F8\u673A</span>
  <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> camera<span class="token punctuation">.</span>position
    <span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>

  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>up<span class="token punctuation">.</span><span class="token function">applyQuaternion</span><span class="token punctuation">(</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">,</span> camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
  quaternion<span class="token punctuation">.</span><span class="token function">setFromRotationMatrix</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E32\u67D3</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h2 id="\u5341\u4E03\u3001\u5C01\u88C5\u76F8\u673A\u8F68\u9053\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E03\u3001\u5C01\u88C5\u76F8\u673A\u8F68\u9053\u5BF9\u8C61" aria-hidden="true">#</a> \u5341\u4E03\u3001\u5C01\u88C5\u76F8\u673A\u8F68\u9053\u5BF9\u8C61</h2><p>\u53C2\u8003 three.js \u91CC\u7684 OrbitControls \u5BF9\u8C61\uFF0C\u5C01\u88C5\u4E00\u4E2A\u8F68\u9053\u63A7\u5236\u5668\u51FA\u6765\u3002<br> \u81F3\u4E8E\u8F68\u8FF9\u7403\u7684\u5C01\u88C5\uFF0C\u53EF\u4EE5\u53C2\u8003\u7740 TrackballControls \u6765\u5B9E\u73B0\u3002</p><p><strong><code>\u6B63\u4EA4\u76F8\u673A\u8F68\u9053\u548C\u900F\u89C6\u76F8\u673A\u8F68\u9053\u5DEE\u5F02\u5BF9\u6BD4</code></strong>\uFF1A</p><ol><li>\u65CB\u8F6C\u8F68\u9053</li></ol><ul><li>\u6B63\u4EA4\u76F8\u673A\u548C\u900F\u89C6\u76F8\u673A\u7684\u65CB\u8F6C\u8F68\u9053\u90FD\u662F\u4E00\u6837\u7684\uFF0C\u90FD\u662F\u4F7F\u7528\u7403\u5750\u6807\uFF0C\u8BA9\u76F8\u673A\u89C6\u70B9\u56F4\u7ED5\u76EE\u6807\u70B9\u505A\u7684\u65CB\u8F6C\u3002</li></ul><ol start="2"><li>\u4F4D\u79FB\u8F68\u9053</li></ol><ul><li>\u6B63\u4EA4\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u662F\u9F20\u6807\u4ECE canvas \u753B\u5E03\u5230\u8FD1\u88C1\u526A\u9762\uFF0C\u518D\u5230\u4E16\u754C\u5750\u6807\u7CFB\u7684\u4F4D\u79FB\u91CF\u7684\u8F6C\u6362\uFF0C\u6700\u540E\u8FD9\u4E2A\u4F4D\u79FB\u91CF\u4F1A\u540C\u65F6\u4F5C\u7528\u4E8E\u76F8\u673A\u7684\u76EE\u6807\u70B9\u548C\u89C6\u70B9\u3002</li><li>\u900F\u89C6\u76F8\u673A\u7684\u4F4D\u79FB\u8F68\u9053\u662F\u9F20\u6807\u4ECE canvas \u753B\u5E03\u5230\u76EE\u6807\u5E73\u9762\uFF0C\u518D\u5230\u4E16\u754C\u5750\u6807\u7CFB\u7684\u4F4D\u79FB\u91CF\u7684\u8F6C\u6362\uFF0C\u6700\u540E\u8FD9\u4E2A\u4F4D\u79FB\u91CF\u4F1A\u540C\u65F6\u4F5C\u7528\u4E8E\u76F8\u673A\u7684\u76EE\u6807\u70B9\u548C\u89C6\u70B9\u3002</li></ul><ol start="3"><li>\u7F29\u653E\u8F68\u9053</li></ol><ul><li>\u6B63\u4EA4\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053\u662F\u901A\u8FC7\u5BF9\u5176\u53EF\u89C6\u533A\u57DF\u7684\u5BBD\u9AD8\u5C3A\u5BF8\u7684\u7F29\u653E\u5B9E\u73B0\u7684\u3002</li><li>\u900F\u89C6\u76F8\u673A\u7684\u7F29\u653E\u8F68\u9053\u662F\u901A\u8FC7\u76F8\u673A\u89C6\u70B9\u5728\u89C6\u7EBF\u4E0A\u7684\u4F4D\u79FB\u5B9E\u73B0\u7684\u3002</li></ul><h3 id="_1-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5C01\u88C5" tabindex="-1"><a class="header-anchor" href="#_1-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5C01\u88C5" aria-hidden="true">#</a> 1.\u8F68\u9053\u63A7\u5236\u5668\u7684\u5C01\u88C5</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  Vector2<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
  Spherical<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pi2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mouseButtons</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;rotate&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;pan&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dragStart</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dragEnd</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">panOffset</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">screenSpacePanning</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">zoomScale</span><span class="token operator">:</span> <span class="token number">0.95</span><span class="token punctuation">,</span>
  <span class="token literal-property property">spherical</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rotateDir</span><span class="token operator">:</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">OrbitControls</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">updateSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> spherical<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> target <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pointerdown</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">,</span> button <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> dragStart<span class="token punctuation">,</span> mouseButtons <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    dragStart<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> mouseButtons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pointermove</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      dragStart<span class="token punctuation">,</span>
      dragEnd<span class="token punctuation">,</span>
      state<span class="token punctuation">,</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;pan&quot;</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">pan</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;rotate&quot;</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pointerup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">wheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      zoomScale<span class="token punctuation">,</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> scale <span class="token operator">=</span> deltaY <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> zoomScale <span class="token operator">:</span> <span class="token number">1</span> <span class="token operator">/</span> zoomScale<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dolly</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">dollyPerspectiveCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spherical<span class="token punctuation">.</span>radius <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">dollyOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> camera <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>zoom <span class="token operator">*=</span> dollyScale<span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">panPerspectiveCamera</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> matrix<span class="token punctuation">,</span> position<span class="token punctuation">,</span> fov<span class="token punctuation">,</span> up <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span><span class="token punctuation">,</span>
      panOffset<span class="token punctuation">,</span>
      screenSpacePanning<span class="token punctuation">,</span>
      target<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//\u89C6\u7EBF\u957F\u5EA6\uFF1A\u76F8\u673A\u89C6\u70B9\u5230\u76EE\u6807\u70B9\u7684\u8DDD\u79BB</span>
    <span class="token keyword">const</span> sightLen <span class="token operator">=</span> position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u89C6\u690E\u4F53\u5782\u76F4\u5939\u89D2\u7684\u4E00\u534A(\u5F27\u5EA6)</span>
    <span class="token keyword">const</span> halfFov <span class="token operator">=</span> <span class="token punctuation">(</span>fov <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">360</span><span class="token punctuation">;</span>
    <span class="token comment">//\u76EE\u6807\u5E73\u9762\u7684\u9AD8\u5EA6</span>
    <span class="token keyword">const</span> targetHeight <span class="token operator">=</span> sightLen <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>halfFov<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">//\u76EE\u6807\u5E73\u9762\u4E0E\u753B\u5E03\u7684\u9AD8\u5EA6\u6BD4</span>
    <span class="token keyword">const</span> ratio <span class="token operator">=</span> targetHeight <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token comment">//\u753B\u5E03\u4F4D\u79FB\u91CF\u8F6C\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF</span>
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> x <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> y <span class="token operator">*</span> ratio<span class="token punctuation">;</span>

    <span class="token comment">//\u76F8\u673A\u5E73\u79FB\u65B9\u5411</span>
    <span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684x\u8F74\u5E73\u79FB\u76F8\u673A</span>
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u9F20\u6807\u6C34\u5E73\u8FD0\u52A8\u65F6\uFF0C\u6309\u7167\u76F8\u673A\u672C\u5730\u5750\u6807\u7684y\u8F74\uFF0C\u6216\u8005-z\u8F74\u5E73\u79FB\u76F8\u673A</span>
    <span class="token keyword">const</span> myOrz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//y\u8F74\uFF0C\u6B63\u4EA4\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
      myOrz<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//-z\u8F74\uFF0C\u900F\u89C6\u76F8\u673A\u4E2D\u9ED8\u8BA4</span>
      myOrz<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u76EE\u6807\u5E73\u9762\u4F4D\u79FB\u91CF\u8F6C\u4E16\u754C\u5750\u6807</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> myOrz<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">panOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> right<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> up <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span><span class="token punctuation">,</span>
      panOffset<span class="token punctuation">,</span>
      screenSpacePanning<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> cameraW <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span>
    <span class="token keyword">const</span> cameraH <span class="token operator">=</span> top <span class="token operator">-</span> bottom<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ratioX <span class="token operator">=</span> x <span class="token operator">/</span> clientWidth<span class="token punctuation">;</span>
    <span class="token keyword">const</span> ratioY <span class="token operator">=</span> y <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceLeft <span class="token operator">=</span> ratioX <span class="token operator">*</span> cameraW<span class="token punctuation">;</span>
    <span class="token keyword">const</span> distanceUp <span class="token operator">=</span> ratioY <span class="token operator">*</span> cameraH<span class="token punctuation">;</span>
    <span class="token keyword">const</span> mx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vx <span class="token operator">=</span> mx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token operator">-</span>distanceLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>screenSpacePanning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">setFromMatrixColumn</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      vy<span class="token punctuation">.</span><span class="token function">crossVectors</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> mx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    vy<span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>distanceUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    panOffset<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>vx<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">dom</span><span class="token operator">:</span> <span class="token punctuation">{</span> clientHeight <span class="token punctuation">}</span><span class="token punctuation">,</span>
      spherical<span class="token punctuation">,</span>
      rotateDir<span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaT <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> deltaP <span class="token operator">=</span> <span class="token punctuation">(</span>pi2 <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> clientHeight<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      spherical<span class="token punctuation">.</span>theta <span class="token operator">-=</span> deltaT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rotateDir<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> phi <span class="token operator">=</span> spherical<span class="token punctuation">.</span>phi <span class="token operator">-</span> deltaP<span class="token punctuation">;</span>
      spherical<span class="token punctuation">.</span>phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>
        Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.99999999</span><span class="token punctuation">,</span> 
        Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.00000001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> spherical<span class="token punctuation">,</span> panOffset <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">//\u57FA\u4E8E\u5E73\u79FB\u91CF\u5E73\u79FB\u76F8\u673A</span>
    target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>panOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u57FA\u4E8E\u7403\u5750\u6807\u7F29\u653E\u76F8\u673A</span>
    <span class="token keyword">const</span> rotateOffset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rotateOffset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u91CD\u7F6E\u65CB\u8F6C\u91CF\u548C\u5E73\u79FB\u91CF</span>
    spherical<span class="token punctuation">.</span><span class="token function">setFromVector3</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    panOffset<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> projectionMatrix<span class="token punctuation">,</span> matrixWorldInverse <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pvMatrix<span class="token punctuation">.</span><span class="token function">multiplyMatrices</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> matrixWorldInverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br></div></div></details><h3 id="_2-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u4F8B\u5316" tabindex="-1"><a class="header-anchor" href="#_2-\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u4F8B\u5316" aria-hidden="true">#</a> 2.\u8F68\u9053\u63A7\u5236\u5668\u7684\u5B9E\u4F8B\u5316</h3><p>OrbitControls \u5BF9\u8C61\u5C31\u50CF three.js \u91CC\u7684\u6837\uFF0C\u53EF\u4EE5\u81EA\u52A8\u6839\u636E\u76F8\u673A\u7C7B\u578B\u53BB\u505A\u76F8\u5E94\u7684\u8F68\u9053\u53D8\u6362\u3002</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u900F\u89C6\u76F8\u673A */</span>
<span class="token comment">/*
	const eye = new Vector3(0, 0.5, 1)
    const target = new Vector3(0, 0, -2.5)
    const up = new Vector3(0, 1, 0)
    const [fov, aspect, near, far] = [
      45,
      canvas.width / canvas.height,
      1,
      20
    ]
    const camera = new PerspectiveCamera(fov, aspect, near, far)
    camera.position.copy(eye)
*/</span>

<span class="token comment">/* \u6B63\u4EA4\u76F8\u673A */</span>
<span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token operator">-</span>halfW<span class="token punctuation">,</span> halfW<span class="token punctuation">,</span> halfH<span class="token punctuation">,</span> <span class="token operator">-</span>halfH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>
    left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far
<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>

<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

\u2026\u2026

<span class="token comment">/* \u5B9E\u4F8B\u5316\u8F68\u9053\u63A7\u5236\u5668 */</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    camera<span class="token punctuation">,</span>
    target<span class="token punctuation">,</span>
    <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//\u6EDA\u8F6E\u4E8B\u4EF6</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    pvMatrix<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div></details><h2 id="\u5341\u516B\u3001\u9876\u70B9\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#\u5341\u516B\u3001\u9876\u70B9\u7D22\u5F15" aria-hidden="true">#</a> \u5341\u516B\u3001\u9876\u70B9\u7D22\u5F15</h2><h3 id="_1-\u9876\u70B9\u7D22\u5F15\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u9876\u70B9\u7D22\u5F15\u6982\u5FF5" aria-hidden="true">#</a> 1.\u9876\u70B9\u7D22\u5F15\u6982\u5FF5</h3><p>\u5BF9\u4E8E\u9876\u70B9\u7D22\u5F15\u7684\u6982\u5FF5\uFF0C\u5728\u590D\u5408\u53D8\u6362\u91CC (\u7528 js \u5B9E\u73B0\u7684\u9876\u70B9\u7D22\u5F15\u529F\u80FD) \u7684\u6A21\u578B\u77E9\u9635\u63D0\u8FC7\u3002</p><details class="custom-container details"><summary>webgl api\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_ViewMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_ViewMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    Vector3
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u9876\u70B9\u5E93 \uFF083\u4E2A\u4E00\u7EC4\uFF0C\u4EE3\u8868x, y, z\uFF09</span>
  <span class="token keyword">const</span> verticeLib <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u9876\u70B9\u7D22\u5F15\u96C6\u5408\uFF0C\u6BCF\u4E00\u4E2A\u6570\u5B57\u5BF9\u5E94\u6BCF\u4E00\u7EC4\u9876\u70B9\uFF083\u4E2A\uFF09</span>
  <span class="token keyword">const</span> indices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span>

    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> verticeLib<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u89C6\u56FE\u77E9\u9635\u548C\u6A21\u578B\u77E9\u9635</span>
  <span class="token keyword">const</span> u_ViewMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ViewMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> viewMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ViewMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> viewMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5EFA\u7ACB\u7F13\u51B2\u533A\u5BF9\u8C61</span>
  <span class="token keyword">const</span> indicesBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u628A\u7F13\u51B2\u533A\u7ED1\u5B9A\u5230webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indicesBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5F80\u7F13\u51B2\u533A\u5199\u6570\u636E</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5237\u5E95\u8272</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7ED8\u56FE</span>
  gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> indices<span class="token punctuation">.</span>length<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><div class="highlight-line">\xA0</div><br><br><br><div class="highlight-line">\xA0</div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Ls+'" alt=""></p><p>gl.drawElements()\uFF1A<br><img src="'+Os+`" alt=""></p></details><h3 id="_2-\u5F69\u8272\u7ACB\u65B9\u4F53" tabindex="-1"><a class="header-anchor" href="#_2-\u5F69\u8272\u7ACB\u65B9\u4F53" aria-hidden="true">#</a> 2.\u5F69\u8272\u7ACB\u65B9\u4F53</h3><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec4 a_Color<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  varying vec4 v_Color<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    PerspectiveCamera<span class="token punctuation">,</span>
    Vector3
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span><span class="token punctuation">;</span>

  <span class="token comment">/* \u6B63\u5E38\u521D\u59CB\u5316\u7740\u8272\u5668\uFF0C\u6253\u5F00\u6DF1\u5EA6\u6D4B\u8BD5*/</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u6253\u5F00\u6DF1\u5EA6\u6D4B\u8BD5=&gt;\u6DF1\u5EA6\u6D4B\u8BD5\u53EF\u4EE5\u89E3\u51B3\u7269\u4F53\u7684\u906E\u6321\u95EE\u9898,\u4E0D\u7136\u540E\u9762\u7684\u7269\u4F53\u53EF\u80FD\u6321\u4F4F\u524D\u9762\u7684\u7269\u4F53</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">/* \u5EFA\u7ACB\u900F\u89C6\u76F8\u673A\u548C\u8F68\u9053\u63A7\u5236\u5668 */</span>
  <span class="token comment">//\u900F\u89C6\u76F8\u673A </span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">45</span><span class="token punctuation">,</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">20</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5B9E\u4F8B\u5316\u8F68\u9053\u63A7\u5236\u5668 </span>
  <span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span>
    <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A </span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6307\u9488\u79FB\u52A8\u65F6,\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001,\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001,\u65CB\u8F6C\u76F8\u673A</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6307\u9488\u62AC\u8D77 </span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6EDA\u8F6E\u4E8B\u4EF6</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>


  <span class="token comment">/* \u58F0\u660E\u9876\u70B9\u6570\u636E vertices \u548C\u9876\u70B9\u7D22\u5F15 indexes */</span>
  <span class="token comment">//    v6----- v5</span>
  <span class="token comment">//   /|      /|</span>
  <span class="token comment">//  v1------v0|</span>
  <span class="token comment">//  | |     | |</span>
  <span class="token comment">//  | |v7---|-|v4</span>
  <span class="token comment">//  |/      |/</span>
  <span class="token comment">//  v2------v3</span>
  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// v0 White</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// v1 Magenta</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v2 Red</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// v3 Yellow</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v4 Green</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v5 Cyan</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// v6 Blue</span>
    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>   <span class="token comment">// v7 Black</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>    <span class="token comment">// front</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>    <span class="token comment">// right</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment">// up</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// left</span>
    <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// down</span>
    <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span>     <span class="token comment">// back</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>


  <span class="token comment">/* \u5C06\u9876\u70B9\u6570\u636E\u5199\u5165\u7F13\u51B2\u533A\uFF0C\u5E76\u5C06\u5176\u4E2D\u7684\u70B9\u4F4D\u548C\u989C\u8272\u6570\u636E\u5206\u522B\u5206\u914D\u7ED9 
  *  a_Position \u548C a_Color 
  */</span>
  <span class="token comment">//\u5143\u7D20\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> elementBytes <span class="token operator">=</span> vertices<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token constant">FSIZE</span> <span class="token operator">=</span> vertices<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7CFB\u5217\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> verticeSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorSize <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token comment">//\u7C7B\u76EE\u5C3A\u5BF8</span>
  <span class="token keyword">const</span> categorySize <span class="token operator">=</span> verticeSize <span class="token operator">+</span> colorSize<span class="token punctuation">;</span>
  <span class="token comment">//\u7C7B\u76EE\u5B57\u8282\u6570</span>
  <span class="token keyword">const</span> categoryBytes <span class="token operator">=</span> categorySize <span class="token operator">*</span> elementBytes<span class="token punctuation">;</span>
  <span class="token comment">//\u7CFB\u5217\u5B57\u8282\u7D22\u5F15\u4F4D\u7F6E</span>
  <span class="token keyword">const</span> verticeByteIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> colorByteIndex <span class="token operator">=</span> verticeSize <span class="token operator">*</span> elementBytes<span class="token punctuation">;</span>

  <span class="token comment">//\u9876\u70B9\u7F13\u51B2\u533A</span>
  <span class="token keyword">const</span> vertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5C06\u9876\u70B9\u7F13\u51B2\u533A\u91CC\u7684\u70B9\u4F4D\u6570\u636E\u5206\u914D\u7ED9a_Position</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Position<span class="token punctuation">,</span>
    verticeSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    verticeByteIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u5C06\u9876\u70B9\u7F13\u51B2\u533A\u91CC\u7684\u989C\u8272\u6570\u636E\u5206\u914D\u7ED9a_Color</span>
  <span class="token keyword">const</span> a_Color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Color&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
    a_Color<span class="token punctuation">,</span>
    colorSize<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span><span class="token punctuation">,</span>
    categoryBytes<span class="token punctuation">,</span>
    colorByteIndex
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">/* \u5C06\u9876\u70B9\u7D22\u5F15\u5199\u5165\u7F13\u51B2\u533A */</span>
  <span class="token comment">// \u5EFA\u7ACB\u7F13\u51B2\u533A\u5BF9\u8C61</span>
  <span class="token keyword">const</span> indexesBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u628A\u7F13\u51B2\u533A\u7ED1\u5B9A\u5230webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\u4E0A</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indexesBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5F80\u7F13\u51B2\u533A\u5199\u6570\u636E</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  
  <span class="token comment">/* \u5EFA\u7ACB\u6A21\u578B\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u7247\u5143\u7740\u8272\u5668 */</span>
  <span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  modelMatrix<span class="token punctuation">.</span><span class="token function">makeScale</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">/* \u5EFA\u7ACB\u6295\u5F71\u89C6\u56FE\u77E9\u9635\uFF0C\u5E76\u4F20\u9012\u7ED9\u7247\u5143\u7740\u8272\u5668 */</span>
  <span class="token keyword">const</span> u_PvMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_PvMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">/* \u7528\u8FDE\u7EED\u6E32\u67D3\u7684\u65B9\u6CD5\u7ED8\u56FE */</span>
  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modelMatrix<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeRotationY</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+Ds+'" alt=""></p><p>\u6CE8\u610F\uFF1A<br> a_Color \u548C a_Position \u4E00\u4E00\u5BF9\u5E94\u7684\uFF0C\u4E00\u4E2A\u9876\u70B9\uFF0C\u4E00\u4E2A\u989C\u8272\uFF0C\u6240\u4EE5\u7528 attribute \u58F0\u660E\u7684 a_Color<br> \u5982\u679C\u6574\u4E2A\u7ACB\u65B9\u4F53\u90FD\u662F\u4E00\u4E2A\u989C\u8272\uFF0C\u76F4\u63A5\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u7528 uniform \u58F0\u660E\u5C31\u597D\u4E86</p></details><h2 id="\u5341\u4E5D\u3001\u591A\u7740\u8272\u5668" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E5D\u3001\u591A\u7740\u8272\u5668" aria-hidden="true">#</a> \u5341\u4E5D\u3001\u591A\u7740\u8272\u5668</h2><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u4E0D\u53EF\u80FD\u53EA\u7528\u4E00\u5957\u7740\u8272\u5668\u505A\u9879\u76EE\u7684\uFF0C\u6BD4\u5982\u573A\u666F\u91CC\u6709\u4E24\u4E2A\u4E09\u89D2\u5F62\uFF0C\u4E00\u4E2A\u4E09\u89D2\u5F62\u9700\u8981\u7740\u7EAF\u8272\uFF0C\u4E00\u4E2A\u4E09\u89D2\u5F62\u9700\u8981\u7740\u7EB9\u7406\u3002</p><p><img src="'+zs+`" alt=""></p><h3 id="_1-\u591A\u7740\u8272\u5668\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-\u591A\u7740\u8272\u5668\u7ED8\u56FE" aria-hidden="true">#</a> 1.\u591A\u7740\u8272\u5668\u7ED8\u56FE</h3><h4 id="_1-1\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668" tabindex="-1"><a class="header-anchor" href="#_1-1\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668" aria-hidden="true">#</a> 1.1\u51C6\u5907\u4E24\u5957\u7740\u8272\u5668</h4><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- \u7740\u7EAF\u8272 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- \u7740\u7EB9\u7406 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span> <span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_1-2\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62" tabindex="-1"><a class="header-anchor" href="#_1-2\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62" aria-hidden="true">#</a> 1.2\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62</h4><ol><li>\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> solidVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> solidFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidFragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> solidProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> solidVsSource<span class="token punctuation">,</span> solidFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>createProgram() \u65B9\u6CD5\u662F\u57FA\u4E8E\u4E00\u5957\u7740\u8272\u5668\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\u7684\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u521B\u5EFA\u7A0B\u5E8F\u5BF9\u8C61</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u5EFA\u7ACB\u7740\u8272\u5BF9\u8C61</span>
  <span class="token keyword">const</span> vertexShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fragmentShader <span class="token operator">=</span> <span class="token function">loadShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u628A\u9876\u70B9\u7740\u8272\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u628A\u7247\u5143\u7740\u8272\u5BF9\u8C61\u88C5\u8FDB\u7A0B\u5E8F\u5BF9\u8C61\u4E2D</span>
  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//\u8FDE\u63A5webgl\u4E0A\u4E0B\u6587\u5BF9\u8C61\u548C\u7A0B\u5E8F\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> program<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u4E4B\u524D\u521D\u59CB\u5316\u7740\u8272\u5668\u65B9\u6CD5 initShaders() \u53EA\u662F\u6BD4\u4E0A\u9762\u7684\u65B9\u6CD5\u591A\u4E86\u4E00\u4E2A\u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61\u7684\u6B65\u9AA4\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u91CC\u4E4B\u6240\u4EE5\u628A\u542F\u7528\u7A0B\u5E8F\u7684\u6B65\u9AA4\u63D0\u53D6\u51FA\u6765\uFF0C\u662F\u56E0\u4E3A\u4E00\u5957\u7740\u8272\u5668\u5BF9\u5E94\u7740\u4E00\u4E2A\u7A0B\u5E8F\u5BF9\u8C61\u3002<br> \u800C\u4E00\u4E2A webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u662F\u53EF\u4EE5\u4F9D\u6B21\u5E94\u7528\u591A\u4E2A\u7A0B\u5E8F\u5BF9\u8C61\u7684\u3002<br> \u901A\u8FC7\u4E0D\u540C\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u7ED8\u5236\u4E0D\u540C\u6750\u8D28\u7684\u56FE\u5F62\u3002</p><ol start="2"><li>\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> solidVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> 
  <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> 
  <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> solidVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> solidPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u56E0\u4E3A\u540E\u9762\u8FD8\u9700\u8981\u7ED8\u5236\u4E00\u4E2A\u7EB9\u7406\u56FE\u5F62\uFF0C\u7EB9\u7406\u56FE\u5F62\u662F\u9700\u8981\u7B49\u7EB9\u7406\u52A0\u8F7D\u6210\u529F\u624D\u80FD\u7ED8\u5236\u7684\u3002<br> \u8FD9\u4F1A\u9020\u6210\u4E24\u4E2A\u4E09\u89D2\u5F62\u7684\u5F02\u6B65\u7ED8\u5236\uFF0C\u8FD9\u4E0D\u662F\u6211\u4EEC\u60F3\u8981\u7684\uFF0C\u56E0\u4E3A\u5F02\u6B65\u4F1A\u628A\u4E4B\u524D\u4E09\u89D2\u5F62\u7684\u7F13\u51B2\u6570\u636E\u7ED9\u6E05\u7406\u6389\u3002<br> \u56E0\u6B64\uFF0C\u9700\u8981\u540C\u6B65\u7ED8\u5236\u4E24\u4E2A\u4E09\u89D2\u5F62\u3002</p><p>\u5148\u628A\u4E0A\u9762\u7684\u7ED8\u56FE\u65B9\u6CD5\u5C01\u88C5\u5230\u4E00\u4E2A\u51FD\u6570\u91CC\uFF0C\u7B49\u7EB9\u7406\u4E09\u89D2\u5F62\u7684\u56FE\u7247\u52A0\u8F7D\u6210\u529F\u4E86\uFF0C\u518D\u6267\u884C\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">drawSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528 */</span>
  <span class="token keyword">const</span> solidVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
    <span class="token string">&quot;solidFragmentShader&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> solidVsSource<span class="token punctuation">,</span> solidFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token keyword">const</span> solidVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_1-3\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62" tabindex="-1"><a class="header-anchor" href="#_1-3\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62" aria-hidden="true">#</a> 1.3\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62</h4><p>\u7EB9\u7406\u4E09\u89D2\u5F62\u7684\u7ED8\u5236\u539F\u7406\u548C\u7EAF\u8272\u4E09\u89D2\u5F62\u4E00\u6837\uFF0C\u8981\u7528\u4E00\u5957\u65B0\u7684\u7740\u8272\u5668\u5EFA\u7ACB\u4E00\u4E2A\u65B0\u7684\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u7136\u540E\u7528\u8FD9\u4E2A\u65B0\u7684\u7A0B\u5E8F\u5BF9\u8C61\u8FDB\u884C\u7ED8\u56FE\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">drawTexture</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528 */</span>
  <span class="token keyword">const</span> textureVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
    <span class="token string">&quot;textureVertexShader&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
    <span class="token string">&quot;textureFragmentShader&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> textureVsSource<span class="token punctuation">,</span> textureFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token comment">// \u9876\u70B9</span>
  <span class="token keyword">const</span> textureVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> texturePosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u56FE\u9489</span>
  <span class="token keyword">const</span> pins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pinBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pinBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pins<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Pin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u7EB9\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="_1-4\u540C\u6B65\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_1-4\u540C\u6B65\u7ED8\u56FE" aria-hidden="true">#</a> 1.4\u540C\u6B65\u7ED8\u56FE</h4><p>\u5F53\u7EB9\u7406\u56FE\u5F62\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u8FDB\u884C\u540C\u6B65\u7ED8\u56FE\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">drawSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">drawTexture</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u60F3\u7ED9\u573A\u666F\u4E2D\u7684\u56FE\u5F62\u6DFB\u52A0\u4E00\u4E2A\u52A8\u753B\uFF0C\u6BD4\u5982\u60F3\u8BA9\u7EAF\u8272\u4E09\u89D2\u5F62\u4E0D\u65AD\u7684\u53D8\u6362\u989C\u8272\u3002<br> \u9996\u5148\u8981\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u7684\u7247\u5143\u7740\u8272\u5668\u5F00\u4E00\u4E2A uniform \u53D8\u91CF\u3002</p><p>\u7136\u540E\u63A5\u4E0B\u6765\u662F\u4E0D\u662F\u5C31\u8981\u4E0D\u65AD\u4FEE\u6539\u8FD9\u4E2A uniform \u53D8\u91CF\uFF0C\u7136\u540E\u6267\u884C\u4E0A\u9762\u7684 drawSolid()\u548C drawTexture(image) \u65B9\u6CD5\u5462\uFF1F</p><h3 id="_2-\u591A\u7740\u8272\u5668\u52A8\u753B" tabindex="-1"><a class="header-anchor" href="#_2-\u591A\u7740\u8272\u5668\u52A8\u753B" aria-hidden="true">#</a> 2.\u591A\u7740\u8272\u5668\u52A8\u753B</h3><p>\u5728\u4E0A\u9762\u7684\u7ED8\u56FE\u65B9\u6CD5\u4E2D\uFF0C\u5F88\u591A\u64CD\u4F5C\u90FD\u662F\u4E0D\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\uFF0C\u6BD4\u5982\u7A0B\u5E8F\u5BF9\u8C61\u5728\u5EFA\u7ACB\u4E4B\u540E\uFF0C\u5C31\u4E0D\u9700\u8981\u518D\u5EFA\u7ACB\u4E86\uFF0C\u540E\u9762\u5728\u7ED8\u56FE\u7684\u65F6\u5019\u518D\u63A5\u7740\u7528\u3002</p><h4 id="_2-1\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u6DFB\u52A0\u4E00\u4E2A\u4EE3\u8868\u65F6\u95F4\u7684-uniform-\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_2-1\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u6DFB\u52A0\u4E00\u4E2A\u4EE3\u8868\u65F6\u95F4\u7684-uniform-\u53D8\u91CF" aria-hidden="true">#</a> 2.1\u7ED9\u7EAF\u8272\u4E09\u89D2\u5F62\u6DFB\u52A0\u4E00\u4E2A\u4EE3\u8868\u65F6\u95F4\u7684 uniform \u53D8\u91CF</h4><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
     uniform float u_Time<span class="token punctuation">;</span>
     <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       float r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>u_Time<span class="token operator">/</span><span class="token number">200.0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
       gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-2\u58F0\u660E\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#_2-2\u58F0\u660E\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u53D8\u91CF" aria-hidden="true">#</a> 2.2\u58F0\u660E\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u53D8\u91CF</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> solidProgram<span class="token punctuation">,</span>
  solidVertexBuffer<span class="token punctuation">,</span>
  solidPosition<span class="token punctuation">,</span>
  solidTime <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> textureProgram<span class="token punctuation">,</span>
  textureVertexBuffer<span class="token punctuation">,</span>
  texturePosition <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> pinBuffer<span class="token punctuation">,</span>
  pin <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u7A0B\u5E8F\u5BF9\u8C61\u3001\u7F13\u51B2\u5BF9\u8C61\u3001\u4ECE\u7740\u8272\u5668\u4E2D\u83B7\u53D6\u7684 attribute \u53D8\u91CF\u548C uniform \u53D8\u91CF\u90FD\u662F\u4E0D\u9700\u8981\u91CD\u590D\u83B7\u53D6\u7684\u3002</p><h4 id="_2-3\u521D\u59CB\u5316\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_2-3\u521D\u59CB\u5316\u65B9\u6CD5" aria-hidden="true">#</a> 2.3\u521D\u59CB\u5316\u65B9\u6CD5</h4><p>\u628A\u7ED8\u5236\u7EAF\u8272\u4E09\u89D2\u5F62\u7684\u65B9\u6CD5\u53D8\u6210\u521D\u59CB\u5316\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61*/</span>
  <span class="token keyword">const</span> solidVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> solidFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
    <span class="token string">&quot;solidFragmentShader&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  solidProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> solidVsSource<span class="token punctuation">,</span> solidFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token keyword">const</span> solidVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  solidVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  solidPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

  solidTime <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">,</span> <span class="token string">&quot;u_Time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* gl.clear(gl.COLOR_BUFFER_BIT)
       gl.drawArrays(gl.TRIANGLES, 0, 3) */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u628A\u7ED8\u5236\u7EB9\u7406\u4E09\u89D2\u5F62\u7684\u65B9\u6CD5\u53D8\u6210\u521D\u59CB\u5316\u65B9\u6CD5</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initTexture</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.\u5EFA\u7ACB\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5E76\u5E94\u7528 */</span>
  <span class="token keyword">const</span> textureVsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
    <span class="token string">&quot;textureVertexShader&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> textureFsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>
    <span class="token string">&quot;textureFragmentShader&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  textureProgram <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> textureVsSource<span class="token punctuation">,</span> textureFsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* 2.\u7528\u5F53\u524D\u7684\u7A0B\u5E8F\u5BF9\u8C61\u7ED8\u5236\u56FE\u5F62 */</span>
  <span class="token comment">// \u9876\u70B9</span>
  <span class="token keyword">const</span> textureVertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  textureVertexBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertices<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  texturePosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Position&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u56FE\u9489</span>
  <span class="token keyword">const</span> pins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pinBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pinBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pins<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;a_Pin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u7EB9\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">,</span> <span class="token string">&quot;u_Sampler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// gl.drawArrays(gl.TRIANGLES, 0, 3)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>\u4E0A\u9762\u5DF2\u7ECF\u6CE8\u91CA\u6389\u7684\u662F\u9700\u8981\u5728\u7ED8\u56FE\u65F6\u91CD\u590D\u6267\u884C\u7684\u3002</p><h4 id="_2-4\u628A\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u65B9\u6CD5\u6536\u96C6\u4E00\u4E0B-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3" tabindex="-1"><a class="header-anchor" href="#_2-4\u628A\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u65B9\u6CD5\u6536\u96C6\u4E00\u4E0B-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3" aria-hidden="true">#</a> 2.4\u628A\u9700\u8981\u91CD\u590D\u6267\u884C\u7684\u65B9\u6CD5\u6536\u96C6\u4E00\u4E0B\uFF0C\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>solidProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> solidVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>solidPosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>solidTime<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>textureProgram<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> textureVertexBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texturePosition<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> pinBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u7531\u4E0A\u53EF\u77E5\uFF0C\u5728\u8FDE\u7EED\u6E32\u67D3\u65F6\uFF0C\u5FC5\u987B\u8981\u6709\u7684\u64CD\u4F5C\uFF1A</p><ul><li>clear() \u6E05\u7406\u753B\u5E03</li><li>useProgram() \u5E94\u7528\u7A0B\u5E8F\u5BF9\u8C61</li><li>bindBuffer() \u7ED1\u5B9A\u7F13\u51B2\u533A\u5BF9\u8C61</li><li>vertexAttribPointer() \u544A\u8BC9\u663E\u5361\u4ECE\u5F53\u524D\u7ED1\u5B9A\u7684\u7F13\u51B2\u533A\uFF08bindBuffer()\u6307\u5B9A\u7684\u7F13\u51B2\u533A\uFF09\u4E2D\u8BFB\u53D6\u9876\u70B9\u6570\u636E</li><li>drawArrays() \u7ED8\u56FE\u65B9\u6CD5</li></ul><p>\u82E5 attribute \u53D8\u91CF\u3001uniform \u53D8\u91CF\u6216\u8005\u56FE\u7247\u53D1\u751F\u4E86\u53D8\u5316\uFF0C\u90A3\u5C31\u9700\u8981\u5BF9\u5176\u8FDB\u884C\u66F4\u65B0\u3002</p><h4 id="_2-5\u5F53\u7EB9\u7406\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E-\u521D\u59CB\u5316\u7ED8\u56FE\u65B9\u6CD5-\u8FDE\u7EED\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_2-5\u5F53\u7EB9\u7406\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E-\u521D\u59CB\u5316\u7ED8\u56FE\u65B9\u6CD5-\u8FDE\u7EED\u7ED8\u56FE" aria-hidden="true">#</a> 2.5\u5F53\u7EB9\u7406\u56FE\u50CF\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u521D\u59CB\u5316\u7ED8\u56FE\u65B9\u6CD5\uFF0C\u8FDE\u7EED\u7ED8\u56FE</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">initSolid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">initTexture</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u4E8C\u5341\u3001\u57FA\u4E8E-webgl-\u7684\u8F7B\u91CF\u7EA7\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u3001\u57FA\u4E8E-webgl-\u7684\u8F7B\u91CF\u7EA7\u67B6\u6784" aria-hidden="true">#</a> \u4E8C\u5341\u3001\u57FA\u4E8E webgl \u7684\u8F7B\u91CF\u7EA7\u67B6\u6784</h2><p>\u4E4B\u524D\u7B80\u5355\u67B6\u6784 Poly \u5DF2\u7ECF\u65E0\u6CD5\u6EE1\u8DB3\u57FA\u672C\u9700\u6C42\uFF0C\u9700\u8981\u5728\u5176\u57FA\u7840\u4E0A\u518D\u505A\u4E00\u4E0B\u5347\u7EA7\u3002<br> \u4E0B\u56FE\u4FBF\u662F\u8981\u642D\u5EFA\u7684\u6846\u67B6\uFF0C\u53C2\u8003\u4E86 three.js\uFF0C\u4F46\u8981\u7B80\u5355\u5F88\u591A\u3002</p><p>\u610F\u6B32\u5148\u7528\u5B83\u6574\u51E0\u4E2A\u6848\u4F8B\u7EC3\u7EC3\u624B\u518D\u8BF4\uFF0C\u7B49\u4EE5\u540E\u9047\u5230\u6EE1\u8DB3\u4E0D\u4E86\u7684\u9700\u6C42\u4E86\uFF0C\u518D\u505A\u6DF1\u5EA6\u6269\u5C55\u3002</p><p><img src="`+Us+`" alt=""></p><ol><li>\u573A\u666F Scene\uFF1A\u5305\u542B\u6240\u6709\u7684\u4E09\u7EF4\u5BF9\u8C61\uFF0C\u5E76\u8D1F\u8D23\u7ED8\u56FE</li><li>\u4E09\u7EF4\u5BF9\u8C61 Obj3D\uFF1A\u5305\u542B\u51E0\u4F55\u4F53 Geo \u548C\u6750\u8D28 Mat\uFF0C\u5BF9\u4E24\u8005\u8FDB\u884C\u7EDF\u4E00\u7BA1\u7406</li><li>\u51E0\u4F55\u4F53 Geo\uFF1A\u5BF9\u5E94 attribute \u9876\u70B9\u6570\u636E</li><li>\u6750\u8D28 Mat\uFF1A\u5305\u542B\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u5BF9\u5E94 uniform \u53D8\u91CF</li></ol><h3 id="_1-\u51E0\u4F55\u4F53-geo" tabindex="-1"><a class="header-anchor" href="#_1-\u51E0\u4F55\u4F53-geo" aria-hidden="true">#</a> 1.\u51E0\u4F55\u4F53 Geo</h3><h4 id="_1-1\u9ED8\u8BA4\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#_1-1\u9ED8\u8BA4\u5C5E\u6027" aria-hidden="true">#</a> 1.1\u9ED8\u8BA4\u5C5E\u6027</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">drawType</span><span class="token operator">:</span><span class="token string">&#39;drawArrays&#39;</span><span class="token punctuation">,</span><span class="token comment">//drawElements</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Geo</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>data \u9876\u70B9\u6570\u636E</li><li>count \u9876\u70B9\u603B\u6570</li><li>index \u9876\u70B9\u7D22\u5F15\u6570\u636E <ul><li>\u9ED8\u8BA4\u4E3A null\uFF0C\u7528 drawArrays \u7684\u65B9\u5F0F\u7ED8\u56FE</li><li>\u82E5\u4E0D\u4E3A null\uFF0C\u7528 drawElements \u7684\u65B9\u5F0F\u7ED8\u56FE</li></ul></li><li>drawType \u7ED8\u56FE\u65B9\u5F0F <ul><li>drawArrays \u4F7F\u7528\u9876\u70B9\u96C6\u5408\u7ED8\u56FE\uFF0C\u9ED8\u8BA4</li><li>drawElements\uFF0C\u4F7F\u7528\u9876\u70B9\u7D22\u5F15\u7ED8\u56FE</li></ul></li></ul><p>data \u7684\u6570\u636E\u7ED3\u6784\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span>\u7C7B\u578B\u6570\u7EC4<span class="token punctuation">,</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span>\u77E2\u91CF\u957F\u5EA6<span class="token punctuation">,</span>
    <span class="token literal-property property">buffer</span><span class="token operator">:</span>\u7F13\u51B2\u5BF9\u8C61<span class="token punctuation">,</span>
    <span class="token literal-property property">location</span><span class="token operator">:</span>attribute\u53D8\u91CF<span class="token punctuation">,</span>
    needUpdate\uFF1A<span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">a_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span>\u7C7B\u578B\u6570\u7EC4<span class="token punctuation">,</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span>\u77E2\u91CF\u957F\u5EA6<span class="token punctuation">,</span>
    <span class="token literal-property property">buffer</span><span class="token operator">:</span>\u7F13\u51B2\u5BF9\u8C61<span class="token punctuation">,</span>
    <span class="token literal-property property">location</span><span class="token operator">:</span>attribute\u53D8\u91CF<span class="token punctuation">,</span>
    needUpdate\uFF1A<span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>array \u5B58\u50A8\u6240\u6709\u7684 attribute \u6570\u636E</li><li>size \u6784\u6210\u4E00\u4E2A\u9876\u70B9\u7684\u6240\u6709\u5206\u91CF\u7684\u6570\u76EE</li><li>buffer \u7528 createBuffer() \u65B9\u6CD5\u5EFA\u7ACB\u7684\u7F13\u51B2\u5BF9\u8C61</li><li>location \u7528 getAttribLocation() \u65B9\u6CD5\u83B7\u53D6\u7684 attribute \u53D8\u91CF</li><li>needUpdate \u5728\u8FDE\u7EED\u6E32\u67D3\u65F6\uFF0C\u662F\u5426\u66F4\u65B0\u7F13\u51B2\u5BF9\u8C61</li></ul><p>index \u6570\u636E\u7ED3\u6784</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span>\u7C7B\u578B\u6570\u7EC4<span class="token punctuation">,</span>
    <span class="token literal-property property">buffer</span><span class="token operator">:</span>\u7F13\u51B2\u5BF9\u8C61<span class="token punctuation">,</span>
    needUpdate\uFF1A<span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_1-2\u521D\u59CB\u5316\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1-2\u521D\u59CB\u5316\u65B9\u6CD5" aria-hidden="true">#</a> 1.2\u521D\u59CB\u5316\u65B9\u6CD5</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>program</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>program<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initIndex</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>init(gl,program) \u65B9\u6CD5\u4F1A\u5728\u573A\u666F Scene \u521D\u59CB\u5316\u65F6\u88AB\u8C03\u7528</p><ul><li>gl\uFF1Awebgl \u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u4F1A\u901A\u8FC7\u573A\u666F Scene \u7684\u521D\u59CB\u5316\u65B9\u6CD5\u4F20\u5165</li><li>program\uFF1A\u7A0B\u5E8F\u5BF9\u8C61\uFF0C\u4F1A\u901A\u8FC7 Obj3D \u7684\u521D\u59CB\u5316\u65B9\u6CD5\u4F20\u5165</li></ul></li><li><p>initData() \u521D\u59CB\u5316\u9876\u70B9\u7D22\u5F15</p><ul><li>\u521D\u59CB\u5316\u9876\u70B9\u6570\u91CF count \u548C\u7ED8\u56FE\u65B9\u5F0F drawType</li><li>\u82E5\u9876\u70B9\u7D22\u5F15\u4E0D\u4E3A null\uFF0C\u5C31\u5EFA\u7ACB\u7F13\u51B2\u533A\u5BF9\u8C61\uFF0C\u5411\u5176\u4E2D\u5199\u5165\u9876\u70B9\u7D22\u5F15\u6570\u636E</li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">initData</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>program</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> attr<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        attr<span class="token punctuation">.</span>buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> attr<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> location <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
            location<span class="token punctuation">,</span>
            attr<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
            <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">0</span>
        <span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
        attr<span class="token punctuation">.</span>location<span class="token operator">=</span>location
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>initIndex() \u521D\u59CB\u5316 attribute \u53D8\u91CF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">initIndex</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> index <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span>index<span class="token punctuation">.</span>array<span class="token punctuation">.</span>length
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawType <span class="token operator">=</span> <span class="token string">&#39;drawElements&#39;</span>
        index<span class="token punctuation">.</span>buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> array<span class="token punctuation">,</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">/</span> size
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawArrays&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_1-3\u66F4\u65B0\u65B9\u6CD5-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3" tabindex="-1"><a class="header-anchor" href="#_1-3\u66F4\u65B0\u65B9\u6CD5-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3" aria-hidden="true">#</a> 1.3\u66F4\u65B0\u65B9\u6CD5\uFF0C\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateIndex</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>updateData(gl) \u66F4\u65B0 attribute \u53D8\u91CF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> attr <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> buffer<span class="token punctuation">,</span> location<span class="token punctuation">,</span> size<span class="token punctuation">,</span> needUpdate<span class="token punctuation">,</span>array <span class="token punctuation">}</span> <span class="token operator">=</span> attr
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            attr<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
            gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>
            location<span class="token punctuation">,</span>
            size<span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span>
            <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token number">0</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>updateIndex(gl) \u66F4\u65B0\u9876\u70B9\u7D22\u5F15</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateIndex</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>index<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            index<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
            gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> index<span class="token punctuation">.</span>array<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_1-4\u8BBE\u7F6E-attribute-\u6570\u636E\u548C\u9876\u70B9\u7D22\u5F15\u6570\u636E\u7684\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1-4\u8BBE\u7F6E-attribute-\u6570\u636E\u548C\u9876\u70B9\u7D22\u5F15\u6570\u636E\u7684\u65B9\u6CD5" aria-hidden="true">#</a> 1.4\u8BBE\u7F6E attribute \u6570\u636E\u548C\u9876\u70B9\u7D22\u5F15\u6570\u636E\u7684\u65B9\u6CD5</h4><p>setData(key,val) \u8BBE\u7F6E attribute \u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setData</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>setIndex(val)\u8BBE\u7F6E\u9876\u70B9\u7D22\u5F15\u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setIndex</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
        index<span class="token punctuation">.</span>array<span class="token operator">=</span>val
        <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span>index<span class="token punctuation">.</span>array<span class="token punctuation">.</span>length
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawType <span class="token operator">=</span> <span class="token string">&#39;drawElements&#39;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> array<span class="token punctuation">,</span> size <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> array<span class="token punctuation">.</span>length <span class="token operator">/</span> size
        <span class="token keyword">this</span><span class="token punctuation">.</span>drawType<span class="token operator">=</span><span class="token string">&#39;drawArrays&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_2-\u6750\u8D28-mat" tabindex="-1"><a class="header-anchor" href="#_2-\u6750\u8D28-mat" aria-hidden="true">#</a> 2.\u6750\u8D28 Mat</h3><h4 id="_1-1\u9ED8\u8BA4\u5C5E\u6027-1" tabindex="-1"><a class="header-anchor" href="#_1-1\u9ED8\u8BA4\u5C5E\u6027-1" aria-hidden="true">#</a> 1.1\u9ED8\u8BA4\u5C5E\u6027</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Mat</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>program \u7A0B\u5E8F\u5BF9\u8C61</li><li>data uniform \u6570\u636E</li><li>mode \u56FE\u5F62\u7684\u7ED8\u5236\u65B9\u5F0F\uFF0C\u9ED8\u8BA4\u72EC\u7ACB\u4E09\u89D2\u5F62\u3002<br> \u6CE8\uFF1Amode \u4E5F\u53EF\u4EE5\u662F\u6570\u7EC4\uFF0C\u8868\u793A\u591A\u79CD\u7ED8\u56FE\u65B9\u5F0F\uFF0C\u5982[&#39;TRIANGLE_STRIP&#39;, &#39;POINTS&#39;]</li><li>maps \u96C6\u5408</li></ul><ol><li>data \u6570\u636E\u7ED3\u6784\uFF1A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">u_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">location</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">needUpdate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>value uniform \u6570\u636E\u503C</li><li>type uniform \u6570\u636E\u7684\u5199\u5165\u65B9\u5F0F</li><li>location \u7528 getUniformLocation() \u65B9\u6CD5\u83B7\u53D6\u7684 uniform \u53D8\u91CF</li><li>needUpdate \u5728\u8FDE\u7EED\u6E32\u67D3\u65F6\uFF0C\u662F\u5426\u66F4\u65B0 uniform \u53D8\u91CF</li></ul><ol start="2"><li>maps \u6570\u636E\u7ED3\u6784:</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span><span class="token punctuation">{</span>
    image<span class="token punctuation">,</span>
    format<span class="token punctuation">,</span>
    wrapS<span class="token punctuation">,</span>
    wrapT<span class="token punctuation">,</span>
    magFilter<span class="token punctuation">,</span>
    minFilter<span class="token punctuation">,</span>
    <span class="token literal-property property">needUpdate</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>image \u56FE\u5F62\u6E90</li><li>format \u6570\u636E\u7C7B\u578B\uFF0C\u9ED8\u8BA4 gl.RGB</li><li>wrapS \u5BF9\u5E94\u7EB9\u7406\u5BF9\u8C61\u7684 TEXTURE_WRAP_S \u5C5E\u6027</li><li>wrapT \u5BF9\u5E94\u7EB9\u7406\u5BF9\u8C61\u7684 TEXTURE_WRAP_T \u5C5E\u6027</li><li>magFilter \u5BF9\u5E94\u7EB9\u7406\u5BF9\u8C61\u7684 TEXTURE_MAG_FILTER \u5C5E\u6027</li><li>minFilter \u5BF9\u5E94\u7EB9\u7406\u5BF9\u8C61\u7684 TEXTURE_MIN_FILTER \u5C5E\u6027</li></ul><h4 id="_1-2\u521D\u59CB\u5316\u65B9\u6CD5-1" tabindex="-1"><a class="header-anchor" href="#_1-2\u521D\u59CB\u5316\u65B9\u6CD5-1" aria-hidden="true">#</a> 1.2\u521D\u59CB\u5316\u65B9\u6CD5</h4><p>\u83B7\u53D6 uniform \u53D8\u91CF\uFF0C\u7ED1\u5B9A\u5230\u5176\u6240\u5728\u7684\u5BF9\u8C61\u4E0A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>program<span class="token punctuation">,</span>data<span class="token punctuation">,</span>maps<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> obj<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        obj<span class="token punctuation">.</span>location <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_1-3\u66F4\u65B0\u65B9\u6CD5-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3-1" tabindex="-1"><a class="header-anchor" href="#_1-3\u66F4\u65B0\u65B9\u6CD5-\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3-1" aria-hidden="true">#</a> 1.3\u66F4\u65B0\u65B9\u6CD5\uFF0C\u7528\u4E8E\u8FDE\u7EED\u6E32\u67D3</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMaps</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>updateData(gl) \u66F4\u65B0 uniform \u53D8\u91CF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateData</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> obj <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span> <span class="token punctuation">}</span>
        obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">false</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> value<span class="token punctuation">,</span> location <span class="token punctuation">}</span> <span class="token operator">=</span> obj
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;Matrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            gl<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>updateMaps(gl) \u66F4\u65B0\u7EB9\u7406</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateMaps</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> maps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">.</span>needUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
        map<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
            format <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span>
            image<span class="token punctuation">,</span>
            wrapS<span class="token punctuation">,</span>
            wrapT<span class="token punctuation">,</span>
            magFilter<span class="token punctuation">,</span>
            minFilter<span class="token punctuation">,</span>
            location<span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> map

        gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">TEXTURE</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ind<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            format<span class="token punctuation">,</span>
            format<span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
            image
        <span class="token punctuation">)</span>
        wrapS<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span>
            wrapS
        <span class="token punctuation">)</span>
        wrapT<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span>
            wrapT
        <span class="token punctuation">)</span>
        magFilter<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span>
            magFilter
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>minFilter <span class="token operator">||</span> minFilter <span class="token operator">&gt;</span> <span class="token number">9729</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            gl<span class="token punctuation">.</span><span class="token function">generateMipmap</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        minFilter<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
            gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
            minFilter
        <span class="token punctuation">)</span>
        gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> ind<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h4 id="_1-4\u8BBE\u7F6E-uniform-\u6570\u636E\u548C\u7EB9\u7406\u7684\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1-4\u8BBE\u7F6E-uniform-\u6570\u636E\u548C\u7EB9\u7406\u7684\u65B9\u6CD5" aria-hidden="true">#</a> 1.4\u8BBE\u7F6E uniform \u6570\u636E\u548C\u7EB9\u7406\u7684\u65B9\u6CD5</h4><p>setData(key,val) \u8BBE\u7F6E uniform \u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setData</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>setMap(val)\u8BBE\u7F6E\u7EB9\u7406</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> maps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> maps<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    obj<span class="token punctuation">.</span>needUpdate<span class="token operator">=</span><span class="token boolean">true</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-\u4E09\u7EF4\u5BF9\u8C61-obj3d" tabindex="-1"><a class="header-anchor" href="#_3-\u4E09\u7EF4\u5BF9\u8C61-obj3d" aria-hidden="true">#</a> 3.\u4E09\u7EF4\u5BF9\u8C61 Obj3D</h3><p>obj3D \u5BF9\u8C61\u6BD4\u8F83\u7B80\u5355\uFF0C\u4E3B\u8981\u8D1F\u8D23\u5BF9 Geo \u5BF9\u8C61\u548C Mat \u5BF9\u8C61\u7684\u7EDF\u4E00\u521D\u59CB\u5316\u548C\u66F4\u65B0\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">geo</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mat</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Obj3D</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mat<span class="token punctuation">,</span> geo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    mat<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    geo<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> mat<span class="token punctuation">.</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mat<span class="token punctuation">,</span> geo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    mat<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    geo<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_4-\u573A\u666F\u5BF9\u8C61-scene" tabindex="-1"><a class="header-anchor" href="#_4-\u573A\u666F\u5BF9\u8C61-scene" aria-hidden="true">#</a> 4.\u573A\u666F\u5BF9\u8C61 Scene</h3><p>Scene \u5BF9\u8C61\u7684\u4E3B\u8981\u529F\u80FD\u5C31\u662F\u6536\u96C6\u6240\u6709\u7684\u4E09\u7EF4\u5BF9\u8C61\uFF0C\u7136\u540E\u753B\u51FA\u6765\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/*\u9ED8\u8BA4\u5C5E\u6027*/</span>
<span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">gl</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Scene</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      obj<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>objs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    objs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> children<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mat <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">geo</span><span class="token operator">:</span> <span class="token punctuation">{</span> drawType<span class="token punctuation">,</span> count <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mat</span><span class="token operator">:</span> <span class="token punctuation">{</span> mode<span class="token punctuation">,</span> program <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
      gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> mode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">[</span>drawType<span class="token punctuation">]</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mode<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span>drawType<span class="token punctuation">]</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">drawArrays</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">drawElements</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> count<span class="token punctuation">,</span> mode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>\u6211\u4EEC\u4F9D\u6B21\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u7684\u65B9\u6CD5\u3002</p><ul><li><p>Scene \u5BF9\u8C61\u7684\u5C5E\u6027\u53EA\u6709\u4E24\u4E2A\uFF1A</p><ul><li>gl\uFF1Awebgl \u4E0A\u4E0B\u6587\u5BF9\u8C61</li><li>children\uFF1A\u4E09\u7EF4\u5BF9\u8C61\u96C6\u5408</li></ul></li><li><p>init() \u521D\u59CB\u5316\u65B9\u6CD5</p></li><li><p>add() \u6DFB\u52A0\u4E09\u7EF4\u5BF9\u8C61</p></li><li><p>remove() \u5220\u9664\u4E09\u7EF4\u5BF9\u8C61</p></li><li><p>setUniform() \u7EDF\u4E00\u8BBE\u7F6E\u6240\u6709\u5BF9\u8C61\u5171\u6709\u7684\u5C5E\u6027\uFF0C\u6BD4\u5982\u89C6\u56FE\u6295\u5F71\u77E9\u9635</p></li><li><p>draw() \u7ED8\u56FE\u65B9\u6CD5</p></li></ul><p>\u5173\u4E8E webgl \u7684\u8F7B\u91CF\u7EA7\u67B6\u6784\u5C31\u5148\u5199\u5230\u8FD9\uFF0C\u4EE5\u540E\u5B66\u5230\u65B0\u7684\u77E5\u8BC6\u4E86\uFF0C\u6216\u8005\u9047\u5230\u65B0\u7684\u9700\u6C42\u4E86\uFF0C\u518D\u505A\u5347\u7EA7\u3002</p><h3 id="\u6D4B\u8BD5-1" tabindex="-1"><a class="header-anchor" href="#\u6D4B\u8BD5-1" aria-hidden="true">#</a> \u6D4B\u8BD5 1</h3><p>\u53EF\u4EE5\u57FA\u4E8E\u4E4B\u524D\u591A\u7740\u8272\u5668\u7684\u4F8B\u5B50\uFF0C\u6D4B\u8BD5\u4E00\u4E0B\u521A\u624D\u7684 webgl \u6846\u67B6\u5728\u591A\u7740\u8272\u5668\u4E2D\u7684\u5E94\u7528\u3002</p><ol><li>\u4E24\u5957\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- \u7740\u7EAF\u8272 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>solidFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform float u_Time<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>u_Time <span class="token operator">/</span> <span class="token number">200.0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7740\u7EB9\u7406 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureVertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    v_Pin <span class="token operator">=</span> a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textureFragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><ol start="2"><li>\u5F15\u5165 js \u6A21\u5757</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span>
  OrthographicCamera<span class="token punctuation">,</span>
  Vector3<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&quot;./jsm/OrbitControls.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Mat.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Geo.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Obj3D.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Scene.js&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>\u5907\u597D webgl \u4E0A\u4E0B\u6587\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>\u5907\u597D\u76F8\u673A\uFF0C\u7A0D\u540E\u4ECE\u4E2D\u63D0\u53D6\u6295\u5F71\u89C6\u56FE\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> halfH <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token keyword">const</span> halfW <span class="token operator">=</span> halfH <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">-</span>halfW<span class="token punctuation">,</span>
  halfW<span class="token punctuation">,</span>
  halfH<span class="token punctuation">,</span>
  <span class="token operator">-</span>halfH<span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token number">8</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrthographicCamera</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="5"><li>\u5B9E\u4F8B\u5316\u573A\u666F\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="6"><li>\u5EFA\u7ACB\u7EAF\u8272\u4E09\u89D2\u5F62</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token keyword">const</span> vs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;solidFragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    program<span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Time</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform1f&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol start="7"><li>\u5EFA\u7ACB\u7EB9\u7406\u4E09\u89D2\u5F62</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;./images/erha.jpg&quot;</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;textureVertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;textureFragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    program<span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniformMatrix4fv&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        image<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* \u7EDF\u4E00\u8BBE\u7F6Euniform\u53D8\u91CF */</span>
  scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&quot;u_PvMatrix&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><ol start="8"><li>\u6E32\u67D3\u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  scene<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&quot;u_Time&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> time <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="\u6D4B\u8BD5-2" tabindex="-1"><a class="header-anchor" href="#\u6D4B\u8BD5-2" aria-hidden="true">#</a> \u6D4B\u8BD5 2</h3><p>\u518D\u62FF\u4E4B\u524D\u7684\u5F69\u8272\u7ACB\u65B9\u4F53\u6765\u6D4B\u8BD5\u4E00\u4E0B webgl \u6846\u67B6\u7684\u9876\u70B9\u7D22\u5F15\u529F\u80FD\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec4 a_Color<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    varying vec4 v_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      v_Color <span class="token operator">=</span> a_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    varying vec4 v_Color<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> v_Color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders<span class="token punctuation">,</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> 
      Matrix4<span class="token punctuation">,</span> 
      PerspectiveCamera<span class="token punctuation">,</span> 
      Vector3 
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Mat.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Geo.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Obj3D.js&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Scene.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vertexShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fragmentShader&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/* \u900F\u89C6\u76F8\u673A */</span>
    <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> up <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token number">45</span><span class="token punctuation">,</span>
        canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
        <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token number">20</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>

    <span class="token comment">/* \u5B9E\u4F8B\u5316\u8F68\u9053\u63A7\u5236\u5668 */</span>
    <span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span>
        <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
    canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        program<span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">u_Time</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">a_Color</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>    <span class="token comment">// front</span>
                <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span>    <span class="token comment">// right</span>
                <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token comment">// up</span>
                <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// left</span>
                <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token comment">// down</span>
                <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span>     <span class="token comment">// back</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span>
            <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span>
            orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements
        <span class="token punctuation">)</span>
        scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br></div></div><h2 id="\u4E8C\u5341\u4E00\u3001\u8BA4\u8BC6\u5149" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u4E00\u3001\u8BA4\u8BC6\u5149" aria-hidden="true">#</a> \u4E8C\u5341\u4E00\u3001\u8BA4\u8BC6\u5149</h2><p>\u5149\u662F\u7531\u5149\u6E90\u53D1\u51FA\u7684\uFF0C\u5149\u6709\u65B9\u5411\u3001\u4EAE\u5EA6\u548C\u989C\u8272\u3002</p><p>\u53EF\u4EE5\u60F3\u8C61\u624B\u7535\u7B52\u6253\u51FA\u7684\u4E00\u9053\u767D\u8272\u7684\u5149\u3002<br> \u624B\u7535\u7B52\u662F\u5149\u6E90\uFF0C\u5176\u4EAE\u5EA6\u4F1A\u53D7\u7535\u6C60\u7684\u5F71\u54CD\uFF0C\u989C\u8272\u4E3A\u767D\u8272\uFF0C\u65B9\u5411\u53EF\u4EE5\u7531\u4F60\u6765\u63A7\u5236\u3002</p><p>\u56E0\u4E3A\u5149\u7684\u5B58\u5728\uFF0C\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\u4E16\u754C\u7684\u591A\u59FF\u591A\u5F69\u3002<br> \u63A5\u4E0B\u5C31\u5177\u4F53\u770B\u4E00\u4E0B\u5149\u7167\u4F1A\u5BF9\u73B0\u5B9E\u4E16\u754C\u4E2D\u7684\u7269\u4F53\u4EA7\u751F\u54EA\u4E9B\u5F71\u54CD\u3002</p><h3 id="_1-\u5149\u7167\u5BF9\u7269\u4F53\u7684\u5F71\u54CD" tabindex="-1"><a class="header-anchor" href="#_1-\u5149\u7167\u5BF9\u7269\u4F53\u7684\u5F71\u54CD" aria-hidden="true">#</a> 1.\u5149\u7167\u5BF9\u7269\u4F53\u7684\u5F71\u54CD</h3><p>\u73B0\u5B9E\u4E16\u754C\u4E2D\u7684\u7269\u4F53\u88AB\u5149\u7EBF\u7167\u5C04\u65F6\uFF0C\u4F1A\u5438\u6536\u4E00\u90E8\u5206\u5149\uFF0C\u53CD\u5C04\u4E00\u90E8\u5206\u5149\u3002 \u5F53\u53CD\u5C04\u7684\u5149\u8FDB\u5165\u4EBA\u7684\u773C\u775B\u4E2D\u65F6\uFF0C\u4EBA\u4EEC\u4FBF\u53EF\u4EE5\u770B\u5230\u7269\u4F53\uFF0C\u5E76\u8BC6\u522B\u51FA\u5B83\u7684\u989C\u8272\u3002</p><p>\u5149\u4F1A\u5BF9\u7269\u4F53\u4EA7\u751F\u4EE5\u4E0B\u5F71\u54CD\uFF1A</p><ul><li>\u5F71\u54CD\u7269\u4F53\u8868\u9762\u4E0D\u540C\u4F4D\u7F6E\u7684\u660E\u6697\u7A0B\u5EA6</li><li>\u5F71\u54CD\u7269\u4F53\u7684\u989C\u8272</li><li>\u5F71\u54CD\u7269\u4F53\u7684\u6295\u5F71</li></ul><p>\u7269\u4F53\u7684\u660E\u6697\u5DEE\u5F02\uFF0C\u53EF\u4EE5\u8BA9\u6211\u4EEC\u611F\u89C9\u8FD9\u4E2A\u7269\u4F53\u662F\u7ACB\u4F53\u7684\u3002<br> \u6BD4\u5982\u4E0B\u56FE\u4E2D\uFF0C\u5DE6\u4FA7\u7684\u7ACB\u65B9\u4F53\u6CA1\u6709\u660E\u6697\u5DEE\u5F02\uFF0C\u7ED9\u4EBA\u7684\u611F\u89C9\u5C31\u662F\u4E00\u4E2A\u5E73\u9762\uFF1B\u53F3\u4FA7\u7684\u7ACB\u65B9\u4F53\u5177\u6709\u660E\u6697\u5DEE\u5F02\uFF0C\u7ED9\u4EBA\u7684\u611F\u89C9\u662F\u7ACB\u4F53\u7684\u3002<br><img src="`+Vs+'" alt=""></p><p>\u7D20\u63CF\u7684\u201C\u4E09\u5927\u9762\u201D\u3001\u201C\u4E94\u8C03\u5B50\u201D<br> \u4E09\u5927\u9762\u3001\u4E94\u8C03\u5B50\u5C31\u662F\u5728\u63CF\u8FF0\u5149\u5BF9\u7269\u4F53\u7684\u660E\u6697\u5F71\u54CD\uFF0C\u8FD9\u4E24\u4E2A\u6982\u5FF5\u53EF\u4EE5\u8BA9\u6211\u4EEC\u753B\u51FA\u7684\u4E1C\u897F\u66F4\u6709\u4F53\u611F\u3002</p><ul><li><p>\u4E09\u5927\u9762\uFF1A\u9ED1\u3001\u767D\u3001\u7070\u4E09\u4E2A\u9762\uFF0C\u63CF\u8FF0\u7684\u5C31\u662F\u7269\u4F53\u7684\u660E\u6697\u5DEE\u5F02\u3002<br><img src="'+Ns+'" alt=""></p></li><li><p>\u4E94\u8C03\u5B50\uFF1A\u9AD8\u5149\u3001\u4E2D\u95F4\u8C03\u3001\u660E\u6697\u4EA4\u754C\u7EBF\u3001\u53CD\u5149\u548C\u6295\u5F71\u3002<br><img src="'+Gs+'" alt=""></p></li></ul><p>\u7269\u4F53\u7684\u989C\u8272\u4F1A\u53D7\u5149\u8272\u7684\u5F71\u54CD\uFF0C\u8FD9\u4E2A\u6211\u4EEC\u4E4B\u540E\u4F1A\u8BE6\u8BF4\u3002<br> \u7269\u4F53\u7684\u5F71\u5B50\u5C31\u662F\u5149\u6E90\u770B\u4E0D\u89C1\u7684\u5730\u65B9\uFF0C\u6211\u4EEC\u4E4B\u540E\u4F1A\u901A\u8FC7\u7B97\u6CD5\u6765\u8BA1\u7B97\u3002<br> \u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u518D\u8BA4\u8BC6\u4E00\u4E0B\u5149\u6E90\u3002</p><h3 id="_2-\u5149\u6E90" tabindex="-1"><a class="header-anchor" href="#_2-\u5149\u6E90" aria-hidden="true">#</a> 2.\u5149\u6E90</h3><p>\u5149\u6E90\uFF0C\u5C31\u662F\u5149\u7684\u6E90\u5934\u3002<br> \u57FA\u4E8E\u5149\u6E90\u53D1\u51FA\u7684\u5149\u7EBF\u7684\u65B9\u5411\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5C06\u5149\u6E90\u5206\u6210\u4E24\u79CD\uFF1A<br><img src="'+Ws+'" alt=""></p><ul><li>\u5E73\u884C\u5149\uFF08directional light\uFF09\uFF1A\u5149\u7EBF\u76F8\u4E92\u5E73\u884C\uFF0C\u5C04\u5411\u540C\u4E00\u65B9\u5411\u3002\u6BD4\u5982\u4ECE\u7A97\u5916\u6444\u5165\u623F\u95F4\u7684\u9633\u5149\u5C31\u662F\u5E73\u884C\u7684\u3002 <code>\u6CE8</code>\uFF1A\u867D\u8BA9\u592A\u9633\u7684\u5149\u4E5F\u662F\u5411\u56DB\u5468\u53D1\u5C04\u7684\uFF0C\u4F46\u592A\u9633\u76F8\u5BF9\u4E8E\u623F\u95F4\u800C\u8A00\u592A\u5927\uFF0C\u5149\u7EBF\u5939\u89D2\u53EF\u4EE5\u5FFD\u7565\u4E0D\u8BA1\uFF0C\u6240\u4EE5\u5C31\u8BA4\u4E3A\u4ECE\u7A97\u5916\u5C04\u5165\u5BA4\u5185\u7684\u9633\u5149\u662F\u5E73\u884C\u7684\u3002</li><li>\u70B9\u5149\u6E90\uFF08point light\uFF09\uFF1A\u5149\u7EBF\u4ECE\u4E00\u70B9\u5411\u5468\u56F4\u653E\u5C04\u3002\u6BD4\u5982\u623F\u95F4\u91CC\u7684\u7684\u706F\u6CE1\u5C31\u662F\u70B9\u5149\u6E90\u3002</li></ul><p>\u82E5\u5BF9\u5149\u6E90\u7684\u7167\u5C04\u8303\u56F4\u505A\u9650\u5236\uFF0C\u8FD8\u53EF\u4EE5\u884D\u751F\u51FA\u4E00\u4E9B\u66F4\u52A0\u5177\u4F53\u7684\u5149\u6E90\uFF0C\u6BD4\u5982\u7B52\u706F\u3001\u805A\u5149\u706F\u7B49\u3002<br> \u73B0\u5B9E\u4E16\u754C\u4E2D\u8FD8\u6709\u4E00\u79CD\u95F4\u63A5\u5149\u6E90\uFF0C\u53EB\u73AF\u5883\u5149\uFF08ambient light\uFF09\uFF0C\u5B83\u662F\u7ECF\u8FC7\u7269\u4F53\u53CD\u5C04\u540E\u7684\u5149\u3002<br><img src="'+Hs+'" alt=""></p><p>\u5F53\u5149\u6E90\u5C04\u51FA\u7684\u5149\u7EBF\u6253\u5230\u7269\u4F53\u4E0A\u65F6\uFF0C\u7269\u4F53\u53CD\u5C04\u7684\u5149\u4FBF\u662F\u6211\u4EEC\u8BC6\u522B\u7269\u4F53\u7684\u5173\u952E\u3002<br> \u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u518D\u8BA4\u8BC6\u4E00\u4E0B\u7269\u4F53\u53CD\u5C04\u7684\u5149\u3002</p><h3 id="_3-\u53CD\u5C04\u5149" tabindex="-1"><a class="header-anchor" href="#_3-\u53CD\u5C04\u5149" aria-hidden="true">#</a> 3.\u53CD\u5C04\u5149</h3><p>\u53CD\u5C04\u5149\uFF1A\u5F53\u5149\u6E90\u5C04\u51FA\u7684\u5149\u7EBF\u6253\u5230\u7269\u4F53\u4E0A\u65F6\uFF0C\u7269\u4F53\u53CD\u5C04\u7684\u5149\u3002</p><p>\u7269\u4F53\u7684\u53CD\u5C04\u5149\u662F\u6709\u65B9\u5411\u548C\u989C\u8272\u7684\uFF0C\u5176\u65B9\u5411\u548C\u989C\u8272\u4F1A\u53D7\u5165\u5C04\u5149\u548C\u7269\u4F53\u8868\u9762\u7684\u5F71\u54CD\u3002<br><img src="'+Ys+'" alt=""></p><p>\u7269\u4F53\u5E38\u89C1\u7684\u7684\u53CD\u5C04\u5149\uFF1A</p><ul><li>\u6F2B\u53CD\u5C04( diffuse reflection)\uFF1A \u7269\u4F53\u5728\u63A5\u6536\u5230\u76F4\u63A5\u5149\u6E90\u7684\u5165\u5C04\u5149\u540E\uFF0C\u4F1A\u5C06\u5149\u7EBF\u5747\u5300\u7684\u53CD\u5C04\u5411\u56DB\u9762\u516B\u65B9\uFF0C\u5982\u4E0B\u56FE\uFF1A<br><img src="'+Xs+'" alt=""></li></ul><p>\u7269\u4F53\u8868\u9762\u8D8A\u7C97\u7CD9\uFF0C\u6F2B\u53CD\u5C04\u5C31\u8D8A\u660E\u663E\u3002</p><ul><li>\u955C\u9762\u53CD\u5C04(specular reflection)\uFF1A \u7269\u4F53\u5728\u63A5\u6536\u5230\u76F4\u63A5\u5149\u6E90\u7684\u5165\u5C04\u5149\u540E\uFF0C\u4F1A\u5C06\u5149\u7EBF\u4EE5\u4E0E\u7269\u4F53\u8868\u9762\u7684\u6CD5\u7EBF\u5BF9\u79F0\u7684\u65B9\u5411\u53CD\u5C04\u51FA\u53BB\u3002<br><img src="'+Ks+'" alt=""></li></ul><p>\u200B\u7269\u4F53\u8868\u9762\u8D8A\u5149\u6ED1\uFF0C\u955C\u9762\u53CD\u5C04\u5C31\u8D8A\u660E\u663E\u3002</p><ul><li>\u73AF\u5883\u53CD\u5C04\uFF08 enviroment ambient reflection\uFF09\uFF1A\u7269\u4F53\u5BF9\u73AF\u5883\u5149\u7684\u53CD\u5C04\u3002</li></ul><p>\u5173\u4E8E\u5149\u7684\u57FA\u672C\u6982\u5FF5\u54B1\u4EEC\u5C31\u5148\u8BF4\u5230\u8FD9\uFF0C\u63A5\u4E0B\u6765\u5177\u4F53\u7684\u8BF4\u4E00\u4E0B\u5982\u4F55\u4E3A\u7269\u4F53\u7740\u8272\u3002</p><h2 id="\u4E8C\u5341\u4E8C\u3001\u7740\u8272" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u4E8C\u3001\u7740\u8272" aria-hidden="true">#</a> \u4E8C\u5341\u4E8C\u3001\u7740\u8272</h2><p>\u901A\u4FD7\u800C\u8A00\uFF0C\u7740\u8272(shading)\u662F\u7ED8\u753B\u65F6\uFF0C\u7528\u7EBF\u6761\u6216\u8272\u5757\u8868\u793A\u7269\u4F53\u660E\u6697\u6216\u989C\u8272\u7684\u65B9\u5F0F\u3002</p><ul><li>\u7EBF\u6761\u7740\u8272 <img src="'+Zs+'" alt=""></li><li>\u8272\u5757\u7740\u8272 <img src="'+Qs+'" alt=""></li></ul><p>\u5728\u8BA1\u7B97\u673A\u56FE\u5F62\u5B66\u4E2D\uFF0C\u7740\u8272\u662F\u5BF9\u4E0D\u540C\u7269\u4F53\u5E94\u7528\u4E0D\u540C\u6750\u8D28\u7684\u8FC7\u7A0B\u3002<br><img src="'+$s+'" alt=""></p><p>\u5728\u8BA1\u7B97\u673A\u91CC\u4E3A\u6A21\u578B\u7740\u8272\uFF0C\u662F\u5F88\u96BE\u539F\u5C01\u4E0D\u52A8\u7684\u8FD8\u539F\u73B0\u5B9E\u7684\u3002<br> \u53EA\u80FD\u8BA9\u6A21\u578B\u66F4\u52A0\u63A5\u8FD1\u73B0\u5B9E\u3002</p><p>\u8BA9\u6A21\u578B\u63A5\u8FD1\u73B0\u5B9E\u7684\u7740\u8272\u65B9\u6CD5\u662F\u6709\u5F88\u591A\u79CD\u7684\u3002<br> \u63A5\u4E0B\u6765\uFF0C\u8BF4\u4E00\u4E2A\u53EB Blinn-Phong \u7740\u8272\u65B9\u6CD5\u3002<br> Blinn-Phong \u662F\u4E00\u79CD\u53CD\u5C04\u6A21\u578B\uFF0C\u4E0D\u5177\u5907\u4E25\u683C\u7684\u7269\u7406\u610F\u4E49\uFF0C\u5B83\u662F\u5BF9\u7269\u7406\u73B0\u8C61\u7684\u6A21\u62DF\uFF0C\u6240\u4EE5\u4E0D\u8981\u57FA\u4E8E\u73B0\u5B9E\u60C5\u51B5\u592A\u8FC7\u8F83\u771F\u3002</p><p>\u5148\u770B\u4E00\u4E0B\u8981\u5BF9\u4E00\u4E2A\u7269\u4F53\u8FDB\u884C\u7740\u8272\u9700\u8981\u8003\u8651\u7684\u6761\u4EF6\u3002<br><img src="'+o+'" alt=""></p><ul><li>\u7740\u8272\u70B9 <ul><li>\u6CD5\u7EBFnormal</li><li>\u989C\u8272diffuse coefficient</li><li>\u5149\u6CFD\u5EA6 shininess</li></ul></li><li>\u5149\u6E90 <ul><li>\u5149\u6E90\u4F4D\u7F6E position</li><li>\u5149\u6E90\u5F3A\u5EA6 intensity</li></ul></li><li>\u7740\u8272\u70B9\u5230\u5149\u6E90\u7684\u8DDD\u79BBr</li><li>\u7740\u8272\u70B9\u5230\u5149\u6E90\u7684\u65B9\u5411l</li><li>\u7740\u8272\u70B9\u5230\u89C6\u70B9\u7684\u65B9\u5411v</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u5148\u8003\u8651\u4E00\u4E0B\u7740\u8272\u70B9\u7684\u4EAE\u5EA6\u548C\u4E0A\u9762\u5404\u79CD\u6761\u4EF6\u7684\u5173\u7CFB\u3002</p><h3 id="_1-\u5149\u7EBF\u4E0E\u7740\u8272\u70B9\u6CD5\u7EBF\u7684\u5939\u89D2" tabindex="-1"><a class="header-anchor" href="#_1-\u5149\u7EBF\u4E0E\u7740\u8272\u70B9\u6CD5\u7EBF\u7684\u5939\u89D2" aria-hidden="true">#</a> 1.\u5149\u7EBF\u4E0E\u7740\u8272\u70B9\u6CD5\u7EBF\u7684\u5939\u89D2</h3><p>\u5728\u540C\u6837\u7684\u5149\u6E90\u4E0B\uFF0C\u5165\u5C04\u5149\u7EBF\u548C\u7740\u8272\u70B9\u6CD5\u7EBF\u7684\u5939\u89D2\u4F1A\u5F71\u54CD\u7740\u8272\u70B9\u63A5\u6536\u5149\u7EBF\u7684\u6570\u91CF\u3002<br><img src="'+Js+`" alt=""></p><p>\u5728\u4E0A\u56FE\u4E2D\uFF0C\u5047\u5982\u7B2C\u4E00\u4E2A\u7740\u8272\u70B9\u80FD\u63A5\u65366\u6761\u5149\u7EBF\uFF0C\u5219\u5F53\u7740\u8272\u70B9\u65CB\u8F6C45\xB0\u540E\uFF0C\u5B83\u5C31\u53EA\u80FD\u63A5\u65364\u6761\u5149\u7EBF\u4E86\u3002<br> \u56E0\u6B64\uFF0C\u6211\u4EEC\u4F1A\u7528\u5165\u5C04\u5149\u7EBFl \u548C\u7740\u8272\u70B9\u6CD5\u7EBFn\u7684\u5939\u89D2\u7684\u4F59\u5F26\u503C\uFF0C\u6765\u8868\u793A\u7740\u8272\u70B9\u7684\u53D7\u5149\u7A0B\u5EA6\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B8 <span class="token operator">=</span> l\xB7n
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u89E3\u91CA\u4E00\u4E0B\u4E0A\u9762\u7684\u7B49\u5F0F\u662F\u600E\u4E48\u6765\u7684\u3002</p><p>\u7531\u70B9\u79EF\u516C\u5F0F\u5F97\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>l\xB7n <span class="token operator">=</span> cos\u03B8 <span class="token operator">*</span> <span class="token operator">|</span>l<span class="token operator">|</span> <span class="token operator">*</span> <span class="token operator">|</span>n<span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B8 <span class="token operator">=</span> l\xB7n <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token operator">|</span>l<span class="token operator">|</span> <span class="token operator">*</span> <span class="token operator">|</span>n<span class="token operator">|</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u56E0\u4E3A</code>\uFF1Al,n\u4E3A\u5355\u4F4D\u5411\u91CF</p><p><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u03B8 <span class="token operator">=</span> l\xB7n <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span>
cos\u03B8 <span class="token operator">=</span> l\xB7n
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-\u5149\u7EBF\u7684\u8870\u51CF" tabindex="-1"><a class="header-anchor" href="#_2-\u5149\u7EBF\u7684\u8870\u51CF" aria-hidden="true">#</a> 2.\u5149\u7EBF\u7684\u8870\u51CF</h3><p>\u5149\u5728\u4F20\u64AD\u7684\u8FC7\u7A0B\u4E2D\u4F1A\u4EA7\u751F\u8870\u51CF\u3002<br> \u7740\u8272\u70B9\u5230\u5149\u6E90\u7684\u8DDD\u79BB\u8D8A\u8FDC\uFF0C\u7740\u8272\u70B9\u63A5\u6536\u5230\u7684\u5149\u80FD\u5C31\u8D8A\u5C11\u3002</p><p>\u73B0\u5B9E\u4E16\u754C\u4E2D\u5F71\u54CD\u5149\u7EBF\u8870\u51CF\u7684\u56E0\u7D20\u6709\u5F88\u591A\uFF0C\u6BD4\u5982\u5929\u6C14\u60C5\u51B5\u3001\u7A7A\u6C14\u8D28\u91CF\u7B49\u3002<br> \u6211\u4EEC\u8FD9\u91CC\u7684\u56FE\u5F62\u5B66\u53EF\u4EE5\u5148\u4E0D\u8003\u8651\u592A\u591A\uFF0C\u6211\u4EEC\u53EF\u4EE5\u7528\u4E00\u4E2A\u7B80\u5355\u7684\u516C\u5F0F\u6765\u6A21\u62DF\u5149\u7EBF\u7684\u8870\u51CF\u3002<br><img src="`+na+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><p>I\u662F\u5149\u6E90\u7684\u5F3A\u5EA6<br> r \u662F\u7740\u8272\u70B9\u5230\u5149\u6E90\u7684\u8DDD\u79BB<br> \u6C42\uFF1A\u7740\u8272\u70B9\u5904\u7684\u5149\u7EBF\u5F3A\u5EA6intensity</p><p><code>\u89E3</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>intensity <span class="token operator">=</span> <span class="token constant">I</span> <span class="token operator">/</span> r\xB2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u6CE8</code>\uFF1A</p><p>\u6709\u4E9B\u5149\u7684\u5149\u7EBF\u8870\u51CF\u662F\u53EF\u4EE5\u88AB\u5FFD\u7565\u7684\uFF0C\u6BD4\u5982\u4ECE\u7A97\u5916\u6253\u8FDB\u623F\u95F4\u91CC\u7684\u9633\u5149\u3002<br> \u5176\u539F\u7406\u5C31\u662F\uFF0C\u65E0\u8BBA\u5149\u7EBF\u65B9\u5411\u8FD8\u662F\u5149\u7EBF\u8870\u51CF\uFF0C\u53EA\u8981\u5176\u5728\u4E00\u5B9A\u8303\u56F4\u5185\u53D8\u5316\u6781\u5C0F\uFF0C\u90A3\u5C31\u53EF\u4EE5\u5FFD\u7565\uFF0C\u4ECE\u800C\u63D0\u9AD8\u6E32\u67D3\u901F\u5EA6\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u628A\u4E0A\u9762\u7684\u5DF2\u77E5\u6761\u4EF6\u548C\u516C\u5F0F\u505A\u4E00\u4E0B\u68B3\u7406\uFF0C\u6C42\u4E00\u4E0B\u7740\u8272\u70B9\u7684\u6F2B\u53CD\u5C04\u3002</p><h3 id="_3-\u6F2B\u53CD\u5C04" tabindex="-1"><a class="header-anchor" href="#_3-\u6F2B\u53CD\u5C04" aria-hidden="true">#</a> 3.\u6F2B\u53CD\u5C04</h3><h4 id="_3-1\u6F2B\u53CD\u5C04\u516C\u5F0F" tabindex="-1"><a class="header-anchor" href="#_3-1\u6F2B\u53CD\u5C04\u516C\u5F0F" aria-hidden="true">#</a> 3.1\u6F2B\u53CD\u5C04\u516C\u5F0F</h4><p><img src="`+o+`" alt=""></p><p>\u6F2B\u53CD\u5C04\u7684\u8BA1\u7B97\u516C\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Ld <span class="token operator">=</span> <span class="token function">kd</span><span class="token punctuation">(</span><span class="token constant">I</span> <span class="token operator">/</span> r\xB2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n\xB7l<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>Ld-diffusely reflected light \u6F2B\u53CD\u5C04</li><li>kd-diffuse coefficient \u6F2B\u53CD\u5C04\u7CFB\u6570\uFF0C\u5373\u989C\u8272</li><li>I/r\xB2 \u7740\u8272\u70B9\u5904\u7684\u5149\u7EBF\u5F3A\u5EA6</li><li>max(0, n\xB7l) \u7740\u8272\u70B9\u63A5\u6536\u5230\u7684\u5149\u7EBF\u6570\u91CF</li></ul><p><code>\u6CE8</code>\uFF1A\u6F2B\u53CD\u5C04\u548C \u89C6\u7EBFv \u6CA1\u6709\u4EFB\u4F55\u5173\u7CFB\uFF0C\u8FD9\u662F\u56E0\u4E3A\u6F2B\u53CD\u5C04\u662F\u5411\u56DB\u9762\u516B\u65B9\u53CD\u5C04\u7684\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u5229\u7528\u8FD9\u4E2A\u516C\u5F0F\u4E3Awebgl\u7684\u4E16\u754C\u6DFB\u52A0\u4E00\u7247\u9633\u5149\u3002</p><h4 id="_3-2-\u6F2B\u53CD\u5C04\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-2-\u6F2B\u53CD\u5C04\u793A\u4F8B" aria-hidden="true">#</a> 3-2-\u6F2B\u53CD\u5C04\u793A\u4F8B</h4><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u7403\u4F53 <ul><li>\u6F2B\u53CD\u5C04\u7CFB\u6570 u_Kd</li></ul></li><li>\u7403\u4F53\u88AB\u9633\u5149\u7167\u5C04</li><li>\u9633\u5149\u7684\u7279\u6027\uFF1A <ul><li>\u5E73\u884C\u5149</li><li>\u5149\u7EBF\u65B9\u5411\u4E3A u_LightDir</li><li>\u5149\u7EBF\u5F3A\u5EA6\u4E3A1\uFF0C\u8870\u51CF\u5FFD\u7565</li></ul></li></ul><p><code>\u6C42</code>\uFF1A\u7403\u4F53\u7684\u6F2B\u53CD\u5C04</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec3 a_Normal<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec3 v_Normal<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    v_Normal <span class="token operator">=</span> a_Normal<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec3 u_Kd<span class="token punctuation">;</span>
  uniform vec3 u_LightDir<span class="token punctuation">;</span>
  varying vec3 v_Normal<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 diffuse <span class="token operator">=</span> u_Kd <span class="token operator">*</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">,</span> u_LightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>diffuse<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    PerspectiveCamera<span class="token punctuation">,</span>
    Vector3<span class="token punctuation">,</span>
    SphereGeometry
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./lv/OrbitControls.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">//\u76EE\u6807\u70B9</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u89C6\u70B9</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
  <span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
  <span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>


  <span class="token comment">/* \u58F0\u660E\u5DF2\u77E5\u6761\u4EF6 */</span>
  <span class="token comment">// \u9633\u5149\u5149\u7EBF\u65B9\u5411</span>
  <span class="token keyword">const</span> lightDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6F2B\u53CD\u5C04\u7CFB\u6570- \u989C\u8272</span>
  <span class="token keyword">const</span> u_Kd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>
  <span class="token comment">// \u7403\u4F53</span>
  <span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SphereGeometry</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
  <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> vertices <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;position&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6CD5\u7EBF\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> normals <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;normal&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u9876\u70B9\u7D22\u5F15\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> indexes <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span>index
  <span class="token comment">// \u6CE8\u610F\uFF1A\u7403\u4F53\u662F\u4F7F\u7528three.js \u7684SphereGeometry \u5BF9\u8C61\u5EFA\u7ACB\u7684\uFF0C</span>
  <span class="token comment">//\u53EF\u4EE5\u76F4\u63A5\u4ECE\u8FD9\u91CC\u9762\u63D0\u53D6\u7403\u4F53\u7684\u9876\u70B9\u96C6\u5408\u3001\u6CD5\u7EBF\u96C6\u5408\u548C\u9876\u70B9\u7D22\u5F15\u3002</span>


  <span class="token comment">/* \u7ED8\u56FE */</span>
  <span class="token comment">// \u573A\u666F</span>
  <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
  scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
    <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
        gl<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Kd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_LightDir&#39;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Kd</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> u_Kd<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_LightDir</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>lightDir<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> normals<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> indexes
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+sa+`" alt=""></p><p>\u6CE8\u610F\uFF1A<br> \u5FAE\u8C03Scene\u5BF9\u8C61\u4E2D\u7528\u9876\u70B9\u7D22\u5F15\u7ED8\u56FE\u7684\u65B9\u6CD5\uFF1A</p><p>\u5C06\u4E4B\u524D\u7684gl.UNSIGNED_BYTE\u53D8\u6210gl.UNSIGNED_SHORT\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_SHORT</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4E4B\u524D\u7528\u9876\u70B9\u7D22\u5F15\u7ED8\u56FE\u65F6\uFF0C\u7528\u7684\u6570\u636E\u7C7B\u578B\u662Fgl.UNSIGNED_BYTE\uFF0C\u5982\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6B64\u6570\u636E\u7C7B\u578B\u53EA\u80FD\u7528Uint8Array\u5BF9\u8C61\u5EFA\u7ACB\u9876\u70B9\u7D22\u5F15\u96C6\u5408\uFF0C\u5982\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\u2026\u2026<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u7136\u800C\uFF0CUint8Array \u6709\u4E2A\u5F0A\u7AEF\uFF0C\u5176\u6570\u636E\u7684\u53D6\u503C\u8303\u56F4\u53EA\u80FD\u662F[0,255]\uFF0C\u8FD9\u5C31\u5BFC\u81F4\u4E86\u4E00\u4E2A\u6A21\u578B\u7684\u9876\u70B9\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7256\u3002</p><p>\u56E0\u6B64\uFF0C\u6211\u4EEC\u9700\u8981\u6269\u5927\u9876\u70B9\u7D22\u5F15\u7684\u53D6\u503C\u8303\u56F4\uFF0C\u6BD4\u5982\u7528Uint16Array \u5EFA\u7ACB\u9876\u70B9\u7D22\u5F15\u3002<br> Uint16Array\u6570\u636E\u7684\u53D6\u503C\u8303\u56F4\u662F[0,65535 ]\uFF0C\u8FD9\u5BF9\u4E8E\u4E00\u822C\u6A21\u578B\u800C\u8A00\uFF0C\u5DF2\u7ECF\u591F\u7528\u4E86\u3002</p><p>\u5728three.js \u91CC\uFF0C\u5176\u9876\u70B9\u7D22\u5F15\u7528\u7684\u5C31\u662FUint16Array \u3002<br> \u4F7F\u7528Uint16Array \u540E\uFF0CdrawElements() \u65B9\u6CD5\u91CC\u7684\u6570\u636E\u7C7B\u578B\u5C31\u9700\u8981\u53D8\u6210gl.UNSIGNED_SHORT\u3002</p></details><h3 id="_4-\u955C\u9762\u53CD\u5C04" tabindex="-1"><a class="header-anchor" href="#_4-\u955C\u9762\u53CD\u5C04" aria-hidden="true">#</a> 4.\u955C\u9762\u53CD\u5C04</h3><h4 id="_4-1\u955C\u9762\u53CD\u5C04\u516C\u5F0F" tabindex="-1"><a class="header-anchor" href="#_4-1\u955C\u9762\u53CD\u5C04\u516C\u5F0F" aria-hidden="true">#</a> 4.1\u955C\u9762\u53CD\u5C04\u516C\u5F0F</h4><p>\u5851\u6599\u548C\u77F3\u818F\u7684\u5DEE\u5F02\u5728\u4E8E\u5176\u8868\u9762\u6BD4\u8F83\u5149\u6ED1\uFF0C\u66F4\u52A0\u63A5\u8FD1\u955C\u9762\uFF0C\u4F1A\u6709\u660E\u663E\u7684\u9AD8\u5149\u5B58\u5728\u3002<br> \u6211\u4EEC\u901A\u8FC7\u955C\u9762\u53CD\u5C04\u8003\u8651\u4E00\u4E0B\uFF0C\u6211\u4EEC\u7684\u773C\u775B\u4EC0\u4E48\u65F6\u5019\u53EF\u4EE5\u770B\u89C1\u7269\u4F53\u7684\u9AD8\u5149\u3002<br><img src="`+aa+'" alt=""></p><p>\u5728\u4E0A\u56FE\u4E2D\uFF0C\u65B9\u5411R \u4FBF\u662F \u5149\u7EBFI \u5728\u7269\u4F53\u8868\u9762\u7684\u955C\u9762\u53CD\u5C04\u65B9\u5411\uFF0CR \u548C l \u57FA\u4E8E\u6CD5\u7EBF n \u5BF9\u79F0\u3002 \u5F53\u89C6\u7EBFv \u63A5\u8FD1R\u7684\u65F6\u5019\uFF0C\u4FBF\u53EF\u4EE5\u770B\u89C1\u9AD8\u5149\u3002</p><p>\u56E0\u6B64\uFF0CPhone \u63D0\u51FA\u4E86\u901A\u8FC7\u2220&lt;v,R&gt; \u7684\u5939\u89D2\u6765\u5224\u65AD\u773C\u775B\u80FD\u5426\u770B\u89C1\u9AD8\u5149\u7684\u65B9\u6CD5\u3002<br> \u7136\u800C\uFF0C\u8981\u57FA\u4E8E \u5149\u7EBFl \u548C \u6CD5\u7EBFn \u53BB\u6C42 l \u7684\u53CD\u5C04\u5411\u91CFR\uFF0C\u662F\u9700\u8981\u4E0D\u5C0F\u7684\u8BA1\u7B97\u91CF\u7684\u3002</p><p>\u6240\u4EE5\uFF0C\u540E\u6765 Blinn \u5C31\u5BF9 Phone \u7684\u65B9\u6848\u4F5C\u51FA\u4E86\u6539\u8FDB\uFF0C\u8BBE\u8BA1\u51FA\u4E86\u66F4\u7B80\u4FBF\u7684 Blinn-Phone \u6750\u8D28\u3002 \u63A5\u4E0B\u6765\uFF0C\u770B\u4E00\u4E0BBlinn-Phone \u6750\u8D28\u7684\u8BBE\u8BA1\u601D\u8DEF\u3002<br><img src="'+pa+`" alt=""></p><p>\u4E0A\u56FE\u4E2D\uFF0C\u5411\u91CFh \u662F\u2220&lt;v,v+l&gt; \u7684\u89D2\u5E73\u5206\u7EBF\u3002</p><p>\u901A\u8FC7\u89C2\u5BDF\uFF0C\u6211\u4EEC\u53EF\u4EE5\u77E5\u9053\uFF1A<br> \u968F\u89C6\u7EBF\u7684\u53D8\u6362\uFF0C\u2220&lt;h,n&gt; \u548C\u2220&lt;v,R&gt; \u7684\u5927\u5C0F\u662F\u6210\u6B63\u6BD4\u7684\u3002<br> \u4E5F\u5C31\u8BF4\uFF0C\u5F53\u89C6\u7EBFv \u8D8A\u63A5\u8FD1\u955C\u9762\u53CD\u5C04R \uFF0C\u89D2\u5E73\u5206\u7EBFh\u5C31\u8D8A\u63A5\u8FD1\u6CD5\u7EBFn\u3002</p><p>Blinn-Phone \u8BA1\u7B97\u955C\u9762\u53CD\u5C04\u7684\u516C\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>h <span class="token operator">=</span> <span class="token punctuation">(</span>v<span class="token operator">+</span>l<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token operator">|</span>v<span class="token operator">+</span>l<span class="token operator">|</span>
Ls <span class="token operator">=</span> ks <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token constant">I</span> <span class="token operator">/</span> r\xB2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n\xB7h<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>h\uFF1A\u2220&lt;v,v+l&gt; \u7684\u89D2\u5E73\u5206\u7EBF</li><li>|v+l|\uFF1A(v+l) \u7684\u957F\u5EA6</li><li>Ls\uFF1A\u955C\u9762\u53CD\u5C04 specularly reflected light</li><li>ks\uFF1A\u955C\u9762\u53CD\u5C04\u7CFB\u6570 specularly coefficient</li><li>max(0,n\xB7h)\uFF1Acos\u2220&lt;h,n&gt;</li><li>pow(max(0,n\xB7h),p)\uFF1Acos\u2220&lt;h,n&gt;\u7684p\u6B21\u65B9</li></ul><p>\u89E3\u91CA\u4E00\u4E0Bcos\u2220&lt;h,n&gt;\u7684p\u6B21\u65B9\u7684\u610F\u4E49\u3002<br> \u82E5\u53EA\u7528cos\u2220&lt;h,n&gt; \u6765\u8BA1\u7B97\u9AD8\u5149\uFF0C\u4F1A\u5F97\u5230\u8F83\u5927\u7684\u9AD8\u5149\uFF0C\u800C\u6211\u4EEC\u5E73\u65F6\u6240\u89C1\u7684\u9AD8\u5149\u4E00\u822C\u90FD\u662F\u6BD4\u8F83\u5C0F\u7684\u3002<br> \u56E0\u6B64\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5BF9cos\u2220&lt;h,n&gt;\u505A\u4E00\u4E0B\u5E42\u8FD0\u7B97\u3002<br><img src="`+ta+`" alt=""></p><h4 id="_4-1\u955C\u9762\u53CD\u5C04\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_4-1\u955C\u9762\u53CD\u5C04\u793A\u4F8B" aria-hidden="true">#</a> 4.1\u955C\u9762\u53CD\u5C04\u793A\u4F8B</h4><p>\u63A5\u4E0B\u6765\uFF0C\u8FD8\u662F\u57FA\u4E8E\u4E4B\u524D\u7684\u90A3\u4E2A\u7403\u4F53\u6765\u505A\u4E00\u4E0B\u955C\u9762\u53CD\u5C04\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u7403\u4F53 <ul><li>\u6F2B\u53CD\u5C04\u7CFB\u6570 u_Kd</li><li>\u955C\u9762\u53CD\u5C04\u7CFB\u6570 u_Ks</li></ul></li><li>\u7403\u4F53\u88AB\u9633\u5149\u7167\u5C04</li><li>\u9633\u5149\u7684\u7279\u6027\uFF1A <ul><li>\u5E73\u884C\u5149</li><li>\u5149\u7EBF\u65B9\u5411\u4E3A u_LightDir</li><li>\u5149\u7EBF\u5F3A\u5EA6\u4E3A 1\uFF0C\u8870\u51CF\u5FFD\u7565</li></ul></li><li>\u89C6\u70B9\u4F4D\u7F6E\uFF1Au_Eye</li></ul><p><code>\u6C42</code>\uFF1A\u7403\u4F53\u7684\u955C\u9762\u53CD\u5C04</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec3 a_Normal<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec3 v_Normal<span class="token punctuation">;</span>
  varying vec3 v_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    v_Normal <span class="token operator">=</span> a_Normal<span class="token punctuation">;</span>
    v_Position <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec3 u_Kd<span class="token punctuation">;</span>
  uniform vec3 u_Ks<span class="token punctuation">;</span>
  uniform vec3 u_LightDir<span class="token punctuation">;</span>
  uniform vec3 u_Eye<span class="token punctuation">;</span>
  varying vec3 v_Normal<span class="token punctuation">;</span>
  varying vec3 v_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u89C6\u70B9\u770B\u5411\u5F53\u524D\u7740\u8272\u70B9\u7684\u89C6\u7EBF</span>
    vec3 eyeDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>u_Eye <span class="token operator">-</span> v_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u89D2\u5E73\u5206\u7EBF</span>
    vec3 h<span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>eyeDir <span class="token operator">+</span> u_LightDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u6F2B\u53CD\u5C04</span>
    vec3 diffuse <span class="token operator">=</span> u_Kd <span class="token operator">*</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">,</span> u_LightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u955C\u9762\u53CD\u5C04</span>
    vec3 specular <span class="token operator">=</span> u_Ks <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>
      <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">64.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Blinn-Phong \u53CD\u5C04</span>
    vec3 l <span class="token operator">=</span> diffuse <span class="token operator">+</span> specular<span class="token punctuation">;</span>

    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span>
    PerspectiveCamera<span class="token punctuation">,</span>
    Vector3<span class="token punctuation">,</span>
    SphereGeometry
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./lv/OrbitControls.js&#39;</span>
  <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span>
  <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span>
  <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span>
  <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// \u76EE\u6807\u70B9</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u89C6\u70B9</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
  <span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
  <span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  
  <span class="token comment">/* \u58F0\u660E\u5DF2\u77E5\u6761\u4EF6 */</span>
  <span class="token comment">// \u9633\u5149\u5149\u7EBF\u65B9\u5411</span>
  <span class="token keyword">const</span> lightDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6F2B\u53CD\u5C04\u7CFB\u6570- \u989C\u8272</span>
  <span class="token keyword">const</span> u_Kd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>
  <span class="token comment">// \u955C\u9762\u53CD\u5C04\u7CFB\u6570</span>
  <span class="token keyword">const</span> u_Ks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">]</span>

  <span class="token comment">// \u7403\u4F53</span>
  <span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SphereGeometry</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> vertices <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;position&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6CD5\u7EBF\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> normals <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;normal&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u9876\u70B9\u7D22\u5F15\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> indexes <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span>index

  <span class="token comment">// \u573A\u666F</span>
  <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
  scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
    <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
        gl<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Kd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_LightDir&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;u_Ks&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Eye&#39;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Kd</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> u_Kd<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_LightDir</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>lightDir<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Ks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> u_Ks<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Eye</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> normals<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> indexes
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+ea+`" alt=""></p></details><h3 id="_5-\u73AF\u5883\u53CD\u5C04" tabindex="-1"><a class="header-anchor" href="#_5-\u73AF\u5883\u53CD\u5C04" aria-hidden="true">#</a> 5.\u73AF\u5883\u53CD\u5C04</h3><h4 id="_5-1\u73AF\u5883\u53CD\u5C04\u7684\u516C\u5F0F" tabindex="-1"><a class="header-anchor" href="#_5-1\u73AF\u5883\u53CD\u5C04\u7684\u516C\u5F0F" aria-hidden="true">#</a> 5.1\u73AF\u5883\u53CD\u5C04\u7684\u516C\u5F0F</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>La <span class="token operator">=</span> ka <span class="token operator">*</span> Ia
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>La\uFF1A\u73AF\u5883\u53CD\u5C04 reflected ambient light</li><li>ka\uFF1A\u73AF\u5883\u5149\u7CFB\u6570 ambient coefficient</li><li>Ia\uFF1A\u73AF\u5883\u5149\u5F3A\u5EA6 ambient intensity</li></ul><h4 id="_5-2\u73AF\u5883\u53CD\u5C04\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_5-2\u73AF\u5883\u53CD\u5C04\u793A\u4F8B" aria-hidden="true">#</a> 5.2\u73AF\u5883\u53CD\u5C04\u793A\u4F8B</h4><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li><p>\u7403\u4F53</p><ul><li>\u6F2B\u53CD\u5C04\u7CFB\u6570 u_Kd</li><li>\u955C\u9762\u53CD\u5C04\u7CFB\u6570 u_Ks</li></ul></li><li><p>\u7403\u4F53\u88AB\u9633\u5149\u7167\u5C04</p></li><li><p>\u9633\u5149\u7684\u7279\u6027\uFF1A</p><ul><li>\u5E73\u884C\u5149</li><li>\u5149\u7EBF\u65B9\u5411\u4E3A u_LightDir</li><li>\u5149\u7EBF\u5F3A\u5EA6\u4E3A 1\uFF0C\u8870\u51CF\u5FFD\u7565</li></ul></li><li><p>\u89C6\u70B9\u4F4D\u7F6E\uFF1Acamera.position</p></li><li><p>\u73AF\u5883\u5149\u7CFB\u6570\uFF1Au_Ka</p></li><li><p>\u73AF\u5883\u5149\u5F3A\u5EA6\uFF1A1</p></li></ul><p><code>\u6C42</code>\uFF1A\u7403\u4F53\u7684\u73AF\u5883\u53CD\u5C04</p><details class="custom-container details"><summary>\u4EE3\u7801\u5B9E\u73B0</summary><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec3 a_Normal<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec3 v_Normal<span class="token punctuation">;</span>
  varying vec3 v_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    v_Normal <span class="token operator">=</span> a_Normal<span class="token punctuation">;</span>
    v_Position <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec3 u_Kd<span class="token punctuation">;</span>
  uniform vec3 u_Ks<span class="token punctuation">;</span>
  uniform vec3 u_Ka<span class="token punctuation">;</span>
  uniform vec3 u_LightDir<span class="token punctuation">;</span>
  uniform vec3 u_Eye<span class="token punctuation">;</span>
  varying vec3 v_Normal<span class="token punctuation">;</span>
  varying vec3 v_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u89C6\u70B9\u770B\u5411\u5F53\u524D\u7740\u8272\u70B9\u7684\u89C6\u7EBF</span>
    vec3 eyeDir <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>u_Eye <span class="token operator">-</span> v_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u89D2\u5E73\u5206\u7EBF</span>
    vec3 h <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span>eyeDir <span class="token operator">+</span> u_LightDir<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u6F2B\u53CD\u5C04</span>
    vec3 diffuse <span class="token operator">=</span> u_Kd <span class="token operator">*</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">,</span> u_LightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u955C\u9762\u53CD\u5C04</span>
    vec3 specular <span class="token operator">=</span> u_Ks <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>
      <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">64.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Blinn-Phong \u53CD\u5C04 (\u6F2B\u53CD\u5C04 + \u955C\u9762\u53CD\u5C04 + \u73AF\u5883\u53CD\u5C04)</span>
    vec3 l <span class="token operator">=</span> diffuse <span class="token operator">+</span> specular <span class="token operator">+</span> u_Ka<span class="token punctuation">;</span>

    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span>
    Matrix4<span class="token punctuation">,</span> 
    PerspectiveCamera<span class="token punctuation">,</span> 
    Vector3<span class="token punctuation">,</span>
    SphereGeometry
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./lv/OrbitControls.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// \u76EE\u6807\u70B9</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//\u89C6\u70B9</span>
  <span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
  <span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
  <span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
  <span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// \u9633\u5149\u5149\u7EBF\u65B9\u5411</span>
  <span class="token keyword">const</span> lightDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6F2B\u53CD\u5C04\u7CFB\u6570- \u989C\u8272</span>
  <span class="token keyword">const</span> u_Kd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>
  <span class="token comment">// \u955C\u9762\u53CD\u5C04\u7CFB\u6570</span>
  <span class="token keyword">const</span> u_Ks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span>
  <span class="token comment">//\u73AF\u5883\u53CD\u5C04\u7CFB\u6570</span>
  <span class="token keyword">const</span> u_Ka <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span>

  <span class="token comment">// \u7403\u4F53</span>
  <span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SphereGeometry</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> vertices <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;position&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6CD5\u7EBF\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> normals <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;normal&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u9876\u70B9\u7D22\u5F15\u96C6\u5408</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">array</span><span class="token operator">:</span> indexes <span class="token punctuation">}</span> <span class="token operator">=</span> sphere<span class="token punctuation">.</span>index

  <span class="token comment">// \u573A\u666F</span>
  <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
  scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
    <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
        gl<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Kd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_LightDir&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;u_Ks&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Ka&#39;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Kd</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> u_Kd<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_LightDir</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>lightDir<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Ks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> u_Ks<span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Eye</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">u_Ka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>u_Ka<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> normals<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> indexes
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>ani<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+g+`" alt=""></p></details><h3 id="_6-blinn-phong\u53CD\u5C04\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#_6-blinn-phong\u53CD\u5C04\u6A21\u578B" aria-hidden="true">#</a> 6.Blinn-Phong\u53CD\u5C04\u6A21\u578B</h3><p>\u4E4B\u524D\u5C06\u6F2B\u53CD\u5C04Diffuse \u3001\u9AD8\u5149Specular \u548C \u73AF\u5883\u5149Ambient \u52A0\u5728\u4E00\u8D77\u7684\u65B9\u6CD5\uFF0C\u5C31\u53EBBlinn-Phong \u53CD\u5C04\u6A21\u578B\uFF0C\u5373\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">L</span> <span class="token operator">=</span> Ld <span class="token operator">+</span> Ls <span class="token operator">+</span> La 
<span class="token constant">L</span> <span class="token operator">=</span> <span class="token function">kd</span><span class="token punctuation">(</span><span class="token constant">I</span><span class="token operator">/</span>r\xB2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n\xB7l<span class="token punctuation">)</span> <span class="token operator">+</span> ks<span class="token operator">*</span><span class="token punctuation">(</span><span class="token constant">I</span><span class="token operator">/</span>r\xB2<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n\xB7h<span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span> <span class="token operator">+</span>  ka<span class="token operator">*</span>Ia
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u901A\u8FC7\u4E0A\u9762\u7684\u793A\u4F8B\uFF0C\u53EF\u4EE5\u77E5\u9053\uFF1A</p><ul><li>\u6F2B\u53CD\u5C04\u53EF\u4EE5\u8BA9\u7269\u4F53\u5177\u6709\u4F53\u611F\uFF1B</li><li>\u955C\u9762\u53CD\u5C04\u53EF\u4EE5\u8BA9\u7269\u4F53\u5728\u6211\u4EEC\u773C\u524D\u4E00\u4EAE\uFF1B</li><li>\u73AF\u5883\u53CD\u5C04\u53EF\u4EE5\u8BA9\u7269\u4F53\u770B\u8D77\u6765\u66F4\u52A0\u7EC6\u817B\u3002</li></ul><p>\u73B0\u5728\u5E94\u8BE5\u5BF9\u4E8E\u7740\u8272\u6709\u4E86\u4E00\u5B9A\u7684\u8BA4\u77E5\uFF0C\u63A5\u4E0B\u6765\u518D\u8BF4\u4E00\u4E2A\u4E4B\u524D\u8DF3\u8FC7\u7684\u77E5\u8BC6\u70B9-\u7740\u8272\u9891\u7387\u3002</p><h2 id="\u4E8C\u5341\u4E8C\u3001\u7740\u8272\u9891\u7387" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u4E8C\u3001\u7740\u8272\u9891\u7387" aria-hidden="true">#</a> \u4E8C\u5341\u4E8C\u3001\u7740\u8272\u9891\u7387</h2><p>\u7740\u8272\u9891\u7387\u4E0E\u6CD5\u7EBF\u662F\u606F\u606F\u76F8\u5173\u7684\uFF0C\u6240\u4EE5\u5F97\u5148\u4ECE\u6CD5\u7EBF\u8BF4\u8D77\u3002<br> \u6CD5\u7EBF\u5C31\u662F\u5782\u76F4\u4E8E\u7740\u8272\u70B9\u7684\u4E00\u4E2A\u5355\u4F4D\u5411\u91CF\uFF0C\u5982\u4E0B\u56FE\uFF1A<br><img src="`+o+`" alt=""></p><p>\u5728 webgl \u4E2D\u5EFA\u7ACB\u7684\u6A21\u578B\u662F\u7528\u4E09\u89D2\u5F62\u62FC\u8D77\u6765\u7684\uFF0C\u800C\u4E0D\u662F\u7528\u7740\u8272\u70B9\u62FC\u8D77\u6765\u7684\uFF0C\u90A3\u4E48\u4E4B\u524D\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u8BA1\u7B97\u7684\u6CD5\u7EBF\u662F\u600E\u4E48\u6765\u7684\u5462\uFF1F</p><p>\u90A3\u662F\u4ECEthree.js\u7684SphereGeometry \u5BF9\u8C61\u91CC\u6765\u7684\u3002<br> \u90A3SphereGeometry \u5BF9\u8C61\u662F\u600E\u4E48\u7B97\u6CD5\u7EBF\u7684\u5462\uFF1F<br> \u4E0D\u59A8\u5148\u770B\u4E00\u4E0B\u6CD5\u7EBF\u7684\u5206\u5E03\u6548\u679C\u3002</p><h3 id="_1-\u6CD5\u7EBF" tabindex="-1"><a class="header-anchor" href="#_1-\u6CD5\u7EBF" aria-hidden="true">#</a> 1.\u6CD5\u7EBF</h3><ol><li>\u51C6\u5907\u4E00\u4EFD\u7528\u4E8E\u7ED8\u5236\u6CD5\u7EBF\u7684\u8F85\u52A9\u7EBF\u7684\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="2"><li>\u5EFA\u7ACB\u4E00\u4E2A\u83B7\u53D6\u6CD5\u7EBF\u8F85\u52A9\u7EBF\u7684\u9876\u70B9\u6570\u636E\u7684\u65B9\u6CD5 (\u9876\u70B9\u96C6\u5408,\u6CD5\u7EBF\u96C6\u5408,\u957F\u5EA6)</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getNormalHelper</span><span class="token punctuation">(</span><span class="token parameter">vertices<span class="token punctuation">,</span> normals<span class="token punctuation">,</span>length<span class="token operator">=</span><span class="token number">0.2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> normalVertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> normals<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6A21\u578B\u7684\u9876\u70B9\u70B9\u4F4D</span>
    <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>
      vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u5C06\u6CD5\u7EBF\u4ECE\u6A21\u578B\u9876\u70B9\u5411\u5916\u5EF6\u4F38</span>
    <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>
      normals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> normals<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> normals<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
    normalVertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>p1<span class="token punctuation">,</span> <span class="token operator">...</span>p2<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>normalVertices<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="3"><li>\u7ED8\u5236\u6CD5\u7EBF\u8F85\u52A9\u7EBF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> matN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;LINES&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token function">getNormalHelper</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> normals<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> objN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoN<span class="token punctuation">,</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matN <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objN<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u6548\u679C\uFF1A<br><img src="`+oa+'" alt=""></p><p>\u7531\u6B64\u53EF\u89C1\uFF0Cthree.js \u91CC\u7684\u8FD9\u4E2ASphereGeometry\u5BF9\u8C61\u7684\u6CD5\u7EBF\u662F\u7531\u7403\u5FC3\u5411\u56DB\u5468\u53CD\u5C04\u3002<br> \u7136\u800C\uFF0C\u6A21\u578B\u7684\u6CD5\u7EBF\u6CD5\u7EBF\u9664\u4E86\u50CF\u4E0A\u9762\u8FD9\u6837\u5206\u5E03\uFF0C\u8FD8\u6709\u6CA1\u6709\u5176\u5B83\u7684\u5206\u5E03\u65B9\u6CD5\u5462\uFF1F<br> \u8FD9\u5C31\u6D89\u53CA\u7740\u8272\u9891\u7387\u7684\u95EE\u9898\uFF0C\u63A5\u4E0B\u6765\u5C31\u901A\u8FC7\u7740\u8272\u9891\u7387\u8BF4\u4E00\u4E0B\u6A21\u578B\u6CD5\u7EBF\u5E38\u89C1\u7684\u8BBE\u7F6E\u65B9\u6CD5\u3002</p><h3 id="_2-\u8BA4\u8BC6\u7740\u8272\u9891\u7387" tabindex="-1"><a class="header-anchor" href="#_2-\u8BA4\u8BC6\u7740\u8272\u9891\u7387" aria-hidden="true">#</a> 2.\u8BA4\u8BC6\u7740\u8272\u9891\u7387</h3><p><img src="'+ca+'" alt=""></p><p>\u5E38\u89C1\u7684\u7740\u8272\u9891\u7387\u6709\u4E09\u79CD\uFF1A</p><ul><li><p>\u9010\u4E09\u89D2\u5F62\u7740\u8272(flat shading)\uFF1A\u6A21\u578B\u7684\u6BCF\u4E2A\u9762\u90FD\u62E5\u6709\u7EDF\u4E00\u7684\u6CD5\u7EBF\uFF0C\u6548\u679C\u6BD4\u8F83\u786C\u6717\u3002</p></li><li><p>\u9010\u9876\u70B9\u7740\u8272(gouraud shading)\uFF1A\u6A21\u578B\u7684\u6BCF\u4E2A\u9876\u70B9\u90FD\u62E5\u6709\u5404\u81EA\u7684\u6CD5\u7EBF\u3002</p><p>\u6BCF\u4E09\u4E2A\u70B9\u6784\u6210\u7684\u4E09\u89D2\u5F62\u7684\u5185\u90E8\u7684\u70B9\u7684\u6CD5\u7EBF\u4F1A\u901A\u8FC7\u4E09\u89D2\u5F62\u7684\u63D2\u503C\u7B97\u6CD5\u8BA1\u7B97\u51FA\u6765\u3002<br> webgl \u7740\u8272\u5668\u5DF2\u7ECF\u901A\u8FC7varying \u53D8\u91CF\u5B9E\u73B0\u4E86\u6B64\u529F\u80FD\u3002<br> \u6548\u679C\u6BD4\u8F83\u5E73\u6ED1\uFF0C\u4F46\u662F\u4E09\u89D2\u5F62\u592A\u5927\u7684\u8BDD\uFF0C\u9AD8\u5149\u5C31\u770B\u4E0D\u89C1\u4E86\u3002</p></li><li><p>\u9010\u7247\u5143\u7740\u8272(phong shading)\uFF1A\u6A21\u578B\u7684\u6BCF\u4E2A\u7247\u5143\u90FD\u62E5\u6709\u5404\u81EA\u7684\u6CD5\u7EBF\uFF0C\u7531phong \u63D0\u51FA\u3002</p></li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u8003\u8651\u4E00\u4E0B\u8981\u6E32\u67D3\u4E00\u4E2A\u5149\u6ED1\u7403\u4F53\uFF0C\u7528\u54EA\u79CD\u7740\u8272\u9891\u7387\u5408\u9002\u3002<br><img src="'+la+'" alt=""></p><p>\u4E0A\u56FE\u81EA\u4E0A\u800C\u4E0B\uFF0C\u7403\u4F53\u9876\u70B9\u7684\u6570\u91CF\u662F\u7531\u5C11\u5230\u591A\u7684\u3002<br> \u7531\u56FE\u53EF\u77E5\uFF1A</p><ul><li>\u5F53\u9876\u70B9\u6570\u91CF\u5F88\u5C11\u65F6\uFF1A <ul><li>\u9010\u4E09\u89D2\u5F62\u7740\u8272\u6548\u679C\u751F\u786C\uFF0C\u6E32\u67D3\u901F\u5EA6\u6700\u5FEB\u3002</li><li>\u9010\u9876\u70B9\u7740\u8272\u6548\u679C\u8F83\u4E3A\u5E73\u6ED1\uFF0C\u4F1A\u5931\u53BB\u9AD8\u5149\uFF0C\u6E32\u67D3\u901F\u5EA6\u9002\u4E2D\u3002</li><li>\u9010\u7247\u5143\u7740\u8272\u6548\u679C\u6700\u4E3A\u5E73\u6ED1\uFF0C\u6E32\u67D3\u901F\u5EA6\u6700\u6162\u3002</li></ul></li><li>\u5F53\u9876\u70B9\u6570\u91CF\u9002\u4E2D\u65F6\uFF0C\u82E5\u5BF9\u6548\u679C\u8981\u6C42\u4E0D\u82DB\u523B\uFF0C\u9002\u5408\u7528\u9876\u70B9\u7740\u8272\u3002\u56E0\u4E3A\u5176\u5177\u6709\u5E73\u6ED1\u7684\u6548\u679C\u548C\u9AD8\u5149\uFF0C\u6E32\u67D3\u901F\u5EA6\u4E5F\u9002\u4E2D\u3002</li><li>\u5F53\u9876\u70B9\u8FBE\u5230\u4E00\u5B9A\u7684\u6570\u91CF\uFF0C\u4E09\u79CD\u7740\u8272\u9891\u7387\u7684\u7740\u8272\u6548\u679C\u90FD\u662F\u4E00\u6837\u7684\uFF0C\u4E14\u9010\u7247\u5143\u7740\u8272\u9891\u7387\u7684\u6E32\u67D3\u901F\u5EA6\u4E0D\u4E00\u5B9A\u4F1A\u6BD4\u5176\u4ED6\u7684\u4E24\u79CD\u7740\u8272\u9891\u7387\u6162\u3002</li></ul><p>\u63A5\u4E0B\u6765\u7528\u4EE3\u7801\u5199\u4E00\u4E0B\u4E0A\u9762\u7684\u7740\u8272\u9891\u7387\u3002<br> \u4E3A\u4E86\u5BF9\u7740\u8272\u9891\u7387\u6709\u4E00\u4E2A\u6DF1\u523B\u7684\u8BA4\u77E5\uFF0C\u5148\u81EA\u5DF1\u5199\u4E2A\u7403\u4F53\u3002</p><h3 id="_3-\u7403\u4F53" tabindex="-1"><a class="header-anchor" href="#_3-\u7403\u4F53" aria-hidden="true">#</a> 3.\u7403\u4F53</h3><p>\u5BF9\u4E8E\u7403\u4F53\u7684\u7ED8\u5236\u539F\u7406\uFF0C\u5C06\u5176\u5C55\u5F00\u5C31\u5F88\u597D\u7406\u89E3\u4E86\u3002<br><img src="'+ua+`" alt=""></p><p>\u4E0A\u56FE\u662F\u4E00\u4E2A4\u884C6\u5217\u7684\u7403\u4F53\u3002</p><p>\u5728\u7ED8\u5236\u7684\u65F6\u5019\uFF0C\u53EA\u8981\u5C06\u5176\u5206\u6210\u4E24\u90E8\u5206\u8003\u8651\u5C31\u53EF\u4EE5\u4E86\uFF1A</p><ul><li>\u4E0A\u4E0B\u4E24\u884C\u4E09\u89D2\u5F62</li><li>\u4E2D\u95F4\u7684\u77E9\u9635</li></ul><p>\u63A5\u4E0B\u6765\u5EFA\u7ACB\u4E00\u4E2ASphere\u5BF9\u8C61\u3002</p><ul><li>\u5C5E\u6027\uFF1A <ul><li>r\uFF1A\u534A\u5F84</li><li>widthSegments\uFF1A\u6A2A\u5411\u6BB5\u6570\uFF0C\u6700\u5C0F3\u6BB5</li><li>heightSegments\uFF1A\u7EB5\u5411\u6BB5\u6570\uFF0C\u6700\u5C0F3\u6BB5</li><li>vertices\uFF1A\u9876\u70B9\u96C6\u5408</li><li>normals\uFF1A\u6CD5\u7EBF\u96C6\u5408</li><li>indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408</li><li>count\uFF1A\u9876\u70B9\u6570\u91CF</li></ul></li><li>\u65B9\u6CD5 <ul><li>init() \u57FA\u4E8E\u7403\u4F53\u7684\u534A\u5F84\u548C\u5206\u6BB5\uFF0C\u8BA1\u7B97\u5176\u7528\u4E8E\u9876\u70B9\u7D22\u5F15\u7ED8\u56FE\u7684\u6570\u636E</li><li>getTriangles() \u57FA\u4E8E\u9876\u70B9\u7D22\u5F15\u96C6\u5408\u89E3\u6790\u51FA\u76F8\u5BF9\u5E94\u7684\u9876\u70B9\u96C6\u5408\uFF0C\u53EF\u4EE5\u7528\u4E8E\u72EC\u7ACB\u4E09\u89D2\u5F62\u7684\u7ED8\u5236</li><li>getVertice(ind) \u57FA\u4E8E\u67D0\u4E2A\u9876\u70B9\u7D22\u5F15\u83B7\u53D6\u9876\u70B9</li></ul></li></ul><p>\u4EE3\u7801\u5B9E\u73B0\uFF1A</p><ol><li>\u5EFA\u7ACB Sphere \u7403\u4F53\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Vector3<span class="token punctuation">,</span>Spherical<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token comment">/*
\u5C5E\u6027\uFF1A
  r\uFF1A\u534A\u5F84
  widthSegments\uFF1A\u6A2A\u5411\u6BB5\u6570\uFF0C\u6700\u5C0F3\u7AEF
  heightSegments\uFF1A\u7EB5\u5411\u6BB5\u6570\uFF0C\u6700\u5C0F3\u7AEF
  vertices\uFF1A\u9876\u70B9\u96C6\u5408
  normals\uFF1A\u6CD5\u7EBF\u96C6\u5408
  indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408
  count\uFF1A\u9876\u70B9\u6570\u91CF
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sphere</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> widthSegments<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> heightSegments<span class="token operator">=</span><span class="token number">16</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token operator">=</span>r
    <span class="token keyword">this</span><span class="token punctuation">.</span>widthSegments<span class="token operator">=</span>widthSegments
    <span class="token keyword">this</span><span class="token punctuation">.</span>heightSegments<span class="token operator">=</span>heightSegments
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> widthSegments<span class="token punctuation">,</span> heightSegments <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">//\u9876\u70B9\u6570\u91CF</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> widthSegments <span class="token operator">*</span> <span class="token punctuation">(</span>heightSegments <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span>
    <span class="token comment">// \u7403\u5750\u6807\u7CFB</span>
    <span class="token keyword">const</span> spherical <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// theta\u548Cphi\u65B9\u5411\u7684\u65CB\u8F6C\u5F27\u5EA6</span>
    <span class="token keyword">const</span> thetaSize <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> widthSegments
    <span class="token keyword">const</span> phiSize <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> heightSegments

    <span class="token comment">// \u9876\u70B9\u96C6\u5408\uFF0C\u5148\u5185\u7F6E\u5317\u6781\u70B9</span>
    <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">// \u6CD5\u7EBF\u96C6\u5408\uFF0C\u5148\u5185\u7F6E\u5317\u6781\u6CD5\u7EBF</span>
    <span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">// \u9876\u70B9\u7D22\u5F15\u96C6\u5408</span>
    <span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u6700\u540E\u4E00\u4E2A\u9876\u70B9\u7D22\u5F15</span>
    <span class="token keyword">const</span> lastInd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment">// \u9010\u884C\u5217\u904D\u5386</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> heightSegments<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u7403\u5750\u6807\u5782\u76F4\u5206\u91CF</span>
      <span class="token keyword">const</span> phi <span class="token operator">=</span> phiSize <span class="token operator">*</span> y
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x1 <span class="token operator">&lt;</span> widthSegments<span class="token punctuation">;</span> x1<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// x1\u540E\u7684\u4E24\u5217</span>
        <span class="token keyword">const</span> x2 <span class="token operator">=</span> x1 <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">const</span> x3 <span class="token operator">=</span> x2 <span class="token operator">%</span> widthSegments <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u8BA1\u7B97\u9876\u70B9\u548C\u6CD5\u7EBF</span>
          spherical<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> phi<span class="token punctuation">,</span> thetaSize <span class="token operator">*</span> x1<span class="token punctuation">)</span>
          <span class="token keyword">const</span> vertice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFromSpherical</span><span class="token punctuation">(</span>spherical<span class="token punctuation">)</span>
          vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>vertice<span class="token punctuation">)</span>
          normals<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>vertice<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u7B2C\u4E00\u884C\u7684\u4E09\u89D2\u7F51</span>
          indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">&lt;</span> heightSegments <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u4E00\u4E2A\u77E9\u5F62\u683C\u5B50\u7684\u5DE6\u4E0Alt\u3001\u53F3\u4E0Art\u3001\u5DE6\u4E0Blb\u3001\u53F3\u4E0Brb\u70B9</span>
          <span class="token keyword">const</span> lt <span class="token operator">=</span> y <span class="token operator">*</span> widthSegments <span class="token operator">+</span> x2
          <span class="token keyword">const</span> rt <span class="token operator">=</span> y <span class="token operator">*</span> widthSegments <span class="token operator">+</span> x3
          <span class="token keyword">const</span> lb <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> widthSegments <span class="token operator">+</span> x2
          <span class="token keyword">const</span> rb <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> widthSegments <span class="token operator">+</span> x3
          <span class="token comment">// \u7B2C\u4E00\u884C\u548C\u6700\u540E\u4E00\u884C\u4E2D\u95F4\u7684\u4E09\u89D2\u7F51</span>
          indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>lb<span class="token punctuation">,</span> rb<span class="token punctuation">,</span> lt<span class="token punctuation">,</span> lt<span class="token punctuation">,</span> rb<span class="token punctuation">,</span> rt<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">===</span> heightSegments <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u6700\u540E\u4E00\u884C\u7684\u4E09\u89D2\u7F51</span>
            indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>lastInd<span class="token punctuation">,</span> rb<span class="token punctuation">,</span> lb<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u5357\u6781\u9876\u70B9</span>
    vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment">// \u5357\u6781\u6CD5\u7EBF</span>
    normals<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>indexes<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getTriangles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>indexes<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
    <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
    <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u901A\u8FC7\u9876\u70B9\u7D22\u5F15\u904D\u5386\u4E09\u89D2\u5F62</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u4E09\u89D2\u5F62\u7684\u4E09\u4E2A\u9876\u70B9</span>
      <span class="token keyword">const</span> p0 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getVertice</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getVertice</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getVertice</span><span class="token punctuation">(</span>indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>p0<span class="token punctuation">,</span> <span class="token operator">...</span>p1<span class="token punctuation">,</span> <span class="token operator">...</span>p2<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getVertice</span><span class="token punctuation">(</span><span class="token parameter">ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>vertices<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
    <span class="token keyword">const</span> i <span class="token operator">=</span> ind <span class="token operator">*</span> <span class="token number">3</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><ol start="2"><li>\u5B9E\u4F8B\u5316 Sphere \u5BF9\u8C61\uFF0C\u5C06\u4E4B\u524D three.js \u7684 SphereGeometry \u5BF9\u8C61\u66FF\u6362\u6389</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Sphere <span class="token keyword">from</span> <span class="token string">&#39;./jsm/Sphere.js&#39;</span>
<span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sphere</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span>normals <span class="token punctuation">}</span> <span class="token operator">=</span> sphere
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u5C31\u7528\u4E0D\u540C\u7684\u7740\u8272\u9891\u7387\u4E3A\u8FD9\u4E2A\u7403\u4F53\u7740\u8272\u3002</p><h3 id="_4-flat\u9010\u4E09\u89D2\u5F62\u7740\u8272" tabindex="-1"><a class="header-anchor" href="#_4-flat\u9010\u4E09\u89D2\u5F62\u7740\u8272" aria-hidden="true">#</a> 4.Flat\u9010\u4E09\u89D2\u5F62\u7740\u8272</h3><p>\u9010\u4E09\u89D2\u5F62\u7740\u8272\u7684\u6CD5\u7EBF\u662F\u6BD4\u8F83\u597D\u7B97\u7684\uFF0C\u76F4\u63A5\u901A\u8FC7\u4E09\u89D2\u5F62\u4E24\u8FB9\u7684\u53C9\u4E58\u4FBF\u53EF\u4EE5\u5F97\u5230\u3002</p><ol><li>\u5EFA\u7ACB\u4E00\u4E2A\u4E13\u95E8\u7528\u4E8E\u8BA1\u7B97\u7740\u8272\u9891\u7387\u7684\u6A21\u5757\u3002</li></ol><p>ShadingFrequency.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Vector3<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// \u9010\u4E09\u89D2\u5F62\u7740\u8272</span>
<span class="token keyword">function</span> <span class="token function">flatShading</span><span class="token punctuation">(</span><span class="token parameter">vertices<span class="token punctuation">,</span> indexes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// flat \u6CD5\u7EBF\u96C6\u5408</span>
  <span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// \u901A\u8FC7\u9876\u70B9\u7D22\u5F15\u904D\u5386\u4E09\u89D2\u5F62</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4E09\u89D2\u5F62\u7684\u4E09\u4E2A\u9876\u70B9</span>
    <span class="token keyword">const</span> p0 <span class="token operator">=</span> <span class="token function">getVertice</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token function">getVertice</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token function">getVertice</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">// \u4E09\u89D2\u9762\u7684\u6CD5\u7EBF</span>
    <span class="token keyword">const</span> n <span class="token operator">=</span> p2<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>
        p0<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    normals<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>n<span class="token punctuation">,</span> <span class="token operator">...</span>n<span class="token punctuation">,</span> <span class="token operator">...</span>n<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u83B7\u53D6\u9876\u70B9</span>
<span class="token keyword">function</span> <span class="token function">getVertice</span><span class="token punctuation">(</span><span class="token parameter">vertices<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> i <span class="token operator">=</span> ind <span class="token operator">*</span> <span class="token number">3</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span>vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vertices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  flatShading<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol start="2"><li>\u5728\u9879\u76EE\u6587\u4EF6\u4E2D\u8C03\u7528\u4E0A\u9762\u9010\u4E09\u89D2\u5F62\u7740\u8272\u7684\u65B9\u6CD5\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> flatShading <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./jsm/ShadingFrequency.js&#39;</span>

<span class="token comment">// \u7403\u4F53</span>
<span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sphere</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token comment">// \u7528\u72EC\u7ACB\u4E09\u89D2\u5F62\u7ED8\u5236\u7403\u4F53\u7684\u9876\u70B9</span>
<span class="token keyword">const</span> vertices <span class="token operator">=</span> sphere<span class="token punctuation">.</span><span class="token function">getTriangles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u9010\u4E09\u89D2\u5F62\u7740\u8272\u7684\u6CD5\u7EBF</span>
<span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token function">flatShading</span><span class="token punctuation">(</span>sphere<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>indexes<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u56E0\u4E3A\u5728\u9010\u4E09\u89D2\u5F62\u7740\u8272\u7684\u6A21\u578B\u4E2D\uFF0C\u6BCF\u4E2A\u9876\u70B9\u90FD\u6709\u4E0D\u540C\u7684\u6CD5\u7EBF\uFF0C\u6240\u4EE5\u4E0D\u9700\u8981\u518D\u4F7F\u7528\u9876\u70B9\u7D22\u5F15\u7ED8\u56FE\u4E86\uFF0C\u76F4\u63A5\u7528\u72EC\u7ACB\u4E09\u89D2\u5F62gl.TRIANGLES \u7ED8\u56FE\u5373\u53EF\u3002</p><ol start="3"><li>\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// \u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Kd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_LightDir&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;u_Ks&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Ka&#39;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_LightDir</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>LightDir<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_Kd</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> u_Kd<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_Ks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> u_Ks<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_Ka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> u_Ka<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_Eye</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> normals<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> matN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;LINES&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> <span class="token function">getNormalHelper</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> normals<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> objN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoN<span class="token punctuation">,</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matN <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objN<span class="token punctuation">)</span>

scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br></div></div><p>\u6700\u7EC8\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+ra+`" alt=""></p><p>\u63A5\u4E0B\u6765\uFF0C\u518D\u8003\u8651\u4E00\u4E0B\u9010\u9876\u70B9\u7740\u8272\u7684\u6CD5\u7EBF\u3002</p><p><code>\u6CE8</code>\uFF1A</p><p>\u5728\u5BF9\u4F7F\u7528\u6A21\u578B\u77E9\u9635\u53D8\u6362\u6A21\u578B\u7684\u65F6\u5019\uFF0C\u9700\u8981\u5C06\u9876\u70B9\u7684\u548C\u6CD5\u7EBF\u7684\u63D2\u503C\u4E00\u8D77\u53D8\u6362\u3002</p><p>\u8FD9\u662F\u6211\u4EEC\u4E4B\u524D\u7684\u9876\u70B9\u7740\u8272\u5668\uFF1A</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec3 a_Normal<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    varying vec3 v_Normal<span class="token punctuation">;</span>
    varying vec3 v_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
      v_Normal<span class="token operator">=</span>a_Normal<span class="token punctuation">;</span>
      v_Position<span class="token operator">=</span><span class="token function">vec3</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u9700\u8981\u8BA9\u4E0A\u9762\u7684\u7684v_Normal\u548Cv_Position\u4E5F\u53D7\u6A21\u578B\u77E9\u9635u_ModelMatrix\u7684\u5F71\u54CD\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    \u2026\u2026
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      vec4 worldPos <span class="token operator">=</span> u_ModelMatrix <span class="token operator">*</span> a_Position<span class="token punctuation">;</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix <span class="token operator">*</span> worldPos<span class="token punctuation">;</span>
      v_Normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">mat3</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">)</span> <span class="token operator">*</span> a_Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v_Position <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>worldPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>u_ModelMatrix*a_Position \u662F\u6A21\u578B\u77E9\u9635\u5BF9\u9876\u70B9\u7684\u53D8\u6362</li><li>mat3(u_ModelMatrix) \u662F\u4E3A\u4E86\u63D0\u53D6\u6A21\u578B\u77E9\u9635\u7684\u53D8\u6362\u56E0\u5B50\uFF0C\u4E5F\u5C31\u662F\u53BB\u6389\u4F4D\u79FB\u6570\u636E</li><li>mat3(u_ModelMatrix)*a_Normal \u5C31\u662F\u5BF9\u6CD5\u7EBF\u7684\u53D8\u6362\uFF0C\u53D8\u6362\u4E4B\u540E\uFF0C\u522B\u5FD8\u4E86\u518D\u7528normalize \u65B9\u6CD5\u5C06\u5176\u5F52\u4E00\u5316</li></ul><h3 id="_5-gouraud\u9010\u9876\u70B9\u7740\u8272" tabindex="-1"><a class="header-anchor" href="#_5-gouraud\u9010\u9876\u70B9\u7740\u8272" aria-hidden="true">#</a> 5.Gouraud\u9010\u9876\u70B9\u7740\u8272</h3><h4 id="_5-1\u7B97\u6CD5\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_5-1\u7B97\u6CD5\u539F\u7406" aria-hidden="true">#</a> 5.1\u7B97\u6CD5\u539F\u7406</h4><p>three.js \u91CCSphereGeometry \u5BF9\u8C61\u7684\u6CD5\u7EBF\uFF0C\u5C31\u662F\u7528\u4E8E\u9010\u9876\u70B9\u7740\u8272\u7684\u3002<br><img src="`+ia+'" alt=""></p><p>\u7136\u800C\uFF0C\u5982\u679C\u4E00\u4E2A\u6A21\u578B\u4E0D\u662F\u7403\u4F53\uFF0C\u5E94\u8BE5\u5982\u4F55\u8BA1\u7B97\u5176\u9010\u9876\u70B9\u7740\u8272\u7684\u6CD5\u7EBF\u5462\uFF1F<br> \u6211\u4EEC\u53EF\u4EE5\u8FD9\u4E48\u7B97\uFF1A\u6C42\u9876\u70B9\u76F8\u90BB\u4E09\u89D2\u5F62\u6CD5\u7EBF\u7684\u5747\u503C\u3002 <img src="'+ka+'" alt=""></p><p>\u4EE5\u4E0A\u56FE\u4E2D\u7684\u9876\u70B9\u6CD5\u7EBFNv \u4E3A\u4F8B\uFF0C\u5176\u8BA1\u7B97\u516C\u5F0F\u5982\u4E0B<br><img src="'+ba+`" alt=""></p><p>\u7136\u800C\uFF0C\u4E3A\u4E86\u8FFD\u6C42\u66F4\u597D\u7684\u6548\u679C\uFF0C\u6211\u4EEC\u8FD8\u53EF\u4EE5\u5728\u6C42\u5747\u503C\u7684\u65F6\u5019\uFF0C\u57FA\u4E8E\u4E09\u89D2\u5F62\u7684\u9762\u79EF\u505A\u4E00\u4E0B\u52A0\u6743\u5904\u7406\u3002</p><h4 id="_5-2\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_5-2\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 5.2\u4EE3\u7801\u5B9E\u73B0</h4><ol><li>\u5728\u4E4B\u524D\u7684ShadingFrequency.js \u6587\u4EF6\u91CC\u6DFB\u52A0\u4E00\u4E2AgouraudShading() \u65B9\u6CD5\uFF0C\u7528\u4E8E\u83B7\u53D6\u9010\u9876\u70B9\u7740\u8272\u7684\u6CD5\u7EBF\u3002</li></ol><p>gouraudShading(vertices, indexes,type=1)</p><ul><li>vertices \u9876\u70B9\u96C6\u5408</li><li>indexes \u9876\u70B9\u7D22\u5F15\u96C6\u5408</li><li>type \u8BA1\u7B97\u6CD5\u7EBF\u7684\u65B9\u5F0F <ul><li>0\uFF0C\u76F8\u90BB\u4E09\u89D2\u5F62\u7684\u6CD5\u7EBF\u7684\u5E73\u5747\u503C</li><li>1\uFF0C\u76F8\u90BB\u7684\u4E09\u89D2\u5F62\u6CD5\u7EBF\u57FA\u4E8E\u9762\u79EF\u7684\u52A0\u6743\u5E73\u5747\u503C\uFF0C\u9ED8\u8BA4</li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">gouraudShading</span><span class="token punctuation">(</span><span class="token parameter">vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vertices<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    normals<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token function">getGouraudNormal</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>vertices<span class="token punctuation">,</span>indexes<span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//\u57FA\u4E8E\u9876\u70B9\u7D22\u5F15\u83B7\u53D6\u9876\u70B9\u7684\u6CD5\u7EBF</span>
<span class="token keyword">function</span> <span class="token function">getGouraudNormal</span><span class="token punctuation">(</span><span class="token parameter">ind<span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u6CD5\u7EBF</span>
  <span class="token keyword">const</span> normal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4E0E\u9876\u70B9\u76F8\u90BB\u4E09\u89D2\u5F62\u7684\u6570\u636E\u96C6\u5408</span>
    <span class="token keyword">const</span> triangles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u4E0E\u9876\u70B9\u76F8\u90BB\u4E09\u89D2\u5F62\u7684\u9762\u79EF\u7684\u603B\u548C</span>
    <span class="token keyword">let</span> sumArea <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// \u5BFB\u627E\u76F8\u90BB\u4E09\u89D2\u5F62</span>
    <span class="token function">findTriangles</span><span class="token punctuation">(</span>ind<span class="token punctuation">,</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> area <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      sumArea <span class="token operator">+=</span> area
      triangles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>n<span class="token punctuation">,</span>area<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// \u52A0\u6743\u5E73\u5747\u503C</span>
    triangles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> n<span class="token punctuation">,</span> area <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      normal<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        n<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>area <span class="token operator">/</span> sumArea<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4E0E\u9876\u70B9\u76F8\u90BB\u4E09\u89D2\u5F62\u7684\u6CD5\u7EBF\u7684\u603B\u548C</span>
    <span class="token function">findTriangles</span><span class="token punctuation">(</span>ind<span class="token punctuation">,</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> <span class="token parameter">n</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      normal<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// \u6CD5\u7EBF\u4E4B\u548C\u5F52\u4E00\u5316</span>
    normal<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> normal
<span class="token punctuation">}</span>

<span class="token comment">// \u5BFB\u627E\u4E0E\u9876\u70B9\u76F8\u90BB\u7684\u6240\u6709\u4E09\u89D2\u5F62</span>
<span class="token keyword">function</span> <span class="token function">findTriangles</span><span class="token punctuation">(</span><span class="token parameter">ind<span class="token punctuation">,</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span>fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indexes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5BFB\u627E\u5171\u70B9\u4E09\u89D2\u5F62</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>indexes<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>ind<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u4E09\u89D2\u5F62\u7684\u4E09\u4E2A\u9876\u70B9</span>
      <span class="token keyword">const</span> p0 <span class="token operator">=</span> <span class="token function">getVertice</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token function">getVertice</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token function">getVertice</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// \u4E09\u89D2\u9762\u7684\u6CD5\u7EBF</span>
      <span class="token keyword">const</span> n <span class="token operator">=</span> p2<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">cross</span><span class="token punctuation">(</span>
          p0<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token function">fn</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><ol start="2"><li>\u4F7F\u7528\u4E4B\u524D\u7684\u7403\u4F53\u6D4B\u8BD5\u4E00\u4E0B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> gouraudShading <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./jsm/ShadingFrequency.js&#39;</span>

<span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sphere</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> indexes <span class="token punctuation">}</span> <span class="token operator">=</span> sphere
<span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token function">gouraudShading</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+ma+'" alt=""></p><p>\u7531\u4E0A\u56FE\u53EF\u89C1\uFF0C\u9AD8\u5149\u6CA1\u4E86\u3002<br> \u8FD9\u5C31\u662F\u9010\u9876\u70B9\u7740\u8272\u7684\u5F0A\u7AEF\uFF0C\u53EA\u8981\u9762\u6570\u4E0D\u591F\uFF0C\u9AD8\u5149\u5C31\u6CA1\u4E86\u3002<br> \u82E5\u662F\u7528\u9010\u7247\u5143\u7740\u8272\u6765\u7ED8\u56FE\uFF0C\u8FD9\u4E2A\u95EE\u9898\u5C31\u4E0D\u4F1A\u51FA\u73B0\u3002</p><h3 id="_6-phong-\u9010\u7247\u5143\u7740\u8272" tabindex="-1"><a class="header-anchor" href="#_6-phong-\u9010\u7247\u5143\u7740\u8272" aria-hidden="true">#</a> 6.Phong-\u9010\u7247\u5143\u7740\u8272</h3><p>\u4E4B\u524D\u9010\u9876\u70B9\u7740\u8272\u65F6\uFF0C\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u8BA1\u7B97\u7684\u6CD5\u7EBF\u63D2\u503C\u5DF2\u7ECF\u4E0D\u4E00\u5B9A\u662F\u5355\u4F4D\u5411\u91CF\uFF0C\u800C\u662F\u957F\u5EA6\u5C0F\u4E8E\u7B49\u4E8E1\u7684\u5411\u91CF\u3002 \u6BD4\u5982\u4E0B\u56FE\u4E2D\u6A59\u8272\u6CD5\u7EBF\u4E4B\u95F4\u7684\u9ED1\u8272\u5411\u91CF\uFF0C\u5176\u957F\u5EA6\u5DF2\u7ECF\u5C0F\u4E8E\u4E861\uFF0C\u8FD9\u5C31\u662F\u9010\u9876\u70B9\u7740\u8272\u4E2D\u9AD8\u5149\u6D88\u5931\u7684\u539F\u56E0\u3002<br><img src="'+da+`" alt=""></p><p>\u82E5\u60F3\u8BA9\u9AD8\u5149\u51FA\u73B0\uFF0C\u5C06\u9ED1\u8272\u5411\u91CF\u5355\u4F4D\u5316\u5373\u53EF\uFF0C\u4E5F\u5C31\u662F\u8BA9\u5176\u957F\u5EA6\u518D\u52A0\u4E0A\u84DD\u8272\u7684\u90A3\u4E00\u6BB5\uFF0C\u5982\u6B64\u7740\u8272\u7684\u65B9\u6CD5\u5C31\u53EB\u9010\u7247\u5143\u7740\u8272\u3002<br> \u63A5\u4E0B\u91CC\uFF0C\u6211\u4EEC\u53EF\u4EE5\u76F4\u63A5\u57FA\u4E8E\u9010\u9876\u70B9\u7740\u8272\u7684\u65B9\u6CD5\u6539\u4E00\u4E0B\u7247\u5143\u7740\u8272\u5668\u5373\u53EF\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">&quot;fs&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;x-shader/x-fragment&quot;</span><span class="token operator">&gt;</span>
    precision mediump float<span class="token punctuation">;</span>
    uniform vec3 u_Kd<span class="token punctuation">;</span>
    uniform vec3 u_Ks<span class="token punctuation">;</span>
    uniform vec3 u_Ka<span class="token punctuation">;</span>
    uniform vec3 u_LightDir<span class="token punctuation">;</span>
    uniform vec3 u_Eye<span class="token punctuation">;</span>
    varying vec3 v_Normal<span class="token punctuation">;</span>
    varying vec3 v_Position<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u6CD5\u7EBF\u63D2\u503C\u5F52\u4E00\u5316</span>
      vec3 normal<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u773C\u775B\u770B\u5411\u5F53\u524D\u7740\u8272\u70B9\u7684\u89C6\u7EBF</span>
      vec3 eyeDir<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>u_Eye<span class="token operator">-</span>v_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u89C6\u7EBF\u4E0E\u5149\u7EBF\u4E4B\u548C</span>
      vec3 el<span class="token operator">=</span>eyeDir<span class="token operator">+</span>u_LightDir<span class="token punctuation">;</span>
      <span class="token comment">//\u89C6\u7EBF\u4E0E\u5149\u7EBF\u7684\u89D2\u5E73\u5206\u7EBF</span>
      vec3 h<span class="token operator">=</span>el<span class="token operator">/</span><span class="token function">length</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u6F2B\u53CD\u5C04</span>
      vec3 diffuse<span class="token operator">=</span>u_Kd<span class="token operator">*</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span>u_LightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u53CD\u5C04</span>
      vec3 specular<span class="token operator">=</span>u_Ks<span class="token operator">*</span><span class="token function">pow</span><span class="token punctuation">(</span>
        <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">64.0</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//Blinn-Phong\u53CD\u5C04</span>
      vec3 l<span class="token operator">=</span>diffuse<span class="token operator">+</span>specular<span class="token operator">+</span>u_Ka<span class="token punctuation">;</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+ga+'" alt=""></p><p>\u4E0A\u9762\u7403\u4F53\u7684\u5BBD\u3001\u9AD8\u6BB5\u6570\u662F6\u548C4\uFF0C\u9762\u6570\u5F88\u4F4E\uFF0C\u4F46\u5176\u8868\u9762\u6548\u679C\u4F9D\u65E7\u5F88\u7EC6\u817B\uFF0C\u8FD9\u5C31\u662F\u9010\u7247\u5143\u7740\u8272\u7684\u4F18\u52BF\u3002</p><h2 id="\u4E8C\u5341\u4E09\u3001\u5149\u6E90\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u4E09\u3001\u5149\u6E90\u7C7B\u578B" aria-hidden="true">#</a> \u4E8C\u5341\u4E09\u3001\u5149\u6E90\u7C7B\u578B</h2><p>\u4E4B\u524D\u7528\u5E73\u884C\u5149\u8BF4\u4E86\u7740\u8272\u9891\u7387\u7684\u6982\u5FF5\u3002<br> \u5149\u6E90\u9664\u4E86\u5E73\u884C\u5149\uFF0C\u8FD8\u6709\u70B9\u5149\u6E90\uFF0C\u82E5\u5BF9\u5E73\u884C\u5149\u548C\u70B9\u5149\u6E90\u7684\u7167\u5C04\u8303\u56F4\u548C\u8870\u51CF\u505A\u9650\u5236\uFF0C\u8FD8\u4F1A\u884D\u751F\u51FA\u7B52\u706F\u3001\u805A\u5149\u706F\u7B49\u7C7B\u578B\u7684\u706F\u5149\u3002</p><h3 id="_1-\u7B52\u706F" tabindex="-1"><a class="header-anchor" href="#_1-\u7B52\u706F" aria-hidden="true">#</a> 1.\u7B52\u706F</h3><h4 id="_1-1\u7B52\u706F\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-1\u7B52\u706F\u6982\u5FF5" aria-hidden="true">#</a> 1.1\u7B52\u706F\u6982\u5FF5</h4><p>\u5BF9\u5E73\u884C\u5149\u7684\u7167\u5C04\u8303\u56F4\u505A\u9650\u5236\u540E\uFF0C\u5176\u706F\u5149\u6253\u51FA\u7684\u6548\u679C\u4FBF\u53EF\u4EE5\u5982\u4E0B\u56FE\u4E00\u6837\uFF1A<br><img src="'+va+'" alt=""></p><p>\u7B52\u706F\u7684\u7167\u5C04\u65B9\u5F0F\u5982\u4E0B\uFF1A<br><img src="'+ya+'" alt=""></p><p>\u901A\u8FC7\u4E0A\u9762\u7684\u4E24\u4E2A\u56FE\uFF0C\u53EF\u4EE5\u77E5\u9053\uFF0C\u8981\u628A\u5E73\u884C\u5149\u9650\u5236\u6210\u7B52\u706F\uFF0C\u9700\u8981\u4EE5\u4E0B\u5DF2\u77E5\u6761\u4EF6\uFF1A</p><ul><li>\u7B52\u706F\u4F4D\u7F6E u_LightPos</li><li>\u7B52\u706F\u76EE\u6807\u70B9 u_LightTarget</li><li>\u5149\u7167\u5F3A\u5EA6 u_Intensity</li><li>\u8870\u51CF\u8DDD\u79BB <ul><li>\u8870\u51CF\u8D77\u59CB\u8DDD\u79BB u_Dist1</li><li>\u8870\u51CF\u7ED3\u675F\u8DDD\u79BB u_Dist2</li><li>\u53CD\u5411\u8870\u51CF\u8DDD\u79BB u_Dist3</li></ul></li><li>\u8870\u51CF\u8303\u56F4 <ul><li>\u8870\u51CF\u8D77\u59CB\u8303\u56F4 u_R1</li><li>\u8870\u51CF\u7ED3\u675F\u8303\u56F4 u_R2</li></ul></li></ul><h4 id="_1-2\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_1-2\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 1.2\u4EE3\u7801\u5B9E\u73B0</h4><p>\u4E0B\u56FE\u662F\u5C06\u8981\u5B9E\u73B0\u7684\u7B52\u706F\u6548\u679C\u3002<br><img src="'+fa+`" alt=""></p><p>\u4E3A\u4E86\u66F4\u597D\u7684\u89C2\u5BDF\u706F\u5149\uFF0C\u9700\u8981\u5148\u5EFA\u7ACB\u4E00\u5757\u5E55\u5E03\u3002</p><ol><li>\u5E55\u5E03 Backdrop.js</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/*
\u5C5E\u6027\uFF1A
  w\uFF1A\u5BBD
  h\uFF1A\u9AD8
  d\uFF1A\u6DF1
  vertices\uFF1A\u9876\u70B9\u96C6\u5408
  normals\uFF1A\u6CD5\u7EBF\u96C6\u5408
  indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408
  count\uFF1A\u9876\u70B9\u6570\u91CF
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Backdrop</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">w<span class="token punctuation">,</span>h<span class="token punctuation">,</span>d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>w<span class="token operator">=</span>w
    <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token operator">=</span>h
    <span class="token keyword">this</span><span class="token punctuation">.</span>d<span class="token operator">=</span>d
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">12</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>d<span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">,</span>
      x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> z<span class="token punctuation">,</span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><ol start="2"><li>\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec3 a_Normal<span class="token punctuation">;</span>
    uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
    uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
    varying vec3 v_Normal<span class="token punctuation">;</span>
    varying vec3 v_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      vec4 worldPos<span class="token operator">=</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
      gl_Position <span class="token operator">=</span> u_PvMatrix<span class="token operator">*</span>worldPos<span class="token punctuation">;</span>
      v_Normal<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">mat3</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">)</span><span class="token operator">*</span>a_Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v_Position<span class="token operator">=</span><span class="token function">vec3</span><span class="token punctuation">(</span>worldPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    <span class="token comment">//\u6F2B\u53CD\u5C04\u7CFB\u6570</span>
    uniform vec3 u_Kd<span class="token punctuation">;</span>
    <span class="token comment">//\u955C\u9762\u53CD\u5C04\u7CFB\u6570</span>
    uniform vec3 u_Ks<span class="token punctuation">;</span>
    <span class="token comment">//\u73AF\u5883\u5149\u53CD\u5C04\u7CFB\u6570</span>
    uniform vec3 u_Ka<span class="token punctuation">;</span>

    <span class="token comment">//\u89C6\u70B9</span>
    uniform vec3 u_Eye<span class="token punctuation">;</span>
    <span class="token comment">// \u7B52\u706F\u4F4D\u7F6E</span>
    uniform vec3 u_LightPos<span class="token punctuation">;</span>
    <span class="token comment">// \u7B52\u706F\u76EE\u6807\u70B9 </span>
    uniform vec3 u_LightTarget<span class="token punctuation">;</span>
    <span class="token comment">//\u706F\u5149\u5F3A\u5EA6</span>
    uniform float u_Intensity<span class="token punctuation">;</span>
    
    <span class="token comment">//\u8870\u51CF\u8D77\u59CB\u8DDD\u79BB</span>
    uniform float u_Dist1<span class="token punctuation">;</span>
    <span class="token comment">//\u8870\u51CF\u7ED3\u675F\u8DDD\u79BB</span>
    uniform float u_Dist2<span class="token punctuation">;</span>
    <span class="token comment">//\u53CD\u5411\u8870\u51CF\u8DDD\u79BB</span>
    uniform float u_Dist3<span class="token punctuation">;</span>
    
    <span class="token comment">//\u8870\u51CF\u8D77\u59CB\u8303\u56F4</span>
    uniform float u_R1<span class="token punctuation">;</span>
    <span class="token comment">//\u8870\u51CF\u7ED3\u675F\u8303\u56F4</span>
    uniform float u_R2<span class="token punctuation">;</span>
    
    <span class="token comment">//\u6CD5\u7EBF\u63D2\u503C</span>
    varying vec3 v_Normal<span class="token punctuation">;</span>
    <span class="token comment">//\u70B9\u4F4D\u63D2\u503C</span>
    varying vec3 v_Position<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u5149\u7EBF\u65B9\u5411</span>
      vec3 lightDir<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>u_LightPos<span class="token operator">-</span>u_LightTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u6CD5\u7EBF\u63D2\u503C\u5F52\u4E00\u5316</span>
      vec3 normal<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>v_Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u773C\u775B\u770B\u5411\u5F53\u524D\u7740\u8272\u70B9\u7684\u89C6\u7EBF</span>
      vec3 eyeDir<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>u_Eye<span class="token operator">-</span>v_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u89C6\u7EBF\u4E0E\u5149\u7EBF\u7684\u89D2\u5E73\u5206\u7EBF</span>
      vec3 h<span class="token operator">=</span><span class="token function">normalize</span><span class="token punctuation">(</span>eyeDir<span class="token operator">+</span>lightDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u6F2B\u53CD\u5C04</span>
      vec3 diffuse<span class="token operator">=</span>u_Kd<span class="token operator">*</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span>lightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u955C\u9762\u53CD\u5C04</span>
      vec3 specular<span class="token operator">=</span>u_Ks<span class="token operator">*</span><span class="token function">pow</span><span class="token punctuation">(</span>
        <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token function">dot</span><span class="token punctuation">(</span>normal<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">64.0</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//\u7740\u8272\u70B9\u5230\u5149\u6E90\u7684\u5411\u91CF</span>
      vec3 pl<span class="token operator">=</span>u_LightPos<span class="token operator">-</span>v_Position<span class="token punctuation">;</span>
      <span class="token comment">//\u7740\u8272\u70B9\u5230\u5149\u7EBF\u7684\u8DDD\u79BB</span>
      float r<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>pl<span class="token punctuation">,</span>lightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u5149\u7EBF\u5782\u76F4\u65B9\u5411\u7684\u8870\u51CF</span>
      float fallY<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">-</span><span class="token function">smoothstep</span><span class="token punctuation">(</span>u_R1<span class="token punctuation">,</span>u_R2<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u5F53\u524D\u7740\u8272\u70B9\u5230\u7B52\u706F\u5149\u6E90\u5E73\u9762\u7684\u8DDD\u79BB</span>
      float dist<span class="token operator">=</span><span class="token function">dot</span><span class="token punctuation">(</span>pl<span class="token punctuation">,</span>lightDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u5149\u7EBF\u65B9\u5411\u7684\u8870\u51CF</span>
      float fallX<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">-</span><span class="token function">smoothstep</span><span class="token punctuation">(</span>u_Dist1<span class="token punctuation">,</span>u_Dist2<span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u53CD\u5411\u8870\u51CF</span>
      float fallB<span class="token operator">=</span><span class="token function">smoothstep</span><span class="token punctuation">(</span>u_Dist3<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//\u7B52\u706F\u4F5C\u7528\u4E8E\u5F53\u524D\u7740\u8272\u70B9\u7684\u4EAE\u5EA6</span>
      float intensity<span class="token operator">=</span>u_Intensity<span class="token operator">*</span>fallY<span class="token operator">*</span>fallX<span class="token operator">*</span>fallB<span class="token punctuation">;</span>
      <span class="token comment">//\u7740\u8272\u70B9\u989C\u8272</span>
      vec3 color<span class="token operator">=</span>intensity<span class="token operator">*</span><span class="token punctuation">(</span>diffuse<span class="token operator">+</span>specular<span class="token punctuation">)</span><span class="token operator">+</span>u_Ka<span class="token punctuation">;</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><ol start="2"><li>\u5BFC\u5165\u76F8\u5173\u7EC4\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span> PerspectiveCamera<span class="token punctuation">,</span> Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span>
<span class="token keyword">import</span> Sphere <span class="token keyword">from</span> <span class="token string">&#39;./lv/Sphere.js&#39;</span>
<span class="token keyword">import</span> Backdrop <span class="token keyword">from</span> <span class="token string">&#39;./lv/Backdrop.js&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> gouraudShading <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./lv/ShadingFrequency.js&#39;</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="3"><li>\u5EFA\u7ACBwebgl\u4E0A\u4E0B\u6587\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>\u5EFA\u7ACB\u76F8\u673A\u8F68\u9053</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u89C6\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span>
<span class="token punctuation">]</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
<span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="5"><li>\u5B9E\u4F8B\u5316\u7403\u4F53\u548C\u5E55\u5E03</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u7403\u4F53 */</span>
<span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sphere</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> indexes <span class="token punctuation">}</span> <span class="token operator">=</span> sphere
<span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token function">gouraudShading</span><span class="token punctuation">(</span>vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">)</span>
<span class="token comment">//\u7403\u4F53\u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">const</span> sphereMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">/* \u5E55\u5E03 */</span>
<span class="token keyword">const</span> backdrop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Backdrop</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">// \u5E55\u5E03\u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">const</span> backMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="6"><li>\u58F0\u660E\u6A21\u578B\u7684\u989C\u8272\u7CFB\u6570\u548C\u706F\u5149\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6F2B\u53CD\u5C04\u7CFB\u6570-\u989C\u8272</span>
<span class="token keyword">const</span> u_Kd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>
<span class="token comment">// \u955C\u9762\u53CD\u5C04\u7CFB\u6570-\u989C\u8272</span>
<span class="token keyword">const</span> u_Ks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span>
<span class="token comment">// \u73AF\u5883\u5149\u7CFB\u6570-\u989C\u8272</span>
<span class="token keyword">const</span> u_Ka <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span>

<span class="token comment">// \u7B52\u706F\u4F4D\u7F6E</span>
<span class="token keyword">const</span> u_LightPos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// \u7B52\u706F\u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> u_LightTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u5149\u7167\u5F3A\u5EA6</span>
<span class="token keyword">const</span> u_Intensity <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment">// \u8870\u51CF\u8D77\u59CB\u8DDD\u79BB</span>
<span class="token keyword">const</span> u_Dist1 <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// \u8870\u51CF\u7ED3\u675F\u8DDD\u79BB</span>
<span class="token keyword">const</span> u_Dist2 <span class="token operator">=</span> <span class="token number">10</span>
<span class="token comment">// \u53CD\u5411\u8870\u51CF\u8DDD\u79BB</span>
<span class="token keyword">const</span> u_Dist3 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token comment">// \u8870\u51CF\u8D77\u59CB\u8303\u56F4</span>
<span class="token keyword">const</span> u_R1 <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">// \u8870\u51CF\u7ED3\u675F\u8303\u56F4</span>
<span class="token keyword">const</span> u_R2 <span class="token operator">=</span> <span class="token number">2.5</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ol start="7"><li>\u57FA\u4E8E\u4E0A\u9762\u7684\u5DF2\u77E5\u6761\u4EF6\uFF0C\u5EFA\u7ACB\u4E09\u7C7Buniform\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u706F\u5149\u6570\u636E</span>
<span class="token keyword">const</span> lightData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">u_LightPos</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>u_LightPos<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_LightTarget</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>u_LightTarget<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Intensity</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_R1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_R1<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_R2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_R2<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Dist1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Dist1<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Dist2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Dist2<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Dist3</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Dist3<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u6750\u8D28\u6570\u636E</span>
<span class="token keyword">const</span> matData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">u_Kd</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Kd<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Ks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Ks<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Ka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Ka<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u76F8\u673A\u6570\u636E</span>
<span class="token keyword">const</span> cameraData <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Eye</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform3fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><ol start="8"><li>\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// \u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Normal&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;u_Kd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Ks&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Ka&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;u_LightPos&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_LightTarget&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Intensity&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;u_Dist1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Dist2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Dist3&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;u_R1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_R2&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// \u7403\u4F53</span>
<span class="token keyword">const</span> matSphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> sphereMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>cameraData<span class="token punctuation">,</span>
    <span class="token operator">...</span>lightData<span class="token punctuation">,</span>
    <span class="token operator">...</span>matData
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoSphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> normals<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> objSphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoSphere<span class="token punctuation">,</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matSphere <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objSphere<span class="token punctuation">)</span>

<span class="token comment">// \u5E55\u5E03</span>
<span class="token keyword">const</span> matBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> backMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>cameraData<span class="token punctuation">,</span>
    <span class="token operator">...</span>lightData<span class="token punctuation">,</span>
    <span class="token operator">...</span>matData
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> backdrop<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> backdrop<span class="token punctuation">.</span>normals<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> backdrop<span class="token punctuation">.</span>indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> objBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matBack<span class="token punctuation">,</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoBack <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objBack<span class="token punctuation">)</span>

<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><ol start="9"><li>\u76F8\u673A\u8F68\u9053\u4EA4\u4E92\u4E8B\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_2-\u9525\u5F62\u706F" tabindex="-1"><a class="header-anchor" href="#_2-\u9525\u5F62\u706F" aria-hidden="true">#</a> 2.\u9525\u5F62\u706F</h3><h4 id="_1-1\u9525\u5F62\u706F\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-1\u9525\u5F62\u706F\u6982\u5FF5" aria-hidden="true">#</a> 1.1\u9525\u5F62\u706F\u6982\u5FF5</h4><p>\u9525\u5F62\u706F\u53EF\u4EE5\u7406\u89E3\u4E3A\u5BF9\u70B9\u5149\u6E90\u7684\u9650\u5236\uFF0C\u4ECE\u4FA7\u9762\u770B\uFF0C\u5176\u6253\u51FA\u7684\u5149\u7EBF\u6210\u9525\u5F62\u3002<br><img src="`+ha+'" alt=""></p><p>\u9525\u5F62\u706F\u7684\u7167\u5C04\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="'+wa+`" alt=""></p><p>\u5B9A\u4E49\u9525\u5F62\u706F\u7684\u6761\u4EF6\uFF1A</p><ul><li>\u9525\u5F62\u706F\u4F4D\u7F6E u_LightPos</li><li>\u9525\u5F62\u706F\u76EE\u6807\u70B9 u_LightTarget</li><li>\u5149\u7167\u5F3A\u5EA6 u_Intensity</li><li>\u8870\u51CF\u8DDD\u79BB <ul><li>\u8870\u51CF\u8D77\u59CB\u8DDD\u79BB u_Dist1</li><li>\u8870\u51CF\u7ED3\u675F\u8DDD\u79BB u_Dist2</li></ul></li><li>\u8870\u51CF\u5939\u89D2 <ul><li>\u8870\u51CF\u8D77\u59CB\u5939\u89D2 u_Fov1</li><li>\u8870\u51CF\u7ED3\u675F\u5939\u89D2 u_Fov2</li></ul></li></ul><h4 id="_1-2\u4EE3\u7801\u5B9E\u73B0-1" tabindex="-1"><a class="header-anchor" href="#_1-2\u4EE3\u7801\u5B9E\u73B0-1" aria-hidden="true">#</a> 1.2\u4EE3\u7801\u5B9E\u73B0</h4><p>\u53EF\u4EE5\u76F4\u63A5\u5728\u4E4B\u524D\u7B52\u706F\u7684\u57FA\u7840\u4E0A\u505A\u4E00\u4E0B\u4FEE\u6539\u3002</p><ol><li>\u628A\u4E4B\u524D\u7684\u8870\u51CF\u8303\u56F4\u53D8\u6210\u8870\u51CF\u5939\u89D2</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u8870\u51CF\u8D77\u59CB\u8303\u56F4</span>
<span class="token keyword">const</span> u_Fov1 <span class="token operator">=</span> <span class="token number">20</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token comment">// \u8870\u51CF\u7ED3\u675F\u8303\u56F4</span>
<span class="token keyword">const</span> u_Fov2 <span class="token operator">=</span> u_Fov1 <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token comment">// \u706F\u5149\u6570\u636E</span>
<span class="token keyword">const</span> lightData <span class="token operator">=</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token literal-property property">u_Fov1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Fov1<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">u_Fov2</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> u_Fov2<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="2"><li>\u5728\u7247\u5143\u7740\u8272\u5668\u4E2D\uFF0C\u6839\u636E\u8870\u51CF\u5939\u89D2\u8BA1\u7B97\u706F\u5149\u5728\u5149\u7EBF\u5782\u76F4\u65B9\u5411\u7684\u8870\u51CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u8870\u51CF\u8303\u56F4</span>
float r1<span class="token operator">=</span><span class="token function">tan</span><span class="token punctuation">(</span>u_Fov1<span class="token punctuation">)</span><span class="token operator">*</span>dist<span class="token punctuation">;</span>
float r2<span class="token operator">=</span><span class="token function">tan</span><span class="token punctuation">(</span>u_Fov2<span class="token punctuation">)</span><span class="token operator">*</span>dist<span class="token punctuation">;</span>
<span class="token comment">//\u7740\u8272\u70B9\u5230\u5149\u7EBF\u7684\u8DDD\u79BB</span>
float r<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>pl<span class="token punctuation">,</span>lightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u5149\u7EBF\u5782\u76F4\u65B9\u5411\u7684\u8870\u51CF</span>
float fallY<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">-</span><span class="token function">smoothstep</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span>r2<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u53D6\u6D88\u706F\u5149\u80CC\u9762\u7684\u7167\u660E</span>
float fallB<span class="token operator">=</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u5BF9\u4E8E\u706F\u5149\u7684\u7C7B\u578B\uFF0C\u5C31\u5148\u8BF4\u8FD9\u4E24\u4E2A\u3002<br> \u5176\u5B9E\uFF0C\u706F\u5149\u4E2D\u662F\u53EF\u4EE5\u7ED8\u56FE\u7684\uFF0C\u53EA\u662F\u8FD9\u5757\u77E5\u8BC6\u6709\u70B9\u590D\u6742\uFF0C\u540E\u9762\u8BF4\u3002<br> \u8FD9\u91CC\uFF0C\u5C31\u770B\u4E2A\u5C0F\u4F8B\u5B50\u3002</p><h3 id="\u6269\u5C55-\u6CC9" tabindex="-1"><a class="header-anchor" href="#\u6269\u5C55-\u6CC9" aria-hidden="true">#</a> \u6269\u5C55-\u6CC9</h3><p>\u53EF\u4EE5\u57FA\u4E8E\u7740\u8272\u70B9\u5230\u5149\u7EBF\u7684\u8DDD\u79BB\u505A\u4E00\u4E2A\u6B63\u5F26\u6CE2\u8870\u51CF\u3002<br><img src="`+xa+`" alt=""></p><ol><li>\u7247\u5143\u7740\u8272\u5668\u4E2D\u7684\u7B97\u6CD5\u5982\u4E0B\uFF1A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u8870\u51CF\u8303\u56F4</span>
float r1<span class="token operator">=</span><span class="token function">tan</span><span class="token punctuation">(</span>u_Fov1<span class="token punctuation">)</span><span class="token operator">*</span>dist<span class="token punctuation">;</span>
float r2<span class="token operator">=</span><span class="token function">tan</span><span class="token punctuation">(</span>u_Fov2<span class="token punctuation">)</span><span class="token operator">*</span>dist<span class="token punctuation">;</span>
<span class="token comment">//\u7740\u8272\u70B9\u5230\u5149\u7EBF\u7684\u8DDD\u79BB</span>
float r<span class="token operator">=</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>pl<span class="token punctuation">,</span>lightDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u5149\u7EBF\u5782\u76F4\u65B9\u5411\u7684\u8870\u51CF</span>
float fallY<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">-</span><span class="token function">smoothstep</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span>r2<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6B63\u5F26\u6CE2\u8870\u51CF\u5F27\u5EA6</span>
float fallAng<span class="token operator">=</span><span class="token function">smoothstep</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span>r2<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">40.0</span><span class="token operator">-</span>u_Time<span class="token operator">/</span><span class="token number">60.0</span><span class="token punctuation">;</span>
<span class="token comment">//\u6B63\u5F26\u6CE2\u8870\u51CF</span>
float fallSin<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">-</span><span class="token function">smoothstep</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token function">sin</span><span class="token punctuation">(</span>fallAng<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u53D6\u6D88\u706F\u5149\u80CC\u9762\u7684\u7167\u660E</span>
float fallB<span class="token operator">=</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5149\u6E90\u4F5C\u7528\u4E8E\u5F53\u524D\u7740\u8272\u70B9\u7684\u4EAE\u5EA6</span>
float intensity<span class="token operator">=</span>u_Intensity<span class="token operator">*</span>fallX<span class="token operator">*</span>fallY<span class="token operator">*</span>fallSin<span class="token operator">*</span>fallB<span class="token punctuation">;</span>
<span class="token comment">//\u7740\u8272\u70B9\u989C\u8272</span>
vec3 color<span class="token operator">=</span>intensity<span class="token operator">*</span><span class="token punctuation">(</span>diffuse<span class="token operator">+</span>specular<span class="token punctuation">)</span><span class="token operator">+</span>u_Ka<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="2"><li>\u8C03\u6574\u4E00\u4E0B\u76F8\u673A\u548C\u706F\u5149</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u76F8\u673A\u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">//\u76F8\u673A\u89C6\u70B9</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
\u2026\u2026

<span class="token comment">// \u9525\u5F62\u706F\u4F4D\u7F6E</span>
<span class="token keyword">const</span> u_LightPos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">// \u9525\u5F62\u706F\u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> u_LightTarget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// \u5149\u7167\u5F3A\u5EA6</span>
<span class="token keyword">const</span> u_Intensity <span class="token operator">=</span> <span class="token number">15</span>
<span class="token comment">// \u8870\u51CF\u8D77\u59CB\u8DDD\u79BB</span>
<span class="token keyword">const</span> u_Dist1 <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// \u8870\u51CF\u7ED3\u675F\u8DDD\u79BB</span>
<span class="token keyword">const</span> u_Dist2 <span class="token operator">=</span> <span class="token number">8.5</span>
<span class="token comment">// \u8870\u51CF\u8D77\u59CB\u8303\u56F4</span>
<span class="token keyword">const</span> u_Fov1 <span class="token operator">=</span> <span class="token number">25</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token comment">// \u8870\u51CF\u7ED3\u675F\u8303\u56F4</span>
<span class="token keyword">const</span> u_Fov2 <span class="token operator">=</span> u_Fov1 <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
\u2026\u2026
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="\u4E8C\u5341\u56DB\u3001\u5E27\u7F13\u51B2\u533A" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u56DB\u3001\u5E27\u7F13\u51B2\u533A" aria-hidden="true">#</a> \u4E8C\u5341\u56DB\u3001\u5E27\u7F13\u51B2\u533A</h2><p>\u5176\u5B9E\uFF0C\u63A5\u4E0B\u6765\u60F3\u8BF4\u6295\u5F71\u7684\uFF0C\u7136\u800C\u6295\u5F71\u7684\u8BA1\u7B97\u8FD8\u9700\u8981\u5E27\u7F13\u51B2\u533A\uFF0C\u6240\u4EE5\u5F97\u5148\u89E3\u91CA\u4E00\u4E0B\u5E27\u7F13\u51B2\u533A\u7684\u6982\u5FF5\u3002</p><h3 id="_1-\u5E27\u7F13\u51B2\u533A\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u5E27\u7F13\u51B2\u533A\u7684\u6982\u5FF5" aria-hidden="true">#</a> 1.\u5E27\u7F13\u51B2\u533A\u7684\u6982\u5FF5</h3><p>webgl \u7ED8\u56FE\u8FC7\u7A0B\u662F\uFF1A\u9876\u70B9\u7740\u8272\u5668\u5B9A\u5F62\uFF0C\u7247\u5143\u7740\u8272\u5668\u9010\u7247\u5143\u586B\u989C\u8272\uFF0C\u7136\u540E\u7ED8\u5236\u5230canvas\u753B\u5E03\u4E0A\u3002<br><img src="`+_a+'" alt=""></p><p>\u5176\u5B9E\uFF0C\u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u4E5F\u53EF\u4EE5\u4E0D\u628A\u56FE\u5F62\u7ED8\u5236\u5230\u753B\u5E03\u4E0A\uFF0C\u800C\u662F\u7ED8\u5236\u5230\u5185\u5B58\u4E4B\u4E2D\uFF0C\u8FD9\u6837\u53EF\u4EE5\u5728\u4E0D\u663E\u793A\u56FE\u50CF\u7684\u524D\u63D0\u4E0B\uFF0C\u83B7\u53D6webgl \u7ED8\u5236\u7684\u56FE\u50CF\u6570\u636E\u3002<br> \u8FD9\u5757\u5728\u5185\u5B58\u4E2D\u5B58\u50A8webgl \u56FE\u50CF\u7684\u533A\u57DF\uFF0C\u5C31\u53EB<strong>\u5E27\u7F13\u51B2\u533A</strong>\u3002<br><img src="'+ja+`" alt=""></p><p>\u6709\u4E86\u5E27\u7F13\u51B2\u533A\u7684\u56FE\u50CF\u6570\u636E\u4E4B\u540E\uFF0C\u8FD8\u4E0D\u663E\u793A\u5B83\uFF0C\u90A3\u5E27\u7F13\u51B2\u533A\u6709\u5565\u7528\u5462\uFF1F<br> \u5E27\u7F13\u51B2\u533A\u7684\u4F5C\u7528\u975E\u5E38\u5F3A\u5927\uFF0C\u53EF\u4EE5\u5BF9webgl \u7684\u6E32\u67D3\u7ED3\u679C\u505A\u540E\u5904\u7406\uFF0C\u6BD4\u5982\u4E3A\u6A21\u578B\u6DFB\u52A0\u63CF\u8FB9\u3001\u5149\u6655\u7B49\uFF1B\u8FD8\u53EF\u4EE5\u57FA\u4E8E\u5149\u6E90\u751F\u6210\u6DF1\u5EA6\u8D34\u56FE\uFF0C\u8BA1\u7B97\u6295\u5F71\u2026\u2026</p><p>\u5BF9\u4E8E\u5E27\u7F13\u51B2\u533A\u7684\u57FA\u672C\u6982\u5FF5\u548C\u4F5C\u7528\u5C31\u8BF4\u5230\u8FD9\uFF0C\u63A5\u4E0B\u6765\u7528\u4EE3\u7801\u6572\u4E00\u4E0B\u3002</p><h3 id="_2-\u5E27\u7F13\u51B2\u533A\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-\u5E27\u7F13\u51B2\u533A\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 2.\u5E27\u7F13\u51B2\u533A\u7684\u4EE3\u7801\u5B9E\u73B0</h3><p>\u5165\u95E8webgl \u7684\u65F6\u5019\u753B\u8FC7\u4E00\u4E2A\u70B9\uFF0C\u63A5\u4E0B\u628A\u8FD9\u4E2A\u70B9\u753B\u5230\u5E27\u7F13\u51B2\u533A\u91CC\u53BB\u3002</p><ol><li>\u8FD9\u662F\u5728canvas \u753B\u5E03\u4E2D\u7ED8\u5236\u4E00\u4E2A\u70B9\u7684\u65B9\u6CD5\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//\u70B9\u4F4D</span>
      gl_Position<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//\u5C3A\u5BF8</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">100.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../jsm/Utils.js&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
  	canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> vs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> program1 <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs1<span class="token punctuation">,</span> fs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program1<span class="token punctuation">)</span>
    
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+qa+`" alt=""></p><ol start="2"><li>\u5728\u7ED8\u5236\u56FE\u5F62\u7684\u65F6\u5019\u505A\u4E2A\u62E6\u622A\uFF0C\u628A\u56FE\u5F62\u753B\u5230\u5E27\u7F13\u51B2\u533A\u91CC\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u2026\u2026
<span class="token keyword">const</span> vs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> program1 <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs1<span class="token punctuation">,</span> fs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program1<span class="token punctuation">)</span>

<span class="token comment">//\u7EB9\u7406\u5BF9\u8C61</span>
gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u5E27\u7F13\u51B2\u533A</span>
<span class="token keyword">const</span> framebuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
  texture<span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u8BBE\u7F6E\u6E32\u67D3\u5C3A\u5BF8</span>
gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7ED8\u56FE</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>\u8FD0\u884C\u4E0A\u9762\u7684\u4EE3\u7801\uFF0C\u4F1A\u53D1\u73B0\u6D4F\u89C8\u5668\u5728\u6CA1\u6709\u62A5\u9519\u7684\u524D\u63D0\u4E0B\uFF0C\u6210\u529F\u7ED8\u5236\u4E0D\u51FA\u4EFB\u4F55\u4E1C\u897F\u6765\u4E86\u3002<br> \u4E0A\u9762\u7684\u4EE3\u7801\u53EF\u4EE5\u5206\u4E24\u90E8\u5206\u770B\uFF0C\u4E00\u90E8\u5206\u662F\u7EB9\u7406\u5BF9\u8C61\uFF0C\u4E00\u90E8\u5206\u662F\u5E27\u7F13\u51B2\u533A\u3002</p><ol><li>\u7EB9\u7406\u5BF9\u8C61\u662F\u7528\u6765\u88C5webgl \u7ED8\u56FE\u7ED3\u679C\u7684\uFF0C\u53EF\u4EE5\u5C06\u5176\u7406\u89E3\u4E3A\u50CF\u7D20\u6570\u636E\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span>
  <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>createTexture() \u521B\u5EFA\u7EB9\u7406\u5BF9\u8C61</li><li>bindTexture(target, texture) \u5C06\u7EB9\u7406\u5BF9\u8C61\u7ED1\u5B9A\u5230\u76EE\u6807\u5BF9\u8C61\u4E0A\uFF0C\u4E0A\u9762\u4EE3\u7801\u91CC\u7684\u76EE\u6807\u5BF9\u8C61\u5C31\u662F\u4E8C\u7EF4\u7EB9\u7406\u5BF9\u8C61gl.TEXTURE_2D</li><li>texParameteri() \u8BBE\u7F6E\u7EB9\u7406\u53C2\u6570</li><li>texImage2D(target, level, internalformat, width, height, border, format, type, ArrayBufferView? pixels) \u8BBE\u7F6E\u7EB9\u7406\u5BF9\u8C61\u7684\u56FE\u50CF\u6E90 <ul><li>target \u7EB9\u7406\u76EE\u6807</li><li>level mipmap \u56FE\u50CF\u7EA7\u522B</li><li>internalformat \u989C\u8272\u683C\u5F0F</li><li>width, height \u7EB9\u7406\u5BF9\u8C61\u7684\u5C3A\u5BF8</li><li>border \u8FB9\u754C\u5BBD\u5EA6\uFF0C\u5FC5\u987B\u4E3A0</li><li>format \u989C\u8272\u683C\u5F0F\uFF0C WebGL 1 \u4E2D\u5FC5\u987B\u548Cinternalformat \u4E00\u81F4</li><li>type \u7EB9\u7406\u6570\u636E\u7C7B\u578B</li><li>pixels \u7EB9\u7406\u7684\u50CF\u7D20\u6E90</li></ul></li></ul><ol start="2"><li>\u5E27\u7F13\u51B2\u533A\u53EF\u4EE5\u7406\u89E3\u4E3A\u7528\u6765\u88C5\u7EB9\u7406\u5BF9\u8C61\u7F13\u51B2\u533A\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> framebuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
  texture<span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>createFramebuffer() \u5EFA\u7ACB\u5E27\u7F13\u51B2\u533A</li><li>bindFramebuffer(target, framebuffer) \u5C06\u5E27\u7F13\u51B2\u533A\u7ED1\u5B9A\u5230\u76EE\u6807\u5BF9\u8C61\u4E0A\u3002 <ul><li>target \u76EE\u6807\u5BF9\u8C61\uFF0C\u7528\u4E8E\u6536\u96C6\u6E32\u67D3\u56FE\u50CF\u7684\u65F6\u6240\u9700\u7684\u989C\u8272\u3001\u900F\u660E\u5EA6\u3001\u6DF1\u5EA6\u548C\u6A21\u5177\u7F13\u51B2\u533A\u6570\u636E</li><li>framebuffer \u5E27\u7F13\u51B2\u533A</li></ul></li><li>framebufferTexture2D(target, attachment, textarget, texture, level) \u5C06\u7EB9\u7406\u5BF9\u8C61\u6DFB\u52A0\u5230\u5E27\u7F13\u51B2\u533A\u4E2D <ul><li>target \u76EE\u6807\u5BF9\u8C61</li><li>attachment \u8BBE\u7F6E\u5C06\u7EB9\u7406\u5BF9\u8C61\u7ED1\u5B9A\u5230\u54EA\u4E2A\u7F13\u51B2\u533A\u4E2D <ul><li>gl.COLOR_ATTACHMENT0 \u5C06\u7EB9\u7406\u5BF9\u8C61\u7ED1\u5B9A\u5230\u989C\u8272\u7F13\u51B2\u533A</li><li>gl.DEPTH_ATTACHMENT \u5C06\u7EB9\u7406\u5BF9\u8C61\u7ED1\u5B9A\u5230\u6DF1\u5EA6\u7F13\u51B2\u533A</li><li>gl.STENCIL_ATTACHMENT \u5C06\u7EB9\u7406\u5BF9\u8C61\u7ED1\u5B9A\u5230\u6A21\u677F\u7F13\u51B2\u533A</li></ul></li><li>textarget \u7EB9\u7406\u7684\u76EE\u6807\u5BF9\u8C61</li><li>texture \u7EB9\u7406\u5BF9\u8C61</li><li>level mipmap \u56FE\u50CF\u7EA7\u522B</li></ul></li></ul><ol start="3"><li>\u6E32\u67D3\u65B9\u6CD5\uFF0C\u628A\u56FE\u5F62\u6E32\u67D3\u8FDB\u5E27\u7F13\u51B2\u533A\u7684\u7EB9\u7406\u5BF9\u8C61\u91CC\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>\u56FE\u5F62\u5728\u6E32\u67D3\u7684\u65F6\u5019\uFF0C\u4F1A\u6709\u4E00\u4E2AVIEWPORT \u5C3A\u5BF8\uFF0C\u53EF\u4EE5\u628A\u8FD9\u4E2A\u5C3A\u5BF8\u7406\u89E3\u4E3A\u6E32\u67D3\u5C3A\u5BF8\uFF0C\u8FD9\u4E2A\u5C3A\u5BF8\u9ED8\u8BA4\u548Ccanvas \u753B\u5E03\u4E00\u81F4\u3002</li></ol><p>\u53EF\u4EE5\u7528gl.getParameter(gl.VIEWPORT) \u65B9\u6CD5\u83B7\u53D6\u753B\u5E03\u7684\u50CF\u7D20\u5C3A\u5BF8\u3002<br> \u4E5F\u9700\u8981\u77E5\u9053\u8BBE\u7F6E\u8FD9\u4E2A\u6E32\u67D3\u5C3A\u5BF8\u7684\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u8BBE\u7F6E\u6E32\u67D3\u5C3A\u5BF8</span>
gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u7ED8\u56FE</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>viewport(x,y,w,h) <ul><li>x,y \u662FVIEWPORT \u7684\u5DE6\u4E0B\u89D2\u70B9\u4F4D\u7F6E</li><li>w,h \u662FVIEWPORT \u7684\u5BBD\u9AD8</li></ul></li></ul><p>\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\uFF0C\u4E00\u822C\u4F1A\u628AVIEWPORT \u5C3A\u5BF8\u8BBE\u7F6E\u7684\u548C\u7EB9\u7406\u5BF9\u8C61\u4E00\u6837\u5927\uFF0C\u8FD9\u6837\u6700\u7EC8\u6E32\u67D3\u51FA\u7684\u56FE\u50CF\u5C31\u662F\u548C\u7EB9\u7406\u5BF9\u8C61\u4E00\u6837\u5927\u7684\u56FE\u50CF\u3002</p><p>\u6709\u4E86\u5E27\u7F13\u51B2\u533A\u4E4B\u540E\uFF0C\u5C31\u53EF\u4EE5\u628A\u5E27\u7F13\u51B2\u533A\u4E2D\u7684\u7EB9\u7406\u5BF9\u8C61\u5F53\u6210\u771F\u7684\u7EB9\u7406\u5BF9\u8C61\u6765\u7528\uFF0C\u628A\u5B83\u8D34\u5230\u6A21\u578B\u4E0A\u3002</p><h3 id="_3-\u5E27\u7F13\u51B2\u533A\u7684\u663E\u793A" tabindex="-1"><a class="header-anchor" href="#_3-\u5E27\u7F13\u51B2\u533A\u7684\u663E\u793A" aria-hidden="true">#</a> 3.\u5E27\u7F13\u51B2\u533A\u7684\u663E\u793A</h3><p>\u63A5\u7740\u4E0A\u9762\u7684\u4EE3\u7801\u5F80\u540E\u5199\u3002</p><ol><li>\u5199\u4E00\u5957\u7EB9\u7406\u7740\u8272\u5668\uFF0C\u7528\u4E8E\u663E\u793A\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u7EB9\u7406\u5BF9\u8C61\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    v_Pin<span class="token operator">=</span>a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ol start="2"><li>\u5E27\u7F13\u51B2\u533A\u7ED8\u5236\u5B8C\u56FE\u50CF\u540E\uFF0C\u628A\u5E27\u7F13\u51B2\u533A\u7F6E\u7A7A\uFF0C\u5426\u5219\u4E0B\u6B21\u7ED8\u56FE\u8FD8\u662F\u4F1A\u753B\u5230\u5E27\u7F13\u51B2\u533A\u91CC\uFF0C\u800C\u4E0D\u662F\u753B\u5230canvas \u753B\u5E03\u91CC\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>\u5C06viewport \u6062\u590D\u5230\u5F53\u524Dcanvas \u753B\u5E03\u7684\u5C3A\u5BF8\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="4"><li>\u7ED8\u5236\u4E00\u4E2A\u77E9\u5F62\u9762\uFF0C\u628A\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u7EB9\u7406\u5BF9\u8C61\u8D34\u4E0A\u53BB\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> vs2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> fs2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
<span class="token keyword">const</span> program2 <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs2<span class="token punctuation">,</span> fs2<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program2<span class="token punctuation">)</span>

<span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
<span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program2<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> a_Pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program2<span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>
<span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program2<span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">)</span>
gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>\u6700\u7EC8\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Pa+'" alt=""></p><p>\u5F53\u628A\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u7EB9\u7406\u5BF9\u8C61\u663E\u793A\u51FA\u6765\u540E\uFF0C\u8FD8\u9700\u8981\u8003\u8651\u4E00\u4E2A\u6DF1\u5EA6\u95EE\u9898\u3002</p><h3 id="_4-\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u6DF1\u5EA6\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_4-\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u6DF1\u5EA6\u6D4B\u8BD5" aria-hidden="true">#</a> 4.\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u6DF1\u5EA6\u6D4B\u8BD5</h3><h4 id="_4-1\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_4-1\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u6982\u5FF5" aria-hidden="true">#</a> 4.1\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u6982\u5FF5</h4><p>\u5728webgl\u4E2D\u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u82E5\u6CA1\u6709\u5F00\u542F\u6DF1\u5EA6\u6D4B\u8BD5 gl.DEPTH_TEST\uFF0C\u90A3\u5B83\u5C31\u4F1A\u50CF\u753B\u6C34\u7C89\u4E00\u6837\uFF0C\u4E00\u5C42\u5C42\u7684\u5F80canvas \u753B\u5E03\u4E0A\u8986\u76D6\u989C\u8272\uFF0C\u5B83\u4E0D\u4F1A\u8003\u8651\u56FE\u5F62\u5728\u6DF1\u5EA6\u4E0A\u7684\u906E\u6321\u95EE\u9898\u3002<br><img src="'+Sa+'" alt=""></p><p>\u5F53\u5F00\u542F\u4E86\u6DF1\u5EA6\u6D4B\u8BD5\uFF0C\u79BB\u89C6\u70B9\u8FD1\u7684\u56FE\u5F62\u5C31\u4F1A\u906E\u6321\u4F8B\u89C6\u70B9\u8FDC\u7684\u56FE\u5F62\u3002<br> \u5F53\u7136\uFF0C\u8FD9\u79CD\u5BF9\u4E8E\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u89E3\u91CA\u662F\u6709\u70B9\u7B3C\u7EDF\u7684\uFF0C\u6BD4\u5982\u50CF\u4E0B\u9762\u7684\u4E09\u4E2A\u4E09\u89D2\u5F62\uFF0C\u5C31\u6CA1\u6CD5\u5224\u65AD\u8C01\u8FDC\u8C01\u8FD1\u4E86\u3002<br><img src="'+Ea+`" alt=""></p><p>webgl\u7684\u6DF1\u5EA6\u6D4B\u8BD5\u662F\u5148\u57FA\u4E8E\u6574\u4E2A\u573A\u666F\u751F\u6210\u4E00\u5F20\u6DF1\u5EA6\u8D34\u56FE\uFF0C\u6DF1\u5EA6\u8D34\u56FE\u91CC\u5B58\u50A8\u4E86\u79BB\u89C6\u70B9\u6700\u8FD1\u7684\u7247\u5143\u7684\u6DF1\u5EA6\u4FE1\u606F\u3002<br> webgl \u5728\u9010\u7247\u5143\u7740\u8272\u65F6\uFF0C\u4F1A\u5224\u65AD\u4E00\u4E0B\u5F53\u524D\u7247\u5143\u7684\u7684\u6DF1\u5EA6\u662F\u5426\u5C0F\u4E8E\u6DF1\u5EA6\u8D34\u56FE\u91CC\u76F8\u5E94\u7247\u5143\u7684\u6DF1\u5EA6\uFF0C\u82E5\u662F\u7684\u8BDD\uFF0C\u90A3webgl\u5C31\u4E0D\u4F1A\u5BF9\u5F53\u524D\u7247\u5143\u8FDB\u884C\u6E32\u67D3\u3002<br> \u4ECE\u800Cwebgl\u5C31\u901A\u8FC7\u53EA\u7ED8\u5236\u5728\u6DF1\u5EA6\u4E0A\u79BB\u89C6\u70B9\u6700\u8FD1\u7684\u7247\u5143\u7684\u65B9\u5F0F\uFF0C\u89E3\u51B3\u4E86\u56FE\u5F62\u906E\u6321\u95EE\u9898\u3002</p><p>\u5728\u4EE3\u7801\u91CC\u7ED9\u5927\u5BB6\u6F14\u793A\u4E00\u4E0B\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u539F\u7406\u3002</p><h4 id="_4-2\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_4-2\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 4.2\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u4EE3\u7801\u5B9E\u73B0</h4><ol><li>\u753B\u4E24\u4E2A\u4E0D\u540C\u6DF1\u5EA6\u7684\u70B9\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    varying float v_Z<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">200.0</span><span class="token punctuation">;</span>
      v_Z<span class="token operator">=</span>a_Position<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    varying float v_Z<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>v_Z<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Utils.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> vs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> program1 <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs1<span class="token punctuation">,</span> fs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program1<span class="token punctuation">)</span>

  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program1<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>\u5176\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ma+`" alt=""></p><p>\u901A\u8FC7\u4EE3\u7801\u53EF\u4EE5\u77E5\u9053\uFF0C\u5728\u88C1\u526A\u7A7A\u95F4\u4E2D\uFF0C\u9ED1\u70B9\u7684\u6DF1\u5EA6\u662F0\uFF0C\u767D\u70B9\u6DF1\u5EA6\u662F0.9\uFF0C\u6309\u7406\u8BF4\u662F\u5E94\u8BE5\u9ED1\u70B9\u906E\u6321\u767D\u70B9\u7684\u3002<br> \u8FD9\u5C31\u56E0\u4E3A\u5728\u6CA1\u6709\u5F00\u542F\u6DF1\u5EA6\u6D4B\u8BD5\u7684\u60C5\u51B5\u4E0B\uFF0Cwebgl \u4F1A\u50CF\u753B\u6CB9\u753B\u4E00\u6837\uFF0C\u6839\u636E\u9876\u70B9\u6570\u636E\u7684\u6392\u5E8F\uFF0C\u4E00\u4E2A\u4E2A\u7ED8\u5236\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token comment">//\u9ED1\u70B9</span>
  <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">//\u767D\u70B9</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u5728\u4E0A\u9762\u7684\u4EE3\u7801\u91CC\uFF0C\u5148\u5199\u5165\u4E86\u9ED1\u70B9\uFF0C\u53C8\u5199\u5165\u4E86\u767D\u70B9\uFF0C\u6240\u4EE5webgl\u5148\u753B\u5B8C\u4E86\u9ED1\u70B9\u540E\uFF0C\u53C8\u5728\u9ED1\u70B9\u4E0A\u9762\u8986\u76D6\u4E86\u4E00\u4E2A\u767D\u70B9\u3002</p><p>\u6CE8\uFF1A\u4E0A\u9762\u7684\u70B9\u4F4D\u662F\u88C1\u526A\u7A7A\u95F4\u4E2D\u7684\u70B9\u4F4D\uFF0C\u4E0D\u8981\u5C06\u5176\u5F53\u6210\u4E16\u754C\u5750\u6807\u7CFB\u91CC\u7684\u70B9\u4F4D\uFF0C\u88C1\u526A\u7A7A\u95F4\u548C\u53F3\u624B\u89C4\u5219\u7684\u4E16\u754C\u5750\u6807\u7CFB\u7684z\u8F74\u662F\u76F8\u53CD\u7684\u3002</p><ol start="2"><li>\u4E3Awebgl \u5F00\u542F\u6DF1\u5EA6\u6D4B\u8BD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ra+`" alt=""></p><p>\u8FD9\u6837 webgl \u5C31\u53EF\u4EE5\u89E3\u51B3\u4E0D\u540C\u6DF1\u5EA6\u4E0A\u5F97\u56FE\u5F62\u906E\u6321\u95EE\u9898\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6D4B\u4E00\u4E0B\u5728\u5E27\u7F13\u51B2\u533A\u91CC\u662F\u5426\u4E5F\u53EF\u4EE5\u7528\u540C\u6837\u7684\u65B9\u5F0F\u89E3\u51B3\u56FE\u5F62\u906E\u6321\u95EE\u9898\u3002</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- \u70B9 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  varying float v_Z<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
    gl_PointSize<span class="token operator">=</span><span class="token number">200.0</span><span class="token punctuation">;</span>
    v_Z<span class="token operator">=</span>a_Position<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  varying float v_Z<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>v_Z<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- \u7EB9\u7406\u7740\u8272\u5668 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    v_Pin<span class="token operator">=</span>a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Utils.js&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">512</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> texture <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fs1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> program1 <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs1<span class="token punctuation">,</span> fs1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program1<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program1<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
    texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> framebuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      texture<span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">const</span> vs2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> fs2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
    <span class="token keyword">const</span> program2 <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vs2<span class="token punctuation">,</span> fs2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program2<span class="token punctuation">)</span>

    <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_Position <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program2<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> a_Pin <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program2<span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>
    <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program2<span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ta+`" alt=""></p><p>\u7531\u6B64\u53EF\u89C1\uFF0C\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u5F00\u542F\u4E86\u5E27\u7F13\u51B2\u533A\u540E\uFF0C\u4F9D\u65E7\u65E0\u6CD5\u5B9E\u73B0\u4E0D\u540C\u6DF1\u5EA6\u7684\u56FE\u5F62\u906E\u6321\u3002<br> \u8FD9\u662F\u56E0\u4E3A\u8FD8\u9700\u8981\u4E3A\u5E27\u7F13\u51B2\u533A\u7ED1\u5B9A\u6DF1\u5EA6\u7F13\u51B2\u533A\u3002</p><h4 id="_4-3\u6DF1\u5EA6\u7F13\u51B2\u533A" tabindex="-1"><a class="header-anchor" href="#_4-3\u6DF1\u5EA6\u7F13\u51B2\u533A" aria-hidden="true">#</a> 4.3\u6DF1\u5EA6\u7F13\u51B2\u533A</h4><p>\u5728\u5E27\u7F13\u51B2\u533A\u7ED8\u56FE\u4E4B\u524D\uFF0C\u518D\u5EFA\u7ACB\u4E00\u4E2A\u6E32\u67D3\u7F13\u51B2\u533A\uFF0C\u7136\u540E\u5C06\u5176\u6DFB\u52A0\u5230\u5E27\u7F13\u51B2\u533A\u4E2D\u3002<br> \u6E32\u67D3\u7F13\u51B2\u533A\u53EF\u4EE5\u7528\u4E8E\u5B58\u50A8\u6DF1\u5EA6\u7F13\u51B2\u533A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> depthbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createRenderbuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">bindRenderbuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> depthbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">renderbufferStorage</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_COMPONENT16</span><span class="token punctuation">,</span>
  <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">framebufferRenderbuffer</span><span class="token punctuation">(</span>
  gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_ATTACHMENT</span><span class="token punctuation">,</span>
  gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> depthbuffer
<span class="token punctuation">)</span><span class="token punctuation">;</span>

gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>createRenderbuffer() \u5EFA\u7ACB\u6E32\u67D3\u7F13\u51B2\u533A\uFF0C\u6E32\u67D3\u7F13\u51B2\u533A\u53EF\u4EE5\u7528\u4E8E\u5B58\u50A8\u6E32\u67D3\u6570\u636E</li><li>renderbufferStorage(target, internalFormat, width, height) \u521D\u59CB\u5316\u6E32\u67D3\u7F13\u51B2\u533A <ul><li>target \u6E32\u67D3\u7F13\u51B2\u533A\u7684\u76EE\u6807\u5BF9\u8C61\uFF0C\u53EA\u80FD\u662F gl.RENDERBUFFER</li><li>internalFormat \u6570\u636E\u683C\u5F0F\uFF0Cgl.DEPTH_COMPONENT16\u4FBF\u662F\u9488\u5BF9\u6DF1\u5EA6\u6570\u636E\u7684</li><li>width, height \u6E32\u67D3\u7F13\u51B2\u533A\u7684\u5BBD\u3001\u9AD8</li></ul></li><li>framebufferRenderbuffer(target, attachment, renderbuffertarget, renderbuffer) \u5411\u5E27\u7F13\u51B2\u533A\u4E2D\u6DFB\u52A0\u6E32\u67D3\u7F13\u51B2\u533A <ul><li>target \u5E27\u7F13\u51B2\u533A\u7684\u76EE\u6807\u5BF9\u8C61</li><li>attachment \u8981\u4E3A\u5E27\u7F13\u51B2\u533A\u7ED1\u5B9A\u7684\u7F13\u51B2\u533A <ul><li>gl.DEPTH_ATTACHMENT \u6DF1\u5EA6\u7F13\u51B2\u533A</li><li>\u2026\u2026</li></ul></li><li>renderbuffertarget \u6E32\u67D3\u7F13\u51B2\u533A\u7684\u76EE\u6807\u5BF9\u8C61\uFF0C\u53EA\u80FD\u662Fgl.RENDERBUFFER</li><li>renderbuffer \u6E32\u67D3\u7F13\u51B2\u533A</li></ul></li></ul><p>\u6700\u7EC8\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Aa+'" alt=""></p><p>\u6CE8\uFF1Awebgl \u7684\u6709\u4E9BAPI \u8BFB\u8D77\u6765\u6709\u4E9B\u6666\u6DA9\uFF0C\u8FD9\u91CC\u9762\u6709\u4E9B\u662Fwebgl \u7684\u5386\u53F2\u9057\u7559\u95EE\u9898\u3002\u6709\u4E9BAPI\uFF0C\u5148\u77E5\u9053\u5176\u5B9E\u73B0\u539F\u7406\u548C\u529F\u80FD\u5373\u53EF\uFF0C\u6709\u4E9B\u53C2\u6570\u4E0D\u5FC5\u592A\u8FC7\u6DF1\u7A76\u3002</p><h2 id="\u4E8C\u5341\u4E94\u3001\u6295\u5F71" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u4E94\u3001\u6295\u5F71" aria-hidden="true">#</a> \u4E8C\u5341\u4E94\u3001\u6295\u5F71</h2><p>\u5F53\u751F\u6D3B\u6709\u4E86\u5149\u7684\u65F6\u5019\uFF0C\u4E5F\u4F1A\u6709\u6295\u5F71\u7684\u5B58\u5728\u3002<br> \u6295\u5F71\u53EF\u4EE5\u66F4\u597D\u7684\u886C\u6258\u5149\u660E\uFF0C\u8BA9\u751F\u6D3B\u53D8\u5F97\u7ACB\u4F53\uFF0C\u6709\u8282\u594F\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u5C31\u8BA9\u6211\u4EEC\u4E00\u8D77\u63A2\u7D22\u6295\u5F71\uFF0C\u53D1\u73B0\u672A\u77E5\u3002\u5728\u5149\u5F71\u6C89\u6D6E\u4E4B\u4E2D\uFF0C\u5BFB\u627E\u751F\u6D3B\u7684\u8282\u594F\u611F\u3002</p><h3 id="_1-\u6295\u5F71\u7684\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-\u6295\u5F71\u7684\u6982\u5FF5" aria-hidden="true">#</a> 1.\u6295\u5F71\u7684\u6982\u5FF5</h3><p>\u6295\u5F71\u5C31\u662F\u5149\u6E90\u7167\u5C04\u4E0D\u5230\u7684\u5730\u65B9\u3002<br> \u53EF\u4EE5\u628A\u5149\u6E90\u60F3\u8C61\u6210\u89C6\u70B9\uFF0C\u5149\u6E90\u770B\u4E0D\u89C1\u5B83\u6240\u7167\u5C04\u7684\u7269\u4F53\u7684\u5F71\u5B50\u3002<br> \u5728webgl\u91CC\uFF0C\u8981\u77E5\u9053\u4E00\u4E2A\u5730\u65B9\u6709\u6CA1\u6709\u6295\u5F71\uFF0C\u53EA\u8981\u77E5\u9053\u89C6\u70B9\u6240\u770B\u7684\u5730\u65B9\u6709\u6CA1\u6709\u88AB\u5149\u6E90\u770B\u89C1\u5230\u5373\u53EF\u3002<br><img src="'+Ba+'" alt=""></p><p>\u4EE5\u4E0A\u56FE\u7684\u9525\u5F62\u706F\u4E3A\u4F8B\uFF0C\u8BF4\u4E00\u4E0B\u5982\u4F55\u5224\u65AD\u4E00\u4E2A\u5730\u65B9\u6709\u6CA1\u6709\u6295\u5F71\uFF1A</p><ol><li>\u628A\u5149\u6E90\u5F53\u6210\u76F8\u673A\uFF0C\u6E32\u67D3\u4E00\u5F20\u6295\u5F71\u8D34\u56FE\u585E\u8FDB\u5E27\u7F13\u51B2\u533A\u91CC\u3002\u6295\u5F71\u8D34\u56FE\u662F\u5B58\u50A8\u56FE\u5F62\u5230\u76F8\u673A\u8DDD\u79BB\u7684\u56FE\u50CF\u3002</li><li>\u5728\u5B9E\u9645\u76F8\u673A\u4E2D\u9010\u7247\u5143\u6E32\u67D3\u65F6\uFF0C\u5BF9\u6BD4\u5F53\u524D\u7247\u5143\u4E0E\u6295\u5F71\u8D34\u56FE\u4E2D\u76F8\u5E94\u4F4D\u7F6E\u7684\u7247\u5143\u7684\u6DF1\u5EA6\u5927\u5C0F\u3002\u82E5\u5F53\u524D\u7247\u5143\u7684\u6DF1\u5EA6\u5C0F\u4E8E\u6295\u5F71\u8D34\u56FE\u4E2D\u76F8\u5E94\u7247\u5143\u7684\u6DF1\u5EA6\uFF0C\u5C31\u8BF4\u660E\u5F53\u524D\u7247\u5143\u5728\u6295\u5F71\u4E2D\u3002</li></ol><p>\u770B\u4E86\u4E0A\u9762\u7684\u6B65\u9AA4\uFF0C\u5927\u5BB6\u53EF\u80FD\u4F1A\u6709\u5F88\u591A\u7684\u7591\u95EE\uFF1A</p><ul><li>\u6295\u5F71\u8D34\u56FE\u600E\u4E48\u505A\uFF1F</li><li>\u5982\u4F55\u628A\u56FE\u5F62\u5230\u5149\u6E90\u7684\u6DF1\u5EA6\u6570\u636E\u5B58\u5165\u6295\u5F71\u8D34\u56FE\u4E2D\uFF1F</li><li>\u5982\u4F55\u627E\u5230\u6E32\u67D3\u65F6\uFF0C\u5F53\u524D\u7247\u5143\u5728\u6295\u5F71\u8D34\u56FE\u4E2D\u6240\u5BF9\u5E94\u7684\u7247\u5143\uFF1F</li><li>\u2026\u2026</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u5E26\u7740\u7591\u95EE\uFF0C\u770B\u4E00\u4E0B\u5176\u4EE3\u7801\u5B9E\u73B0\u8FC7\u7A0B\u3002</p><h3 id="_2-\u6295\u5F71\u7684\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_2-\u6295\u5F71\u7684\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> 2.\u6295\u5F71\u7684\u4EE3\u7801\u5B9E\u73B0</h3><p>\u5728\u4E0B\u9762\u7684\u4EE3\u7801\u91CC\uFF0C\u901A\u8FC7\u9525\u5F62\u706F\u7ED9\u4E00\u4E2A\u4E09\u89D2\u5F62\u6DFB\u52A0\u6295\u5F71\u3002<br> \u4E3A\u4E86\u76F4\u51FB\u91CD\u70B9\uFF0C\u5148\u4E0D\u8003\u8651\u4E09\u89D2\u5F62\u5BF9\u5149\u7684\u53CD\u5C04\uFF0C\u6211\u4EEC\u53EA\u5173\u6CE8\u4E09\u89D2\u5F62\u7684\u6295\u5F71\u3002<br> \u5176\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="'+v+`" alt=""></p><h4 id="_2-1\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u5236\u6295\u5F71\u8D34\u56FE" tabindex="-1"><a class="header-anchor" href="#_2-1\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u5236\u6295\u5F71\u8D34\u56FE" aria-hidden="true">#</a> 2.1\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u5236\u6295\u5F71\u8D34\u56FE</h4><ol><li>\u5728\u5E27\u7F13\u51B2\u533A\u7ED8\u5236\u6295\u5F71\u8D34\u56FE\u7684\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position<span class="token operator">=</span>u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>z<span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u5728\u9876\u70B9\u7740\u8272\u5668\u91CC\uFF0Cu_PvMatrix \u662F\u57FA\u4E8E\u628A\u9525\u5F62\u706F\u5F53\u6210\u76F8\u673A\u540E\uFF0C\u83B7\u53D6\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002<br> \u5728\u7247\u5143\u7740\u8272\u5668\u91CC\uFF0Cgl_FragCoord.z \u662F\u7247\u5143\u7684\u6DF1\u5EA6\u4FE1\u606F\uFF0C\u8FD9\u4E2A\u4FE1\u606F\u88AB\u5199\u8FDB\u4E86gl_FragColor \u7247\u5143\u989C\u8272\u91CC\u3002<br> gl_FragCoord \u5BF9\u5E94\u7684\u662F\u7247\u5143\u5750\u6807\u7684\u610F\u601D\uFF0C\u6211\u4EEC\u9700\u8981\u77E5\u9053\u7247\u5143\u5750\u6807\u548C\u88C1\u526A\u5750\u6807\u7684\u6620\u5C04\u5173\u7CFB\u3002</p><p>\u6211\u4E4B\u524D\u8BF4\u8FC7\uFF0C\u88C1\u526A\u7A7A\u95F4\u5728x,y,z \u65B9\u5411\u7684\u8FB9\u754C\u90FD\u662F(-1,1)\uFF0C\u8FD9\u4E09\u4E2A\u65B9\u5411\u7684\u8FB9\u754C\u6620\u5C04\u5230\u7247\u5143\u5750\u6807\u540E\u5C31\u662F(0,1)\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A<br><img src="`+Fa+`" alt=""></p><ol start="2"><li>\u5728js \u4E2D\u51C6\u5907\u76F8\u673A\u3001\u706F\u5149\u548C\u6A21\u578B\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Utils.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span> 
  PerspectiveCamera<span class="token punctuation">,</span> 
  Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ratio <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u706F\u5149</span>
<span class="token keyword">const</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> ratio<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>
light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
light<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
light<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pvMatrixLight <span class="token operator">=</span> light<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span>

<span class="token comment">// \u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> ratio<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">)</span>
camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
camera<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> camera<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span>

<span class="token comment">// \u4E09\u89D2\u5F62\u6570\u636E</span>
<span class="token keyword">const</span> triangleVertice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.1</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// \u5730\u9762\u6570\u636E</span>
<span class="token keyword">const</span> floorVertice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
  <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
  <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
  <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><ol start="3"><li>\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u7EB9\u7406\u5C3A\u5BF8</span>
<span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">1024</span>
<span class="token comment">// \u7EB9\u7406\u5BF9\u8C61</span>
<span class="token keyword">let</span> texture <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token comment">/* \u5E27\u7F13\u51B2\u533A\u5185\u7ED8\u56FE */</span>
<span class="token punctuation">{</span>
  <span class="token comment">// \u7A0B\u5E8F\u5BF9\u8C61</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
  <span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span>

  <span class="token comment">// \u7EB9\u7406\u5BF9\u8C61</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
  texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
    width<span class="token punctuation">,</span> height<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u5E27\u7F13\u51B2\u533A</span>
  <span class="token keyword">const</span> framebuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    texture<span class="token punctuation">,</span> <span class="token number">0</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// \u6E32\u67D3\u7F13\u51B2\u533A\uFF0C\u5B58\u50A8\u6DF1\u5EA6\u6570\u636E</span>
  <span class="token keyword">const</span> depthbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createRenderbuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindRenderbuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> depthbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">renderbufferStorage</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_COMPONENT16</span><span class="token punctuation">,</span>
    width<span class="token punctuation">,</span> height
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">framebufferRenderbuffer</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_ATTACHMENT</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> depthbuffer
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u89C6\u53E3\u5C3A\u5BF8</span>
  gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E05\u7406\u753B\u5E03</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u706F\u5149\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  <span class="token keyword">const</span> u_PvMatrixLight <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_PvMatrixLight<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pvMatrixLight<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u4E09\u89D2\u5F62\u7684\u6A21\u578B\u77E9\u9635</span>
  <span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u7ED8\u5236\u4E09\u89D2\u5F62</span>
  <span class="token function">drawObj</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> triangleVertice<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

  <span class="token comment">// \u7ED8\u5236\u5E73\u9762</span>
  <span class="token function">drawObj</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> floorVertice<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>

  <span class="token comment">//\u8FD8\u539F</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u7ED8\u5236\u56FE\u5F62</span>
<span class="token keyword">function</span> <span class="token function">drawObj</span><span class="token punctuation">(</span><span class="token parameter">program<span class="token punctuation">,</span> vertice<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> verticesBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> verticesBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> vertice<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> attribute <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>attribute<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>attribute<span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLE_STRIP</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u56FE\u7684\u539F\u7406\uFF0C\u5DF2\u7ECF\u8BF4\u8FC7\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u518D\u8FC7\u591A\u89E3\u91CA\u3002</p><h4 id="_2-2\u5728canvas-\u753B\u5E03\u4E0A\u7ED8\u56FE" tabindex="-1"><a class="header-anchor" href="#_2-2\u5728canvas-\u753B\u5E03\u4E0A\u7ED8\u56FE" aria-hidden="true">#</a> 2.2\u5728canvas \u753B\u5E03\u4E0A\u7ED8\u56FE</h4><ol><li>\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  
  uniform mat4 u_PvMatrixLight<span class="token punctuation">;</span>
  varying vec4 v_ClipPosLight<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec4 worldPos<span class="token operator">=</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    gl_Position<span class="token operator">=</span>u_PvMatrix<span class="token operator">*</span>worldPos<span class="token punctuation">;</span>
    v_ClipPosLight<span class="token operator">=</span>u_PvMatrixLight<span class="token operator">*</span>worldPos<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_ShadowMap<span class="token punctuation">;</span>
  varying vec4 v_ClipPosLight<span class="token punctuation">;</span>
  bool <span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 fragPos<span class="token operator">=</span><span class="token punctuation">(</span>v_ClipPosLight<span class="token punctuation">.</span>xyz<span class="token operator">/</span>v_ClipPosLight<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    vec4 shadowFrag <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_ShadowMap<span class="token punctuation">,</span> fragPos<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fragPos<span class="token punctuation">.</span>z<span class="token operator">&gt;</span>shadowFrag<span class="token punctuation">.</span>r<span class="token operator">+</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float darkness<span class="token operator">=</span><span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">0.7</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>darkness<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\uFF0C\u7528\u5230\u4E86\u4E24\u79CD\u70B9\u4F4D\uFF0C\u4E24\u79CD\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</p><ul><li>a_Position \u5F53\u524D\u6A21\u578B\u7684\u9876\u70B9\u70B9\u4F4D\u3002</li><li>u_ModelMatrix \u5F53\u524D\u6A21\u578B\u7684\u6A21\u578B\u77E9\u9635\u3002</li><li>u_PvMatrix \u76F8\u673A\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</li><li>u_PvMatrixLight \u706F\u5149\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635\u3002</li><li>v_ClipPosLight \u4EE5\u9525\u5F62\u706F\u4E3A\u76F8\u673A\u65F6\uFF0C\u9876\u70B9\u5728\u88C1\u526A\u7A7A\u95F4\u91CC\u7684\u4F4D\u7F6E\u3002</li></ul><p>\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\uFF0CisInShadow() \u5373\u4F7F\u5224\u65AD\u5F53\u524D\u7247\u5143\u662F\u5426\u5728\u6295\u5F71\u91CC\u7684\u65B9\u6CD5\u3002</p><p>fragPos\u5C31\u662F\u5F53\u524D\u7247\u5143\u5728\u706F\u5149\u76F8\u673A\u91CC\u7684\u7247\u5143\u4F4D\u3002<br> fragPos\u7684x,y \u503C\u5C31\u662F\u5F53\u524D\u7247\u5143\u5728\u6295\u5F71\u8D34\u56FE\u91CC\u7684x,y\u4F4D\u7F6E\u3002<br> \u57FA\u4E8EfragPos\u7684x,y \u503C\uFF0C\u5C31\u53EF\u4EE5\u627E\u5230\u6295\u5F71\u8D34\u56FE\u91CC\u7684\u76F8\u5E94\u7247\u5143\uFF0C\u5373shadowFrag\u3002<br> \u56E0\u4E3AshadowFrag\u7684r \u503C\u91CC\u9762\u5B58\u50A8\u4E86\u79BB\u5149\u6E90\u6700\u8FD1\u7684\u7247\u5143\u7684\u6DF1\u5EA6\uFF0C\u6240\u4EE5\u5C06\u5176\u548CfragPos.z \u505A\u5927\u5C0F\u5224\u65AD\uFF0C\u5C31\u53EF\u4EE5\u77E5\u9053\u5F53\u524D\u7247\u5143\u662F\u5426\u5728\u6295\u5F71\u4E2D\u4E86\u3002<br> \u6309\u7406\u8BF4\uFF0C\u6211\u7528fragPos.z&gt;shadowFrag.r \u4FBF\u53EF\u4EE5\u5224\u65AD\u4E24\u4E2A\u6DF1\u5EA6\u503C\u7684\u5927\u5C0F\u3002<br> \u4F46\u662F\uFF0C\u6211\u8FD8\u8BA9shadowFrag.r \u52A0\u4E0A\u4E861.0/256.0\uFF0C\u8FD9\u662F\u4E3A\u4E86\u89E3\u51B3\u6570\u636E\u7684\u7CBE\u5EA6\u95EE\u9898\u3002<br> fragPos.z \u5C5E\u4E8Efloat \u6D6E\u70B9\u6570\uFF0C\u5176\u7CBE\u5EA6\u662Fmediump \u4E2D\u7B49\u7CBE\u5EA6\uFF0C\u5176\u8303\u56F4(-pow(2,14),pow(2,14))<br> shadowFrag.r \u5C5E\u4E8E\u50CF\u7D20\u6570\u636E\uFF0C\u5176\u7CBE\u5EA6\u53EA\u67091/pow(2,8)\uFF0C\u53731/256=0.00390625<br> \u4F4E\u7CBE\u5EA6\u7684\u6570\u636E\u5728\u5B58\u50A8\u65F6\uFF0C\u4F1A\u53D1\u751F\u6570\u636E\u4E22\u5931\u3002</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl_FragColor<span class="token punctuation">.</span>r<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token operator">-</span><span class="token number">0.0000000001</span><span class="token punctuation">;</span>
float z<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>z<span class="token operator">==</span>gl_FragColor<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//\u7EFF\u8272</span>
  gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>z<span class="token operator">&gt;</span>gl_FragColor<span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//\u7EA2\u8272</span>
  gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u6309\u7406\u8BF4\uFF0Cz\u80AF\u5B9A\u662F\u8981\u6BD4gl_FragColor.r \u5927\u7684\u3002<br> \u4F46\u662F\uFF0C\u56E0\u4E3A\u7CBE\u5EA6\u95EE\u9898\uFF0Cgl_FragColor.r \u4F9D\u65E7\u7B49\u4E8E1.0/256.0<br> \u6240\u4EE5\uFF0C\u6700\u7EC8gl_FragColor\u662F\u7EFF\u8272\u3002<br> \u8FD9\u4E5F\u5C31\u5BFC\u81F4\u4E86\uFF0C\u672C\u5E94\u8BE5\u663E\u793A\u51FA\u6765\u7684\u6295\u5F71\u4E0D\u4F1A\u663E\u793A\u3002<br> \u6240\u4EE5\uFF0C\u6211\u53C8\u4E3Agl_FragColor.r \u52A0\u4E0A\u4E86\u4E00\u4E2A\u7CBE\u5EA6\u3002</p><ol start="2"><li>\u5728canvas\u753B\u5E03\u4E0A\u7ED8\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token comment">// \u7A0B\u5E8F\u5BF9\u8C61</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u6E05\u7406\u753B\u5E03</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u7EB9\u7406</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span>
  <span class="token keyword">const</span> u_Sampler <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ShadowMap&#39;</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">//\u76F8\u673A\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  <span class="token keyword">const</span> u_PvMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_PvMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pvMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//\u706F\u5149\u7684\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  <span class="token keyword">const</span> u_PvMatrixLight <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_PvMatrixLight&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_PvMatrixLight<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> pvMatrixLight<span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u4E09\u89D2\u5F62\u7684\u6A21\u578B\u77E9\u9635</span>
  <span class="token keyword">const</span> u_ModelMatrix <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>u_ModelMatrix<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u7ED8\u5236\u4E09\u89D2\u5F62</span>
  <span class="token function">drawObj</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> triangleVertice<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

  <span class="token comment">// \u7ED8\u5236\u5E73\u9762</span>
  <span class="token function">drawObj</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> floorVertice<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>\u4E0A\u9762\u7684\u7ED8\u56FE\u903B\u8F91\u4E4B\u524D\u90FD\u8BF4\u8FC7\uFF0C\u6240\u4EE5\u5C31\u4E0D\u518D\u8D58\u8FF0\u4E86\u3002</p><h3 id="_3-\u63D0\u9AD8\u6DF1\u5EA6\u6570\u636E\u7684\u7CBE\u5EA6" tabindex="-1"><a class="header-anchor" href="#_3-\u63D0\u9AD8\u6DF1\u5EA6\u6570\u636E\u7684\u7CBE\u5EA6" aria-hidden="true">#</a> 3.\u63D0\u9AD8\u6DF1\u5EA6\u6570\u636E\u7684\u7CBE\u5EA6</h3><p>\u5F53\u7740\u8272\u70B9\u95F4\u7684\u6DF1\u5EA6\u5DEE\u5F02\u8F83\u5C0F\uFF0C\u5728gl_FragColor\u76841/256\u7684\u7CBE\u5EA6\u4E0B\uFF0C\u53EF\u80FD\u5C31\u96BE\u4EE5\u5176\u6DF1\u5EA6\u5DEE\u5F02\u3002</p><p>\u6BD4\u5982\uFF0C\u6211\u628A\u4E4B\u524D\u7684\u5149\u6E90\u9AD8\u5EA6\u8C03\u9AD8\uFF0C\u9634\u5F71\u5C31\u4F1A\u6D88\u5931\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ca+`" alt=""></p><p>\u5BF9\u4E8E\u8FD9\u79CD\u95EE\u9898\uFF0C\u53EF\u4EE5\u901A\u8FC7\u628A\u6DF1\u5EA6\u6570\u636E\u5B58\u50A8\u5230gl_FragColor \u7684\u6240\u6709\u5206\u91CF\u91CC\uFF0C\u4ECE\u800C\u63D0\u9AD8\u6DF1\u5EA6\u6570\u636E\u7684\u5B58\u50A8\u7CBE\u5EA6\u3002</p><h4 id="_3-1\u7B97\u6CD5" tabindex="-1"><a class="header-anchor" href="#_3-1\u7B97\u6CD5" aria-hidden="true">#</a> 3.1\u7B97\u6CD5</h4><p>1/256\u7684\u7CBE\u5EA6\u4E0D\u592A\u76F4\u89C2\uFF0C\u62FF1/10\u7684\u7CBE\u5EA6\u4E3E\u4F8B\u5B50\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u6DF1\u5EA6n=0.1234</li><li>\u56DB\u7EF4\u5411\u91CFv(r,g,b,a)</li><li>\u5411\u91CFv \u4E2D\u6BCF\u4E2A\u5206\u91CF\u7684\u7CBE\u5EA6\u90FD\u662F1/10</li></ul><p><code>\u6C42</code>\uFF1A</p><ul><li>\u5728\u4E0D\u4E22\u5931\u6570\u636E\u7684\u524D\u63D0\u4E0B\uFF0C\u5C06\u5B9E\u6570n \u5B58\u5165\u5411\u91CFv \u7684\u65B9\u6CD5</li><li>\u4ECE\u5411\u91CFv \u4E2D\u8BFB\u53D6\u5B8C\u6574\u6570\u636E\u7684\u65B9\u6CD5</li></ul><p><code>\u601D\u8DEF</code>\uFF1A</p><p>\u6839\u636E\u5DF2\u77E5\u6761\u4EF6\u53EF\u77E5\uFF0C\u5411\u91CFv\u4E2D\u7684\u6BCF\u4E2A\u5206\u91CF\u53EA\u80FD\u5B58\u50A8\u5C0F\u6570\u70B9\u540E\u7684\u4E00\u4F4D\u6570\uFF0C\u53730.0\u52300.9\u3002<br> \u82E5\u6211\u4EEC\u7ED9v.x\u4E00\u4E2A0.11\u7684\u6570\u5B57\uFF0C\u90A3\u4E48\u5411\u91CFv \u4F1A\u5C060.11 \u89E3\u6790\u4E3A\u5C0F\u6570\u70B9\u540E\u7684\u4E00\u4F4D\u6570\u3002<br> \u81F3\u4E8E\u89E3\u6790\u65B9\u5F0F\u662F\u56DB\u820D\u4E94\u5165\u3001\u8FD8\u662F\u94F6\u884C\u5BB6\u820D\u5165\uFF0C\u90A3\u90FD\u4E0D\u91CD\u8981\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u77E5\u9053\u5411\u91CFv\u4E2D\u7684\u6BCF\u4E2A\u5206\u91CF\u53EA\u80FD\u5B58\u50A8\u5C0F\u6570\u70B9\u540E\u7684\u4E00\u4F4D\u6570\u5373\u53EF\u3002<br> \u6839\u636E\u76EE\u6D4B\uFF0C\u53EF\u4EE5\u77E5\u9053\uFF0C\u5C06\u5B9E\u6570n \u5C0F\u6570\u70B9\u540E\u76841,2,3,4 \u5206\u522B\u5B58\u5165\u5411\u91CFv \u5373\u53EF\uFF0C\u56E0\u6B64v=(0.1,0.2,0.3,0.4)</p><p><code>\u89E3</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>

b<span class="token operator">=</span>n<span class="token operator">*</span>a
b<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.1234</span><span class="token punctuation">,</span> <span class="token number">1.234</span><span class="token punctuation">,</span> <span class="token number">12.34</span><span class="token punctuation">,</span> <span class="token number">123.4</span><span class="token punctuation">)</span>

c<span class="token operator">=</span><span class="token function">fract</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.1234</span><span class="token punctuation">,</span> <span class="token number">0.234</span><span class="token punctuation">,</span> <span class="token number">0.34</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span>

d<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

e<span class="token operator">=</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>gba<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span>d
e<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.0234</span><span class="token punctuation">,</span> <span class="token number">0.034</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

v<span class="token operator">=</span>c<span class="token operator">-</span>e
v<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>\u4E0A\u9762\u7684\u8FD0\u7B97\u8FC7\u7A0B\uFF0C\u5C31\u662F\u5728\u4E0D\u4E22\u5931\u6570\u636E\u7684\u524D\u63D0\u4E0B\uFF0C\u5C06\u5B9E\u6570n \u5B58\u5165\u5411\u91CFv \u7684\u65B9\u6CD5\u3002<br> \u63A5\u4E0B\u6765\uFF0C\u518D\u4ECE\u5411\u91CFv \u4E2D\u63D0\u53D6\u5B8C\u6574\u6570\u636E\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">/</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span>

n<span class="token operator">=</span>v\xB7a
n<span class="token operator">=</span><span class="token number">0.1</span><span class="token operator">+</span><span class="token number">0.02</span><span class="token operator">+</span><span class="token number">0.003</span><span class="token operator">+</span><span class="token number">0.0004</span>
n<span class="token operator">=</span><span class="token number">0.1234</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u8FD9\u5C31\u662F\u628A\u4E00\u4E2A\u5B9E\u6570\u5B58\u5165\u7279\u5B9A\u7CBE\u5EA6\u7684\u5411\u91CF\uFF0C\u5E76\u53D6\u51FA\u7684\u65B9\u6CD5\u3002<br> \u5F53\u5411\u91CFv \u4E2D\u6BCF\u4E2A\u5206\u91CF\u7684\u7CBE\u5EA6\u4E0D\u662F1/10\uFF0C\u800C\u662F256 \u7684\u65F6\u5019\uFF0C\u53EA\u8981\u5C0610 \u66FF\u6362\u6210256 \u5373\u53EF\u3002</p><h4 id="_3-2\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_3-2\u4EE3\u7801" aria-hidden="true">#</a> 3.2\u4EE3\u7801</h4><ol><li>\u5728\u5E27\u7F13\u51B2\u533A\u7ED8\u5236\u6295\u5F71\u8D34\u56FE\u65F6\uFF0C\u628A\u6DF1\u5EA6\u5B58\u5165gl_FragColor \u7684\u6240\u6709\u5206\u91CF\u91CC\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> vec4 bitShift <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>
      <span class="token number">1.0</span><span class="token punctuation">,</span> 
      <span class="token number">256.0</span><span class="token punctuation">,</span> 
      <span class="token number">256.0</span> <span class="token operator">*</span> <span class="token number">256.0</span><span class="token punctuation">,</span> 
      <span class="token number">256.0</span> <span class="token operator">*</span> <span class="token number">256.0</span> <span class="token operator">*</span> <span class="token number">256.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vec4 bitMask <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 depth <span class="token operator">=</span> <span class="token function">fract</span><span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>z <span class="token operator">*</span> bitShift<span class="token punctuation">)</span><span class="token punctuation">;</span>
    depth <span class="token operator">-=</span> depth<span class="token punctuation">.</span>gbaa <span class="token operator">*</span> bitMask<span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span>depth<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>	
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="2"><li>\u5728canvas \u753B\u5E03\u4E0A\u7ED8\u56FE\u65F6\uFF0C\u4ECE\u6295\u5F71\u8D34\u56FE\u4E2D\u63D0\u53D6\u6295\u5F71\u6570\u636E\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_ShadowMap<span class="token punctuation">;</span>
  varying vec4 v_ClipPosLight<span class="token punctuation">;</span>
  bool <span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 fragPos<span class="token operator">=</span><span class="token punctuation">(</span>v_ClipPosLight<span class="token punctuation">.</span>xyz<span class="token operator">/</span>v_ClipPosLight<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    vec4 shadowFrag <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_ShadowMap<span class="token punctuation">,</span> fragPos<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vec4 bitShift <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>
      <span class="token number">1.0</span><span class="token punctuation">,</span> 
      <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">,</span> 
      <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    float depth <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>shadowFrag<span class="token punctuation">,</span> bitShift<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fragPos<span class="token punctuation">.</span>z<span class="token operator">&gt;</span>depth<span class="token operator">+</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float darkness<span class="token operator">=</span><span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">0.7</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>darkness<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>\u8FD9\u6837\u5C31\u53EF\u4EE5\u6B63\u5E38\u7ED8\u5236\u51FA\u6295\u5F71\uFF1A<br><img src="`+v+`" alt=""></p><p>\u5E27\u7F13\u51B2\u533A\u4EE5\u53CA\u5E27\u7F13\u51B2\u533A\u5728\u6295\u5F71\u4E2D\u7684\u5E94\u7528\u5C31\u8BF4\u5230\u8FD9\uFF0C\u63A5\u4E0B\u6765\u5C01\u88C5\u4E2A\u5E27\u7F13\u51B2\u533A\u51FA\u6765\u3002</p><h3 id="_4-\u5E27\u7F13\u51B2\u533A\u7684\u5C01\u88C5" tabindex="-1"><a class="header-anchor" href="#_4-\u5E27\u7F13\u51B2\u533A\u7684\u5C01\u88C5" aria-hidden="true">#</a> 4.\u5E27\u7F13\u51B2\u533A\u7684\u5C01\u88C5</h3><p>\u5E27\u7F13\u51B2\u533A\u548C\u4E4B\u524D\u5EFA\u7ACB\u7684 Scene \u573A\u666F\u5BF9\u8C61\u662F\u5DEE\u4E0D\u591A\u7684\u3002\u53EA\u662F\u5728\u5176\u57FA\u7840\u4E0A\uFF0C\u8981\u989D\u5916\u544A\u8BC9webgl\uFF0C\u5728\u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u4E0D\u8981\u518D\u753B\u5230canvas \u753B\u5E03\u4E0A\u4E86\uFF0C\u800C\u662F\u8981\u753B\u5230\u5E27\u7F13\u51B2\u533A\u91CC\u3002</p><p>\u6240\u4EE5\uFF0C\u53EF\u4EE5\u5EFA\u7ACB\u4E00\u4E2AFrame \u5BF9\u8C61\uFF0C\u7EE7\u627F\u81EA Scene\u5BF9\u8C61\uFF0C\u7136\u540E\u518D\u4E3A\u5176\u65B0\u589E\u5E27\u7F13\u51B2\u533A\u76F8\u5173\u7684\u65B9\u6CD5\u3002</p><h4 id="_4-1\u5B8C\u5584scene-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_4-1\u5B8C\u5584scene-\u5BF9\u8C61" aria-hidden="true">#</a> 4.1\u5B8C\u5584Scene \u5BF9\u8C61</h4><ol><li>\u5148\u7ED9Scene \u5BF9\u8C61\u6DFB\u52A0\u4E24\u4E2A\u5C5E\u6027\uFF1A</li></ol><ul><li>backgroundColor \u80CC\u666F\u8272</li><li>depthTest \u662F\u5426\u5F00\u542F\u6DF1\u5EA6\u6D4B\u8BD5</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">depthTest</span><span class="token operator">:</span><span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u4E4B\u524D\u662F\u628A\u8FD9\u4E24\u4E2A\u5C5E\u6027\u5199\u5728Scene\u5916\u9762\u7684\uFF0C\u4F46\u6709\u4E86\u5E27\u7F13\u51B2\u533A\u540E\uFF0C\u8FD9\u5C31\u4E0D\u5408\u9002\u4E86\u3002\u6BD4\u5982\uFF0C\u5E27\u7F13\u51B2\u533A\u548CScene \u5BF9\u8C61\u53EF\u80FD\u6709\u4E24\u79CD\u4E0D\u4E00\u6837\u7684\u80CC\u666F\u8272\u3002</p><ol start="2"><li>\u5728\u7ED8\u56FE\u65B9\u6CD5\u4E2D\uFF0C\u66F4\u65B0\u80CC\u666F\u8272\u548C\u6DF1\u5EA6\u6D4B\u8BD5\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span> children2Draw<span class="token punctuation">,</span> programs<span class="token punctuation">,</span>backgroundColor<span class="token punctuation">,</span>depthTest <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token operator">...</span>backgroundColor<span class="token punctuation">)</span>
  depthTest <span class="token operator">?</span> gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span> <span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span>
	\u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4-2\u5EFA\u7ACBframe-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_4-2\u5EFA\u7ACBframe-\u5BF9\u8C61" aria-hidden="true">#</a> 4.2\u5EFA\u7ACBFrame \u5BF9\u8C61</h4><p>Frame.js \u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./Scene.js&#39;</span>

<span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">texture</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">framebuffer</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">depthbuffer</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Frame</span> <span class="token keyword">extends</span> <span class="token class-name">Scene</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>attr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u521D\u59CB\u5316\u5E27\u7F13\u51B2\u533A</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>framebuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>depthbuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createRenderbuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u66F4\u65B0\u5316\u5E27\u7F13\u51B2\u533A</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// \u7EB9\u7406\u5BF9\u8C61</span>
    gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>texture<span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
      width<span class="token punctuation">,</span> height<span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u5E27\u7F13\u51B2\u533A</span>
    gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>framebuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>texture<span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// \u6E32\u67D3\u7F13\u51B2\u533A\uFF0C\u5B58\u50A8\u6DF1\u5EA6\u6570\u636E</span>
    gl<span class="token punctuation">.</span><span class="token function">bindRenderbuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depthbuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">renderbufferStorage</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_COMPONENT16</span><span class="token punctuation">,</span>
      width<span class="token punctuation">,</span> height
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">framebufferRenderbuffer</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_ATTACHMENT</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>depthbuffer
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// \u89C6\u53E3\u5C3A\u5BF8</span>
    gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">//\u6E05\u7406\u7F13\u51B2\u533A\uFF0C\u91CD\u7F6E\u89C6\u53E3</span>
  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">canvas</span><span class="token operator">:</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span>height<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">=</span>gl
    gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindRenderbuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">RENDERBUFFER</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p>\u5C5E\u6027\uFF1A</p><ul><li>texture \u7EB9\u7406\u5BF9\u8C61</li><li>framebuffer \u5E27\u7F13\u51B2\u533A</li><li>depthbuffer \u6DF1\u5EA6\u7F13\u51B2\u533A</li><li>width \u7EB9\u7406\u5BF9\u8C61\u7684\u5BBD\u5EA6</li><li>height \u7EB9\u7406\u5BF9\u8C61\u7684\u9AD8\u5EA6</li></ul><p>\u65B9\u6CD5\uFF1A</p><ul><li>init() \u521D\u59CB\u5316</li><li>update() \u7ED1\u5B9A\u5E27\u7F13\u51B2\u533A</li><li>reset() \u6E05\u7406\u7F13\u51B2\u533A\uFF0C\u91CD\u7F6E\u89C6\u53E3</li><li>draw() \u7ED8\u56FE\u65B9\u6CD5</li></ul><p>Frame\u5BF9\u8C61\u6267\u884C\u4E86draw() \u65B9\u6CD5\u540E\uFF0C\u4FBF\u53EF\u4EE5\u5C06\u6E32\u67D3\u7ED3\u679C\u5B58\u50A8\u5230texture \u5BF9\u8C61\u91CC\u3002</p><p>\u4E4B\u540E\u5728canvas \u753B\u5E03\u4E2D\u7ED8\u56FE\u7684\u65F6\u5019\uFF0C\u9700\u8981texture \u4EA4\u7ED9Scene\u573A\u666F\u4E2D\u4E09\u7EF4\u7269\u4F53\u7684Mat\u5BF9\u8C61\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> mat<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>\u2026\u2026<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maps</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">u_ShadowMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">texture</span><span class="token operator">:</span> frame<span class="token punctuation">.</span>texture
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u4EE5\u524D\u5728 maps \u4E2D\u662F\u901A\u8FC7 image \u56FE\u50CF\u6E90\u5EFA\u7ACB\u7684 texture \u7EB9\u7406\u5BF9\u8C61\uFF0C\u800C\u73B0\u5728 texture \u7EB9\u7406\u5BF9\u8C61\u5DF2\u7ECF\u6709\u4E86\uFF0C\u6240\u9700\u8981\u5BF9\u4E4B\u524D\u7684Mat \u6750\u8D28\u5BF9\u8C61\u4E5F\u505A\u4E0B\u8C03\u6574\u3002</p><h4 id="_4-3\u8C03\u6574mat-\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_4-3\u8C03\u6574mat-\u5BF9\u8C61" aria-hidden="true">#</a> 4.3\u8C03\u6574Mat \u5BF9\u8C61</h4><ol><li>\u5728init() \u521D\u59CB\u5316\u65B9\u6CD5\u4E2D\uFF0C\u82E5map\u8D34\u56FE\u6CA1\u6709texture \u7EB9\u7406\u5BF9\u8C61\uFF0C\u518D\u53BB\u5EFA\u7ACB\u7EB9\u7406\u5BF9\u8C61\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">.</span>texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      map<span class="token punctuation">.</span>texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateMap</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>map<span class="token punctuation">,</span>ind<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>\u5728updateMap() \u65B9\u6CD5\u4E2D\uFF0C\u82E5image \u56FE\u50CF\u6E90\u5B58\u5728\uFF0C\u518D\u6267\u884C\u56FE\u50CF\u6E90\u7684\u8BBE\u7F6E\u65B9\u6CD5\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateMap</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  image<span class="token operator">&amp;&amp;</span>gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>
    gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
    format<span class="token punctuation">,</span>
    format<span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
    image
  <span class="token punctuation">)</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>\u5B8C\u6210\u4E86\u5E27\u7F13\u51B2\u533A\u7684\u5C01\u88C5\uFF0C\u63A5\u4E0B\u6765\u5C06\u5176\u5B9E\u4F8B\u5316\uFF0C\u6D4B\u8BD5\u4E00\u4E0B\u3002</p><h4 id="_4-4\u5B9E\u4F8B\u5316\u5E27\u7F13\u51B2\u533A\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_4-4\u5B9E\u4F8B\u5316\u5E27\u7F13\u51B2\u533A\u5BF9\u8C61" aria-hidden="true">#</a> 4.4\u5B9E\u4F8B\u5316\u5E27\u7F13\u51B2\u533A\u5BF9\u8C61</h4><p>\u53EF\u4EE5\u5728\u4E4B\u524D\u9525\u5F62\u706F\u7684\u57FA\u7840\u4E0A\uFF0C\u4E3A\u5C0F\u7403\u6DFB\u52A0\u4E00\u4E2A\u6295\u5F71\uFF0C\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ia+`" alt=""></p><ol><li>\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- \u5728\u5E27\u7F13\u51B2\u533A\u7ED8\u5236\u6295\u5F71\u8D34\u56FE --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vShadow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position<span class="token operator">=</span>u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fShadow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> vec4 bitShift <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>
      <span class="token number">1.0</span><span class="token punctuation">,</span> 
      <span class="token number">256.0</span><span class="token punctuation">,</span> 
      <span class="token number">256.0</span> <span class="token operator">*</span> <span class="token number">256.0</span><span class="token punctuation">,</span> 
      <span class="token number">256.0</span> <span class="token operator">*</span> <span class="token number">256.0</span> <span class="token operator">*</span> <span class="token number">256.0</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vec4 bitMask <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 depth <span class="token operator">=</span> <span class="token function">fract</span><span class="token punctuation">(</span>gl_FragCoord<span class="token punctuation">.</span>z <span class="token operator">*</span> bitShift<span class="token punctuation">)</span><span class="token punctuation">;</span>
    depth <span class="token operator">-=</span> depth<span class="token punctuation">.</span>gbaa <span class="token operator">*</span> bitMask<span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span>depth<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Blinn-Phong --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  \u2026\u2026
  uniform mat4 u_PvMatrixLight<span class="token punctuation">;</span>
  varying vec4 v_ClipPosLight<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    \u2026\u2026
    v_ClipPosLight<span class="token operator">=</span>u_PvMatrixLight<span class="token operator">*</span>worldPos<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  \u2026\u2026   
  <span class="token comment">//\u6295\u5F71\u8D34\u56FE</span>
  uniform sampler2D u_ShadowMap<span class="token punctuation">;</span>
  <span class="token comment">//\u5F53\u524D\u7740\u8272\u70B9\u5728\u706F\u5149\u91CC\u7684\u88C1\u526A\u5750\u6807</span>
  varying vec4 v_ClipPosLight<span class="token punctuation">;</span>
  
  <span class="token comment">//\u5F53\u524D\u7740\u8272\u70B9\u662F\u5426\u5728\u6295\u5F71\u4E2D</span>
  bool <span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 fragPos<span class="token operator">=</span><span class="token punctuation">(</span>v_ClipPosLight<span class="token punctuation">.</span>xyz<span class="token operator">/</span>v_ClipPosLight<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2.0</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    vec4 shadowFrag <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_ShadowMap<span class="token punctuation">,</span> fragPos<span class="token punctuation">.</span>xy<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> vec4 bitShift <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>
      <span class="token number">1.0</span><span class="token punctuation">,</span> 
      <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">256.0</span><span class="token punctuation">,</span> 
      <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">256.0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    float depth <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>shadowFrag<span class="token punctuation">,</span> bitShift<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> fragPos<span class="token punctuation">.</span>z<span class="token operator">&gt;</span>depth<span class="token operator">+</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">256.0</span><span class="token operator">*</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    \u2026\u2026
    <span class="token comment">//\u6295\u5F71</span>
    float darkness<span class="token operator">=</span><span class="token function">isInShadow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token number">0.4</span><span class="token operator">:</span><span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token comment">//\u7740\u8272\u70B9\u989C\u8272</span>
    vec3 color<span class="token operator">=</span>intensity<span class="token operator">*</span>darkness<span class="token operator">*</span><span class="token punctuation">(</span>diffuse<span class="token operator">+</span>specular<span class="token punctuation">)</span><span class="token operator">+</span>u_Ka<span class="token punctuation">;</span>
    
    gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><ol start="2"><li>\u5F15\u5165\u7F13\u51B2\u533A\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Frame <span class="token keyword">from</span> <span class="token string">&#39;./lv/Frame.js&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>\u5EFA\u7ACBwebgl\u4E0A\u4E0B\u6587\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//gl.clearColor(0.0, 0.0, 0.0, 1.0);</span>
<span class="token comment">//gl.enable(gl.DEPTH_TEST);</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>\u5EFA\u7ACB\u76F8\u673A\u548C\u76F8\u673A\u8F68\u9053</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">//\u89C6\u70B9</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span>
<span class="token punctuation">]</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
<span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="5"><li>\u5B9E\u4F8B\u5316\u7403\u4F53\u548C\u5E55\u5E03</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* \u7403\u4F53 */</span>
<span class="token keyword">const</span> sphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sphere</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> vertices<span class="token punctuation">,</span> indexes<span class="token punctuation">,</span>normals <span class="token punctuation">}</span> <span class="token operator">=</span> sphere
<span class="token comment">//\u7403\u4F53\u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">const</span> sphereMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> sphere<span class="token punctuation">.</span>r<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">/* \u5E55\u5E03 */</span>
<span class="token keyword">const</span> backdrop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Backdrop</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">// \u5E55\u5E03\u6A21\u578B\u77E9\u9635</span>
<span class="token keyword">const</span> backMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="6"><li>\u7528\u900F\u89C6\u76F8\u673A\u5EFA\u7ACB\u706F\u5149\u5BF9\u8C61\uFF0C\u5E76\u4ECE\u4E2D\u83B7\u53D6\u900F\u89C6\u89C6\u56FE\u77E9\u9635\uFF0C\u5B58\u5165\u706F\u5149\u6570\u636E\u4E2D\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> ratio<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>u_LightPos<span class="token punctuation">)</span>
light<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>u_LightTarget<span class="token punctuation">)</span>
light<span class="token punctuation">.</span><span class="token function">updateMatrixWorld</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> pvMatrixLight <span class="token operator">=</span> light<span class="token punctuation">.</span>projectionMatrix<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>matrixWorldInverse<span class="token punctuation">)</span>

<span class="token comment">// \u706F\u5149\u6570\u636E</span>
<span class="token keyword">const</span> lightData <span class="token operator">=</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token literal-property property">u_PvMatrixLight</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> pvMatrixLight<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="7"><li>\u5B9E\u4F8B\u5316\u5E27\u7F13\u51B2\u533A\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5E27\u7F13\u51B2\u533A</span>
<span class="token keyword">const</span> frame <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Frame</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
frame<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;shadow&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vShadow&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fShadow&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="8"><li>\u5B9E\u4F8B\u5316\u573A\u666F\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// \u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    \u2026\u2026
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      \u2026\u2026
      <span class="token string">&#39;u_PvMatrixLight&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ShadowMap&#39;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="9"><li>\u5EFA\u7ACB\u7403\u4F53\u548C\u5E55\u5E03\u6240\u5BF9\u5E94\u7684Geo\u548CMat</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u7403\u4F53</span>
<span class="token keyword">const</span> matSphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> sphereMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>cameraData<span class="token punctuation">,</span>
    <span class="token operator">...</span>lightData<span class="token punctuation">,</span>
    <span class="token operator">...</span>matData
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoSphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> normals<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u5E55\u5E03</span>
<span class="token keyword">const</span> matBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;Blinn-Phong&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> backMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>cameraData<span class="token punctuation">,</span>
    <span class="token operator">...</span>lightData<span class="token punctuation">,</span>
    <span class="token operator">...</span>matData
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> backdrop<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Normal</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> backdrop<span class="token punctuation">.</span>normals<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> backdrop<span class="token punctuation">.</span>indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><ol start="10"><li>\u57FA\u4E8E\u7403\u4F53\u548C\u5E55\u5E03\u6240\u5BF9\u5E94\u7684Geo\u548CMat\uFF0C\u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u5236\u6295\u5F71\u8D34\u56FE\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5728\u5E27\u7F13\u51B2\u533A\u4E2D\u7ED8\u56FE</span>
frame<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> geoSphere<span class="token punctuation">.</span>data<span class="token punctuation">.</span>a_Position<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">index</span><span class="token operator">:</span> geoSphere<span class="token punctuation">.</span>index
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;shadow&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> matSphere<span class="token punctuation">.</span>data<span class="token punctuation">.</span>u_ModelMatrix<span class="token punctuation">,</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> matSphere<span class="token punctuation">.</span>data<span class="token punctuation">.</span>u_PvMatrixLight<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> geoBack<span class="token punctuation">.</span>data<span class="token punctuation">.</span>a_Position<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">index</span><span class="token operator">:</span> geoBack<span class="token punctuation">.</span>index
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;shadow&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> matBack<span class="token punctuation">.</span>data<span class="token punctuation">.</span>u_ModelMatrix<span class="token punctuation">,</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> matBack<span class="token punctuation">.</span>data<span class="token punctuation">.</span>u_PvMatrixLight<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
frame<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ol start="11"><li>\u5C06\u5E27\u7F13\u51B2\u533A\u91CC\u7684\u7EB9\u7406\u5BF9\u8C61\u4EA4\u7ED9\u7403\u4F53\u548C\u5E55\u5E03\u7684\u6750\u8D28\u5BF9\u8C61\uFF0C\u7528\u4E8E\u6E32\u67D3\u6295\u5F71\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> maps <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">u_ShadowMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">texture</span><span class="token operator">:</span> frame<span class="token punctuation">.</span>texture
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
matSphere<span class="token punctuation">.</span>maps <span class="token operator">=</span> maps
matBack<span class="token punctuation">.</span>maps <span class="token operator">=</span> maps
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="12"><li>\u5728canvas \u753B\u5E03\u4E2D\u7ED8\u56FE\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> objSphere <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoSphere<span class="token punctuation">,</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matSphere <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objSphere<span class="token punctuation">)</span>
<span class="token keyword">const</span> objBack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mat</span><span class="token operator">:</span> matBack<span class="token punctuation">,</span> <span class="token literal-property property">geo</span><span class="token operator">:</span> geoBack <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>objBack<span class="token punctuation">)</span>

<span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="13"><li>\u6211\u4EEC\u4E5F\u53EF\u4EE5\u4E3A\u5C0F\u7403\u6DFB\u52A0\u4E00\u4E2A\u5F39\u8DF3\u52A8\u753B\uFF0C\u6D4B\u8BD5\u4E00\u4E0B\u5F02\u6B65\u6E32\u67D3\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>time <span class="token operator">/</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> sphere<span class="token punctuation">.</span>r
  sphereMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> y
  frame<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">setUniform</span><span class="token punctuation">(</span><span class="token string">&#39;u_Eye&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u5173\u4E8E\u6295\u5F71\u548C\u5E27\u7F13\u51B2\u533A\u7684\u7528\u6CD5\uFF0C\u5C31\u5148\u8BF4\u5230\u8FD9\u3002<br> \u5BF9\u4E8E\u6295\u5F71\u7684\u6A21\u7CCA\uFF0C\u4EE5\u53CA\u5E27\u7F13\u51B2\u533A\u7684\u5176\u5B83\u73A9\u6CD5\uFF0C\u7B49\u8D70\u5B8C\u4E86\u6574\u4E2A\u8BFE\u7A0B\uFF0C\u518D\u505A\u6DF1\u5EA6\u5256\u6790\u3002<br> \u5230\u76EE\u524D\u4E3A\u6B62\uFF0C\u90FD\u662F\u7528\u7EAF\u8272\u5B9A\u4E49\u7684\u6A21\u578B\u7684\u53CD\u5C04\u7CFB\u6570\u3002<br> \u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u7EB9\u7406\u662F\u4E0D\u53EF\u6216\u7F3A\u7684\uFF0C\u56E0\u6B64\u8FD8\u9700\u8981\u8BF4\u4E00\u4E0B\u7EB9\u7406\u6620\u5C04\u3002</p><h2 id="\u4E8C\u5341\u516D\u3001\u7EB9\u7406\u6620\u5C04" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u5341\u516D\u3001\u7EB9\u7406\u6620\u5C04" aria-hidden="true">#</a> \u4E8C\u5341\u516D\u3001\u7EB9\u7406\u6620\u5C04</h2><p>\u7EB9\u7406\u6620\u5C04\u5C31\u662F\u5C06\u7EB9\u7406\u4E2D\u7684\u50CF\u7D20\u6620\u5C04\u5230\u6A21\u578B\u76F8\u5E94\u4F4D\u7F6E\u7684\u7740\u8272\u70B9\u4E0A\u3002<br> \u7EB9\u7406\u4E2D\u6240\u5B58\u50A8\u7684\u50CF\u7D20\u4FE1\u606F\uFF0C\u53EF\u4EE5\u7528\u6765\u8868\u793A\u6A21\u578B\u7684\u6F2B\u53CD\u5C04\u3001\u955C\u9762\u53CD\u5C04\u3001\u900F\u660E\u5EA6\u3001\u51F9\u51F8\u7B49\u3002<br> \u7EB9\u7406\u6620\u5C04\u662F\u901A\u8FC7UV \u5750\u6807\u5B9E\u73B0\u7684\u3002<br> \u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u82E5\u6A21\u578B\u662F\u7531\u5EFA\u6A21\u5E08\u63D0\u4F9B\u7684\uFF0C\u90A3\u6211\u4EEC\u53EF\u4EE5\u8DDF\u4ED6\u8981\u4E00\u4EFD\u8D34\u56FE\u7684 UV \u5750\u6807\u3002<br> \u7136\u800C\uFF0C\u6709\u4E9B\u6A21\u578B\u662F\u9700\u8981\u6211\u4EEC\u52A8\u6001\u5EFA\u6A21\u7684\uFF0C\u8FD9\u79CD\u6A21\u578B\u6240\u9700\u7684 UV \u5750\u6807\u5C31\u9700\u8981\u6211\u4EEC\u81EA\u5DF1\u6765\u8BA1\u7B97\u4E86\u3002</p><p>\u63A5\u4E0B\u6765\u8BF4\u4E24\u4E2A\u5E38\u89C1\u7EB9\u7406\u6620\u5C04\u3002</p><h3 id="_1-\u7B49\u8DDD\u5706\u67F1\u6295\u5F71" tabindex="-1"><a class="header-anchor" href="#_1-\u7B49\u8DDD\u5706\u67F1\u6295\u5F71" aria-hidden="true">#</a> 1.\u7B49\u8DDD\u5706\u67F1\u6295\u5F71</h3><h4 id="_1-1\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1-1\u6982\u5FF5" aria-hidden="true">#</a> 1.1\u6982\u5FF5</h4><p>\u4E4B\u524D\u753B\u8FC7\u4E00\u4E2A\u7403\u4F53\uFF1A<br><img src="`+g+'" alt=""></p><p>\u7136\u540E\u4ECE\u57FA\u7EF4\u767E\u79D1\u4E0A\u627E\u4E86\u4E00\u5F20\u5730\u7403\u7684\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u8D34\u56FE\uFF1A<br><img src="'+La+'" alt=""></p><p>\u63A5\u4E0B\u6765\u4FBF\u53EF\u4EE5\u5229\u7528\u7B49\u8DDD\u6295\u5F71\u89C4\u5219\u628A\u4E0A\u9762\u7684\u8D34\u56FE\u8D34\u5230\u7403\u4F53\u4E0A\uFF1A<br><img src="'+y+'" alt=""></p><p>\u5B9E\u73B0\u4E0A\u9762\u8FD9\u4E2A\u6548\u679C\u7684\u5173\u952E\u5C31\u662F\u7EB9\u7406\u6620\u5C04\uFF0C\u6211\u6240\u4F7F\u7528\u7684\u7EB9\u7406\u6620\u5C04\u65B9\u6CD5\u5C31\u662F\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u3002<br> \u7B49\u8DDD\u7684\u610F\u601D\u5C31\u662F\u4E0A\u9762\u7684\u8D34\u56FE\u91CC\uFF0C\u6BCF\u4E2A\u683C\u5B50\u7684\u5BBD(\u7EAC\u7EBF)\u3001\u9AD8(\u7ECF\u7EBF)\u5C3A\u5BF8\u90FD\u662F\u76F8\u7B49\u7684\u3002<br> \u5706\u67F1\u6295\u5F71\u7684\u610F\u601D\u662F\uFF0C\u7528\u5706\u67F1\u5305\u88F9\u7403\u4F53\uFF0C\u5706\u67F1\u7684\u9762\u4E0E\u7403\u4F53\u76F8\u5207\u3002\u5728\u7403\u4F53\u4E2D\u5FC3\u653E\u4E00\u4E2A\u70B9\u5149\u6E90\uFF0C\u70B9\u5149\u6E90\u4F1A\u628A\u7403\u4F53\u6295\u5C04\u5230\u5706\u67F1\u4E0A\uFF0C\u4ECE\u800C\u5F97\u5230\u7403\u4F53\u7684\u5706\u67F1\u6295\u5F71\u3002<br><img src="'+Oa+'" alt=""></p><p>\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u8D34\u56FE\u4E5F\u53EF\u4EE5\u7406\u89E3\u4E3A\u7403\u4F53\u5C55\u5F00\u540E\u7684\u6837\u5B50\u3002<br><img src="'+Da+'" alt=""></p><p>\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u9664\u4E86\u53EF\u4EE5\u753B\u5730\u7403\uFF0C\u5B83\u5728VR \u4E2D\u4E5F\u5F97\u5230\u4E86\u5E7F\u6CDB\u7684\u5E94\u7528\u3002<br> \u73B0\u5728\u5E02\u9762\u4E0A\u7684720\xB0\u5168\u666F\u76F8\u673A\u62CD\u6444\u51FA\u7684\u5168\u666F\u56FE\u7247\uFF0C\u4E00\u822C\u90FD\u662F\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u56FE\u7247\u3002<br><img src="'+f+'" alt=""></p><p>\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u7684\u8BA1\u7B97\u633A\u7B80\u5355\u7684\uFF0C\u4E4B\u524D\u8BF4\u7403\u5750\u6807\u7CFB\u7684\u65F6\u5019\u5C31\u5DF2\u7ECF\u4E3A\u5176\u6253\u597D\u4E86\u57FA\u7840\u3002</p><h4 id="_1-2\u5730\u7406\u5750\u6807\u7CFB" tabindex="-1"><a class="header-anchor" href="#_1-2\u5730\u7406\u5750\u6807\u7CFB" aria-hidden="true">#</a> 1.2\u5730\u7406\u5750\u6807\u7CFB</h4><p>\u5730\u7406\u5750\u6807\u7CFB(Geographic coordinate system) \u5C31\u662F\u4E00\u79CD\u7403\u5750\u6807\u7CFB(Spherical coordinate system)\u3002<br> \u5730\u7406\u5750\u6807\u7CFB\u548Cthree.js \u91CC\u7684Spherical \u7403\u5750\u6807\u7CFB\u5DEE\u4E0D\u591A\uFF0C\u53EA\u662F\u5728\u03B8\u548C\u03C6\u7684\u5B9A\u4E49\u4E0A\u7565\u6709\u5DEE\u5F02\u3002</p><p>Spherical \u7403\u5750\u6807\u7CFB\u91CC\u7684\u65B9\u4F4D\u89D2\u03B8\u548C\u6781\u89D2\u03C6\u7684\u5B9A\u4E49\u89C4\u5219\uFF1A</p><ul><li>\u03B8 \u8D77\u59CB\u4E8Ez\u8F74\u7684\u6B63\u534A\u8F74\uFF0C\u9006\u65F6\u9488\u65CB\u8F6C\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\u03B8 \u503C\u8D8A\u5927\uFF0C0 \u2264 \u03B8 &lt; 2\u03C0</li><li>\u03C6 \u8D77\u59CB\u4E8Ey\u8F74\u7684\u6B63\u534A\u8F74\uFF0C\u5411\u4E0B\u65CB\u8F6C\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\u03C6 \u503C\u8D8A\u5927\uFF0C0 \u2264 \u03C6 &lt; \u03C0</li></ul><p>\u4E0B\u56FE\u662F\u5730\u7406\u5750\u6807\u7CFB\uFF1A<br><img src="'+za+'" alt=""></p><ul><li>\u03B8 \u5BF9\u5E94\u7ECF\u5EA6\uFF0C\u8D77\u59CB\u4E8Ex\u8F74\u7684\u6B63\u534A\u8F74\uFF0C\u5373\u672C\u521D\u5B50\u5348\u7EBF\u7684\u4F4D\u7F6E\uFF0C\u03B8=0 <ul><li>\u4ECE0\xB0 \u9006\u65F6\u9488\u65CB\u8F6C\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\u03B8 \u503C\u8D8A\u5927\uFF0C\u65CB\u8F6C\u5230180\xB0\u7ED3\u675F\uFF0C\u662F\u4E3A\u4E1C\u7ECF\uFF0C0 \u2264 \u03B8 &lt; \u03C0</li><li>\u4ECE0\xB0 \u987A\u65F6\u9488\u65CB\u8F6C\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\u03B8 \u503C\u8D8A\u5C0F\uFF0C\u65CB\u8F6C\u5230-180\xB0\u7ED3\u675F\uFF0C\u662F\u4E3A\u897F\u7ECF\uFF0C0 \u2264 \u03B8 &lt; -\u03C0</li></ul></li><li>\u03C6 \u5BF9\u5E94\u7EF4\u5EA6\uFF0C\u8D77\u59CB\u4E8E\u8D64\u9053\uFF0C\u03C6=0 <ul><li>\u4ECE0\xB0 \u5411\u4E0A\u65CB\u8F6C\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\u03C6 \u503C\u8D8A\u5927\uFF0C\u65CB\u8F6C\u523090\xB0\u7ED3\u675F\uFF0C\u662F\u4E3A\u5317\u7EAC\uFF0C0 \u2264 \u03C6 &lt; \u03C0/2</li><li>\u4ECE0\xB0 \u5411\u4E0B\u65CB\u8F6C\uFF0C\u65CB\u8F6C\u91CF\u8D8A\u5927\u03C6 \u503C\u8D8A\u5C0F\uFF0C\u65CB\u8F6C\u5230-90\xB0\u7ED3\u675F\uFF0C\u662F\u4E3A\u5357\u7EAC\uFF0C0 \u2264 \u03C6 &lt; -\u03C0/2</li></ul></li></ul><p>\u5BF9\u4E8E\u5DF2\u77E5\u4E00\u70B9\u7684\u7ECF\u7EAC\u5EA6\uFF0C\u6C42\u6B64\u70B9\u7684\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u4F4D\u7684\u65B9\u6CD5\uFF0C\u4E0A\u56FE\u5DF2\u7ECF\u8BE6\u7EC6\u753B\u51FA\u3002</p><h4 id="_1-3\u7ECF\u7EAC\u5EA6\u4E0E\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u8D34\u56FE\u7684\u7EBF\u6027\u6620\u5C04" tabindex="-1"><a class="header-anchor" href="#_1-3\u7ECF\u7EAC\u5EA6\u4E0E\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u8D34\u56FE\u7684\u7EBF\u6027\u6620\u5C04" aria-hidden="true">#</a> 1.3\u7ECF\u7EAC\u5EA6\u4E0E\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u8D34\u56FE\u7684\u7EBF\u6027\u6620\u5C04</h4><p>\u901A\u8FC7\u4E0A\u9762\u7ECF\u7EAC\u5EA6\u7684\u5B9A\u4E49\u89C4\u5219\uFF0C\u53EF\u4EE5\u77E5\u9053\uFF1A</p><ul><li>\u7ECF\u5EA6\u548CU\u503C\u76F8\u6620\u5C04</li><li>\u7EF4\u5EA6\u548CV\u503C\u76F8\u6620\u5C04</li></ul><p>\u5176\u5177\u4F53\u7684\u6620\u5C04\u6620\u5C04\u65B9\u5F0F\u5982\u4E0B\u56FE\u6240\u793A\uFF1A<br><img src="'+Ua+`" alt=""></p><ul><li>\u7ECF\u5EA6[-\u03C0,\u03C0] \u6620\u5C04u[0,1]</li><li>\u7EF4\u5EA6[-\u03C0/2,\u03C0/2] \u6620\u5C04v[0,1]</li></ul><h4 id="_1-4\u7ED8\u5236\u5730\u7403" tabindex="-1"><a class="header-anchor" href="#_1-4\u7ED8\u5236\u5730\u7403" aria-hidden="true">#</a> 1.4\u7ED8\u5236\u5730\u7403</h4><ol><li>\u5EFA\u7ACB\u4E00\u4E2A\u5730\u7406\u5750\u6807\u7CFBGeography\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u628A\u7ECF\u7EAC\u5EA6\u8F6C\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Vector3<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token comment">/*
\u5C5E\u6027\uFF1A
  r\uFF1A\u534A\u5F84
  longitude\uFF1A\u7ECF\u5EA6(\u5F27\u5EA6)
  latitude\uFF1A\u7EAC\u5EA6(\u5F27\u5EA6)
  position\uFF1A\u4E09\u7EF4\u5750\u6807\u4F4D

\u6784\u9020\u53C2\u6570\uFF1A
  r,longitude,latitude 
  \u6216\u8005
  position
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Geography</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>longitude<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> latitude<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token operator">=</span>r
    <span class="token keyword">this</span><span class="token punctuation">.</span>longitude<span class="token operator">=</span>longitude
    <span class="token keyword">this</span><span class="token punctuation">.</span>latitude <span class="token operator">=</span> latitude
    <span class="token keyword">this</span><span class="token punctuation">.</span>position<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//\u514B\u9686</span>
  <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span> longitude<span class="token punctuation">,</span> latitude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Geography</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//\u8BBE\u7F6E\u534A\u5F84\uFF0C\u66F4\u65B0\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u4F4D</span>
  <span class="token function">setR</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>r <span class="token operator">=</span> r
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//\u6839\u636E\u7ECF\u7EAC\u5EA6\u66F4\u65B0\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u4F4D</span>
  <span class="token function">updatePos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> r<span class="token punctuation">,</span>longitude<span class="token punctuation">,</span>latitude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>latitude<span class="token punctuation">)</span> <span class="token operator">*</span> r
    <span class="token keyword">this</span><span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
      Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>longitude<span class="token punctuation">)</span><span class="token operator">*</span>len<span class="token punctuation">,</span>
      Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>latitude<span class="token punctuation">)</span><span class="token operator">*</span>r<span class="token punctuation">,</span>
      <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>longitude<span class="token punctuation">)</span><span class="token operator">*</span>len
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><ol start="2"><li>\u5EFA\u6A21</li></ol><p>\u4E4B\u524D\u753B\u8FC7\u4E00\u4E2A\u7403\u4F53Sphere.js\uFF0C\u53EA\u4E0D\u8FC7\u8FD9\u4E2A\u7403\u4F53\u7684\u5357\u6781\u548C\u5317\u6781\u5171\u7528\u4E00\u4E2A\u9876\u70B9\uFF0C\u4E0D\u9002\u5408\u505A\u67F1\u72B6\u6295\u5F71\u8D34\u56FE\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u5728\u5176\u57FA\u7840\u4E0A\u518D\u6539\u88C5\u4E00\u4E2A\u7403\u4F53Earth\u51FA\u6765\uFF0C\u8FD9\u4E2AEarth\u5BF9\u8C61\u662F\u6309\u7167\u77E9\u5F62\u7F51\u683C\u5EFA\u6A21\u7684\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A<br><img src="`+Va+`" alt=""></p><p>\u5F53\u524D\u8FD9\u4E2AEarth\u5BF9\u8C61\u662F\u76F4\u63A5\u6309\u7167\u77E9\u5F62\u7F51\u683C\u5EFA\u6A21\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Geography <span class="token keyword">from</span> <span class="token string">&#39;./Geography.js&#39;</span>

<span class="token comment">/*
\u5C5E\u6027\uFF1A
  r\uFF1A\u534A\u5F84
  widthSegments\uFF1A\u6A2A\u5411\u6BB5\u6570\uFF0C\u6700\u5C0F3\u7AEF
  heightSegments\uFF1A\u7EB5\u5411\u6BB5\u6570\uFF0C\u6700\u5C0F2\u7AEF
  vertices\uFF1A\u9876\u70B9\u96C6\u5408
  normals\uFF1A\u6CD5\u7EBF\u96C6\u5408
  indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408
  uv\uFF1Auv\u5750\u6807
  count\uFF1A\u9876\u70B9\u6570\u91CF
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Earth</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">r<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> widthSegments<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> heightSegments<span class="token operator">=</span><span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>r<span class="token operator">=</span>r
    <span class="token keyword">this</span><span class="token punctuation">.</span>widthSegments<span class="token operator">=</span>widthSegments
    <span class="token keyword">this</span><span class="token punctuation">.</span>heightSegments<span class="token operator">=</span>heightSegments
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>r<span class="token punctuation">,</span>widthSegments<span class="token punctuation">,</span> heightSegments <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">//\u7F51\u683C\u7EBF\u7684\u6570\u91CF</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>width<span class="token punctuation">,</span>height<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>widthSegments<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>heightSegments <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">//\u9876\u70B9\u6570\u91CF</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> width<span class="token operator">*</span>height
    <span class="token comment">// theta\u548Cphi\u65B9\u5411\u7684\u65CB\u8F6C\u5F27\u5EA6</span>
    <span class="token keyword">const</span> thetaSize <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> widthSegments
    <span class="token keyword">const</span> phiSize <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> heightSegments

    <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
    <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u6CD5\u7EBF\u96C6\u5408</span>
    <span class="token keyword">const</span> normals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u9876\u70B9\u7D22\u5F15\u96C6\u5408</span>
    <span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">//uv \u5750\u6807\u96C6\u5408</span>
    <span class="token keyword">const</span> uv<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u9010\u884C\u5217\u904D\u5386</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> height<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u7EF4\u5EA6 </span>
      <span class="token keyword">const</span> phi <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span>phiSize <span class="token operator">*</span> y
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u7ECF\u5EA6\uFF0C-Math.PI\u662F\u4E3A\u4E86\u8BA90\xB0\u7ECF\u7EBF\u7ECF\u8FC7x\u8F74\u7684\u6B63\u534A\u8F74</span>
        <span class="token keyword">const</span> theta <span class="token operator">=</span> thetaSize <span class="token operator">*</span> x<span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span>
        <span class="token comment">// \u8BA1\u7B97\u9876\u70B9\u548C\u6CD5\u7EBF</span>
        <span class="token keyword">const</span> vertice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geography</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span>theta<span class="token punctuation">,</span>phi<span class="token punctuation">)</span><span class="token punctuation">.</span>position
        vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>vertice<span class="token punctuation">)</span><span class="token punctuation">)</span>
        normals<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>vertice<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>u<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
          x <span class="token operator">/</span> widthSegments<span class="token punctuation">,</span>
          <span class="token number">1</span><span class="token operator">-</span>y<span class="token operator">/</span>heightSegments
        <span class="token punctuation">]</span>
        uv<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
        <span class="token comment">// \u9876\u70B9\u7D22\u5F15</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u4E00\u4E2A\u77E9\u5F62\u683C\u5B50\u7684\u5DE6\u4E0Alt\u3001\u53F3\u4E0Art\u3001\u5DE6\u4E0Blb\u3001\u53F3\u4E0Brb\u70B9</span>
          <span class="token keyword">const</span> lt <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> width <span class="token operator">+</span> <span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> rt <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> width <span class="token operator">+</span> x
          <span class="token keyword">const</span> lb <span class="token operator">=</span> y <span class="token operator">*</span> width <span class="token operator">+</span> <span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> rb <span class="token operator">=</span> y <span class="token operator">*</span> width <span class="token operator">+</span> x
          indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>lb<span class="token punctuation">,</span> rb<span class="token punctuation">,</span> lt<span class="token punctuation">,</span> lt<span class="token punctuation">,</span> rb<span class="token punctuation">,</span> rt<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>normals<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>uv<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>indexes<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><ol start="3"><li>\u7740\u8272\u5668</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  attribute vec2 a_Pin<span class="token punctuation">;</span>
  uniform mat4 u_PvMatrix<span class="token punctuation">;</span>
  uniform mat4 u_ModelMatrix<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position<span class="token operator">=</span>u_PvMatrix<span class="token operator">*</span>u_ModelMatrix<span class="token operator">*</span>a_Position<span class="token punctuation">;</span>
    v_Pin<span class="token operator">=</span>a_Pin<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform sampler2D u_Sampler<span class="token punctuation">;</span>
  varying vec2 v_Pin<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="3"><li>\u8D34\u56FE</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram<span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;/jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span> PerspectiveCamera<span class="token punctuation">,</span> Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./lv/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span>
<span class="token keyword">import</span> Earth <span class="token keyword">from</span> <span class="token string">&#39;./lv/Earth.js&#39;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
<span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u7403\u4F53</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Earth</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>

<span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//\u89C6\u70B9</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">45</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5</span>
<span class="token punctuation">]</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
<span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span> camera<span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">//\u5730\u7403</span>
<span class="token keyword">const</span> matEarth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoEarth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//\u52A0\u8F7D\u56FE\u7247</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/earth.jpg&#39;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  matEarth<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Sampler <span class="token operator">=</span> <span class="token punctuation">{</span> image <span class="token punctuation">}</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> geoEarth<span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> matEarth
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u8FDE\u7EED\u6E32\u67D3</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+y+'" alt=""></p><p>\u5230\u73B0\u5728\uFF0C\u5E94\u8BE5\u5BF9\u7B49\u8DDD\u5706\u67F1\u6295\u5F71\u6709\u4E86\u4E00\u4E2A\u6574\u4F53\u7684\u8BA4\u77E5\u3002<br> \u63A5\u4E0B\u5C31\u53EF\u4EE5\u518D\u505A\u4E00\u4E0B\u6269\u5C55\uFF0C\u6839\u636E\u7ECF\u7EAC\u5EA6\uFF0C\u4E3A\u67D0\u4E2A\u5730\u70B9\u505A\u6807\u8BB0\u3002</p><h4 id="_1-5\u6807\u8BB0\u70B9" tabindex="-1"><a class="header-anchor" href="#_1-5\u6807\u8BB0\u70B9" aria-hidden="true">#</a> 1.5\u6807\u8BB0\u70B9</h4><p>\u767E\u5EA6\u5730\u56FE\u91CC\u62FF\u5230\u4E86\u5929\u5B89\u95E8\u7684\u7ECF\u7EAC\u5EA6(116.404,39.915)\uFF0C\u5176\u610F\u601D\u5C31\u662F\u4E1C\u7ECF116.404\xB0, \u5317\u7EAC39.915\xB0<br> \u4F7F\u7528Geography \u5BF9\u8C61\u4FBF\u53EF\u4EE5\u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u4F4D\uFF0C\u7136\u540E\u518D\u6839\u636E\u8FD9\u4E2A\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u4F4D\u505A\u4E2A\u6807\u8BB0\u5373\u53EF\u3002<br><img src="'+Na+`" alt=""></p><p>\u6807\u8BB0\u70B9\u7684\u5236\u4F5C\u601D\u8DEF\u6709\u4E24\u79CD\uFF1A</p><ul><li>\u7528<img>\u4E4B\u7C7B\u7684HTML\u6807\u7B7E\u5B9E\u73B0\u3002 <ul><li>\u4F18\u70B9\uFF1A\u5236\u4F5C\u4FBF\u6377\uFF0C\u5C24\u5176\u662F\u8981\u4E3A\u5176\u6DFB\u52A0\u6587\u5B57\u7684\u65F6\u5019\u3002</li><li>\u7F3A\u70B9\uFF1A\u8981\u5C06\u6807\u8BB0\u70B9\u5728webgl \u88C1\u526A\u7A7A\u95F4\u5750\u6807\u4F4D\u8F6C\u6362\u5230css \u5750\u6807\u4F4D\u3002\u9700\u8981\u989D\u5916\u8003\u8651\u6807\u8BB0\u70B9\u4E0E\u6A21\u578B\u7684\u906E\u6321\u95EE\u9898\u3002</li></ul></li><li>\u5728webgl \u4E2D\u5B9E\u73B0\u3002 <ul><li>\u4F18\u70B9\uFF1A\u6807\u8BB0\u70B9\u64CD\u4F5C\u65B9\u4FBF\uFF0C\u6A21\u578B\u906E\u6321\u5B9E\u73B0\u4FBF\u6377\u3002</li><li>\u7F3A\u70B9\uFF1A\u82E5\u6807\u8BB0\u70B9\u4E2D\u5B58\u5728\u6587\u5B57\uFF0C\u9700\u505A\u989D\u5916\u8003\u91CF\u3002</li></ul></li></ul><p>\u5BF9\u4E8E\u6587\u5B57\u6807\u8BB0\u7684\u663E\u793A\u95EE\u9898\uFF0C\u8FD9\u91CC\u5148\u4E0D\u8BF4\uFF0C\u540E\u9762\u4F1A\u5355\u72EC\u8BE6\u89E3\u3002<br> \u63A5\u4E0B\u6765\uFF0C\u5148\u7528webgl \u5728\u5730\u56FE\u4E0A\u663E\u793A\u4E00\u4E2A\u4E0D\u5E26\u6587\u5B57\u7684\u6807\u8BB0\u70B9\u3002</p><ol><li>\u5EFA\u7ACB\u4E00\u4E2A\u77E9\u5F62\u9762\u5BF9\u8C61\uFF0C\u65B9\u4FBF\u4E4B\u540E\u628A\u6807\u8BB0\u70B9\u4F5C\u4E3A\u8D34\u56FE\u8D34\u4E0A\u53BB\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Vector2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token comment">/*
\u5C5E\u6027\uFF1A
  size:\u5C3A\u5BF8
  orign:\u57FA\u70B9\uFF0C\u767E\u5206\u6BD4\uFF0C\u9ED8\u8BA4\u5DE6\u4E0B\u89D2
  vertices\uFF1A\u9876\u70B9\u96C6\u5408
  normals\uFF1A\u6CD5\u7EBF\u96C6\u5408
  indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408
  uv\uFF1Auv\u5750\u6807
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Rect</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">w<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> h<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">0</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>orign<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> size<span class="token punctuation">,</span> orign <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> l<span class="token operator">=</span><span class="token operator">-</span>orign<span class="token punctuation">.</span>x<span class="token operator">*</span>size<span class="token punctuation">.</span>x
    <span class="token keyword">const</span> b <span class="token operator">=</span><span class="token operator">-</span>orign<span class="token punctuation">.</span>y <span class="token operator">*</span> size<span class="token punctuation">.</span>y
    <span class="token keyword">const</span> r<span class="token operator">=</span>size<span class="token punctuation">.</span>x<span class="token operator">+</span>l
    <span class="token keyword">const</span> t<span class="token operator">=</span>size<span class="token punctuation">.</span>y<span class="token operator">+</span>b
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      l<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      r<span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      r<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u57FA\u4E8E\u4E4B\u524D\u5706\u67F1\u6295\u5F71\u6587\u4EF6\u7565\u4F5C\u8C03\u6574\u3002</p><ol start="2"><li>\u5B9E\u4F8B\u5316Rect \u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Rect <span class="token keyword">from</span> <span class="token string">&#39;./lv/Rect.js&#39;</span>
\u2026\u2026
gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
\u2026\u2026
<span class="token comment">// \u77E9\u5F62\u9762</span>
<span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>\u57FA\u4E8E\u5929\u5B89\u95E8\u7ECF\u7EAC\u5EA6\uFF0C\u5EFA\u7ACBGeography \u5BF9\u8C61\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> rad <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
<span class="token keyword">const</span> geography <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geography</span><span class="token punctuation">(</span>
  earth<span class="token punctuation">.</span>r<span class="token punctuation">,</span>
  <span class="token number">116.404</span> <span class="token operator">*</span> rad<span class="token punctuation">,</span>
  <span class="token number">39.915</span> <span class="token operator">*</span> rad
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>\u8BA9\u76F8\u673A\u7684\u89C6\u70B9\u76F4\u89C6\u5929\u95E8\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> eye <span class="token operator">=</span> geography<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setR</span><span class="token punctuation">(</span>earth<span class="token punctuation">.</span>r <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>position
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="5"><li>\u57FA\u4E8E\u6807\u8BB0\u70B9\u7684\u4E09\u7EF4\u76F4\u89D2\u5750\u6807\u4F4D\u6784\u5EFA\u4E00\u4E2A\u6A21\u578B\u77E9\u9635</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>geography<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="6"><li>\u5EFA\u7ACB\u6807\u8BB0\u70B9\u7684Mat\u548CGeo \u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> matMark <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> modelMatrix<span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoMark <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="7"><li>\u5F53\u6240\u6709\u8D34\u56FE\u90FD\u52A0\u8F7D\u6210\u529F\u540E\uFF0C\u5C06\u8D34\u56FE\u4F20\u7ED9\u76F8\u5E94\u7684Mat \u5BF9\u8C61\u3002\u7136\u540E\u5EFA\u7ACB\u5730\u7403\u548C\u6807\u8BB0\u70B9\u6240\u5BF9\u5E94\u7684Obj3D\u5BF9\u8C61\uFF0C\u5C06\u5176\u6DFB\u52A0\u5230Scene \u573A\u666F\u4E2D\uFF0C\u8FDB\u884C\u6E32\u67D3\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u52A0\u8F7D\u56FE\u5F62</span>
<span class="token keyword">const</span> imgPromises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;earth.jpg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mark.png&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
  <span class="token keyword">return</span> <span class="token function">imgPromise</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>imgPromises<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">imgs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  matEarth<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Sampler <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  matMark<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Sampler <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> imgs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span>
  <span class="token punctuation">}</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> geoEarth<span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> matEarth
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> geoMark<span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> matMark
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u8FDE\u7EED\u6E32\u67D3</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">time <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol start="8"><li>\u8BA9\u6807\u8BB0\u70B9\u8D34\u5408\u5230\u5730\u7403\u8868\u9762</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> modelMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>geography<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>
          geography<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
          target<span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u6700\u7EC8\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+Ga+'" alt=""></p><p>\u5728\u5B9E\u9645\u9879\u76EE\u4E2D\uFF0C\u56F4\u7ED5\u5730\u7403\uFF0C\u662F\u53EF\u4EE5\u505A\u5F88\u591A\u4E1C\u897F\u3002<br> \u6BD4\u5982\u5728\u7403\u4F53\u4E0A\u7ED8\u5236\u67F1\u72B6\u56FE\uFF0C\u8868\u793A\u4E0D\u540C\u5730\u533A\u7684\u7ECF\u6D4E\u589E\u957F\u60C5\u51B5\uFF1B<br> \u5728\u4E24\u4E2A\u5730\u70B9\u4E4B\u95F4\u7ED8\u52363D\u8DEF\u5F84\uFF0C\u4EE5\u8868\u793A\u4E24\u5730\u4E4B\u95F4\u5B58\u5728\u7684\u8054\u7CFB\uFF1B<br> \u5BF9\u4E8E\u8FD9\u4E9B\u6548\u679C\uFF0C\u5C31\u5148\u4E0D\u505A\u6269\u5C55\u4E86\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u518D\u628A\u76F8\u673A\u585E\u8FDB\u5730\u7403\u91CC\uFF0C\u505A\u4E00\u4E2AVR\u7684\u6548\u679C\u3002</p><h3 id="_2-vr" tabindex="-1"><a class="header-anchor" href="#_2-vr" aria-hidden="true">#</a> 2.VR</h3><p>VR(Virtual Reality) \u7684\u610F\u601D\u5C31\u662F\u865A\u62DF\u73B0\u5B9E\uFF0C\u53EF\u4EE5\u901A\u8FC7VR \u773C\u955C\u7ED9\u4EBA\u73AF\u5883\u6C89\u6D78\u611F\u3002</p><p>VR \u7684\u5236\u4F5C\u9700\u8981\u8003\u8651\u4E24\u70B9\uFF1A</p><ul><li>\u642D\u5EFA\u573A\u666F\uFF0C\u5F53\u524D\u6BD4\u8F83\u5E38\u89C1\u7684\u642D\u5EFA\u573A\u666F\u7684\u65B9\u6CD5\u5C31\u662F\u5C06\u5168\u666F\u56FE\u8D34\u5230\u7ACB\u65B9\u4F53\uFF0C\u6216\u8005\u7403\u4F53\u4E0A\u3002</li><li>\u573A\u666F\u53D8\u6362\uFF0C\u4E00\u822C\u4F1A\u628A\u900F\u89C6\u76F8\u673A\u585E\u8FDB\u7ACB\u65B9\u4F53\uFF0C\u6216\u8005\u7403\u4F53\u91CC\uFF0C\u7136\u540E\u53D8\u6362\u573A\u666F\u3002</li></ul><p>\u63A5\u4E0B\u6765\u5177\u4F53\u8BF4\u4E00\u4E0B\u5176\u5B9E\u73B0\u6B65\u9AA4\u3002</p><h4 id="_2-1\u642D\u5EFA\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#_2-1\u642D\u5EFA\u573A\u666F" aria-hidden="true">#</a> 2.1\u642D\u5EFA\u573A\u666F</h4><ol><li><p>\u7528720\xB0\u5168\u666F\u76F8\u673A\u62CD\u6444\u4E00\u5F20\u5BA4\u5185\u5168\u666F\u56FE\u3002<br><img src="'+f+`" alt=""></p></li><li><p>\u5728\u4E4B\u524D\u5730\u7403\u6587\u4EF6\u7684\u57FA\u7840\u4E0A\u505A\u4FEE\u6539\uFF0C\u628A\u5730\u56FE\u66FF\u6362\u6210\u4E0A\u9762\u7684\u5BA4\u5185\u5168\u666F\u56FE\u3002</p></li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/room.jpg&#39;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>\u628A\u76F8\u673A\u6253\u5165\u7403\u4F53\u4E4B\u4E2D</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//\u89C6\u70B9</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">60</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+h+`" alt=""></p><p>\u73B0\u5728VR\u7684\u6548\u679C\u5C31\u5DF2\u7ECF\u6709\u4E86\uFF0C\u63A5\u4E0B\u6765\u8FD8\u9700\u8981\u8003\u8651VR \u573A\u666F\u7684\u53D8\u6362\u3002</p><h4 id="_2-2-vr\u573A\u666F\u7684\u53D8\u6362" tabindex="-1"><a class="header-anchor" href="#_2-2-vr\u573A\u666F\u7684\u53D8\u6362" aria-hidden="true">#</a> 2.2 VR\u573A\u666F\u7684\u53D8\u6362</h4><p>VR \u573A\u666F\u7684\u53D8\u6362\u901A\u8FC7\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u4FBF\u53EF\u4EE5\u5B9E\u73B0\u3002<br> \u5F53\u524D\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u5DF2\u7ECF\u5177\u5907\u4E86\u65CB\u8F6C\u3001\u7F29\u653E\u548C\u5E73\u79FB\u529F\u80FD\u3002<br> \u53EA\u4E0D\u8FC7\uFF0C\u9488\u5BF9VR \u8FD8\u5F97\u5BF9\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668\u505A\u4E00\u4E0B\u5FAE\u8C03\u3002</p><ol><li>\u53D6\u6D88\u76F8\u673A\u7684\u5E73\u79FB\uFF0C\u4EE5\u907F\u514D\u76F8\u673A\u8DD1\u5230\u7403\u4F53\u4E4B\u5916\u3002</li></ol><p>\u4E3A\u76F8\u673A\u8F68\u9053\u63A7\u5236\u5668 OrbitControls \u6DFB\u52A0\u4E00\u4E2A\u662F\u5426\u542F\u7528\u5E73\u79FB\u7684\u529F\u80FD\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token literal-property property">enablePan</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5728\u5E73\u79FB\u65B9\u6CD5\u4E2D\uFF0C\u505A\u4E2A\u662F\u5426\u5E73\u79FB\u7684\u5224\u65AD\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">pointermove</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> dragStart<span class="token punctuation">,</span> dragEnd<span class="token punctuation">,</span> state<span class="token punctuation">,</span>enablePan<span class="token punctuation">,</span> <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  dragEnd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;pan&#39;</span><span class="token operator">:</span>
      enablePan<span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">pan</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>dragStart<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    \u2026\u2026
  <span class="token punctuation">}</span>
  dragStart<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dragEnd<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u8FD9\u6837\u5C31\u53EF\u4EE5\u5728\u5B9E\u4F8B\u5316OrbitControls \u5BF9\u8C61\u7684\u65F6\u5019\uFF0C\u5C06enablePan \u8BBE\u7F6E\u4E3Afalse\uFF0C\u4ECE\u800C\u7981\u6B62\u76F8\u673A\u5E73\u79FB\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  camera<span class="token punctuation">,</span>
  target<span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
  <span class="token literal-property property">enablePan</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>\u4F7F\u7528\u900F\u89C6\u76F8\u673A\u7F29\u653EVR \u573A\u666F\u65F6\uFF0C\u4E0D\u518D\u4F7F\u7528\u89C6\u70B9\u5230\u76EE\u6807\u7684\u8DDD\u79BB\u6765\u7F29\u653E\u573A\u666F\uFF0C\u56E0\u4E3A\u8FD9\u6837\u7684\u653E\u5927\u6548\u679C\u4E0D\u592A\u660E\u663E\u3002\u6240\u4EE5\uFF0C\u53EF\u4EE5\u76F4\u63A5\u50CF\u6B63\u4EA4\u76F8\u673A\u90A3\u6837\uFF0C\u7F29\u653E\u88C1\u526A\u9762\u3002</li></ol><p>\u4E3AOrbitControls \u5BF9\u8C61\u7684wheel \u65B9\u6CD5\u6DFB\u52A0\u4E00\u4E2A\u63A7\u5236\u7F29\u653E\u65B9\u5F0F\u7684\u53C2\u6570\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">wheel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> deltaY <span class="token punctuation">}</span><span class="token punctuation">,</span>type<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> zoomScale<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">let</span> scale<span class="token operator">=</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token operator">?</span>zoomScale<span class="token operator">:</span><span class="token number">1</span> <span class="token operator">/</span> zoomScale
  <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dolly</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateSph</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u8FD9\u6837\u5C31\u53EF\u4EE5\u50CF\u7F29\u653E\u6B63\u4EA4\u76F8\u673A\u90A3\u6837\u7F29\u653E\u900F\u89C6\u76F8\u673A\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">&#39;OrthographicCamera&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>\u5728\u7F29\u653E\u7684\u65F6\u5019\uFF0C\u9700\u8981\u9650\u5236\u4E00\u4E0B\u7F29\u653E\u8303\u56F4\uFF0C\u514D\u5F97\u7F29\u653E\u5F97\u592A\u5927\uFF0C\u6216\u8005\u7F29\u5C0F\u5F97\u8D85\u51FA\u4E86\u7403\u4F53\u4E4B\u5916\u3002</li></ol><p>\u4E3AOrbitControls \u6DFB\u52A0\u4E24\u4E2A\u7F29\u653E\u6781\u503C\uFF1A</p><ul><li>minZoom \u7F29\u653E\u7684\u6700\u5C0F\u503C</li><li>maxZoom \u7F29\u653E\u7684\u6700\u5927\u503C</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token literal-property property">minZoom</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maxZoom</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u5728\u76F8\u5E94\u7684\u7F29\u653E\u65B9\u6CD5\u4E2D\uFF0C\u5BF9\u7F29\u653E\u91CF\u505A\u9650\u5236\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">dollyOrthographicCamera</span><span class="token punctuation">(</span><span class="token parameter">dollyScale</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>camera<span class="token punctuation">,</span>maxZoom<span class="token punctuation">,</span>minZoom<span class="token punctuation">}</span><span class="token operator">=</span><span class="token keyword">this</span>
  <span class="token keyword">const</span> zoom<span class="token operator">=</span>camera<span class="token punctuation">.</span>zoom<span class="token operator">*</span>dollyScale
  camera<span class="token punctuation">.</span>zoom <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>
    Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>maxZoom<span class="token punctuation">,</span> zoom<span class="token punctuation">)</span><span class="token punctuation">,</span>
    minZoom
  <span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u5728\u5B9E\u4F8B\u5316OrbitControls \u5BF9\u8C61\u65F6\uFF0C\u8BBE\u7F6E\u7F29\u653E\u8303\u56F4\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token literal-property property">maxZoom</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token literal-property property">minZoom</span><span class="token operator">:</span> <span class="token number">0.4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-3\u9640\u87BA\u4EEA" tabindex="-1"><a class="header-anchor" href="#_2-3\u9640\u87BA\u4EEA" aria-hidden="true">#</a> 2.3\u9640\u87BA\u4EEA</h4><p>VR \u7684\u771F\u6B63\u9B45\u529B\u5728\u4E8E\uFF0C\u4F60\u53EF\u4EE5\u5E26\u4E0AVR \u773C\u955C\uFF0C\u4F53\u4F1A\u8EAB\u4E34\u5176\u5883\u7684\u611F\u89C9\u3002<br> VR \u773C\u955C\u4E4B\u6240\u4EE5\u80FD\u7ED9\u4F60\u8EAB\u4E34\u5176\u5883\u7684\u611F\u89C9\uFF0C\u662F\u56E0\u4E3A\u5B83\u5185\u90E8\u6709\u4E00\u4E2A\u9640\u87BA\u4EEA\uFF0C\u53EF\u4EE5\u76D1\u542C\u8BBE\u5907\u7684\u8F6C\u52A8\uFF0C\u4ECE\u800C\u5E26\u52A8VR \u573A\u666F\u7684\u53D8\u6362\u3002<br> \u76EE\u524D\u5E02\u573A\u4E0A\u5E38\u89C1\u7684VR \u773C\u955C\u6709\u4E24\u79CD\uFF1A\u9700\u8981\u63D2\u5165\u624B\u673A\u7684VR\u773C\u955C\u548C\u4E00\u4F53\u673A\u3002<br> \u4E00\u822C\u624B\u673A\u91CC\u90FD\u662F\u6709\u9640\u87BA\u4EEA\u7684\uFF0C\u56E0\u6B64\u6211\u4EEC\u53EF\u4EE5\u7528\u624B\u673A\u6765\u4F53\u9A8CVR\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u53EF\u4EE5\u5148\u6574\u4E2A\u5C0F\u4F8B\u5B50\u7EC3\u7EC3\u624B\u3002<br> \u8981\u753B\u4E2A\u7ACB\u65B9\u4F53\uFF0C\u7136\u540E\u7528\u9640\u87BA\u4EEA\u65CB\u8F6C\u5B83\u3002</p><p>\u4E3A\u4E86\u66F4\u597D\u7684\u7406\u89E3\u9640\u87BA\u4EEA\u3002\u6211\u4EEC\u628A\u4E4B\u524D\u7684\u7403\u4F53\u53D8\u6210\u7ACB\u65B9\u4F53\uFF0C\u5728\u5176\u4E0A\u9762\u8D34\u4E0A\u753B\u6709\u4E1C\u3001\u897F\u3001\u5357\u3001\u5317\u548C\u4E0A\u3001\u4E0B\u7684\u8D34\u56FE\u3002\u7136\u540E\u5728\u5176\u4E2D\u6253\u5165\u76F8\u673A\uFF0C\u7528\u9640\u87BA\u4EEA\u53D8\u6362\u76F8\u673A\u89C6\u70B9\uFF0C\u5982\u4E0B\u56FE\uFF1A<br><img src="`+Wa+`" alt=""></p><ol><li>\u5EFA\u7ACB\u7ACB\u65B9\u4F53\u5BF9\u8C61Box</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/*
\u5C5E\u6027\uFF1A
  w\uFF1A\u5BBD
  h\uFF1A\u9AD8
  d\uFF1A\u6DF1
  vertices\uFF1A\u9876\u70B9\u96C6\u5408
  normals\uFF1A\u6CD5\u7EBF\u96C6\u5408
  indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408
  uv\uFF1Auv\u5750\u6807\u96C6\u5408
  count\uFF1A\u9876\u70B9\u6570\u91CF
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Box</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">w<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>h<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>d<span class="token operator">=</span><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>w<span class="token operator">=</span>w
    <span class="token keyword">this</span><span class="token punctuation">.</span>h<span class="token operator">=</span>h
    <span class="token keyword">this</span><span class="token punctuation">.</span>d<span class="token operator">=</span>d
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">36</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>d <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token comment">// \u524D 0 1 2 3</span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
      <span class="token comment">// \u53F3 4 5 6 7</span>
      x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span>
      <span class="token comment">// \u540E 8 9 10 11</span>
      x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span>
      <span class="token comment">// \u5DE6 12 13 14 15 </span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
      <span class="token comment">// \u4E0A 16 17 18 19</span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> <span class="token operator">-</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span>
      <span class="token comment">// \u4E0B 20 21 22 23 </span>
      <span class="token operator">-</span>x<span class="token punctuation">,</span><span class="token operator">-</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span><span class="token operator">-</span>x<span class="token punctuation">,</span><span class="token operator">-</span>y<span class="token punctuation">,</span><span class="token operator">-</span>z<span class="token punctuation">,</span>x<span class="token punctuation">,</span><span class="token operator">-</span>y<span class="token punctuation">,</span>z<span class="token punctuation">,</span>x<span class="token punctuation">,</span><span class="token operator">-</span>y<span class="token punctuation">,</span><span class="token operator">-</span>z<span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> 
      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">/* this.uv = new Float32Array([
      0,1,0,0,1,1,1,0,
      0,1,0,0,1,1,1,0,
      0,1,0,0,1,1,1,0,
      0,1,0,0,1,1,1,0,
      0,1,0,0,1,1,1,0,
      0,1,0,0,1,1,1,0,
    ]) */</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span>
      <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span>
      <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span>
      <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span>
      <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span>
      <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> 
      <span class="token number">20</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">23</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><ol start="2"><li>\u5728Google\u6D4F\u89C8\u5668\u4E2D\u6253\u5F00\u4F20\u611F\u5668\uFF0C\u6A21\u62DF\u9640\u87BA\u4EEA\u7684\u65CB\u8F6C\u3002</li></ol><p>\u5728\u7535\u8111\u91CC\u505A\u6D4B\u8BD5\u7684\u65F6\u5019\uFF0C\u9700\u8981\u7528\u6D4F\u89C8\u5668\u91CC\u7684\u5F00\u53D1\u8005\u5DE5\u5177<br><img src="`+Ha+`" alt=""></p><p>\u4E4B\u540E\u53EF\u4EE5\u5728js\u4E2D\u901A\u8FC7 deviceorientation \u4E8B\u4EF6\u76D1\u542C\u9640\u87BA\u4EEA\u7684\u53D8\u5316\u3002<br> \u4ECEdeviceorientation \u4E8B\u4EF6\u7684\u56DE\u8C03\u53C2\u6570event\u91CC\uFF0C\u53EF\u4EE5\u89E3\u6784\u51FAalpha, beta, gamma \u4E09\u4E2A\u53C2\u6570\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;deviceorientation&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma <span class="token punctuation">}</span><span class="token operator">=</span>event
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>alpha, beta, gamma\u5BF9\u5E94\u4E86\u9640\u87BA\u4EEA\u6B27\u62C9\u65CB\u8F6C\u7684\u4E09\u4E2A\u53C2\u6570\u3002</p><p>\u5728\u53F3\u624B\u5750\u6807\u7CFB\u4E2D\uFF0C\u5176\u6982\u5FF5\u5982\u4E0B\uFF1A</p><ul><li>alpha\uFF1A\u7ED5\u4E16\u754C\u5750\u6807\u7CFB\u7684y\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u7684\u89D2\u5EA6\uFF0C\u65CB\u8F6C\u8303\u56F4\u662F[-180\xB0,180\xB0)</li><li>beta\uFF1A\u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684x\u8F74\u9006\u65F6\u9488\u65CB\u8F6C\u7684\u89D2\u5EA6\uFF0C\u65CB\u8F6C\u8303\u56F4\u662F[-180\xB0,180\xB0)</li><li>gamma \uFF1A\u7ED5\u672C\u5730\u5750\u6807\u7CFB\u7684z\u8F74\u987A\u65F6\u9488\u65CB\u8F6C\u7684\u89D2\u5EA6\uFF0C\u65CB\u8F6C\u8303\u56F4\u662F[-90\xB0,90\xB0)</li></ul><p><code>\u6CE8</code>\uFF1Aalpha, beta, gamma\u5177\u4F53\u662F\u7ED5\u54EA\u4E2A\u8F74\u65CB\u8F6C\uFF0C\u8DDF\u6211\u4EEC\u5F53\u524D\u7A0B\u5E8F\u6240\u4F7F\u7528\u7684\u5750\u6807\u7CFB\u6709\u5173\u3002\u6240\u4EE5\u5927\u5BB6\u4E4B\u540E\u82E5\u662F\u770B\u5230\u6709\u4E9B\u6559\u7A0B\u5728\u8BF4\u9640\u87BA\u4EEA\u65F6\uFF0C\u8DDF\u6211\u8BF4\u7684\u4E0D\u4E00\u6837\uFF0C\u4E5F\u4E0D\u8981\u60CA\u5947\uFF0C\u53EA\u8981\u5728\u5B9E\u8DF5\u4E2D\u6CA1\u6709\u95EE\u9898\u5C31\u53EF\u4EE5\u3002</p><p>\u9640\u87BA\u4EEA\u6B27\u62C9\u65CB\u8F6C\u7684\u987A\u5E8F\u662F&#39;YXZ&#39;\uFF0C\u800C\u4E0D\u662F\u6B27\u62C9\u5BF9\u8C61\u9ED8\u8BA4\u7684&#39;XYZ&#39;\u3002<br> \u6B27\u62C9\u65CB\u8F6C\u987A\u5E8F\u662F\u5F88\u91CD\u8981\u7684\uFF0C\u5982\u679C\u4E71\u4E86\uFF0C\u5C31\u65E0\u6CD5\u8BA9VR\u65CB\u8F6C\u4E0E\u9640\u87BA\u4EEA\u76F8\u5339\u914D\u4E86\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u57FA\u4E8E\u4E4B\u524DVR.html \u6587\u4EF6\u505A\u4E0B\u8C03\u6574\u3002</p><ol start="3"><li>\u5EFA\u7ACB\u7ACB\u65B9\u4F53\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Box <span class="token keyword">from</span> <span class="token string">&#39;./lv/Box.js&#39;</span>
<span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Box</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>\u8C03\u6574\u76F8\u673A\u6570\u636E</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//\u89C6\u70B9</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.45</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">120</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">2</span>
<span class="token punctuation">]</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>eye<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u76F8\u673A\u7684\u89C6\u7EBF\u662F\u6839\u636E\u9640\u87BA\u4EEA\u7684\u521D\u59CB\u72B6\u6001\u8BBE\u7F6E\u7684\u3002<br> \u5728\u9640\u87BA\u4EEA\u7684alpha, beta, gamma\u7686\u4E3A0\u7684\u60C5\u51B5\u4E0B\uFF0C\u624B\u673A\u6210\u4FEF\u89C6\u72B6\u6001\u3002<br><img src="`+w+`" alt=""></p><p>\u6240\u4EE5\uFF0C\u76F8\u673A\u4E5F\u8981\u6210\u4FEF\u89C6\u72B6\u6001\uFF0C\u56E0\u6B64\u89C6\u70B9\u7684y\u503C\u8BBE\u7F6E\u4E3A0.45\u3002<br> \u7136\u800C\uFF0C\u89C6\u7EBF\u4E5F\u4E0D\u80FD\u5B8C\u5168\u5782\u76F4\uFF0C\u56E0\u4E3A\u8FD9\u6837\u89C6\u70B9\u7ED5y\u8F74\u65CB\u8F6C\u5C31\u4F1A\u5931\u6548\u3002<br> \u6240\u4EE5\uFF0C\u89C6\u70B9\u7684z\u503C\u7ED9\u4E86\u4E00\u4E2A\u8F83\u5C0F\u7684\u6570\u5B570.0001\u3002</p><ol start="5"><li>\u573A\u666F\u7684\u6E32\u67D3\u548C\u4E4B\u524D\u662F\u4E00\u6837\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  camera<span class="token punctuation">,</span>
  target<span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
  <span class="token literal-property property">enablePan</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maxZoom</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token literal-property property">minZoom</span><span class="token operator">:</span> <span class="token number">0.4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">//\u7ACB\u65B9\u4F53</span>
<span class="token keyword">const</span> matBox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geoBox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> box<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> box<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> box<span class="token punctuation">.</span>indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//\u52A0\u8F7D\u56FE\u7247</span>
<span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&#39;./images/magic.jpg&#39;</span>
image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  matBox<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Sampler <span class="token operator">=</span> <span class="token punctuation">{</span>
    image<span class="token punctuation">,</span>
    <span class="token literal-property property">magFilte</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minFilter</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> geoBox<span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> matBox
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A<br><img src="`+w+`" alt=""></p><ol start="7"><li>\u76D1\u542C\u9640\u87BA\u4EEA\u4E8B\u4EF6\u65F6\uFF0C\u9700\u8981\u8003\u8651\u4E09\u4EF6\u4E8B\uFF1A</li></ol><ul><li>\u5224\u65AD\u5F53\u524D\u8BBE\u5907\u91CC\u662F\u5426\u6709\u9640\u87BA\u4EEA\u3002</li><li>\u8BA9\u7528\u6237\u89E6\u53D1\u6D4F\u89C8\u5668\u5BF9\u9640\u87BA\u4EEA\u4E8B\u4EF6\u7684\u76D1\u542C\uFF0C\u53EF\u901A\u8FC7click \u4E4B\u7C7B\u7684\u4E8B\u4EF6\u89E6\u53D1\u3002</li><li>\u82E5\u7CFB\u7EDF\u662Fios\uFF0C\u9700\u8981\u8BF7\u6C42\u7528\u6237\u8BB8\u53EF\u3002</li></ul><p>css \u6837\u5F0F\uFF1A</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">html</span> <span class="token punctuation">{</span><span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden
<span class="token punctuation">}</span>
<span class="token selector">.wrapper</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">#playBtn</span> <span class="token punctuation">{</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 24px 24px<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #00acec<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 6px solid <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 9px 9px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>html \u6807\u7B7E\uFF1A</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>playBtn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u5F00\u542FVR\u4E4B\u65C5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>js \u4EE3\u7801\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u906E\u7F69</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.wrapper&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// \u6309\u94AE</span>
<span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#playBtn&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// \u5224\u65AD\u8BBE\u5907\u4E2D\u662F\u5426\u6709\u9640\u87BA\u4EEA</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>DeviceMotionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u8BA9\u7528\u6237\u89E6\u53D1\u9640\u87BA\u4EEA\u7684\u76D1\u542C\u4E8B\u4EF6</span>
  btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u82E5\u662Fios\u7CFB\u7EDF\uFF0C\u9700\u8981\u8BF7\u6C42\u7528\u6237\u8BB8\u53EF</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>DeviceMotionEvent<span class="token punctuation">.</span>requestPermission<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u60A8\u7684\u8BBE\u5907\u91CC\u6CA1\u6709\u9640\u87BA\u4EEA\uFF01&#39;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u8BF7\u6C42\u7528\u6237\u8BB8\u53EF</span>
<span class="token keyword">function</span> <span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  DeviceMotionEvent<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">permissionState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// granted:\u7528\u6237\u5141\u8BB8\u6D4F\u89C8\u5668\u76D1\u542C\u9640\u87BA\u4EEA\u4E8B\u4EF6</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionState <span class="token operator">===</span> <span class="token string">&#39;granted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u8BF7\u5141\u8BB8\u4F7F\u7528\u9640\u87BA\u4EEA\u{1F339}&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u8BF7\u6C42\u5931\u8D25\uFF01&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u76D1\u542C\u9640\u87BA\u4EEA</span>
<span class="token keyword">function</span> <span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wrapper<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;deviceorientation&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> alpha<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> rad <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>
    <span class="token keyword">const</span> euler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Euler</span><span class="token punctuation">(</span>
      beta <span class="token operator">*</span> rad<span class="token punctuation">,</span>
      alpha <span class="token operator">*</span> rad<span class="token punctuation">,</span>
      <span class="token operator">-</span>gamma <span class="token operator">*</span> rad<span class="token punctuation">,</span>
      <span class="token string">&#39;YXZ&#39;</span>
    <span class="token punctuation">)</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
      eye<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyEuler</span><span class="token punctuation">(</span>euler<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>\u5173\u4E8E\u9640\u87BA\u4EEA\u7684\u57FA\u672C\u7528\u6CD5\u5C31\u8BF4\u5230\u8FD9\u3002</p><p>\u4E4B\u524D\u5728\u7F51\u4E0A\u770B\u4E86\u4E00\u4E9B\u9640\u87BA\u4EEA\u76F8\u5173\u7684\u6559\u7A0B\uFF0C\u5F88\u591A\u90FD\u6CA1\u8BF4\u5230\u70B9\u4E0A\uFF0C\u56E0\u4E3A\u82E5\u662F\u4E0D\u77E5\u9053\u6B27\u62C9\u65CB\u8F6C\u7684\u6982\u5FF5\uFF0C\u5C31\u8BF4\u4E0D\u660E\u767D\u9640\u87BA\u4EEA\u3002</p><p>\u6240\u4EE5\uFF0C\u4E00\u5B9A\u8981\u82B1\u65F6\u95F4\u5B66\u4E60\u56FE\u5F62\u5B66\uFF0C\u56FE\u5F62\u5B66\u5173\u7CFB\u7740\u81EA\u8EAB\u53D1\u5C55\u7684\u6F5C\u529B\u3002<br> \u63A5\u4E0B\u6765\u53EF\u4EE5\u5728VR.html \u6587\u4EF6\u91CC\uFF0C\u4EE5\u540C\u6837\u7684\u539F\u7406\u628A\u9640\u87BA\u4EEA\u5199\u8FDB\u53BB\uFF0C\u5E76\u7ED3\u5408\u9879\u76EE\u7684\u5B9E\u9645\u9700\u6C42\u505A\u4E00\u4E0B\u4F18\u5316\u3002</p><h4 id="_2-4-vr-\u9640\u87BA\u4EEA" tabindex="-1"><a class="header-anchor" href="#_2-4-vr-\u9640\u87BA\u4EEA" aria-hidden="true">#</a> 2.4 VR+\u9640\u87BA\u4EEA</h4><p>\u53EF\u4EE5\u5148\u628A\u9640\u87BA\u4EEA\u5C01\u88C5\u4E00\u4E0B\uFF0C\u4EE5\u540E\u7528\u8D77\u6765\u65B9\u4FBF\u3002</p><ol><li>\u5C01\u88C5\u4E00\u4E2A\u9640\u87BA\u4EEA\u5BF9\u8C61Gyro.js</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Euler<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rad <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span>

<span class="token keyword">const</span> <span class="token function-variable function">defAttr</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//\u7528\u4E8E\u89E6\u53D1\u4E8B\u4EF6\u7684\u6309\u94AE</span>
  <span class="token literal-property property">btn</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token comment">//\u6CA1\u6709\u9640\u87BA\u4EEA</span>
  <span class="token function-variable function">noDevice</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//\u5F53\u70B9\u51FB\u6309\u94AE\u65F6</span>
  <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//\u53EF\u4EE5\u4F7F\u7528\u9640\u87BA\u4EEA\u65F6\u89E6\u53D1\u4E00\u6B21</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//\u7528\u6237\u62D2\u7EDD\u5F00\u542F\u9640\u87BA\u4EEA</span>
  <span class="token function-variable function">reject</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//\u8BF7\u6C42\u5931\u8D25</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//\u9640\u87BA\u4EEA\u53D8\u6362</span>
  <span class="token function-variable function">change</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Gyro</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">defAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attr<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> btn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>DeviceMotionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u8BA9\u7528\u6237\u89E6\u53D1\u9640\u87BA\u4EEA\u7684\u76D1\u542C\u4E8B\u4EF6</span>
      btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//\u82E5\u7CFB\u7EDF\u662Fios\uFF0C\u9700\u8981\u8BF7\u6C42\u7528\u6237\u8BB8\u53EF</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>DeviceMotionEvent<span class="token punctuation">.</span>requestPermission<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">noDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//\u8BF7\u6C42\u7528\u6237\u8BB8\u53EF</span>
  <span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    DeviceMotionEvent<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">permissionState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// granted:\u7528\u6237\u5141\u8BB8\u6D4F\u89C8\u5668\u76D1\u542C\u9640\u87BA\u4EEA\u4E8B\u4EF6</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>permissionState <span class="token operator">===</span> <span class="token string">&#39;granted&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u76D1\u542C\u9640\u87BA\u4EEA</span>
  <span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;deviceorientation&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> beta<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> gamma <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Euler</span><span class="token punctuation">(</span>
        beta <span class="token operator">*</span> rad<span class="token punctuation">,</span>
        alpha <span class="token operator">*</span> rad<span class="token punctuation">,</span>
        <span class="token operator">-</span>gamma <span class="token operator">*</span> rad<span class="token punctuation">,</span>
        <span class="token string">&#39;YXZ&#39;</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><ol start="2"><li>\u628A\u9640\u87BA\u4EEA\u5BF9\u8C61\u5F15\u5165VR\u6587\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Gyro <span class="token keyword">from</span> <span class="token string">&#39;./lv/Gyro.js&#39;</span>

<span class="token comment">// \u906E\u7F69</span>
<span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;.wrapper&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// \u6309\u94AE</span>
<span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#playBtn&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// \u9640\u87BA\u4EEA</span>
<span class="token keyword">const</span> gyro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gyro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  btn<span class="token punctuation">,</span>
  <span class="token function-variable function">noDevice</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u60A8\u7684\u8BBE\u5907\u91CC\u6CA1\u6709\u9640\u87BA\u4EEA\uFF01&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">reject</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u8BF7\u5141\u8BB8\u4F7F\u7528\u9640\u87BA\u4EEA\u{1F339}&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u8BF7\u6C42\u5931\u8D25\uFF01&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wrapper<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">change</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">euler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
      eye<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyEuler</span><span class="token punctuation">(</span>euler<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
gyro<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ol start="3"><li>\u4F18\u5316\u56FE\u50CF\u7684\u52A0\u8F7D\u3002</li></ol><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\uFF0C\u4E3A\u4E86\u8BA9\u7528\u6237\u770B\u5230\u6BD4\u8F83\u6E05\u6670\u7684\u6548\u679C\uFF0C\u5F80\u5F80\u9700\u8981\u4F7F\u7528\u6BD4\u8F83\u5927\u7684\u5168\u666F\u56FE\uFF0C\u6BD4\u59824096*2048 \u7684\u5C3A\u5BF8\u3002<br> \u5927\u5C3A\u5BF8\u7684\u56FE\u7247\u52A0\u8F7D\u8D77\u6765\u4F1A\u5F88\u6162\uFF0C\u4E3A\u4E86\u51CF\u5C11\u7528\u6237\u7684\u7B49\u5F85\uFF0C\u53EF\u4EE5\u5148\u52A0\u8F7D\u4E00\u4E2A\u8F83\u5C0F\u7684\u56FE\u7247\uFF0C\u7136\u540E\u6162\u6162\u7684\u8FC7\u5EA6\u5230\u5927\u56FE\u3002</p><p>\u6BD4\u5982\uFF0C\u53EF\u4EE5\u4ECE\u5C0F\u5230\u5927\u51C6\u59074\u5F20\u4E0D\u540C\u5C3A\u5BF8\u7684\u5168\u666F\u56FE\uFF1A</p><ul><li>512*256</li><li>1024*512</li><li>2048*1024</li><li>4096*2048</li></ul><p>\u63A5\u4E0B\u6765\u5148\u52A0\u8F7D\u7B2C\u4E00\u5F20\u5C0F\u56FE\uFF0C\u5C06\u5176\u663E\u793A\u51FA\u6765\u540E\uFF0C\u518D\u4F9D\u6B21\u52A0\u8F7D\u540E\u9762\u7684\u5927\u56FE\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u56FE\u7247\u5E8F\u53F7</span>
<span class="token keyword">let</span> level <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">//\u52A0\u8F7D\u56FE\u7247</span>
<span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/room</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg</span><span class="token template-punctuation string">\`</span></span>
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">firstRender</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//\u66F4\u65B0\u8D34\u56FE</span>
      matEarth<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> image <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      level<span class="token operator">++</span>
      <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7B2C\u4E00\u6B21\u6E32\u67D3</span>
<span class="token keyword">function</span> <span class="token function">firstRender</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  btn<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;\u5F00\u542FVR\u4E4B\u65C5&#39;</span>
  matEarth<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>u_Sampler <span class="token operator">=</span> <span class="token punctuation">{</span>
    image<span class="token punctuation">,</span>
    <span class="token literal-property property">magFilte</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
    <span class="token literal-property property">minFilter</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">geo</span><span class="token operator">:</span> geoEarth<span class="token punctuation">,</span>
    <span class="token literal-property property">mat</span><span class="token operator">:</span> matEarth
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>\u4E0E\u6B64\u540C\u65F6\uFF0C\u6211\u4EEC\u8FD8\u5F97\u5FAE\u8C03\u4E00\u4E0BMat.js\u91CC\u7684\u66F4\u65B0\u8D34\u56FE\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateMap</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span>map<span class="token punctuation">,</span>ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token comment">//gl.bindTexture(gl.TEXTURE_2D, null)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u9700\u8981\u53D6\u6D88\u5BF9\u7EB9\u7406\u7F13\u51B2\u533A\u7684\u6E05\u7406\u3002<br> \u4EE5\u524D\u8981\u6E05\u7406\u7EB9\u7406\u7F13\u51B2\u533A\uFF0C\u662F\u56E0\u4E3A\u4E0D\u9700\u8981\u5BF9\u7EB9\u7406\u7F13\u51B2\u533A\u91CC\u7684\u7EB9\u7406\u5BF9\u8C61\u8FDB\u884C\u66F4\u65B0\uFF0C\u5C06\u5176\u6E05\u7406\u6389\u8FD8\u53EF\u4EE5\u8282\u7EA6\u5185\u5B58\u3002<br> \u800C\u73B0\u5728\u9700\u8981\u5BF9\u7EB9\u7406\u7F13\u51B2\u533A\u91CC\u7684\u7EB9\u7406\u5BF9\u8C61\u8FDB\u884C\u66F4\u65B0\uFF0C\u90A3\u5C31\u4E0D\u80FD\u6E05\u7406\u6389\u4E86\u3002</p><h4 id="_2-5\u5F00\u573A\u52A8\u753B" tabindex="-1"><a class="header-anchor" href="#_2-5\u5F00\u573A\u52A8\u753B" aria-hidden="true">#</a> 2.5\u5F00\u573A\u52A8\u753B</h4><p>\u5F00\u573A\u52A8\u753B\u7684\u4F5C\u7528\uFF0C\u5C31\u662F\u7ED9\u7528\u6237\u4E00\u4E2A\u5438\u5F15\u773C\u7403\u7684\u6548\u679C\uFF0C\u63D0\u9AD8\u9879\u76EE\u7684\u8DA3\u5473\u6027\u3002<br> \u5F00\u573A\u52A8\u753B\u7684\u5F00\u573A\u65B9\u5F0F\u6709\u5F88\u591A\uFF0C\u54B1\u4EEC\u8FD9\u91CC\u5C31\u8BF4\u4E00\u4E2A\u6BD4\u8F83\u5E38\u89C1\u7684\uFF1A\u4ECE\u4E0A\u5E1D\u89C6\u89D2\u5230\u666E\u901A\u89C6\u89D2\u7684\u8FC7\u5EA6\u3002</p><p>\u4E0A\u5E1D\u89C6\u89D2\u5C31\u662F\u4E00\u4E2A\u4FEF\u89C6\u7684\u89C6\u89D2\uFF0C\u89C6\u91CE\u4E00\u5B9A\u8981\u5E7F\uFF0C\u5982\u4E0B\u56FE\uFF1A<br><img src="`+Ya+'" alt=""></p><p>\u4E4B\u540E\uFF0C\u6211\u4F1A\u7528\u8865\u95F4\u52A8\u753B\uFF0C\u5C06\u5176\u8FC7\u5EA6\u5230\u666E\u901A\u89C6\u89D2\uFF0C\u5982\u4E0B\u56FE\uFF1A<br><img src="'+h+`" alt=""></p><p>\u4ECE\u4E0A\u5E1D\u89C6\u89D2\u5230\u666E\u901A\u89C6\u89D2\u7684\u53D8\u6362\u6D89\u53CA\u4EE5\u4E0B\u5C5E\u6027\uFF1A</p><ul><li>\u76F8\u673A\u89C6\u70B9\u7684\u4F4D\u7F6E</li><li>\u76F8\u673A\u89C6\u690E\u4F53\u7684\u5782\u76F4\u89C6\u89D2</li></ul><p>\u63A5\u4E0B\u6765\u4FBF\u53EF\u4EE5\u57FA\u4E8E\u4E0A\u9762\u7684\u5C5E\u6027\u505A\u7F13\u52A8\u52A8\u753B\u3002</p><ol><li>\u628A\u5F53\u524D\u7684\u76F8\u673A\u89C6\u89D2\u8C03\u4E3A\u4E0A\u5E1D\u89C6\u89D2\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//\u89C6\u70B9-\u6839\u636E\u9640\u87BA\u4EEA\u505A\u6B27\u62C9\u65CB\u8F6C</span>
<span class="token keyword">const</span> eye <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span> <span class="token number">0.15</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">)</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">130</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">2</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
<span class="token comment">// \u4E0A\u5E1D\u89C6\u89D2</span>
camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.42</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="2"><li>\u57FA\u4E8E\u76F8\u673A\u7684\u89C6\u70B9\u548C\u89C6\u690E\u4F53\u7684\u5782\u76F4\u5939\u89D2\u5EFA\u7ACB\u4E24\u4E2A\u76EE\u6807\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> endPos <span class="token operator">=</span> camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> endFov <span class="token operator">=</span> fov
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E0A\u9762\u7684\u4E24\u4E2A\u76EE\u6807\u53D8\u91CF\u9ED8\u8BA4\u662F\u548C\u5F53\u524D\u76F8\u673A\u4E00\u81F4\u7684\uFF0C\u4E4B\u540E\u9640\u87BA\u4EEA\u53D1\u751F\u53D8\u5316\u65F6\u4F1A\u5BF9\u5176\u505A\u4FEE\u6539\u3002</p><ol start="3"><li>\u5728\u9640\u87BA\u4EEA\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u8BBE\u7F6E\u76EE\u6807\u53D8\u91CF</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u9640\u87BA\u4EEA</span>
<span class="token keyword">const</span> gyro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gyro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  \u2026\u2026
  <span class="token function-variable function">change</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">euler</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    endFov <span class="token operator">=</span> <span class="token number">60</span>
    endPos<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
      eye<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyEuler</span><span class="token punctuation">(</span>euler<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>\u5F53\u524D\u7684\u5F00\u573A\u52A8\u753B\u662F\u9488\u5BF9\u6709\u9640\u87BA\u4EEA\u7684\u624B\u673A\u800C\u8A00\u7684\uFF0C\u63A5\u4E0B\u6765\u518D\u505A\u5BF9PC\u7AEF\u7684\u5F00\u573A\u52A8\u753B\u3002</p><ol start="4"><li>\u5F53\u9F20\u6807\u70B9\u51FB\u201C\u5F00\u542FVR\u4E4B\u65C5\u201D \u7684\u65F6\u5019\uFF0C\u82E5\u6D4F\u89C8\u5668\u5728PC\u7AEF\uFF0C\u5C06\u89C6\u89D2\u8C03\u4E3A\u666E\u901A\u89C6\u89D2\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> pc <span class="token operator">=</span> <span class="token function">isPC</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gyro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gyro</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 	\u2026\u2026
  <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      endPos<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.0001</span><span class="token punctuation">)</span>
      endFov <span class="token operator">=</span> <span class="token number">60</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>isPC() \u662F\u5224\u65AD\u6D4F\u89C8\u5668\u662F\u5426\u5728PC\u7AEF\u7684\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">isPC</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="5"><li>\u5EFA\u7ACB\u7F13\u52A8\u52A8\u753B\u65B9\u6CD5</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">tween</span><span class="token punctuation">(</span><span class="token parameter">ratio <span class="token operator">=</span> <span class="token number">0.05</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u82E5\u5F53\u524D\u8BBE\u5907\u4E3APC,\u7F13\u52A8\u7ED3\u675F\u540E\u5C31\u4E0D\u518D\u7F13\u52A8\uFF0C\u4E4B\u540E\u7684\u53D8\u6362\u4EA4\u7ED9\u8F68\u9053\u63A7\u5236\u5668</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pc <span class="token operator">&amp;&amp;</span> camera<span class="token punctuation">.</span>fov <span class="token operator">&lt;</span> endFov <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

  camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">lerp</span><span class="token punctuation">(</span>endPos<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span>
  camera<span class="token punctuation">.</span>fov <span class="token operator">+=</span> <span class="token punctuation">(</span>endFov <span class="token operator">-</span> camera<span class="token punctuation">.</span>fov<span class="token punctuation">)</span> <span class="token operator">*</span> ratio
  camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  orbit<span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  orbit<span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><p>camera.updateProjectionMatrix() \u66F4\u65B0\u6295\u5F71\u77E9\u9635\u3002</p><p>\u56E0\u4E3A\u4E0A\u9762\u66F4\u65B0\u4E86\u89C6\u690E\u4F53\u7684\u5782\u76F4\u5939\u89D2\uFF0C\u6240\u4EE5\u76F8\u673A\u7684\u6295\u5F71\u77E9\u9635\u4E5F\u8981\u505A\u540C\u6B65\u7684\u66F4\u65B0\uFF0C\u5177\u4F53\u539F\u7406\u53C2\u89C1\u4E4B\u524D\u7684\u900F\u89C6\u6295\u5F71\u77E9\u9635\u3002</p></li><li><p>orbit.updateCamera() \u66F4\u65B0\u76F8\u673A\uFF0C\u5C06\u76F8\u673A\u7684\u89C6\u70B9\u4F4D\u7F6E\u548C\u89C6\u7EBF\u5199\u5165\u76F8\u673A\u7684\u672C\u5730\u77E9\u9635\u91CC\u3002</p></li><li><p>orbit.resetSpherical() \u91CD\u7F6E\u7403\u5750\u6807\u3002\u7528\u9F20\u6807\u65CB\u8F6C\u76F8\u673A\u7684\u65F6\u5019\u4F1A\u5C06\u65CB\u8F6C\u4FE1\u606F\u5199\u5165\u7403\u5750\u6807\u3002</p></li></ul><ol start="6"><li>\u5728\u8FDE\u7EED\u6E32\u67D3\u65F6\u6267\u884C\u7F13\u52A8\u52A8\u753B</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">tween</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-6\u6DFB\u52A0\u6807\u8BB0\u70B9" tabindex="-1"><a class="header-anchor" href="#_2-6\u6DFB\u52A0\u6807\u8BB0\u70B9" aria-hidden="true">#</a> 2.6\u6DFB\u52A0\u6807\u8BB0\u70B9</h4><p>\u6807\u8BB0\u70B9\u53EF\u4EE5\u544A\u8BC9\u7528\u6237\u4E0D\u540C\u533A\u57DF\u7684\u540D\u79F0\uFF0C\u6216\u8005\u4E3A\u7528\u6237\u6307\u5F15\u65B9\u5411\u3002<br> \u5728\u6DFB\u52A0\u6807\u8BB0\u70B9\u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u8981\u8003\u8651\u4E24\u70B9\uFF1A</p><ul><li>\u5982\u4F55\u6DFB\u52A0\u6807\u8BB0\u70B9</li><li>\u5982\u4F55\u5236\u4F5C\u6807\u8BB0\u70B9</li></ul><p>\u63A5\u4E0B\u6765\u5728 VR \u573A\u666F\u4E2D\u6DFB\u52A0HTML\u7C7B\u578B\u7684\u6807\u8BB0\u70B9\uFF0C\u8FD9\u79CD\u65B9\u6CD5\u662F\u6BD4\u8F83\u5E38\u89C1\u7684\u3002<br> \u5728VR\u4E2D\u6DFB\u52A0HTML\u7C7B\u578B\u6807\u8BB0\u70B9\u7684\u6838\u5FC3\u95EE\u9898\u662F\uFF1A\u5982\u4F55\u8BA9HTML \u6807\u8BB0\u70B9\u968FVR \u573A\u666F\u540C\u6B65\u53D8\u6362\u3002<br> \u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u8981\u6309\u4EE5\u4E0B\u51E0\u6B65\u8D70\uFF1A<br><img src="`+x+`" alt=""></p><ol><li>\u9F20\u6807\u70B9\u51FBcanvas \u753B\u5E03\u65F6\uFF0C\u5C06\u6B64\u70B9\u7684canvas\u5750\u6807\u8F6C\u4E16\u754C\u5750\u6807A\u3002<br> \u200B<code>\u6CE8</code>\uFF1Acanvas\u5750\u6807\u8F6C\u4E16\u754C\u5750\u6807\u7684\u539F\u7406\u5728\u201C\u8FDB\u5165\u4E09\u7EF4\u4E16\u754C\u201D\u7684\u9009\u62E9\u7ACB\u65B9\u4F53\u91CC\u8BF4\u8FC7\u3002</li><li>\u4EE5\u89C6\u70B9\u4E3A\u8D77\u70B9\uFF0CA\u70B9\u4F4D\u65B9\u5411\u505A\u5C04\u7EBFEA\u3002</li><li>\u6C42\u5C04\u7EBFEA\u4E0E\u7403\u4F53\u7684\u4EA4\u70B9P\uFF0C\u6B64\u70B9\u4FBF\u662F\u6807\u8BB0\u70B9\u5728\u4E16\u754C\u5750\u6807\u7CFB\u5185\u7684\u4E16\u754C\u5750\u6807\u3002</li><li>\u5728\u53D8\u6362VR\u573A\u666F\u65F6\uFF0C\u5C06\u6807\u8BB0\u70B9\u7684\u4E16\u754C\u5750\u6807\u8F6Ccanvas\u5750\u6807\uFF0C\u7136\u540E\u7528\u6B64\u5750\u6807\u66F4\u65B0\u6807\u8BB0\u70B9\u7684\u4F4D\u7F6E\u3002</li></ol><p>\u5728\u4E0A\u9762\u7684\u6B65\u9AA4\u4E2D\uFF0C\u7B2C3\u6B65\u662F\u5173\u952E\uFF0C\u6211\u4EEC\u8BE6\u7EC6\u8BB2\u89E3\u4EE5\u4E0B\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u5C04\u7EBF EA</li><li>\u7403\u4F53\u7403\u5FC3\u4E3AO\uFF0C\u534A\u5F84\u4E3A r</li></ul><p><code>\u6C42</code>\uFF1A\u5C04\u7EBF EA\u4E0E\u7403\u4F53\u7684\u4EA4\u70B9P</p><p><code>\u89E3</code>\uFF1A</p><p>\u5148\u5224\u65AD\u5C04\u7EBF\u7684\u57FA\u7EBF\u4E0E\u7403\u4F53\u7684\u5173\u7CFB\u3002</p><p><code>\u8BBE</code>\uFF1AEA\u7684\u5355\u4F4D\u5411\u91CF\u4E3Av</p><p>\u7528EO\u53C9\u4E58EA\u7684\u5355\u4F4D\u5411\u91CF\uFF0C\u6C42\u5F97\u7403\u5FC3O \u5230\u76F4\u7EBF\u7684\u8DDD\u79BB|OB|</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">|</span><span class="token constant">OB</span><span class="token operator">|=</span><span class="token operator">|</span><span class="token constant">EO</span><span class="token operator">^</span>v<span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u57FA\u4E8E|OB|\u548C\u534A\u5F84r\uFF0C\u53EF\u4EE5\u77E5\u9053\u57FA\u7EBF\u4E0E\u7403\u4F53\u7684\u5173\u7CFB\uFF1A<br><img src="`+Xa+`" alt=""></p><ul><li>|OB|&gt;r\uFF0C\u76F4\u7EBF\u4E0E\u7403\u4F53\u76F8\u79BB\uFF0C\u6CA1\u6709\u4EA4\u70B9</li><li>|OB|=r\uFF0C\u76F4\u7EBF\u4E0E\u7403\u4F53\u76F8\u5207\uFF0C1\u4E2A\u4EA4\u70B9 \uFF0C\u4EA4\u70B9\u4E3AB\u70B9</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">B</span><span class="token operator">=</span>v<span class="token operator">*</span><span class="token punctuation">(</span><span class="token constant">EO</span>\xB7v<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>|OB|&lt;r\uFF0C\u76F4\u7EBF\u4E0E\u7403\u4F53\u76F8\u4EA4\uFF0C2\u4E2A\u4EA4\u70B9\uFF0C\u5176\u7B97\u6CD5\u5982\u4E0B\uFF1A<br><img src="`+x+`" alt=""></li></ul><p>\u5728\u76F4\u7EBFEA\u4E0A\u7684\u70B9\u53EF\u4EE5\u5199\u505A\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">E</span><span class="token operator">+</span>\u03BBv<span class="token punctuation">,</span> \u03BB\u2208<span class="token constant">R</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u76F4\u7EBF\u548C\u7403\u4F53\u76F8\u4EA4\u7684\u70B9\u6EE1\u8DB3\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token constant">E</span><span class="token operator">+</span>\u03BBv<span class="token operator">-</span><span class="token constant">O</span><span class="token punctuation">)</span>\xB2<span class="token operator">=</span>r\xB2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>(\u03BBv+OE)\xB2\u53EF\u7406\u89E3\u4E3A\u5411\u91CFOP\u7684\u957F\u5EA6\u7684\u5E73\u65B9\u3002<br> E-O\u53EF\u5199\u505AOE\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>\u03BBv<span class="token operator">+</span><span class="token constant">OE</span><span class="token punctuation">)</span>\xB2<span class="token operator">=</span>r\xB2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5C55\u5F00\u4E0A\u5F0F\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03BB\xB2v\xB2<span class="token operator">+</span><span class="token number">2</span>\u03BBv\xB7<span class="token constant">OE</span><span class="token operator">+</span><span class="token constant">OE</span>\xB2<span class="token operator">=</span>r\xB2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u56E0\u4E3A</code>\uFF1A\u5355\u4F4D\u5411\u91CF\u4E0E\u5176\u81EA\u8EAB\u7684\u70B9\u79EF\u7B49\u4E8E1<br><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03BB\xB2<span class="token operator">+</span><span class="token number">2</span>\u03BBv\xB7<span class="token constant">OE</span><span class="token operator">+</span><span class="token constant">OE</span>\xB2<span class="token operator">=</span>r\xB2
\u03BB\xB2<span class="token operator">+</span><span class="token number">2</span>\u03BBv\xB7<span class="token constant">OE</span><span class="token operator">+</span><span class="token constant">OE</span>\xB2<span class="token operator">-</span>r\xB2<span class="token operator">=</span><span class="token number">0</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u89E3\u4E00\u5143\u4E8C\u6B21\u65B9\u7A0B\u5F0F\uFF0C\u6C42\u03BB\uFF1A<br> \u4E3A\u4E86\u65B9\u4FBF\u4E66\u5199\uFF0C\u8BBE\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>b<span class="token operator">=</span>2v\xB7<span class="token constant">OE</span>
c<span class="token operator">=</span><span class="token constant">OE</span>\xB2<span class="token operator">-</span>r\xB2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>\u5219</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03BB\xB2<span class="token operator">+</span>\u03BBb<span class="token operator">+</span>c<span class="token operator">=</span><span class="token number">0</span>
\u03BB\xB2<span class="token operator">+</span>b\u03BB<span class="token operator">+</span><span class="token punctuation">(</span>b<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>\xB2<span class="token operator">=</span><span class="token operator">-</span>c<span class="token operator">+</span><span class="token punctuation">(</span>b<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token function">\xB2</span>
<span class="token punctuation">(</span>\u03BB<span class="token operator">+</span>b<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span>\xB2<span class="token operator">=</span><span class="token punctuation">(</span>b\xB2<span class="token operator">-</span>4c<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span>
\u03BB<span class="token operator">+</span>b<span class="token operator">/</span><span class="token number">2</span><span class="token operator">=</span><span class="token function">\xB1sqrt</span><span class="token punctuation">(</span>b\xB2<span class="token operator">-</span>4c<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
\u03BB<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">b\xB1sqrt</span><span class="token punctuation">(</span>b\xB2<span class="token operator">-</span>4c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>\u77E5\u9053\u4E86\u03BB \uFF0C\u4E5F\u5C31\u53EF\u4EE5\u76F4\u7EBF\u4E0E\u7403\u4F53\u7684\u4EA4\u70B9\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u03BBv<span class="token operator">+</span><span class="token constant">OE</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u6CE8</code>\uFF1A\u5F53\u03BB\u5C0F\u4E8E0\u65F6\uFF0C\u4EA4\u70B9\u5728\u5C04\u7EBFEA\u7684\u53CD\u65B9\u5411\uFF0C\u5E94\u8BE5\u820D\u5F03\u3002<br> \u5173\u4E8E\u5C04\u7EBF\u4E0E\u7403\u4F53\u7684\u4EA4\u70B9\uFF0C\u5C31\u8BF4\u5230\u8FD9\u3002</p><p>\u63A5\u4E0B\u6765\u57FA\u4E8E\u4E4B\u524D\u7684VR.html \u4EE3\u7801\uFF0C\u5728VR\u7403\u4F53\u4E0A\u6253\u4E00\u4E2A\u6807\u8BB0\u70B9\u3002</p><ol><li>\u5EFA\u7ACB\u4E00\u4E2A\u6807\u8BB0\u70B9\u3002\u5F53\u524D\u5148\u4E0D\u8003\u8651\u6807\u8BB0\u70B9\u7684\u6587\u5B57\u5185\u5BB9\u7684\u7F16\u8F91\uFF0C\u53EA\u5173\u6CE8\u6807\u8BB0\u70B9\u7684\u4F4D\u7F6E\u3002</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">#mark</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 6px 12px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
    <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mark<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u6807\u8BB0\u70B9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>\u83B7\u53D6\u6807\u8BB0\u70B9\uFF0C\u5EFA\u7ACBmarkWp\u53D8\u91CF\uFF0C\u7528\u4E8E\u8BB0\u5F55\u6807\u8BB0\u70B9\u7684\u4E16\u754C\u5750\u6807\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u6807\u8BB0</span>
<span class="token keyword">const</span> mark <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#mark&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// \u6807\u8BB0\u70B9\u7684\u4E16\u754C\u4F4D</span>
<span class="token keyword">let</span> markWp <span class="token operator">=</span> <span class="token keyword">null</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>\u5F53\u9F20\u6807\u53CC\u51FBcanvas \u753B\u5E03\u7684\u65F6\u5019\uFF0C\u6DFB\u52A0\u6807\u8BB0\u70B9\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dblclick&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">addMark</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>addMark() \u65B9\u6CD5\u505A\u4E863\u4EF6\u4E8B\u60C5\uFF1A</p><ul><li>worldPos() \u628A\u9F20\u6807\u70B9\u51FB\u5728canvas\u753B\u5E03\u4E0A\u7684canvas\u5750\u6807\u8F6C\u6362\u4E3A\u4E16\u754C\u5750\u6807.<br> \u6B64\u65B9\u6CD5\u54B1\u4EEC\u4E4B\u524D\u5199\u8FC7\uFF0C\u4ECEUtils.js \u4E2D\u5F15\u5165\u5373\u53EF\u3002</li><li>getMarkWp() \u6839\u636E\u9F20\u6807\u70B9\u7684\u4E16\u754C\u5750\u6807\u8BBE\u7F6E\u6807\u8BB0\u70B9\u7684\u4E16\u754C\u5750\u6807\u3002<br> \u8FD9\u4FBF\u662F\u53C2\u7167\u4E4B\u524D\u5C04\u7EBF\u548C\u7403\u4F53\u4EA4\u70B9\u7684\u6570\u5B66\u516C\u5F0F\u6765\u5199\u7684\u3002<br><code>\u6CE8</code>\uFF1A\u9F20\u6807\u70B9\u7684\u4E16\u754C\u5750\u6807\u5E76\u4E0D\u662F\u6807\u8BB0\u70B9\u7684\u4E16\u754C\u5750\u6807\u3002</li><li>setMarkCp() \u8BBE\u7F6E\u6807\u8BB0\u70B9\u7684canvas\u5750\u6807\u4F4D\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">addMark</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u9F20\u6807\u70B9\u7684\u4E16\u754C\u5750\u6807</span>
  <span class="token keyword">const</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">worldPos</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> canvas<span class="token punctuation">,</span> pvMatrix<span class="token punctuation">)</span>
  <span class="token comment">//\u83B7\u53D6\u6807\u8BB0\u70B9\u7684\u4E16\u754C\u5750\u6807</span>
  markWp <span class="token operator">=</span><span class="token function">getMarkWp</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> earth<span class="token punctuation">.</span>r<span class="token punctuation">)</span>
  <span class="token comment">//\u8BBE\u7F6E\u6807\u8BB0\u70B9\u7684canvas\u5750\u6807\u4F4D</span>
  <span class="token function">setMarkCp</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> event<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/* \u83B7\u53D6\u5C04\u7EBF\u548C\u7403\u4F53\u7684\u4EA4\u70B9
  E \u5C04\u7EBF\u8D77\u70B9-\u89C6\u70B9
  A \u5C04\u7EBF\u76EE\u6807\u70B9
  O \u7403\u5FC3
  r \u534A\u5F84
*/</span>
<span class="token keyword">function</span> <span class="token function">getMarkWp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">E</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">O</span><span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token constant">OE</span> <span class="token operator">=</span> <span class="token constant">E</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">)</span>
  <span class="token comment">//b=2v\xB7OE</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token constant">OE</span><span class="token punctuation">)</span>
  <span class="token comment">//c=OE\xB2-r\xB2</span>
  <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token constant">OE</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token constant">OE</span><span class="token punctuation">)</span> <span class="token operator">-</span> r <span class="token operator">*</span> r
  <span class="token comment">//\u03BB=(-b\xB1sqrt(b\xB2-4c))/2</span>
  <span class="token keyword">const</span> lambda <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>b <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>b <span class="token operator">*</span> b <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
  <span class="token comment">//\u03BBv+OE</span>
  <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiplyScalar</span><span class="token punctuation">(</span>lambda<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">OE</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u8BBE\u7F6E\u6807\u8BB0\u70B9\u7684canvas\u5750\u6807\u4F4D</span>
<span class="token keyword">function</span> <span class="token function">setMarkCp</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span>
  mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="4"><li>\u5F53\u65CB\u8F6C\u548C\u7F29\u653E\u76F8\u673A\u7684\u65F6\u5019\uFF0C\u5BF9\u6807\u8BB0\u70B9\u8FDB\u884C\u540C\u6B65\u53D8\u6362\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">&#39;OrthographicCamera&#39;</span><span class="token punctuation">)</span>
  <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//\u66F4\u65B0\u6807\u8BB0\u70B9\u7684\u4F4D\u7F6E</span>
<span class="token keyword">function</span> <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>markWp<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

  <span class="token comment">//\u5224\u65AD\u6807\u8BB0\u70B9\u5728\u76F8\u673A\u7684\u6B63\u9762\u8FD8\u662F\u80CC\u9762</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>position<span class="token punctuation">}</span><span class="token operator">=</span>camera
  <span class="token keyword">const</span> dot <span class="token operator">=</span> markWp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>
    target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dot <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;block&#39;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u5C06\u6807\u8BB0\u70B9\u7684\u4E16\u754C\u5750\u6807\u8F6C\u88C1\u526A\u5750\u6807</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> markWp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>pvMatrix<span class="token punctuation">)</span>
  <span class="token comment">// \u5C06\u6807\u8BB0\u70B9\u7684\u88C1\u526A\u5750\u6807\u8F6Ccanvas\u5750\u6807</span>
  <span class="token function">setMarkCp</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token operator">-</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>\u4E4B\u540E\u56F4\u7ED5\u6807\u8BB0\u70B9\u8FD8\u53EF\u4EE5\u518D\u8FDB\u4E00\u6B65\u4F18\u5316\uFF1A</p><ul><li>\u4F7F\u6807\u8BB0\u70B9\u7684\u6587\u5B57\u5185\u5BB9\u53EF\u7F16\u8F91</li><li>\u4F18\u5316\u6807\u8BB0\u70B9\u6837\u5F0F</li><li>\u4F7F\u6807\u8BB0\u70B9\u53EF\u62D6\u62FD</li><li>\u6DFB\u52A0\u591A\u4E2A\u6807\u8BB0\u70B9</li><li>\u2026\u2026</li></ul>`,938),Rp=n("\u8FD9\u4E9B\u90FD\u662F\u6B63\u5E38\u7684\u524D\u7AEF\u4E1A\u52A1\u903B\u8F91\uFF0C\u6211\u8FD9\u91CC\u5C31\u53EA\u91CD\u70B9\u8BF4\u56FE\u5F62\u5B66\u76F8\u5173\u7684\u77E5\u8BC6\u4E86\u3002"),Tp=s("br",null,null,-1),Ap=n(" \u4E4B\u540E\u53EF\u4EE5\u53C2\u8003\u4E00\u4E2A\u53EB\u201C"),Bp={href:"https://720yun.com/",target:"_blank",rel:"noopener noreferrer"},Fp=n("720\u4E91"),Cp=n("\u201D\u7684\u7F51\u7AD9\uFF0C\u5B83\u5C31\u662F\u4E13\u4E1A\u505AVR\u7684\u3002"),Ip=s("br",null,null,-1),Lp=s("img",{src:Ka,alt:""},null,-1),Op=a(`<h4 id="_2-7-vr\u573A\u666F\u7684\u5207\u6362" tabindex="-1"><a class="header-anchor" href="#_2-7-vr\u573A\u666F\u7684\u5207\u6362" aria-hidden="true">#</a> 2.7 VR\u573A\u666F\u7684\u5207\u6362</h4><p>\u5728\u5B9E\u9645\u5F00\u53D1\u4E2D\u901A\u5E38\u4F1A\u9047\u5230\u8FD9\u6837\u7684\u9700\u6C42\uFF1A<br> \u5728\u5BA2\u5385\u7684VR\u573A\u666F\u4E2D\u6709\u4E00\u6247\u8FDB\u5165\u5367\u5BA4\u7684\u95E8\uFF0C\u5728\u5367\u5BA4\u95E8\u4E0A\u6709\u4E00\u4E2A\u5199\u7740\u201C\u5367\u5BA4\u201D\u7684\u6807\u8BB0\u70B9\u3002<br> \u5F53\u70B9\u51FB\u201C\u5367\u5BA4\u201D\u6807\u8BB0\u70B9\u65F6\uFF0C\u5C31\u8FDB\u5165\u5367\u5BA4\u7684VR \u4E2D\u3002<br> \u8FD9\u4E2A\u9700\u6C42\u4FBF\u6D89\u53CA\u4E86\u5BA2\u5385\u548C\u5367\u5BA4\u4E24\u4E2AVR\u573A\u666F\u7684\u5207\u6362\u3002<br> \u4E24\u4E2AVR\u573A\u666F\u7684\u5207\u6362\u6700\u7B80\u5355\u7684\u5B9E\u73B0\u65B9\u6CD5\u5C31\u662F\u76F4\u63A5\u6362\u8D34\u56FE\u4E86\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u5FEB\u901F\u3001\u7B80\u5355\u3001\u76F4\u63A5\uFF0C\u7136\u800C\u901A\u5E38\u8001\u677F\u8FD8\u60F3\u8BA9\u6211\u4EEC\u7ED9\u5B83\u4E00\u4E2A\u8FC7\u5EA6\u6548\u679C\u3002<br> \u56E0\u6B64\uFF0C\u4E24\u4E2AVR \u573A\u666F\u7684\u8FC7\u5EA6\u624D\u662F\u8FD9\u91CC\u8981\u8BF4\u7684\u91CD\u70B9\u3002</p><ol><li>\u51C6\u5907\u4E00\u4EFDVR\u6570\u636Evr.json\uFF0C\u76F8\u5F53\u4E8E\u540E\u7AEF\u6570\u636E\u5E93\u91CC\u7684\u6570\u636E\u3002</li></ol><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;imgSrc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./images/room.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eye&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.14966274559865525</span><span class="token punctuation">,</span> <span class="token number">-0.009630159419482085</span><span class="token punctuation">,</span> <span class="token number">0.002884893313037499</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;marks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u6B21\u5367&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pos&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.45099085840209097</span><span class="token punctuation">,</span> <span class="token number">0.0889607157340315</span><span class="token punctuation">,</span> <span class="token number">0.19670596506927274</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;link&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u4E3B\u5367&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pos&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.34961792927865026</span><span class="token punctuation">,</span> <span class="token number">0.30943492493218633</span><span class="token punctuation">,</span> <span class="token number">-0.17893387258739163</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;link&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;imgSrc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./images/secBed.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eye&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.14966274559865525</span><span class="token punctuation">,</span> <span class="token number">-0.009630159419482085</span><span class="token punctuation">,</span> <span class="token number">0.002884893313037499</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;marks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u5BA2\u5385&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pos&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.34819482247111166</span><span class="token punctuation">,</span> <span class="token number">0.29666506812630905</span><span class="token punctuation">,</span> <span class="token number">-0.20186679508508473</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;link&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;imgSrc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./images/mainBed.jpg&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eye&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.14966274559865525</span><span class="token punctuation">,</span> <span class="token number">-0.009630159419482085</span><span class="token punctuation">,</span> <span class="token number">0.002884893313037499</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;marks&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\u5BA2\u5385&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;pos&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">-0.07077938553590507</span><span class="token punctuation">,</span> <span class="token number">0.14593627464082626</span><span class="token punctuation">,</span> <span class="token number">-0.47296181910077806</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;link&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>\u5F53\u524D\u8FD9\u4E2Ajson \u6587\u4EF6\u91CC\u67093\u4E2AVR \u573A\u666F\u7684\u6570\u636E\uFF0C\u5206\u522B\u662F\u5BA2\u5385\u3001\u4E3B\u5367\u3001\u6B21\u5367\u3002</p><ul><li>imgSrc VR\u56FE\u7247</li><li>eye \u76F8\u673A\u89C6\u70B9</li><li>marks \u6807\u8BB0\u70B9 <ul><li>name \u6807\u8BB0\u70B9\u540D\u79F0</li><li>pos \u6807\u8BB0\u70B9\u4E16\u754C\u4F4D\uFF0C\u53EF\u5728\u4E0A\u4E00\u8282\u6DFB\u52A0\u6807\u8BB0\u70B9\u7684\u65F6\u5019\uFF0C\u5C06\u5176\u5B58\u50A8\u5230\u540E\u7AEF</li><li>link \u5F53\u524D\u6807\u8BB0\u70B9\u94FE\u63A5\u7684VR \u7684id</li></ul></li></ul><ol start="2"><li>\u57FA\u4E8E\u4E4B\u524D\u6DFB\u52A0\u6807\u8BB0\u70B9\u6587\u4EF6\uFF0C\u505A\u4E0B\u8C03\u6574\uFF0C\u5EFA\u7ACB\u4E00\u4E2A\u6807\u8BB0\u70B9\u5BB9\u5668marks\uFF0C\u4E4B\u540E\u4F1A\u5F80marks\u91CC\u653Ehtml\u7C7B\u578B\u7684\u6807\u8BB0\u70B9</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.mark</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 6px 12px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>
    <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>marks<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  \u2026\u2026
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="3"><li>\u7B80\u5316\u51FA\u4E00\u4E2AVR\u573A\u666F</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram<span class="token punctuation">,</span> worldPos <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;/jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span> PerspectiveCamera<span class="token punctuation">,</span> Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./lv/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span>
<span class="token keyword">import</span> Earth <span class="token keyword">from</span> <span class="token string">&#39;./lv/Earth.js&#39;</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
<span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u7403\u4F53</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Earth</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>

<span class="token comment">// \u76EE\u6807\u70B9</span>
<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token number">60</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
  <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5</span>
<span class="token punctuation">]</span>
<span class="token comment">// \u900F\u89C6\u76F8\u673A</span>
<span class="token keyword">const</span> camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerspectiveCamera</span><span class="token punctuation">(</span>fov<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span>
<span class="token comment">// \u8F68\u9053\u63A7\u5236\u5668</span>
<span class="token keyword">const</span> orbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  camera<span class="token punctuation">,</span>
  target<span class="token punctuation">,</span>
  <span class="token literal-property property">dom</span><span class="token operator">:</span> canvas<span class="token punctuation">,</span>
  <span class="token literal-property property">enablePan</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maxZoom</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  <span class="token literal-property property">minZoom</span><span class="token operator">:</span> <span class="token number">0.4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
<span class="token keyword">const</span> pvMatrix <span class="token operator">=</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//\u6807\u8BB0</span>
<span class="token keyword">const</span> marks <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#marks&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// \u573A\u666F</span>
<span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//\u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
  <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
      gl<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">//\u7403\u4F53</span>
<span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">magFilter</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minFilter</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
      <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>indexes
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// \u6E32\u67D3</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/* \u53D6\u6D88\u53F3\u51FB\u83DC\u5355\u7684\u663E\u793A */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;contextmenu&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u6309\u4E0B\u65F6\uFF0C\u8BBE\u7F6E\u62D6\u62FD\u8D77\u59CB\u4F4D\uFF0C\u83B7\u53D6\u8F68\u9053\u63A7\u5236\u5668\u72B6\u6001\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerdown&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerdown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u79FB\u52A8\u65F6\uFF0C\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u5E73\u79FB\u72B6\u6001\uFF0C\u5E73\u79FB\u76F8\u673A\uFF1B\u82E5\u63A7\u5236\u5668\u5904\u4E8E\u65CB\u8F6C\u72B6\u6001\uFF0C\u65CB\u8F6C\u76F8\u673A\u3002 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
  <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6307\u9488\u62AC\u8D77 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointerup&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointerup</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/* \u6EDA\u8F6E\u4E8B\u4EF6 */</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;wheel&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">wheel</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">&#39;OrthographicCamera&#39;</span><span class="token punctuation">)</span>
  <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br></div></div><p>\u5F53\u524D\u662F\u6E32\u67D3\u4E0D\u51FA\u4E1C\u897F\u6765\u7684\uFF0C\u56E0\u4E3A\u6211\u8FD8\u6CA1\u6709\u7ED9\u7403\u4F53\u6307\u5B9A\u8D34\u56FE\u3002</p><ol start="4"><li>\u8BF7\u6C42VR \u6570\u636E\uFF0C\u66F4\u65B0VR\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> data<span class="token punctuation">;</span>
<span class="token keyword">let</span> curVr<span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;./data/vr.json&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">dt</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    data <span class="token operator">=</span> dt
    curVr <span class="token operator">=</span> <span class="token function">getVrById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">//\u66F4\u65B0VR</span>
    <span class="token function">updateVr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u6E32\u67D3</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6839\u636Eid\u83B7\u53D6VR\u6570\u636E</span>
<span class="token keyword">function</span> <span class="token function">getVrById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u6839\u636E\u6570\u636E\u66F4\u65B0VR</span>
<span class="token keyword">function</span> <span class="token function">updateVr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> curVr<span class="token punctuation">.</span>imgSrc
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u66F4\u65B0\u56FE\u7247</span>
    mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> image <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//\u66F4\u65B0\u76F8\u673A\u89C6\u70B9</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">...</span>curVr<span class="token punctuation">.</span>eye<span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//\u663E\u793A\u6807\u8BB0\u70B9</span>
    <span class="token function">showMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u663E\u793A\u6807\u8BB0\u70B9</span>
<span class="token keyword">function</span> <span class="token function">showMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  curVr<span class="token punctuation">.</span>marks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span>
    div<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;mark&#39;</span>
    div<span class="token punctuation">.</span>innerText <span class="token operator">=</span> ele<span class="token punctuation">.</span>name
    div<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-link&#39;</span><span class="token punctuation">,</span> ele<span class="token punctuation">.</span>link<span class="token punctuation">)</span>
    marks<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//\u66F4\u65B0\u6807\u8BB0\u70B9\u7684canvas\u5750\u6807\u4F4D</span>
<span class="token keyword">function</span> <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>marks<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> position <span class="token punctuation">}</span> <span class="token operator">=</span> camera
  <span class="token keyword">const</span> <span class="token constant">EO</span> <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
  curVr<span class="token punctuation">.</span>marks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> markWp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector3</span><span class="token punctuation">(</span><span class="token operator">...</span>ele<span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
    <span class="token keyword">const</span> mark <span class="token operator">=</span> marks<span class="token punctuation">.</span>children<span class="token punctuation">[</span>ind<span class="token punctuation">]</span>
    <span class="token keyword">const</span> dot <span class="token operator">=</span> markWp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span><span class="token constant">EO</span><span class="token punctuation">)</span>
    mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> dot <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&#39;block&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;none&#39;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> markWp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyMatrix4</span><span class="token punctuation">(</span>pvMatrix<span class="token punctuation">)</span>
    mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span>
    mark<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token punctuation">(</span><span class="token operator">-</span>y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><ol start="5"><li>\u70B9\u51FB\u6807\u8BB0\u70B9\u65F6\uFF0C\u6839\u636E\u6807\u8BB0\u70B9\u7684data-link \u66F4\u65B0VR</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>marks<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> target <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>className <span class="token operator">!==</span> <span class="token string">&#39;mark&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
  marks<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
  curVr <span class="token operator">=</span> <span class="token function">getVrById</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;data-link&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">updateVr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="6"><li>\u8FDE\u7EED\u6E32\u67D3\u7684\u65F6\u5019\uFF0C\u66F4\u65B0\u6807\u8BB0\u70B9\u7684canvas\u5750\u6807\u4F4D</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="7"><li>\u628A\u9F20\u6807\u7684\u4F4D\u79FB\u4E8B\u4EF6\u7ED1\u5B9A\u5230window\u4E0A</li></ol><p>\u5F53\u9F20\u6807\u79FB\u52A8\u5230\u6807\u8BB0\u70B9\u4E0A\u65F6\uFF0C\u4F1A\u88AB\u6807\u8BB0\u70B9\u5361\u4F4F\uFF0C\u65E0\u6CD5\u79FB\u52A8\uFF0C\u8FD9\u662F\u56E0\u4E3A\u6807\u8BB0\u70B9\u6321\u4F4F\u4E86canvas\uFF0C\u6240\u4EE5\u4E0D\u80FD\u518D\u628A\u9F20\u6807\u4E8B\u4EF6\u7ED1\u5B9A\u5230canvas\u4E0A\u4E86\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;pointermove&#39;</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  orbit<span class="token punctuation">.</span><span class="token function">pointermove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-8-vr\u573A\u666F\u7684\u8FC7\u6E21\u52A8\u753B" tabindex="-1"><a class="header-anchor" href="#_2-8-vr\u573A\u666F\u7684\u8FC7\u6E21\u52A8\u753B" aria-hidden="true">#</a> 2.8 VR\u573A\u666F\u7684\u8FC7\u6E21\u52A8\u753B</h4><p>\u5F53\u524D\u663E\u793A\u7684VR\u5C31\u53EB\u5B83\u65E7VR\uFF0C\u63A5\u4E0B\u6765\u8981\u663E\u793A\u7684VR\u5C31\u53EB\u5B83\u65B0VR\u3002<br> \u8FD9\u4E24\u4E2AVR\u53EF\u4EE5\u60F3\u8C61\u6210\u4E24\u5F20\u56FE\u7247\uFF0C\u65E7VR\u5728\u65B0VR\u4E0A\u9762\uFF0C\u65E7VR\u906E\u6321\u4E86\u65B0VR\u3002<br> \u5728\u5207\u6362VR\u7684\u65F6\u5019\uFF0C\u53EF\u4EE5\u5148\u5B9E\u73B0\u8FD9\u6837\u4E00\u4E2A\u8FC7\u6E21\u6548\u679C\uFF1A\u8BA9\u65E7VR\u6E10\u9690\uFF0C\u4ECE\u800C\u9732\u51FA\u4E0B\u9762\u7684\u65B0VR\u3002<br> \u5E27\u7F13\u51B2\u533A\u4FBF\u53EF\u4EE5\u89C6\u4E4B\u4E3A\u5B58\u50A8\u5728\u5185\u5B58\u91CC\u7684\u56FE\u7247\u3002<br> \u5C06\u4E24\u4E2AVR\u573A\u666F\u5206\u522B\u6E32\u67D3\u5230\u4E24\u4E2A\u5E27\u7F13\u51B2\u533A\u91CC\u540E\uFF0C\u4FBF\u53EF\u4EE5\u57FA\u4E8E\u900F\u660E\u5EA6\u878D\u5408\u4E00\u4E0B\uFF0C\u7136\u540E\u8D34\u5230\u4E00\u4E2A\u5145\u6EE1\u7A97\u53E3\u7684\u5E73\u9762\u4E0A\uFF0C\u4ECE\u800C\u5B9E\u73B0\u8FC7\u5EA6\u6548\u679C\u3002</p><ol><li>\u5C01\u88C5\u4E2A\u573A\u666F\u5BF9\u8C61\u51FA\u6765\uFF0C\u8FD9\u4E2A\u573A\u666F\u91CC\u53EA\u6709\u4E00\u4E2A\u5145\u6EE1\u7A97\u53E3\u7684\u5E73\u9762\uFF0C\u4E4B\u540E\u4F1A\u628A\u5E27\u7F13\u51B2\u533A\u8D34\u4E0A\u53BB</li></ol><p>VRPlane.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./Obj3D.js&#39;</span>
<span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./Scene.js&#39;</span>
<span class="token keyword">import</span> Rect <span class="token keyword">from</span> <span class="token string">&#39;./Rect.js&#39;</span>

<span class="token keyword">const</span> vs <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
  attribute vec4 a_Position;
  attribute vec2 a_Pin;
  varying vec2 v_Pin;
  void main(){
    gl_Position=a_Position;
    v_Pin=a_Pin;
  }
</span><span class="token template-punctuation string">\`</span></span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
  precision mediump float;
  uniform float u_Ratio;
  uniform sampler2D u_SampNew;
  uniform sampler2D u_SampOld;
  varying vec2 v_Pin;
  void main(){
    vec4 t1 = texture2D( u_SampNew, v_Pin );
    vec4 t2 = texture2D( u_SampOld, v_Pin );
    gl_FragColor = mix(t2,t1, u_Ratio);
  }
</span><span class="token template-punctuation string">\`</span></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VRPlane</span> <span class="token keyword">extends</span> <span class="token class-name">Scene</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">createModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span><span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>vs<span class="token punctuation">,</span>fs<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_SampNew&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_SampOld&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Ratio&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Ratio</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniform1f&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rect</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">array</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">array</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> rect<span class="token punctuation">.</span>indexes
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mat<span class="token operator">=</span>mat
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><ol start="2"><li>\u5C01\u88C5\u4E00\u4E2A\u5305\u542BVR\u573A\u666F\u7684\u5E27\u7F13\u51B2\u533A\u5BF9\u8C61</li></ol><p>VRFrame.js</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./Utils.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Matrix4<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./Mat.js&#39;</span>
<span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./Geo.js&#39;</span>
<span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./Obj3D.js&#39;</span>
<span class="token keyword">import</span> Earth <span class="token keyword">from</span> <span class="token string">&#39;./Earth.js&#39;</span>
<span class="token keyword">import</span> Frame <span class="token keyword">from</span> <span class="token string">&#39;./Frame.js&#39;</span>

<span class="token keyword">const</span> vs <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
  attribute vec4 a_Position;
  attribute vec2 a_Pin;
  uniform mat4 u_PvMatrix;
  uniform mat4 u_ModelMatrix;
  varying vec2 v_Pin;
  void main(){
    gl_Position=u_PvMatrix*u_ModelMatrix*a_Position;
    v_Pin=a_Pin;
  }
</span><span class="token template-punctuation string">\`</span></span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
  precision mediump float;
  uniform sampler2D u_Sampler;
  varying vec2 v_Pin;
  void main(){
    gl_FragColor=texture2D(u_Sampler,v_Pin);
  }
</span><span class="token template-punctuation string">\`</span></span>

<span class="token comment">/* \u53C2\u6570
  gl,
  orbit,
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VRFrame</span> <span class="token keyword">extends</span> <span class="token class-name">Frame</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">createModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> orbit<span class="token punctuation">,</span> gl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span><span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span>vs<span class="token punctuation">,</span>fs<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_PvMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_ModelMatrix&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_PvMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">u_ModelMatrix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Matrix4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;uniformMatrix4fv&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">u_Sampler</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">magFilter</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
          <span class="token literal-property property">minFilter</span><span class="token operator">:</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Earth</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">3</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
          <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> earth<span class="token punctuation">.</span>indexes
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mat<span class="token operator">=</span>mat
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div><ol start="3"><li>\u57FA\u4E8E\u4E4B\u524D\u7684\u573A\u666F\u5207\u6362\u6587\u4EF6\u4FEE\u6539\u4EE3\u7801\uFF0C\u5F15\u5165\u7EC4\u4EF6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Matrix4<span class="token punctuation">,</span> PerspectiveCamera<span class="token punctuation">,</span> Vector3
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./lv/OrbitControls.js&#39;</span>
<span class="token keyword">import</span> VRFrame <span class="token keyword">from</span> <span class="token string">&#39;./lv/VRFrame.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VRPlane <span class="token keyword">from</span> <span class="token string">&#39;./lv/VRPlane.js&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Track <span class="token keyword">from</span> <span class="token string">&#39;/jsm/Track.js&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>\u5F00\u542F\u900F\u660E\u5EA6</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">BLEND</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gl<span class="token punctuation">.</span><span class="token function">blendFunc</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">SRC_ALPHA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">ONE_MINUS_SRC_ALPHA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="5"><li>\u5B9E\u4F8B\u5316\u4E00\u4E2A\u573A\u666F\u5BF9\u8C61\uFF0C\u4E24\u4E2A\u5E27\u7F13\u51B2\u533A</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VRPlane</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> vrNew <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VRFrame</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl<span class="token punctuation">,</span> orbit <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> vrOld <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VRFrame</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl<span class="token punctuation">,</span> orbit <span class="token punctuation">}</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_SampOld&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">texture</span><span class="token operator">:</span> vrOld<span class="token punctuation">.</span>texture
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u521D\u59CB\u72B6\u6001\uFF0C\u65E7VR \u662F\u6CA1\u6709\u56FE\u7247\u7684\uFF0C\u9ED8\u8BA4\u753B\u51FA\u6765\u5C31\u662F\u4E00\u5F20\u9ED1\u56FE\uFF0C\u5C06\u5176\u4F20\u7ED9\u573A\u666F\u5BF9\u8C61\u7684u_SampOld\u540E\uFF0C\u4FBF\u53EF\u4EE5\u5B9E\u73B0\u5728\u9ED1\u6697\u4E2D\u6E10\u73B0\u65B0VR\u7684\u6548\u679C\u3002<br> \u65B0VR \u9700\u8981\u5728\u52A0\u8F7D\u5230\u56FE\u7247\u540E\uFF0C\u753B\u51FAVR\uFF0C\u518D\u4F20\u7ED9\u573A\u666F\u5BF9\u8C61\u7684u_SampNew\u3002</p><ol start="6"><li>\u5B9E\u4F8B\u5316\u65F6\u95F4\u8F68\u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u662F\u5426\u5236\u4F5C\u8865\u95F4\u52A8\u753B</span>
<span class="token keyword">let</span> tweenable <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token comment">// \u8865\u95F4\u6570\u636E</span>
<span class="token keyword">let</span> aniDt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">ratio</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
<span class="token comment">// \u65F6\u95F4\u8F68</span>
<span class="token keyword">let</span> track <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Track</span><span class="token punctuation">(</span>aniDt<span class="token punctuation">)</span>
track<span class="token punctuation">.</span>timeLen <span class="token operator">=</span> <span class="token number">1000</span>
track<span class="token punctuation">.</span>keyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">&#39;ratio&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
track<span class="token punctuation">.</span><span class="token function-variable function">onEnd</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  tweenable <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ol start="7"><li>\u5728\u5207\u6362\u56FE\u7247\u65F6\uFF1A</li></ol><ul><li>\u5F00\u542F\u8865\u95F4\u52A8\u753B</li><li>\u8BBE\u7F6E\u65B0\u3001\u65E7VR\u7684\u56FE\u7247</li><li>\u628A\u65E7VR\u7684\u7EB9\u7406\u5BF9\u8C61\u4F20\u5165u_SampOld</li><li>\u6839\u636EVR \u6570\u636E\u66F4\u65B0\u89C6\u70B9\u4F4D\u7F6E</li><li>\u6839\u636EVR \u6570\u636E\u663E\u793A\u6807\u8BB0\u70B9</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//\u6682\u5B58\u5F53\u524D\u7684VR\u56FE\u50CF</span>
<span class="token keyword">let</span> tempImg <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">// \u66F4\u65B0VR\u56FE\u50CF</span>
<span class="token keyword">function</span> <span class="token function">updateVr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> curVr<span class="token punctuation">.</span>imgSrc
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u5F00\u542F\u8865\u95F4\u52A8\u753B</span>
    tweenable <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">//\u65F6\u95F4\u8F68\u8D77\u59CB\u65F6\u95F4</span>
    track<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">//\u82E5tempImg \u4E0D\u4E3Anull</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tempImg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u8BBE\u7F6E\u65E7VR\u7684\u56FE\u7247</span>
      vrOld<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">image</span><span class="token operator">:</span> tempImg <span class="token punctuation">}</span><span class="token punctuation">)</span>
      vrOld<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// \u628A\u65E7VR\u7684\u7EB9\u7406\u5BF9\u8C61\u4F20\u5165u_SampOld</span>
      scene<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_SampOld&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">texture</span><span class="token operator">:</span> vrOld<span class="token punctuation">.</span>texture
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6682\u5B58\u5F53\u524D\u56FE\u7247</span>
    tempImg <span class="token operator">=</span> image
    <span class="token comment">//\u8BBE\u7F6E\u65B0VR\u7684\u56FE\u7247</span>
    vrNew<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> image <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//\u8BBE\u7F6E\u76F8\u673A\u89C6\u70B9</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">...</span>curVr<span class="token punctuation">.</span>eye<span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">updateCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    orbit<span class="token punctuation">.</span><span class="token function">resetSpherical</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//\u663E\u793A\u5F53\u524DVR\u7684\u6807\u8BB0\u70B9</span>
    <span class="token function">showMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>\u5C06\u4E4B\u524D Mat.js \u5BF9\u8C61\u7684setMap \u65B9\u6CD5\u505A\u4E0B\u8C03\u6574</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span>val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  val<span class="token punctuation">.</span>needUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>\u8FD9\u6837\uFF0C\u82E5key\u5728maps\u4E2D\u5B58\u5728\uFF0C\u5C31\u5408\u5E76val\uFF1B\u82E5\u4E0D\u5B58\u5728\uFF0C\u5C31\u5199\u5165val\u3002</p><ol start="8"><li>\u8FDE\u7EED\u6E32\u67D3</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tweenable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u66F4\u65B0\u65F6\u95F4\u8F68\u7684\u65F6\u95F4</span>
    track<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// \u66F4\u65B0\u573A\u666F\u5BF9\u8C61\u7684\u63D2\u503C\u6570\u636E</span>
    scene<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&#39;u_Ratio&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> aniDt<span class="token punctuation">.</span>ratio
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u66F4\u65B0\u6295\u5F71\u89C6\u56FE\u77E9\u9635</span>
  orbit<span class="token punctuation">.</span><span class="token function">getPvMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u65B0VR\u7ED8\u56FE</span>
  vrNew<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u66F4\u65B0\u573A\u666F\u5BF9\u8C61\u7684u_SampNew</span>
  scene<span class="token punctuation">.</span>mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_SampNew&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">texture</span><span class="token operator">:</span> vrNew<span class="token punctuation">.</span>texture
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//\u573A\u666F\u5BF9\u8C61\u7ED8\u56FE</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u66F4\u65B0\u6807\u8BB0\u70B9\u7684canvas\u5750\u6807</span>
  <span class="token function">updateMarkCp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>\u5230\u76EE\u524D\u4E3A\u6B62\uFF0C\u4FBF\u53EF\u4EE5\u5B9E\u73B0VR\u573A\u666F\u7684\u900F\u660E\u5EA6\u8865\u95F4\u52A8\u753B\u3002<br> \u63A5\u4E0B\u6765\uFF0C\u8FD8\u53EF\u4EE5\u518D\u4E30\u5BCC\u4E00\u4E0B\u8865\u95F4\u52A8\u753B\u6548\u679C\u3002</p><ol start="9"><li>\u5728\u900F\u660E\u5EA6\u52A8\u753B\u7684\u57FA\u7840\u4E0A\uFF0C\u518D\u8BA9\u65E7VR\u505A\u4E00\u4E2A\u653E\u5927\u6548\u679C\uFF0C\u7ED9\u7528\u6237\u8425\u9020\u4E00\u4E2A\u62C9\u8FDB\u89C6\u53E3\u7684\u6548\u679C\uFF0C\u4F7F\u9879\u76EE\u770B\u8D77\u6765\u66F4\u52A0\u8D70\u5FC3</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>precision mediump <span class="token keyword">float</span><span class="token punctuation">;</span>
uniform <span class="token keyword">float</span> u_Ratio<span class="token punctuation">;</span>
uniform sampler2D u_SampNew<span class="token punctuation">;</span>
uniform sampler2D u_SampOld<span class="token punctuation">;</span>
varying vec2 v_Pin<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  vec2 halfuv<span class="token operator">=</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">float</span> scale<span class="token operator">=</span><span class="token number">1.0</span><span class="token operator">-</span>u_Ratio<span class="token operator">*</span><span class="token number">0.1</span><span class="token punctuation">;</span>
  vec2 pin<span class="token operator">=</span><span class="token punctuation">(</span>v_Pin<span class="token operator">-</span>halfuv<span class="token punctuation">)</span><span class="token operator">*</span>scale<span class="token operator">+</span>halfuv<span class="token punctuation">;</span>
  vec4 t1 <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span> u_SampNew<span class="token punctuation">,</span> v_Pin <span class="token punctuation">)</span><span class="token punctuation">;</span>
  vec4 t2 <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span> u_SampOld<span class="token punctuation">,</span> pin <span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl_FragColor <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>t2<span class="token punctuation">,</span>t1<span class="token punctuation">,</span> u_Ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>\u653E\u5927\u65E7VR\u7684\u65B9\u6CD5\u6709\u5F88\u591A\uFF0C\u53EF\u4EE5\u4ECE\u6A21\u578B\u3001\u76F8\u673A\u3001\u7247\u5143\u7740\u8272\u5668\u7B49\u65B9\u9762\u6765\u5B9E\u73B0\u3002<br> \u8FD9\u91CC\u5C31\u627E\u4E86\u4E2A\u6BD4\u8F83\u7B80\u5355\u7684\u65B9\u6CD5\uFF0C\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u653E\u5927\u65E7VR\u3002</p><p>\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u653E\u5927\u65E7VR \u7684\u65B9\u6CD5\uFF0C\u81F3\u5C11\u6709\u4E24\u79CD\uFF1A</p><ul><li>\u57FA\u4E8E\u7247\u5143\u653E\u5927\u65E7VR</li><li>\u57FA\u4E8EUV\u653E\u5927\u65E7VR</li></ul><p>\u57FA\u4E8E\u7247\u5143\u653E\u5927\u65E7VR\uFF0C\u9700\u8981\u5728\u7247\u5143\u7740\u8272\u5668\u91CC\u77E5\u9053canvas\u753B\u5E03\u5728gl_FragCoord \u5750\u6807\u7CFB\u91CC\u7684\u4E2D\u5FC3\u70B9\uFF0C\u6709\u70B9\u9EBB\u70E6\u3002<br> \u57FA\u4E8EUV\u653E\u5927\u65E7VR\uFF0C\u76F4\u63A5\u57FA\u4E8Euv \u5750\u6807\u7CFB\u7684\u4E2D\u5FC3\u70B9(0.5,0.5) \u7F29\u5C0Fuv\u5750\u6807\u5373\u53EF\uFF0C\u6BD4\u8F83\u7B80\u5355\uFF0C\u6240\u4EE5\u5C31\u4F7F\u7528\u8FD9\u4E2A\u65B9\u6CD5\u653E\u5927\u65E7VR\u4E86\u3002</p><h3 id="_3-\u7EBF\u6761\u7684\u7EB9\u7406\u6620\u5C04" tabindex="-1"><a class="header-anchor" href="#_3-\u7EBF\u6761\u7684\u7EB9\u7406\u6620\u5C04" aria-hidden="true">#</a> 3.\u7EBF\u6761\u7684\u7EB9\u7406\u6620\u5C04</h3><p>\u4E4B\u524D\u5728\u8BF4WebGL\u56FE\u5F62\u7684\u65F6\u5019\u8BF4\u8FC7\uFF0CWebGL\u6709LINES\u3001LINE_STRIP\u3001LINE_LOOP \u4E09\u79CD\u753B\u7EBF\u7684\u65B9\u6CD5\u3002<br> \u4E0D\u8FC7\uFF0C\u4E09\u79CD\u65B9\u6CD5\u53EA\u80FD\u7ED8\u5236\u4E00\u4E2A\u50CF\u7D20\u5BBD\u7684\u7EBF\uFF0C\u5982\u679C\u8981\u60F3\u753B\u7684\u662F\u4E0B\u56FE\u4E2D\u7C97\u70B9\u7684\u516C\u8DEF\u5462\uFF1F<br><img src="`+_+'" alt=""></p><p>\u8FD9\u6761\u516C\u8DEF\u7684\u7ED8\u5236\u8981\u5206\u4E24\u90E8\u5206\u8003\u8651\uFF1A</p><ul><li>\u5BBD\u5EA6\u7EBF</li><li>\u7EB9\u7406\u6620\u5C04</li></ul><h4 id="_3-1\u8BA4\u8BC6\u5BBD\u5EA6\u7EBF" tabindex="-1"><a class="header-anchor" href="#_3-1\u8BA4\u8BC6\u5BBD\u5EA6\u7EBF" aria-hidden="true">#</a> 3.1\u8BA4\u8BC6\u5BBD\u5EA6\u7EBF</h4><p>\u5F53\u7EBF\u6709\u4E86\u5BBD\u5EA6\u4E4B\u540E\uFF0C\u5B83\u5C31\u4E0D\u4EC5\u4EC5\u662F\u6709\u4E86\u5BBD\u5EA6\u90A3\u4E48\u7B80\u5355\uFF0C\u56E0\u4E3A\u8FD9\u672C\u8D28\u4E0A\u662F\u4E00\u4E2A\u7531\u7EBF\u8F6C\u9762\uFF0C\u63D0\u5347\u4E86\u4E00\u4E2A\u7EF4\u5EA6\u7684\u95EE\u9898\u3002\u8FD9\u4F1A\u5EF6\u4F38\u51FA\u8BB8\u591A\u9664\u5BBD\u5EA6\u4E4B\u5916\u7684\u5176\u5B83\u7279\u6027\u3002<br> \u5BF9\u4E8E\u6709\u5BBD\u5EA6\u7684\u7EBF\uFF0Ccanvas 2d \u5C31\u505A\u5F97\u5F88\u597D\uFF0C\u6240\u4EE5\u54B1\u4EEC\u5148\u901A\u8FC7canvas 2d \u8BA4\u8BC6\u4E00\u4E0B\u6709\u5BBD\u5EA6\u7684\u7EBF\u7684\u7279\u6027\uFF1A</p><ul><li><p>lineWidth \u5B9A\u4E49\u63CF\u8FB9\u7684\u5BBD\u5EA6\uFF0C\u5B83\u662F\u4ECE\u8DEF\u5F84\u7684\u4E2D\u5FC3\u5F00\u59CB\u7ED8\u5236\u7684\uFF0C\u5185\u5916\u5404\u5360\u5BBD\u5EA6\u7684\u4E00\u534A\u3002<br><img src="'+Za+'" alt=""></p></li><li><p>lineCap \u7EBF\u6761\u7AEF\u70B9\u6837\u5F0F<br><img src="'+Qa+'" alt=""></p></li><li><p>lineJoin \u62D0\u89D2\u7C7B\u578B<br><img src="'+$a+'" alt=""></p></li><li><p>miterLimit \u9650\u5236\u5C16\u89D2<br> \u5F53lineJoin \u4E3Amiter \u65F6\uFF0C\u82E5\u62D0\u89D2\u8FC7\u5C0F\uFF0C\u62D0\u89D2\u7684\u539A\u5EA6\u5C31\u4F1A\u8FC7\u5927\u3002<br><img src="'+Ja+'" alt=""></p></li></ul><p>\u200BmiterLimit=1 \u540E\uFF0C\u53EF\u907F\u514D\u6B64\u95EE\u9898<br><img src="'+np+'" alt=""></p><ul><li>setLineDash(segments) \u865A\u7EBF<br> ctx.setLineDash([ 60, 90 ])<br><img src="'+sp+'" alt=""></li></ul><p>\u200Bctx.setLineDash([ 60, 90, 120 ])<br><img src="'+ap+'" alt=""></p><ul><li>lineDashOffset \u865A\u7EBF\u504F\u79FB</li></ul><p>ctx.lineDashOffset=0<br><img src="'+pp+'" alt=""></p><p>\u200Bctx.lineDashOffset=-60<br><img src="'+tp+'" alt=""></p><h4 id="_3-2\u5BBD\u5EA6\u7EBF\u7684\u7ED8\u5236\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#_3-2\u5BBD\u5EA6\u7EBF\u7684\u7ED8\u5236\u601D\u8DEF" aria-hidden="true">#</a> 3.2\u5BBD\u5EA6\u7EBF\u7684\u7ED8\u5236\u601D\u8DEF</h4><ul><li><p>\u7740\u8272\u5668\u7ED8\u56FE\uFF1A\u5148\u7528WebGL \u539F\u751F\u65B9\u6CD5\u7ED8\u5236\u5355\u50CF\u7D20\u7684\u7EBF\uFF0C\u7136\u540E\u5229\u7528\u5E27\u7F13\u51B2\u533A\u4E3A\u5176\u63CF\u8FB9\u3002<br><img src="'+ep+'" alt=""></p><ul><li>\u4F18\u70B9\uFF1A\u7B80\u5355\u5FEB\u901F\uFF0C\u53EF\u4EE5\u753B\u51FA\u62D0\u89D2\u548C\u7AEF\u70B9\u90FD\u4E3Around \u7C7B\u578B\u7684\u7EBF</li><li>\u7F3A\u70B9\uFF1A\u96BE\u4EE5\u63A7\u5236\u5176\u7AEF\u70B9\u548C\u62D0\u89D2\u6837\u5F0F\uFF0C\u65E0\u6CD5\u505A\u7EB9\u7406\u6620\u5C04\uFF0C\u65E0\u6CD5\u6DF1\u5EA6\u6D4B\u8BD5</li></ul></li><li><p>\u9876\u70B9\u5EFA\u6A21\uFF0C\u57FA\u4E8E\u7EBF\u6761\u8DEF\u5F84\uFF0C\u5411\u5176\u5185\u5916\u4E24\u4FA7\u6324\u538B\u7EBF\u6761\u3002<br><img src="'+j+'" alt=""></p><ul><li>\u4F18\u70B9\uFF1A\u53EF\u63A7\u6027\u5F3A\uFF0C\u53EF\u6EE1\u8DB3\u5404\u79CD\u7EBF\u6761\u7279\u6027\uFF0C\u53EF\u505A\u7EB9\u7406\u6620\u5C04\uFF0C\u652F\u6301\u6DF1\u5EA6\u6D4B\u8BD5</li><li>\u7F3A\u70B9\uFF1A\u9876\u70B9\u70B9\u4F4D\u7684\u8BA1\u7B97\u91CF\u6709\u70B9\u5927\u3002</li></ul></li></ul><p>\u56E0\u4E3A\u8981\u4E3A\u5BBD\u5EA6\u7EBF\u8D34\u56FE\uFF0C\u6240\u4EE5\u5C31\u7528\u9876\u70B9\u5EFA\u6A21\u7684\u65B9\u5F0F\u7ED8\u5236\u6709\u5BBD\u5EA6\u7684\u7EBF\u4E86\u3002<br> \u5148\u7528\u6700\u7B80\u5355\u7684\u65B9\u5F0F\u753B\u4E00\u6761\u5BBD\u5EA6\u7EBF\uFF1A\u50CFcanvas 2d\u90A3\u6837\uFF0C\u4EE5lineCap\u4E3Abutt\uFF0ClineJoin \u4E3Amiter\u7684\u65B9\u5F0F\u7ED8\u5236\u3002</p><h4 id="_3-3\u5BBD\u5EA6\u7EBF\u7684\u6324\u538B\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_3-3\u5BBD\u5EA6\u7EBF\u7684\u6324\u538B\u539F\u7406" aria-hidden="true">#</a> 3.3\u5BBD\u5EA6\u7EBF\u7684\u6324\u538B\u539F\u7406</h4><p>\u5BBD\u5EA6\u7EBF\u4E2D\u76F8\u90BB\u7684\u4E24\u6761\u7EBF\u6BB5\u5B58\u5728\u4E24\u79CD\u5173\u7CFB\uFF1A</p><ul><li><p>\u76F8\u4EA4<br><img src="'+j+'" alt=""></p></li><li><p>\u5E73\u884C<br><img src="'+q+'" alt=""></p></li></ul><p>\u6324\u538B\u9876\u70B9\u7684\u65B9\u5F0F\u6709\u4E24\u79CD\uFF1A</p><ul><li>\u5782\u76F4\u6324\u538B\uFF0C\u5BF9\u5E94\u7EBF\u6761\u7AEF\u70B9\u6216\u76F8\u90BB\u7EBF\u6BB5\u5E73\u884C\u65F6\u7684\u70B9\u3002</li><li>\u975E\u5782\u76F4\u6324\u538B\uFF0C\u5BF9\u5E94\u76F8\u90BB\u7EBF\u6BB5\u4E0D\u5E73\u884C\u65F6\u7684\u70B9\uFF0C\u5373\u76F8\u4EA4\u7EBF\u6BB5\u7684\u62D0\u70B9\u3002</li></ul><h4 id="_3-4\u5782\u76F4\u6324\u538B\u70B9" tabindex="-1"><a class="header-anchor" href="#_3-4\u5782\u76F4\u6324\u538B\u70B9" aria-hidden="true">#</a> 3.4\u5782\u76F4\u6324\u538B\u70B9</h4><p>\u4EE5\u4E0B\u56FE\u4E3A\u4F8B\uFF1A<br><img src="'+q+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u70B9A\u3001\u70B9B</li><li>\u7EBF\u6761\u5BBD\u5EA6\u4E3AlineWidth</li><li>A1\u3001A2\u662F\u81EA\u70B9A \u6CBFAB\u65B9\u5411\u5782\u76F4\u6324\u538B\u51FA\u7684\u70B9</li></ul><p><code>\u6C42</code>\uFF1AA1\u3001A2</p><p><code>\u89E3</code>\uFF1A</p><p>\u8BA1\u7B97\u7EBF\u6761\u5BBD\u5EA6\u7684\u4E00\u534Ah\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>h<span class="token operator">=</span>lineWidth<span class="token operator">/</span><span class="token number">2</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7531\u70B9A\u3001\u70B9B\u8BA1\u7B97\u5411\u91CFAB\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">AB</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token operator">=</span><span class="token constant">B</span><span class="token operator">-</span><span class="token constant">A</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5C06\u5411\u91CFAB\u9006\u65F6\u9488\u65CB\u8F6C90\xB0\uFF0C\u8BBE\u7F6E\u957F\u5EA6\u4E3Ah\uFF0C\u5F97\u70B9A1\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">A1</span><span class="token operator">=</span>h<span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span>y<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">|</span><span class="token punctuation">(</span><span class="token operator">-</span>y<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u5C06\u5411\u91CFAB\u987A\u65F6\u9488\u65CB\u8F6C90\xB0\uFF0C\u8BBE\u7F6E\u957F\u5EA6\u4E3Ah\uFF0C\u5F97\u70B9A2\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">A2</span><span class="token operator">=</span>h<span class="token operator">*</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">|</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6324\u538B\u7AEF\u70B9C \u540E\u7684\u70B9C1\u3001C2 \u4EA6\u662F\u540C\u7406\u3002<br> \u81F3\u4E8E\u6324\u538B\u4E2D\u95F4\u70B9B \u540E\u7684B1\u3001B2\uFF0C\u82E5\u70B9B\u76F8\u90BB\u7684\u7EBF\u6BB5\u5E73\u884C\uFF0C\u5176\u8BA1\u7B97\u65B9\u6CD5\u4EA6\u662F\u540C\u7406\u3002<br> AB\u662F\u5426\u5E73\u884C\u4E8EBC\u7684\u5224\u65AD\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token constant">AB</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span><span class="token constant">AB</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token constant">BC</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span><span class="token constant">BC</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="_3-4\u8BA1\u7B97\u62D0\u70B9" tabindex="-1"><a class="header-anchor" href="#_3-4\u8BA1\u7B97\u62D0\u70B9" aria-hidden="true">#</a> 3.4\u8BA1\u7B97\u62D0\u70B9</h4><p><img src="`+op+`" alt=""></p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u70B9A\u3001\u70B9B\u3001\u70B9C</li><li>\u7EBF\u6761\u5BBD\u5EA6\u4E3AlineWidth</li><li>AB\u3001BC \u4E0D\u5E73\u884C</li></ul><p><code>\u6C42</code>\uFF1A\u62D0\u70B9B1\u3001B2</p><p><code>\u601D\u8DEF</code>\uFF1A</p><p>\u6C42\u62D0\u70B9\u7684\u672C\u8D28\uFF0C\u5C31\u662F\u6C42\u4E24\u6761\u76F4\u7EBF\u7684\u7684\u4EA4\u70B9\u3002 \u6C42\u76F4\u7EBF\u4EA4\u70B9\u7684\u65B9\u6CD5\u6709\u5F88\u591A\uFF0C\u9AD8\u4E2D\u6570\u5B66\u6709\u4E00\u4E2A\u7528\u76F4\u7EBF\u4E00\u822C\u5F0F\u6C42\u4EA4\u70B9\u7684\u65B9\u6CD5\uFF0C\u6211\u4EEC\u4E5F\u53EF\u4EE5\u7528\u5411\u91CF\u63A8\u5BFC\u3002</p><p><code>\u89E3</code>\uFF1A</p><p>\u7531\u5DF2\u77E5\u6761\u4EF6\u53EF\u77E5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">BD</span>\u2225<span class="token constant">EB2</span>
<span class="token constant">BE</span>\u2225<span class="token constant">DB2</span>
<span class="token operator">|</span><span class="token constant">BF</span><span class="token operator">|=</span><span class="token operator">|</span><span class="token constant">BG</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>\u6240\u4EE5</code>\uFF1A</p><p>BEB2D \u662F\u7B49\u8FB9\u5E73\u884C\u56DB\u8FB9\u5F62\u3002</p><p>\u8BA1\u7B97\u5411\u91CFBD\u7684\u5355\u4F4D\u5411\u91CFd\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>d<span class="token operator">=</span><span class="token constant">AB</span><span class="token operator">/</span><span class="token operator">|</span><span class="token constant">AB</span><span class="token operator">|</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8BA1\u7B97\u5411\u91CFBE\u7684\u5355\u4F4D\u5411\u91CFe\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>e<span class="token operator">=</span><span class="token constant">CB</span><span class="token operator">/</span><span class="token operator">|</span><span class="token constant">CB</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7531\u7B49\u8FB9\u5E73\u884C\u56DB\u8FB9\u5F62\u5B9A\u7406\uFF0C\u53EF\u6C42\u5F97BB2 \u7684\u5355\u4F4D\u5411\u91CFb\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>b<span class="token operator">=</span><span class="token punctuation">(</span>d<span class="token operator">+</span>e<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">|</span>d<span class="token operator">+</span>e<span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u53EA\u8981\u6C42\u5F97BB2\u7684\u957F\u5EA6\uFF0C\u4FBF\u53EF\u77E5\u9053\u70B9B2\u3002</p><p>\u7531\u5411\u91CF\u7684\u70B9\u79EF\u516C\u5F0F\u53EF\u77E5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u2220<span class="token constant">B2BG</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token constant">BG</span>\xB7b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">|</span><span class="token constant">BG</span><span class="token operator">|</span><span class="token operator">*</span><span class="token operator">|</span>b<span class="token operator">|</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>\u56E0\u4E3A</code>\uFF1A</p><p>b\u662F\u5355\u4F4D\u5411\u91CF</p><p><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u2220<span class="token constant">B2BG</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token constant">BG</span>\xB7b<span class="token punctuation">)</span><span class="token operator">/</span><span class="token operator">|</span><span class="token constant">BG</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u7531\u4F59\u5F26\u516C\u5F0F\u53EF\u77E5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>cos\u2220<span class="token constant">B2BG</span><span class="token operator">=</span><span class="token operator">|</span><span class="token constant">BG</span><span class="token operator">|</span><span class="token operator">/</span><span class="token operator">|</span><span class="token constant">BB2</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token constant">BB2</span><span class="token operator">|=</span><span class="token operator">|</span><span class="token constant">BG</span><span class="token operator">|</span><span class="token operator">/</span>cos\u2220<span class="token constant">B2BG</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>\u6240\u4EE5</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">BB2</span><span class="token operator">=</span>b<span class="token operator">*</span><span class="token operator">|</span><span class="token constant">BB2</span><span class="token operator">|</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u6240\u4EE5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">B2</span><span class="token operator">=</span><span class="token constant">BB2</span><span class="token operator">+</span><span class="token constant">B</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u77E5\u9053\u4E86B2\u540E\uFF0CB1\u4E5F\u5C31\u597D\u6C42\u4E86\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">B1</span><span class="token operator">=</span><span class="token operator">-</span><span class="token constant">BB2</span><span class="token operator">+</span><span class="token constant">B</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u8FD9\u4FBF\u662F\u7528\u5411\u91CF\u63A8\u5BFC\u62D0\u70B9\u7684\u65B9\u6CD5\u3002</p>`,123),Dp=n("\u5BF9\u4E8E\u7528\u76F4\u7EBF\u7684\u4E00\u822C\u5F0F\u6C42\u4EA4\u70B9\u7684\u65B9\u6CD5\uFF0C"),zp={href:"http://yxyy.name/blog/md.html?ossName=162765212208629481006223312756.md&title=%E6%BC%AB%E8%B0%88%E7%9B%B4%E7%BA%BF%E4%B9%8B%E7%82%B9%E6%96%9C%E5%BC%8F%E5%92%8C%E4%B8%80%E8%88%AC%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"},Up=n("\u76F8\u5173\u6587\u7AE0"),Vp=n("\u3002"),Np=a(`<h4 id="_3-5\u7ED8\u5236\u5BBD\u5EA6\u7EBF" tabindex="-1"><a class="header-anchor" href="#_3-5\u7ED8\u5236\u5BBD\u5EA6\u7EBF" aria-hidden="true">#</a> 3.5\u7ED8\u5236\u5BBD\u5EA6\u7EBF</h4><ol><li>\u5EFA\u7ACB\u4E00\u4E2ABoldLine \u5BF9\u8C61</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Vector2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span>
<span class="token comment">/*
\u5C5E\u6027\uFF1A
  points:\u7EBF\u6761\u8282\u70B9,\u4E8C\u7EF4\uFF0C[Vector2,Vector2,\u2026\u2026]
  lineWidth\uFF1A\u7EBF\u5BBD
  vertices\uFF1A\u9876\u70B9\u96C6\u5408
  normals\uFF1A\u6CD5\u7EBF\u96C6\u5408
  indexes\uFF1A\u9876\u70B9\u7D22\u5F15\u96C6\u5408
  uv\uFF1Auv\u5750\u6807\u96C6\u5408
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">BoldLine</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">points<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lineWidth<span class="token operator">=</span><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>points<span class="token operator">=</span>points
    <span class="token keyword">this</span><span class="token punctuation">.</span>lineWidth<span class="token operator">=</span>lineWidth
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>normals<span class="token operator">=</span><span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uv <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> points<span class="token punctuation">,</span><span class="token literal-property property">lineWidth</span><span class="token operator">:</span>h <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> points<span class="token punctuation">.</span>length
    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    
    <span class="token comment">// \u6324\u538B\u7EBF\u6761\uFF0C\u83B7\u53D6\u9876\u70B9</span>
    <span class="token keyword">const</span> extrudePoints<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extrude</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
    <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// \u9876\u70B9\u7D22\u5F15</span>
    <span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment">// \u4EE5\u7EBF\u6BB5\u6324\u538B\u51FA\u7684\u56DB\u8FB9\u5F62\u4E3A\u5355\u4F4D\uFF0C\u6784\u5EFA\u9876\u70B9\u96C6\u5408\u3001\u9876\u70B9\u7D22\u5F15</span>
    <span class="token keyword">const</span> len1 <span class="token operator">=</span> points<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len1<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//\u56DB\u8FB9\u5F62\u76844\u4E2A\u9876\u70B9</span>
      <span class="token keyword">const</span> pi<span class="token operator">=</span>i <span class="token operator">*</span> <span class="token number">2</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token constant">A1</span><span class="token punctuation">,</span> <span class="token constant">A2</span><span class="token punctuation">,</span> <span class="token constant">B1</span><span class="token punctuation">,</span> <span class="token constant">B2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        extrudePoints<span class="token punctuation">[</span>pi<span class="token punctuation">]</span><span class="token punctuation">,</span>
        extrudePoints<span class="token punctuation">[</span>pi<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        extrudePoints<span class="token punctuation">[</span>pi<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        extrudePoints<span class="token punctuation">[</span>pi<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
      vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token operator">...</span><span class="token constant">A1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">A2</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">B1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">B2</span>
      <span class="token punctuation">)</span>
      <span class="token comment">// \u9876\u70B9\u7D22\u5F15</span>
      <span class="token keyword">const</span> A1i <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">4</span>
      <span class="token keyword">const</span> A2i <span class="token operator">=</span> A1i<span class="token operator">+</span><span class="token number">1</span>
      <span class="token keyword">const</span> B1i <span class="token operator">=</span> A1i<span class="token operator">+</span><span class="token number">2</span>
      <span class="token keyword">const</span> B2i <span class="token operator">=</span> A1i <span class="token operator">+</span> <span class="token number">3</span>
      indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        A1i<span class="token punctuation">,</span>A2i<span class="token punctuation">,</span>B1i<span class="token punctuation">,</span>
        B1i<span class="token punctuation">,</span>A2i<span class="token punctuation">,</span>B2i
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>vertices<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indexes<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>indexes<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u6324\u538B\u7EBF\u6761</span>
  <span class="token function">extrude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> points <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">//\u7EBF\u5BBD\u7684\u4E00\u534A</span>
    <span class="token keyword">const</span> h <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lineWidth <span class="token operator">/</span> <span class="token number">2</span>
    <span class="token comment">//\u9876\u70B9\u96C6\u5408\uFF0C\u6324\u538B\u8D77\u59CB\u70B9\u7F6E\u5165\u5176\u4E2D</span>
    <span class="token keyword">const</span> extrudePoints <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">verticalPoint</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>h<span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token comment">// \u6324\u538B\u7EBF\u6761\u5185\u90E8\u70B9\uFF0C\u7F6E\u5165extrudePoints</span>
    <span class="token keyword">const</span> len1<span class="token operator">=</span>points<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">const</span> len2<span class="token operator">=</span>len1<span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len2<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// \u4E09\u4E2A\u70B9,\u4E24\u6761\u7EBF</span>
      <span class="token keyword">const</span> <span class="token constant">A</span><span class="token operator">=</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">const</span> <span class="token constant">B</span><span class="token operator">=</span>points<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token keyword">const</span> <span class="token constant">C</span> <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
      <span class="token comment">// \u4E24\u6761\u7EBF\u662F\u5426\u76F8\u4EA4</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">intersect</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        extrudePoints<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interPoint</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        extrudePoints<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">verticalPoint</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u6324\u538B\u6700\u540E\u4E00\u4E2A\u70B9</span>
    extrudePoints<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">verticalPoint</span><span class="token punctuation">(</span>
      points<span class="token punctuation">[</span>len2<span class="token punctuation">]</span><span class="token punctuation">,</span> points<span class="token punctuation">[</span>len1<span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">,</span> points<span class="token punctuation">[</span>len1<span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> extrudePoints
  <span class="token punctuation">}</span>

  <span class="token comment">// \u5224\u65AD\u4E24\u6761\u76F4\u7EBF\u662F\u5426\u76F8\u4EA4</span>
  <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span><span class="token constant">C</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> angAB<span class="token operator">=</span><span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">angle</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> angBC <span class="token operator">=</span> <span class="token constant">C</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">angle</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>angAB<span class="token operator">-</span>angBC<span class="token punctuation">)</span><span class="token operator">%</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//\u5782\u76F4\u6324\u538B\u70B9</span>
  <span class="token function">verticalPoint</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span><span class="token punctuation">,</span>h<span class="token punctuation">,</span><span class="token constant">M</span><span class="token operator">=</span><span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span>y<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u62D0\u70B9</span>
  <span class="token function">interPoint</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> d<span class="token operator">=</span><span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token constant">B</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> b <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token constant">BG</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>d<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>
    <span class="token keyword">const</span> BGLen<span class="token operator">=</span><span class="token constant">BG</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> cos <span class="token operator">=</span> <span class="token constant">BG</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">/</span> BGLen
    <span class="token keyword">const</span> <span class="token constant">BB2</span> <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>BGLen <span class="token operator">/</span> cos<span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token constant">BB1</span> <span class="token operator">=</span> <span class="token constant">BB2</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token constant">BB1</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token constant">BB2</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><ol start="2"><li>\u7ED8\u5236\u5BBD\u5EA6\u7EBF</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram<span class="token punctuation">,</span> imgPromise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./lv/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> 
    Matrix4<span class="token punctuation">,</span> 
    PerspectiveCamera<span class="token punctuation">,</span> 
    Vector3<span class="token punctuation">,</span> 
    Vector2 
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span>
  <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span>
  <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span>
  <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span>
  <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span>
  <span class="token keyword">import</span> BoldLine <span class="token keyword">from</span> <span class="token string">&#39;./lv/BoldLine.js&#39;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">900</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">900</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u573A\u666F</span>
  <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
  scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
    <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
        gl<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BoldLine</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> line<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> line<span class="token punctuation">.</span>indexes
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>	
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+cp+'" alt=""></p><h4 id="_3-6\u5BBD\u5EA6\u7EBF\u8D34\u56FE\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#_3-6\u5BBD\u5EA6\u7EBF\u8D34\u56FE\u601D\u8DEF" aria-hidden="true">#</a> 3.6\u5BBD\u5EA6\u7EBF\u8D34\u56FE\u601D\u8DEF</h4><p><img src="'+lp+`" alt=""></p><ol><li>\u4EE5\u7EBF\u6BB5\u6324\u51FA\u7684\u56DB\u8FB9\u5F62\u4E3A\u5355\u4F4D\u8FDB\u884C\u8D34\u56FE\u3002</li><li>\u8D34\u56FE\u7684\u65F6\u5019\uFF0C\u4E3A\u4E86\u65B9\u4FBF\u505A\u7EB9\u7406\u6620\u5C04\uFF0C\u53EF\u4EE5\u5148\u8BA9\u6BCF\u4E00\u4E2A\u56DB\u8FB9\u5F62\u8EBA\u5E73\uFF0C\u518D\u505A\u7EB9\u7406\u6620\u5C04\u3002</li><li>\u4E3A\u4E86\u907F\u514D\u8D34\u56FE\u62C9\u4F38\uFF0C\u53EF\u57FA\u4E8E\u7EBF\u5BBD\uFF0C\u8BBE\u7F6E\u8D34\u56FE\u5728u\u5411\u7684reapeat \u7CFB\u6570\u3002</li></ol><p>\u4E3E\u4E2A\u4F8B\u5B50\u3002</p><p><code>\u5DF2\u77E5</code>\uFF1A</p><ul><li>\u8D34\u56FE\u662F\u4E00\u4E2A\u6B63\u65B9\u5F62\u56FE\u7247\u3002</li><li>\u7EBF\u5BBD\u4E3Ah</li></ul><p><code>\u6C42</code>\uFF1A\u5219\u70B9B1\u3001B2\u3001C1\u3001C2\u6240\u5BF9\u5E94\u7684uv\u5750\u6807</p><p><code>\u89E3</code>\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">B1</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token constant">B12</span><span class="token punctuation">.</span>x<span class="token operator">/</span>h<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token constant">B2</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token constant">B22</span><span class="token punctuation">.</span>x<span class="token operator">/</span>h<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token constant">C1</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token constant">C12</span><span class="token punctuation">.</span>x<span class="token operator">/</span>h<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token constant">C2</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token constant">C22</span><span class="token punctuation">.</span>x<span class="token operator">/</span>h<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-7\u5BBD\u5EA6\u7EBF\u8D34\u56FE\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_3-7\u5BBD\u5EA6\u7EBF\u8D34\u56FE\u4EE3\u7801" aria-hidden="true">#</a> 3.7\u5BBD\u5EA6\u7EBF\u8D34\u56FE\u4EE3\u7801</h4><ol><li>\u5728BoldLine.js \u4E2D\u8BA1\u7B97uv\u5750\u6807\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> points<span class="token punctuation">,</span><span class="token literal-property property">lineWidth</span><span class="token operator">:</span>h <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> points<span class="token punctuation">.</span>length
  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

  <span class="token comment">// \u6324\u538B\u7EBF\u6761\uFF0C\u83B7\u53D6\u9876\u70B9</span>
  <span class="token keyword">const</span> extrudePoints<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">extrude</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// \u9876\u70B9\u96C6\u5408</span>
  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// \u9876\u70B9\u7D22\u5F15</span>
  <span class="token keyword">const</span> indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// uv \u5750\u6807</span>
  <span class="token keyword">const</span> uv<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token comment">// \u4EE5\u7EBF\u6BB5\u6324\u538B\u6210\u7684\u56DB\u8FB9\u5F62\u4E3A\u5355\u4F4D\uFF0C\u6784\u5EFA\u9876\u70B9\u96C6\u5408\u3001\u9876\u70B9\u7D22\u5F15\u3001uv</span>
  <span class="token keyword">const</span> len1 <span class="token operator">=</span> points<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len1<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u56DB\u8FB9\u5F62\u76844\u4E2A\u9876\u70B9</span>
    <span class="token keyword">const</span> pi<span class="token operator">=</span>i <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token constant">A1</span><span class="token punctuation">,</span> <span class="token constant">A2</span><span class="token punctuation">,</span> <span class="token constant">B1</span><span class="token punctuation">,</span> <span class="token constant">B2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      extrudePoints<span class="token punctuation">[</span>pi<span class="token punctuation">]</span><span class="token punctuation">,</span>
      extrudePoints<span class="token punctuation">[</span>pi<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      extrudePoints<span class="token punctuation">[</span>pi<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      extrudePoints<span class="token punctuation">[</span>pi<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    vertices<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token operator">...</span><span class="token constant">A1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">A2</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">B1</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">B2</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// \u9876\u70B9\u7D22\u5F15</span>
    <span class="token keyword">const</span> A1i <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token number">4</span>
    <span class="token keyword">const</span> A2i <span class="token operator">=</span> A1i<span class="token operator">+</span><span class="token number">1</span>
    <span class="token keyword">const</span> B1i <span class="token operator">=</span> A1i<span class="token operator">+</span><span class="token number">2</span>
    <span class="token keyword">const</span> B2i <span class="token operator">=</span> A1i <span class="token operator">+</span> <span class="token number">3</span>
    indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      A1i<span class="token punctuation">,</span>A2i<span class="token punctuation">,</span>B1i<span class="token punctuation">,</span>
      B1i<span class="token punctuation">,</span>A2i<span class="token punctuation">,</span>B2i
    <span class="token punctuation">)</span>
    <span class="token comment">//\u9006\u5411\u65CB\u8F6C\u56DB\u8FB9\u5F62</span>
    <span class="token keyword">const</span> ang <span class="token operator">=</span> <span class="token operator">-</span><span class="token constant">B1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">angle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token constant">O</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>lb<span class="token punctuation">,</span> rt<span class="token punctuation">,</span> rb<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token constant">A2</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rotateAround</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">,</span>ang<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token constant">B1</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rotateAround</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">,</span>ang<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token constant">B2</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token constant">A1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rotateAround</span><span class="token punctuation">(</span><span class="token constant">O</span><span class="token punctuation">,</span>ang<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    uv<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token comment">//A1</span>
      lb<span class="token punctuation">.</span>x <span class="token operator">/</span> h<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//A2</span>
      rt<span class="token punctuation">.</span>x <span class="token operator">/</span> h<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//B1</span>
      rb<span class="token punctuation">.</span>x <span class="token operator">/</span> h<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//B2</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>vertices <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uv<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>uv<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>indexes<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>indexes<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><ol start="2"><li>\u7ED8\u5236\u5BBD\u5EA6\u7EBF</li></ol><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    attribute vec4 a_Position<span class="token punctuation">;</span>
    attribute vec2 a_Pin<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_Position <span class="token operator">=</span> a_Position<span class="token punctuation">;</span>
      v_Pin<span class="token operator">=</span>a_Pin<span class="token punctuation">;</span>
      gl_PointSize<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    precision mediump float<span class="token punctuation">;</span>
    uniform sampler2D u_Sampler<span class="token punctuation">;</span>
    varying vec2 v_Pin<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span><span class="token function">texture2D</span><span class="token punctuation">(</span>u_Sampler<span class="token punctuation">,</span>v_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createProgram<span class="token punctuation">,</span> imgPromise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./lv/Utils.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> 
    Matrix4<span class="token punctuation">,</span> 
    PerspectiveCamera<span class="token punctuation">,</span> 
    Vector3<span class="token punctuation">,</span> 
    Vector2 
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;https://unpkg.com/three/build/three.module.js&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> OrbitControls <span class="token keyword">from</span> <span class="token string">&#39;./jsm/OrbitControls.js&#39;</span>
  <span class="token keyword">import</span> Mat <span class="token keyword">from</span> <span class="token string">&#39;./lv/Mat.js&#39;</span>
  <span class="token keyword">import</span> Geo <span class="token keyword">from</span> <span class="token string">&#39;./lv/Geo.js&#39;</span>
  <span class="token keyword">import</span> Obj3D <span class="token keyword">from</span> <span class="token string">&#39;./lv/Obj3D.js&#39;</span>
  <span class="token keyword">import</span> Scene <span class="token keyword">from</span> <span class="token string">&#39;./lv/Scene.js&#39;</span>
  <span class="token keyword">import</span> BoldLine <span class="token keyword">from</span> <span class="token string">&#39;./lv/BoldLine.js&#39;</span>

  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">900</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">900</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;webgl&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u573A\u666F</span>
  <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span> gl <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6CE8\u518C\u7A0B\u5E8F\u5BF9\u8C61</span>
  scene<span class="token punctuation">.</span><span class="token function">registerProgram</span><span class="token punctuation">(</span>
    <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>
        gl<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;vs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">,</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">attributeNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;a_Position&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;a_Pin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">uniformNames</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> mat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">program</span><span class="token operator">:</span> <span class="token string">&#39;line&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;TRIANGLES&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BoldLine</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> geo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Geo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> line<span class="token punctuation">.</span>vertices<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a_Pin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">array</span><span class="token operator">:</span> line<span class="token punctuation">.</span>uv<span class="token punctuation">,</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">array</span><span class="token operator">:</span> line<span class="token punctuation">.</span>indexes
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Obj3D</span><span class="token punctuation">(</span><span class="token punctuation">{</span> geo<span class="token punctuation">,</span> mat <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">./images/road.jpg</span><span class="token template-punctuation string">\`</span></span>
  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mat<span class="token punctuation">.</span><span class="token function">setMap</span><span class="token punctuation">(</span><span class="token string">&#39;u_Sampler&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      image
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    scene<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br></div></div><ol start="3"><li>\u5BF9Mat.js \u5BF9\u8C61\u91CC\u7684updateMap() \u65B9\u6CD5\u7A0D\u4F5C\u8C03\u6574\uFF0C\u5224\u65AD\u4E00\u4E0B\u8981\u66F4\u65B0\u7684\u8D34\u56FE\u91CC\u6709\u6CA1\u6709\u7EB9\u7406\u5BF9\u8C61texture\uFF0C\u82E5\u6CA1\u6709\uFF0C\u5C31\u65B0\u5EFA\u4E00\u4E2A\u3002</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">updateMap</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> map<span class="token punctuation">,</span> ind</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    format <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">RGB</span><span class="token punctuation">,</span>
    image<span class="token punctuation">,</span>
    wrapS<span class="token punctuation">,</span>
    wrapT<span class="token punctuation">,</span>
    magFilter<span class="token punctuation">,</span>
    minFilter<span class="token punctuation">,</span>
    texture
  <span class="token punctuation">}</span> <span class="token operator">=</span> map
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>texture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">.</span>texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  gl<span class="token punctuation">.</span><span class="token function">pixelStorei</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">UNPACK_FLIP_Y_WEBGL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">TEXTURE</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>ind<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> map<span class="token punctuation">.</span>texture<span class="token punctuation">)</span>
  \u2026\u2026
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>\u6548\u679C\u5982\u4E0B\uFF1A</p><p><img src="`+_+'" alt=""></p>',25);function Gp(Wp,Hp){const p=P("ExternalLinkIcon");return S(),E(M,null,[rp,s("p",null,[ip,s("a",kp,[bp,t(p)]),mp,dp,gp]),vp,s("p",null,[yp,s("a",fp,[hp,t(p)]),wp]),xp,s("p",null,[_p,jp,qp,s("a",Pp,[Sp,t(p)]),Ep]),Mp,s("p",null,[Rp,Tp,Ap,s("a",Bp,[Fp,t(p)]),Cp,Ip,Lp]),Op,s("p",null,[Dp,s("a",zp,[Up,t(p)]),Vp]),Np],64)}var Kp=R(up,[["render",Gp]]);export{Kp as default};
