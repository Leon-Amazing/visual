<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.34">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="logo.png"><title>GLSL ES 基础 | 数据可视化</title><meta name="description" content="Leon's library">
    <link rel="modulepreload" href="/visual/assets/app.6795915a.js"><link rel="modulepreload" href="/visual/assets/GLSL-ES-basic.html.6b063d62.js"><link rel="modulepreload" href="/visual/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/visual/assets/GLSL-ES-basic.html.3bd7f544.js">
    <link rel="stylesheet" href="/visual/assets/style.14b7ee11.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/visual/" class=""><img class="logo" src="/visual/logo.png" alt="数据可视化"><span class="site-name can-hide">数据可视化</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/visual/computer/ComputerGraphics.md" class="" aria-label="计算机图形学"><!--[--><!--]--> 计算机图形学 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="WebGL"><span class="title">WebGL</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="WebGL"><span class="title">WebGL</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>WebGL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/visual/webgl/WebGL-share.md" class="" aria-label="WebGL基础"><!--[--><!--]--> WebGL基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/visual/webgl/WebGL-practice.md" class="" aria-label="WebGL实践"><!--[--><!--]--> WebGL实践 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>GLSL ES</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/visual/webgl/GLSL-ES-basic.md" class="" aria-label="GLSL ES基础"><!--[--><!--]--> GLSL ES基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/visual/webgl/GLSL-ES-practice.md" class="" aria-label="GLSL ES实践"><!--[--><!--]--> GLSL ES实践 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/visual/threejs/index.md" class="" aria-label="ThreeJS"><!--[--><!--]--> ThreeJS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/visual/echarts/index.md" class="" aria-label="Echarts"><!--[--><!--]--> Echarts <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/visual/computer/ComputerGraphics.md" class="" aria-label="计算机图形学"><!--[--><!--]--> 计算机图形学 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="WebGL"><span class="title">WebGL</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="WebGL"><span class="title">WebGL</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>WebGL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/visual/webgl/WebGL-share.md" class="" aria-label="WebGL基础"><!--[--><!--]--> WebGL基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/visual/webgl/WebGL-practice.md" class="" aria-label="WebGL实践"><!--[--><!--]--> WebGL实践 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>GLSL ES</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/visual/webgl/GLSL-ES-basic.md" class="" aria-label="GLSL ES基础"><!--[--><!--]--> GLSL ES基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/visual/webgl/GLSL-ES-practice.md" class="" aria-label="GLSL ES实践"><!--[--><!--]--> GLSL ES实践 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/visual/threejs/index.md" class="" aria-label="ThreeJS"><!--[--><!--]--> ThreeJS <!--[--><!--]--></a></div><div class="navbar-item"><a href="/visual/echarts/index.md" class="" aria-label="Echarts"><!--[--><!--]--> Echarts <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">GLSL ES 基础 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#一、-glsl-es-概述和基本规范" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、 GLSL ES 概述和基本规范"><!--[--><!--]--> 一、 GLSL ES 概述和基本规范 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#二、-glsl-es-语法测试" class="router-link-active router-link-exact-active sidebar-item" aria-label="二、 GLSL ES 语法测试"><!--[--><!--]--> 二、 GLSL ES 语法测试 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-glsl-es-数据的输出" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.GLSL ES 数据的输出"><!--[--><!--]--> 1.GLSL ES 数据的输出 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-在-canvas-画布中获取像素数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.在 canvas 画布中获取像素数据"><!--[--><!--]--> 2.在 canvas 画布中获取像素数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-打印多个向量" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.打印多个向量"><!--[--><!--]--> 3.打印多个向量 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_4-打印多个向量-适配不同分辨率的设备" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 打印多个向量-适配不同分辨率的设备"><!--[--><!--]--> 4. 打印多个向量-适配不同分辨率的设备 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#三、-变量" class="router-link-active router-link-exact-active sidebar-item" aria-label="三、 变量"><!--[--><!--]--> 三、 变量 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-声明变量的方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.声明变量的方法"><!--[--><!--]--> 1.声明变量的方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-变量命名规范" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.变量命名规范"><!--[--><!--]--> 2.变量命名规范 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-变量的赋值" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.变量的赋值"><!--[--><!--]--> 3.变量的赋值 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_4-变量的类型转换" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.变量的类型转换"><!--[--><!--]--> 4.变量的类型转换 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#四、向量" class="router-link-active router-link-exact-active sidebar-item" aria-label="四、向量"><!--[--><!--]--> 四、向量 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-向量类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.向量类型"><!--[--><!--]--> 1.向量类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-向量的创建" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.向量的创建"><!--[--><!--]--> 2.向量的创建 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-向量分量的访问" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.向量分量的访问"><!--[--><!--]--> 3.向量分量的访问 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#五、矩阵" class="router-link-active router-link-exact-active sidebar-item" aria-label="五、矩阵"><!--[--><!--]--> 五、矩阵 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-矩阵的类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.矩阵的类型"><!--[--><!--]--> 1.矩阵的类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-矩阵的建立" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.矩阵的建立"><!--[--><!--]--> 2.矩阵的建立 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-矩阵的访问" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.矩阵的访问"><!--[--><!--]--> 3.矩阵的访问 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#六、运算符" class="router-link-active router-link-exact-active sidebar-item" aria-label="六、运算符"><!--[--><!--]--> 六、运算符 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-算术运算符" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.算术运算符"><!--[--><!--]--> 1.算术运算符 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-赋值运算符" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.赋值运算符"><!--[--><!--]--> 2.赋值运算符 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-比较运算符" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.比较运算符"><!--[--><!--]--> 3.比较运算符 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_4-条件运算符" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.条件运算符"><!--[--><!--]--> 4.条件运算符 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_5-逻辑运算符" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.逻辑运算符"><!--[--><!--]--> 5.逻辑运算符 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#七、向量运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="七、向量运算"><!--[--><!--]--> 七、向量运算 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-向量和单独数字的运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.向量和单独数字的运算"><!--[--><!--]--> 1.向量和单独数字的运算 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-向量和向量的运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.向量和向量的运算"><!--[--><!--]--> 2.向量和向量的运算 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-向量和矩阵的运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.向量和矩阵的运算"><!--[--><!--]--> 3.向量和矩阵的运算 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#八、矩阵运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="八、矩阵运算"><!--[--><!--]--> 八、矩阵运算 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-矩阵和单独数字的运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="1-矩阵和单独数字的运算"><!--[--><!--]--> 1-矩阵和单独数字的运算 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-矩阵和矩阵的运算" class="router-link-active router-link-exact-active sidebar-item" aria-label="2-矩阵和矩阵的运算"><!--[--><!--]--> 2-矩阵和矩阵的运算 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#九、struct" class="router-link-active router-link-exact-active sidebar-item" aria-label="九、struct"><!--[--><!--]--> 九、struct <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#十、数组" class="router-link-active router-link-exact-active sidebar-item" aria-label="十、数组"><!--[--><!--]--> 十、数组 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#十一、程序流程控制" class="router-link-active router-link-exact-active sidebar-item" aria-label="十一、程序流程控制"><!--[--><!--]--> 十一、程序流程控制 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-if-判断" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.if 判断"><!--[--><!--]--> 1.if 判断 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-for-循环" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.for 循环"><!--[--><!--]--> 2.for 循环 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#十二、函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="十二、函数"><!--[--><!--]--> 十二、函数 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-函数的建立" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.函数的建立"><!--[--><!--]--> 1.函数的建立 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-示例" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.示例"><!--[--><!--]--> 2.示例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_3-函数的声明" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.函数的声明"><!--[--><!--]--> 3.函数的声明 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_4-参数限定词" class="router-link-active router-link-exact-active sidebar-item" aria-label="4-参数限定词"><!--[--><!--]--> 4-参数限定词 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#十三、变量的作用域" class="router-link-active router-link-exact-active sidebar-item" aria-label="十三、变量的作用域"><!--[--><!--]--> 十三、变量的作用域 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#十四、精度限定词" class="router-link-active router-link-exact-active sidebar-item" aria-label="十四、精度限定词"><!--[--><!--]--> 十四、精度限定词 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_1-精度的分类" class="router-link-active router-link-exact-active sidebar-item" aria-label="1-精度的分类"><!--[--><!--]--> 1-精度的分类 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/visual/webgl/GLSL-ES-basic.html#_2-精度的定义方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="2-精度的定义方法"><!--[--><!--]--> 2-精度的定义方法 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="glsl-es-基础" tabindex="-1"><a class="header-anchor" href="#glsl-es-基础" aria-hidden="true">#</a> GLSL ES 基础</h1><h2 id="一、-glsl-es-概述和基本规范" tabindex="-1"><a class="header-anchor" href="#一、-glsl-es-概述和基本规范" aria-hidden="true">#</a> 一、 GLSL ES 概述和基本规范</h2><blockquote><p>GLSL ES 是在 GLSL（OpenGL 着色器语言）的基础上，删除和简化了一部分功能后形成的，ES 版本主要降低了硬件功耗，减少了性能开销。<br> 实际上 WebGL 并不支持 GLSL ES 的所有特性，所以大家以后在 WebGL API 里可能会遇到部分参数无效的情况。</p></blockquote><p>GLSL ES 是写在着色器中的，其具备以下基本规范：</p><ol><li><p>大小写敏感</p></li><li><p>语句末尾必须要有分号</p></li><li><p>以 main 函数为主函数</p></li><li><p>注释语法和 js 一样</p></li></ol><ul><li>单行: //</li><li>多行: /**/</li></ul><ol start="5"><li>基本数据类型：</li></ol><ul><li>数字型 <ul><li>浮点型 float，如 1.0</li><li>整型 int，如 1</li></ul></li><li>布尔型 bool <ul><li>true</li><li>false</li></ul></li></ul><h2 id="二、-glsl-es-语法测试" tabindex="-1"><a class="header-anchor" href="#二、-glsl-es-语法测试" aria-hidden="true">#</a> 二、 GLSL ES 语法测试</h2><h3 id="_1-glsl-es-数据的输出" tabindex="-1"><a class="header-anchor" href="#_1-glsl-es-数据的输出" aria-hidden="true">#</a> 1.GLSL ES 数据的输出</h3><p>实现思路是先把 GLSL ES 数据画到画布中，然后再从画布的像素数据中解析出 GLSL ES 数据。</p><p>因为 gl_FragColor 中 1 个单位的分量就相当于 canvas 画布中 255 的分量值，所以我让上面的向量 v 直接除以 255。</p><p>注：此方法只适用于向量因子在 0-255 的数据。我们在此先不考虑太深，先把语法跑通。</p><h3 id="_2-在-canvas-画布中获取像素数据" tabindex="-1"><a class="header-anchor" href="#_2-在-canvas-画布中获取像素数据" aria-hidden="true">#</a> 2.在 canvas 画布中获取像素数据</h3><p>通过 canvas.getContext() 方法获取 2d 或 webgl 上下文对象的同时，也决定了 canvas 画布的命运。</p><p>canvas.getContext(‘2d’) 方法会让 canvas 画布变成 2d 画布，2d 的 canvas 画布可以通过 ctx.getImageData() 方法获取画布中的像素；</p><p>canvas.getContext(‘webgl’) 方法会让 canvas 画布变成 webgl 画布，webgl 画布需要通过 ctx.readPixels() 方法获取画布中的像素。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 顶点着色器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//点位</span>
    gl_Position<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//尺寸</span>
    gl_PointSize<span class="token operator">=</span><span class="token number">512.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 片元着色器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>v<span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token comment">// 获取着色器文本</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token comment">//三维画笔</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//初始化着色器</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//声明颜色 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//刷底色</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//绘制顶点</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//像素容器</span>
  <span class="token keyword">const</span> pixel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//抓取像素</span>
  gl<span class="token punctuation">.</span><span class="token function">readPixels</span><span class="token punctuation">(</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">1</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
    gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
    pixel
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pixel<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [6, 8, 10, 12]</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>gl.readPixels(x, y, width, height, format, type, pixels)</p><ul><li>x, y：从哪里采集像素</li><li>width, height：采集多大一块区域的像素</li><li>format：数据格式</li><li>type：数据类型 <ul><li>gl.UNSIGNED_BYTE</li><li>gl.UNSIGNED_SHORT_5_6_5</li><li>gl.UNSIGNED_SHORT_4_4_4_4</li><li>gl.UNSIGNED_SHORT_5_5_5_1</li><li>gl.FLOAT</li></ul></li><li>pixels：装像素的容器 <ul><li>Uint8Array 对应 gl.UNSIGNED_BYTE</li><li>Uint16Array 对应 gl.UNSIGNED_SHORT_5_6_5, gl.UNSIGNED_SHORT_4_4_4_4, 或者 gl.UNSIGNED_SHORT_5_5_5_1</li><li>Float32Array 对应 gl.FLOAT</li></ul></li></ul><h3 id="_3-打印多个向量" tabindex="-1"><a class="header-anchor" href="#_3-打印多个向量" aria-hidden="true">#</a> 3.打印多个向量</h3><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 顶点着色器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//点位</span>
    gl_Position<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//尺寸</span>
    gl_PointSize<span class="token operator">=</span><span class="token number">512.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 片元着色器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>
    <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float dist<span class="token operator">=</span><span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1-0.5</span>
    <span class="token comment">//0.5/4=0.125</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.0</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.125</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.125</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.25</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.375</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.375</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      discard<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token comment">// 获取着色器文本</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token comment">//三维画笔</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//初始化着色器</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//声明颜色 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//刷底色</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//绘制顶点</span>
  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">POINTS</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//圆环宽度</span>
  <span class="token keyword">const</span> vw <span class="token operator">=</span> <span class="token number">512</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token comment">//遍历圆环</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">logPixel</span><span class="token punctuation">(</span>vw <span class="token operator">*</span> i <span class="token operator">+</span> vw <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">logPixel</span><span class="token punctuation">(</span><span class="token parameter">offset <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//像素容器</span>
    <span class="token keyword">const</span> pixel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//抓取像素</span>
    gl<span class="token punctuation">.</span><span class="token function">readPixels</span><span class="token punctuation">(</span>
      canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> offset<span class="token punctuation">,</span>
      canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token number">1</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span>
      gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span>
      pixel
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pixel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Uint8Array(4)[(255, 0, 0, 255)];</span>
    <span class="token comment">// Uint8Array(4)[(255, 255, 0, 255)];</span>
    <span class="token comment">// Uint8Array(4)[(0, 255, 0, 255)];</span>
    <span class="token comment">// Uint8Array(4)[(0, 0, 255, 255)];</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br></div></div><p>效果如下：<br><img src="/visual/glsl-es/-1.png" alt=""></p><p>注：</p><p>上面这种方式，在特定的一些高分辨率设备上，会出现兼容性问题，画出来的圆会比较小，取样会失败。</p><h3 id="_4-打印多个向量-适配不同分辨率的设备" tabindex="-1"><a class="header-anchor" href="#_4-打印多个向量-适配不同分辨率的设备" aria-hidden="true">#</a> 4. 打印多个向量-适配不同分辨率的设备</h3><p>接下来会基于片元位置和画布的宽高比绘图，然后再基于这样的比例取样。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 顶点着色器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertexShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-vertex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  attribute vec4 a_Position<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_Position<span class="token operator">=</span>a_Position<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 片元着色器 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  uniform vec2 u_CanvasSize<span class="token punctuation">;</span>
  float halfW<span class="token operator">=</span>u_CanvasSize<span class="token punctuation">.</span>x<span class="token operator">/</span><span class="token number">2.0</span><span class="token punctuation">;</span>
  float halfH<span class="token operator">=</span>u_CanvasSize<span class="token punctuation">.</span>y<span class="token operator">/</span><span class="token number">2.0</span><span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
      <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>
      <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>
      <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    bool xb<span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>x<span class="token operator">&lt;</span>halfW<span class="token punctuation">;</span>
    bool yb<span class="token operator">=</span> gl_FragCoord<span class="token punctuation">.</span>y<span class="token operator">&lt;</span>halfH<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>yb<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>xb<span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>xb<span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> initShaders <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../jsm/Utils.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Poly <span class="token keyword">from</span> <span class="token string">&quot;./jsm/Poly.js&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token comment">// 获取着色器文本</span>
  <span class="token keyword">const</span> vsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#vertexShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token keyword">const</span> fsSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#fragmentShader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>
  <span class="token comment">//三维画笔</span>
  <span class="token keyword">const</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//初始化着色器</span>
  <span class="token function">initShaders</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vsSource<span class="token punctuation">,</span> fsSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//声明颜色 rgba</span>
  gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Poly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    gl<span class="token punctuation">,</span>
    source<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;TRIANGLE_STRIP&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a_Position</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">u_CanvasSize</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;uniform2fv&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  rect<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>w<span class="token punctuation">,</span> h<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> px <span class="token operator">=</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> w<span class="token punctuation">;</span>
      <span class="token keyword">const</span> py <span class="token operator">=</span> <span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> h<span class="token punctuation">;</span>
      <span class="token function">logPixel</span><span class="token punctuation">(</span>px<span class="token punctuation">,</span> py<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">logPixel</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pixel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl<span class="token punctuation">.</span><span class="token function">readPixels</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> pixel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pixel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Uint8Array(4)[(255, 0, 0, 255)];</span>
    <span class="token comment">// Uint8Array(4)[(255, 255, 0, 255)];</span>
    <span class="token comment">// Uint8Array(4)[(0, 255, 0, 255)];</span>
    <span class="token comment">// Uint8Array(4)[(0, 0, 255, 255)];</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><h2 id="三、-变量" tabindex="-1"><a class="header-anchor" href="#三、-变量" aria-hidden="true">#</a> 三、 变量</h2><h3 id="_1-声明变量的方法" tabindex="-1"><a class="header-anchor" href="#_1-声明变量的方法" aria-hidden="true">#</a> 1.声明变量的方法</h3><p>GLSL ES 是强类型语言，在声明变量的时候应该指明变量类型，如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>float f<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
int i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
bool b<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-变量命名规范" tabindex="-1"><a class="header-anchor" href="#_2-变量命名规范" aria-hidden="true">#</a> 2.变量命名规范</h3><ul><li>只能包括 a-z,A-Z,0-9,_</li><li>变量名首字母不能是数字</li><li>不能是 GLSL 关键字，如 attribute,vec4,bool</li><li>不能是 GLSL 保留字，如 cast,class,long</li><li>不能以下单词开头：gl_, webgl_, _webgl_</li></ul><h3 id="_3-变量的赋值" tabindex="-1"><a class="header-anchor" href="#_3-变量的赋值" aria-hidden="true">#</a> 3.变量的赋值</h3><p>变量使用等号=赋值，=两侧的数据类型需要一致。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>int i<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// ✔</span>
int i<span class="token operator">=</span><span class="token number">8.0</span><span class="token punctuation">;</span> <span class="token comment">// ✖</span>
float f<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// ✖</span>
float f<span class="token operator">=</span><span class="token number">8.0</span><span class="token punctuation">;</span> <span class="token comment">// ✔</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-变量的类型转换" tabindex="-1"><a class="header-anchor" href="#_4-变量的类型转换" aria-hidden="true">#</a> 4.变量的类型转换</h3><p>有时候，需要将类型 a 的数据转成类型 b 的数据，交给类型为 b 的变量。</p><p>比如，要把整形数字转成浮点型交给浮点型变量：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>float f<span class="token operator">=</span><span class="token function">float</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>基础数据的转换有以下几种：</p><ul><li>浮点转整数：int(float)</li><li>布尔转整数：int(bool)</li><li>整数转浮点：float(int)</li><li>布尔转浮点：float(bool)</li><li>整数转布尔：bool(int)</li><li>浮点转布尔：bool(float)</li></ul><h2 id="四、向量" tabindex="-1"><a class="header-anchor" href="#四、向量" aria-hidden="true">#</a> 四、向量</h2><h3 id="_1-向量类型" tabindex="-1"><a class="header-anchor" href="#_1-向量类型" aria-hidden="true">#</a> 1.向量类型</h3><p>GLSL ES 支持 2、3、4 维向量，根据分量的数据类型，向量可以分为 3 类：</p><ul><li>vec2、vec3、vec4：分量是浮点数</li><li>ivec2、ivec3、ivec4：分量是整数</li><li>bvec2、bvec3、bvec4：分量是布尔值</li></ul><h3 id="_2-向量的创建" tabindex="-1"><a class="header-anchor" href="#_2-向量的创建" aria-hidden="true">#</a> 2.向量的创建</h3><p>在 GLSL ES 中，向量占有很重要的地位，所以 GLSL ES 为其提供了非常灵活的创建方式。</p><p>比如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec3 v3 <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// (1.0, 0.0, 0.5)</span>
vec2 v2 <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// (1.0, 0.0)</span>
vec4 v4 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        	 <span class="token comment">// (1.0,1.0,1.0,1.0)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>还可以将多个向量合在一起：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 v4b<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>        	 <span class="token comment">// (1.0,0.0,1.0,1.0)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>注：= 两侧的数据类型必须一致，比如下面的写法会报错：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 v4 <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//错的</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_3-向量分量的访问" tabindex="-1"><a class="header-anchor" href="#_3-向量分量的访问" aria-hidden="true">#</a> 3.向量分量的访问</h3><ul><li>通过分量属性访问</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>v4<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>z<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>w<span class="token punctuation">;</span> <span class="token comment">// 齐次坐标</span>
v4<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>b<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 色值</span>
v4<span class="token punctuation">.</span>s<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>t<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>p<span class="token punctuation">,</span> v4<span class="token punctuation">.</span>q<span class="token punctuation">;</span> <span class="token comment">// 纹理坐标</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>将分量的多个属性连在一起，可以获取多个向量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 v4 <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">,</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v4<span class="token punctuation">.</span>xy <span class="token comment">//(1.0,2.0)</span>
v4<span class="token punctuation">.</span>yx <span class="token comment">//(2.0,1.0)</span>
v4<span class="token punctuation">.</span>xw <span class="token comment">//(1.0,4.0)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>通过分量索引访问</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>v4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v4<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v4<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v4<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>用上面的方法访问到向量后，也可以用=号为向量赋值。</p><p>如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>v4<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
v4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
v4<span class="token punctuation">.</span>xy <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="五、矩阵" tabindex="-1"><a class="header-anchor" href="#五、矩阵" aria-hidden="true">#</a> 五、矩阵</h2><h3 id="_1-矩阵的类型" tabindex="-1"><a class="header-anchor" href="#_1-矩阵的类型" aria-hidden="true">#</a> 1.矩阵的类型</h3><p>GLSL ES 支持 2、3、4 维矩阵：</p><ul><li>mat2</li><li>mat3</li><li>mat4</li></ul><p>矩阵中的元素都是浮点型。</p><h3 id="_2-矩阵的建立" tabindex="-1"><a class="header-anchor" href="#_2-矩阵的建立" aria-hidden="true">#</a> 2.矩阵的建立</h3><p>GLSL ES 中的矩阵是列主序的，在建立矩阵的时候，其参数结构有很多种。</p><ul><li>浮点数，其参数是按照列主序排列的。</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mat4 m=mat4(
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>向量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 v4_1<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v4_2<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v4_3<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v4_4<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>v4_1<span class="token punctuation">,</span>v4_2<span class="token punctuation">,</span>v4_3<span class="token punctuation">,</span>v4_4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
[
	1,2,3,4,
    5,6,7,8,
    9,10,11,12,
    13,14,15,16
]
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>浮点+向量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 v4_1<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v4_2<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    v4_1<span class="token punctuation">,</span>
    v4_2<span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
	1,5,9,13,
    2,6,10,14,
    3,7,11,15,
    4,8,12,16
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>单个浮点数</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
[
	1, 0, 0, 0,
    0, 1, 0, 0,
    0, 0, 1, 0,
    0, 0, 0, 1,
]
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注：如矩阵中的参数数量大于 1，小于矩阵元素数量，会报错</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m4 <span class="token operator">=</span> <span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 报错</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_3-矩阵的访问" tabindex="-1"><a class="header-anchor" href="#_3-矩阵的访问" aria-hidden="true">#</a> 3.矩阵的访问</h3><ol><li>使用[] 可以访问矩阵的某一行</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">/*
	1,5,9,13,
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>使用 m[y][x] 方法，可以访问矩阵第 y 行，第 x 列的元素。</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">/* 1 */</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="3"><li>m[y] 可以理解为一个向量，其内部的元素，可以像访问向量元素一样去访问。</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">//1</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token comment">//1</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>r <span class="token comment">//1</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>s <span class="token comment">//1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>注：我们在此要注意一下[] 中索引值的限制。</p><p>[] 中的索引值只能通过以下方式定义：</p><ul><li>整形字面量，如 0，1，2，3</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>用 const 修饰的变量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> int y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注：以下写法是错误的</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>int y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>循环索引</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 n<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>int i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>n<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ……
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>前面三项组成的表达式</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> int y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
m<span class="token punctuation">[</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="六、运算符" tabindex="-1"><a class="header-anchor" href="#六、运算符" aria-hidden="true">#</a> 六、运算符</h2><p>GLSL ES 的运算符合 js 类似。</p><h3 id="_1-算术运算符" tabindex="-1"><a class="header-anchor" href="#_1-算术运算符" aria-hidden="true">#</a> 1.算术运算符</h3><table><thead><tr><th>运算符</th><th>描述</th><th>例子</th></tr></thead><tbody><tr><td>+</td><td>加法</td><td>x = y + 2</td></tr><tr><td>-</td><td>减法</td><td>x = y - 2</td></tr><tr><td>*</td><td>乘法</td><td>x = y * 2</td></tr><tr><td>/</td><td>除法</td><td>x = y / 2</td></tr><tr><td>++</td><td>自增</td><td>x = ++y</td></tr><tr><td></td><td></td><td>x = y++</td></tr><tr><td>--</td><td>自减</td><td>x = --y</td></tr><tr><td></td><td></td><td>x = y--</td></tr></tbody></table><h3 id="_2-赋值运算符" tabindex="-1"><a class="header-anchor" href="#_2-赋值运算符" aria-hidden="true">#</a> 2.赋值运算符</h3><table><thead><tr><th>运算符</th><th>描述</th><th>例子</th></tr></thead><tbody><tr><td>=</td><td>赋值等于</td><td>x = y</td></tr><tr><td>+=</td><td>加等于</td><td>x += y</td></tr><tr><td>-=</td><td>减等于</td><td>x -= y</td></tr><tr><td>*=</td><td>乘等于</td><td>x *= y</td></tr><tr><td>/=</td><td>除等于</td><td>x /= y</td></tr></tbody></table><h3 id="_3-比较运算符" tabindex="-1"><a class="header-anchor" href="#_3-比较运算符" aria-hidden="true">#</a> 3.比较运算符</h3><table><thead><tr><th style="text-align:left;">运算符</th><th style="text-align:left;">描述</th><th style="text-align:left;">比较</th></tr></thead><tbody><tr><td style="text-align:left;">==</td><td style="text-align:left;">等于</td><td style="text-align:left;">x == 8</td></tr><tr><td style="text-align:left;">!=</td><td style="text-align:left;">不等于</td><td style="text-align:left;">x != 8</td></tr><tr><td style="text-align:left;">&gt;</td><td style="text-align:left;">大于</td><td style="text-align:left;">x &gt; 8</td></tr><tr><td style="text-align:left;">&lt;</td><td style="text-align:left;">小于</td><td style="text-align:left;">x &lt; 8</td></tr><tr><td style="text-align:left;">&gt;=</td><td style="text-align:left;">大于或等于</td><td style="text-align:left;">x &gt;= 8</td></tr><tr><td style="text-align:left;">&lt;=</td><td style="text-align:left;">小于或等于</td><td style="text-align:left;">x &lt;= 8</td></tr></tbody></table><h3 id="_4-条件运算符" tabindex="-1"><a class="header-anchor" href="#_4-条件运算符" aria-hidden="true">#</a> 4.条件运算符</h3><table><thead><tr><th style="text-align:left;">语法</th><th style="text-align:left;">例子</th></tr></thead><tbody><tr><td style="text-align:left;">布尔 ?值 1:值 2</td><td style="text-align:left;">float f=2&gt;3?1.0:2.0;</td></tr></tbody></table><h3 id="_5-逻辑运算符" tabindex="-1"><a class="header-anchor" href="#_5-逻辑运算符" aria-hidden="true">#</a> 5.逻辑运算符</h3><table><thead><tr><th style="text-align:left;">运算符</th><th style="text-align:left;">描述</th><th style="text-align:left;">例子</th></tr></thead><tbody><tr><td style="text-align:left;">&amp;&amp;</td><td style="text-align:left;">和</td><td style="text-align:left;">true&amp;&amp;true=true;</td></tr><tr><td style="text-align:left;">||</td><td style="text-align:left;">或</td><td style="text-align:left;">false||true=true; true||true=true;</td></tr><tr><td style="text-align:left;">!</td><td style="text-align:left;">非</td><td style="text-align:left;">!false=true;</td></tr><tr><td style="text-align:left;">^^</td><td style="text-align:left;">异或</td><td style="text-align:left;">false^^true=true; true^^true=false;</td></tr></tbody></table><h2 id="七、向量运算" tabindex="-1"><a class="header-anchor" href="#七、向量运算" aria-hidden="true">#</a> 七、向量运算</h2><p>向量可以与以下数据进行各种运算：</p><ul><li>单独数字</li><li>向量</li><li>矩阵</li></ul><h3 id="_1-向量和单独数字的运算" tabindex="-1"><a class="header-anchor" href="#_1-向量和单独数字的运算" aria-hidden="true">#</a> 1.向量和单独数字的运算</h3><p>向量可以与单独数字进行加减乘除。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v<span class="token operator">+=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
v<span class="token operator">-=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
v<span class="token operator">*=</span><span class="token number">2.0</span><span class="token punctuation">;</span>
v<span class="token operator">/=</span><span class="token number">2.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>vec4 是浮点型向量。</p><p>我们上例中，写在 vec4() 中的整数可以被 vec4() 方法转换成浮点数。</p><p>vec4 向量在做四则运算时，其用于运算的数字类型应该是浮点型。</p><p>比如，下面的写法会报错：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>v <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>整型向量 ivec2、ivec3、ivec4 的运算原理同上。</p><h3 id="_2-向量和向量的运算" tabindex="-1"><a class="header-anchor" href="#_2-向量和向量的运算" aria-hidden="true">#</a> 2.向量和向量的运算</h3><p>1.加减乘除</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 p<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v<span class="token operator">+=</span>p<span class="token punctuation">;</span>
v<span class="token operator">-=</span>p<span class="token punctuation">;</span>
v<span class="token operator">*=</span>p<span class="token punctuation">;</span>
v<span class="token operator">/=</span>p<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>2.其它方法</p><ul><li>distance(p0,p1) 向量距离</li><li>dot(p0,p1) 点积</li><li>cross(p0,p1) 叉乘</li><li>……</li></ul><h3 id="_3-向量和矩阵的运算" tabindex="-1"><a class="header-anchor" href="#_3-向量和矩阵的运算" aria-hidden="true">#</a> 3.向量和矩阵的运算</h3><p>矩阵只能与向量进行乘法运算。</p><p>向量乘以矩阵和矩阵乘以向量的结果是不一样的，但数据类型都是向量。</p><ul><li>矩阵乘以向量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 p<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v<span class="token operator">=</span>m<span class="token operator">*</span>p<span class="token punctuation">;</span>

<span class="token comment">/*
	[30, 70, 110, 150]
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>以 v.x 为例说一下其算法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>v<span class="token punctuation">.</span>x <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>x <span class="token operator">+</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>y <span class="token operator">+</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>z <span class="token operator">+</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">9</span> <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">;</span>
v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>向量乘以矩阵</p><p>将上面的代码改一下：</p></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vec4 v=p*m;

/*
	[90, 100, 110, 120]
*/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>以 v.x 为例说一下其算法：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>v<span class="token punctuation">.</span>x <span class="token operator">=</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>x <span class="token operator">+</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>y <span class="token operator">+</span> m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>z <span class="token operator">+</span> m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">9</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">13</span><span class="token punctuation">;</span>
v<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="八、矩阵运算" tabindex="-1"><a class="header-anchor" href="#八、矩阵运算" aria-hidden="true">#</a> 八、矩阵运算</h2><p>矩阵可以与以下数据进行各种运算：</p><ul><li><p>单独数字</p></li><li><p>向量</p></li><li><p>矩阵</p></li></ul><h3 id="_1-矩阵和单独数字的运算" tabindex="-1"><a class="header-anchor" href="#_1-矩阵和单独数字的运算" aria-hidden="true">#</a> 1-矩阵和单独数字的运算</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">16</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token operator">+=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
m<span class="token operator">-=</span><span class="token number">1.0</span><span class="token punctuation">;</span>
m<span class="token operator">*=</span><span class="token number">2.0</span><span class="token punctuation">;</span>
m<span class="token operator">/=</span><span class="token number">2.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-矩阵和矩阵的运算" tabindex="-1"><a class="header-anchor" href="#_2-矩阵和矩阵的运算" aria-hidden="true">#</a> 2-矩阵和矩阵的运算</h3><p>矩阵和矩阵之间可以进行加减乘除。</p><p>以下面的两个矩阵为例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mat4 m<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
mat4 n<span class="token operator">=</span><span class="token function">mat4</span><span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>1.矩阵加法：相同索引位置的元素相加</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m <span class="token operator">+=</span> n<span class="token punctuation">;</span>

<span class="token comment">/*
	3, 20, 9, 10,
	6, 12, 10, 9,
	12, 8, 9, 10,
	24, 12, 10, 9,
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>2.矩阵减法：相同索引位置的元素相减</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m <span class="token operator">-=</span> n<span class="token punctuation">;</span>
<span class="token comment">/*
	1, 12, 7, 6,
	2, 4, 6, 7,
	4, 0, 7, 6,
	8, 4, 6, 7,
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3.矩阵除法：相同索引位置的元素相除</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>m/=n;
/*
	2, 4, 8, 4,
	2, 2, 4, 8,
	2, 1, 8, 4,
	2, 2, 4, 8,
*/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3.矩阵乘法</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>m <span class="token operator">*=</span> n<span class="token punctuation">;</span>
<span class="token comment">/*
	58, 68, 64, 64,
	52, 80, 72, 72,
	64, 116, 88, 88,
	64, 176, 120, 120,
*/</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>矩阵乘法规则，我们之前在说复合矩阵的时候说过。</p><p>以其结果的的第一列为例，再回顾一下其计算规则：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">2</span>*<span class="token number">1</span>+<span class="token number">4</span>*<span class="token number">4</span>+<span class="token number">8</span>*<span class="token number">1</span>+<span class="token number">16</span>*<span class="token number">2</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">58</span>

m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">2</span>*<span class="token number">2</span>+<span class="token number">4</span>*<span class="token number">4</span>+<span class="token number">8</span>*<span class="token number">2</span>+<span class="token number">16</span>*<span class="token number">1</span>
m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">52</span>

m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">2</span>*<span class="token number">4</span>+<span class="token number">4</span>*<span class="token number">4</span>+<span class="token number">8</span>*<span class="token number">1</span>+<span class="token number">16</span>*<span class="token number">2</span>
m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">64</span>

m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>+m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>*n<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">2</span>*<span class="token number">8</span>+<span class="token number">4</span>*<span class="token number">4</span>+<span class="token number">8</span>*<span class="token number">2</span>+<span class="token number">16</span>*<span class="token number">1</span>
m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>=<span class="token number">64</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="九、struct" tabindex="-1"><a class="header-anchor" href="#九、struct" aria-hidden="true">#</a> 九、struct</h2><p>struct 翻译过来叫结构体，它类似于 js 里的构造函数，只是语法规则不一样。</p><p>1.struct 的建立</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>struct Light<span class="token punctuation">{</span>
    vec4 color<span class="token punctuation">;</span>
    vec3 pos<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面的 struct 类似于 js 的 function，color 和 pos 既是结构体的属性，也使其形参。</p><p>2.struct 的实例化</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Light l1<span class="token operator">=</span><span class="token function">Light</span><span class="token punctuation">(</span>
    <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面的 vec4()和 vec3()数据是结构体的实参，分别对应 color 属性和 pos 属性。</p><p>3.访问 struct 实例对象中的属性</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl_FragColor <span class="token operator">=</span> l1<span class="token punctuation">.</span>color <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="十、数组" tabindex="-1"><a class="header-anchor" href="#十、数组" aria-hidden="true">#</a> 十、数组</h2><p>glsl 中的数组具有以下特性：</p><ul><li><p>属于类型数组</p></li><li><p>只支持一维数组</p></li><li><p>不支持 pop()、push() 等操作</p><p>1.在建立某个类型的数组时，在数据类型后面加[]即可，[]中要写数组的长度：</p></li></ul><p>如：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 vs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
vs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>2.数组的长度需要按照以下方式定义：</p><ul><li>整形字面量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec4 vs<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>const 限定字修饰的整形变量</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> int size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
vec4 vs<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>不能是函数的参数</p><p>3.数组需要显示的通过索引位置一个元素、一个元素的赋值。</p></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>vs[0]=vec4(1,2,3,4);
vs[1]=vec4(5,6,7,8);
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4.数组中的元素需要用整形的索引值访问</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>gl_FragColor <span class="token operator">=</span> vs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="十一、程序流程控制" tabindex="-1"><a class="header-anchor" href="#十一、程序流程控制" aria-hidden="true">#</a> 十一、程序流程控制</h2><h3 id="_1-if-判断" tabindex="-1"><a class="header-anchor" href="#_1-if-判断" aria-hidden="true">#</a> 1.if 判断</h3><p>glsl 中的 if 判断和 js 里的 if 写法是一样的。都有一套 if、else if、else 判断。</p><p>如我们之前打印多个向量时写过的判断逻辑：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>float dist<span class="token operator">=</span><span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.0</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.125</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.125</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.25</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.375</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span><span class="token number">0.375</span><span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    discard<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>if 语句写太多会降低着色器执行速度，然而 glsl 还没有 switch 语句，大家需要注意一下。</p><h3 id="_2-for-循环" tabindex="-1"><a class="header-anchor" href="#_2-for-循环" aria-hidden="true">#</a> 2.for 循环</h3><p>glsl 中的 for 循环和 js 类似；</p><p>for(初始化表达式; 条件表达式; 循环表达式){</p><p>​ 循环体;</p><p>}</p><p>for 循环的基本规则如下：</p><ul><li><p>循环变量只能有一个，只能是 int 或 float 类型。</p></li><li><p>在循环体中也可以使用 break 或 continue，其功能和 js 一样。</p></li></ul><p>我们可以把之前打印多个向量的方法做一下修改：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>float dist<span class="token operator">=</span><span class="token function">distance</span><span class="token punctuation">(</span>gl_PointCoord<span class="token punctuation">,</span><span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>int i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float r1<span class="token operator">=</span><span class="token number">0.125</span><span class="token operator">*</span><span class="token function">float</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float r2<span class="token operator">=</span>r1<span class="token operator">+</span><span class="token number">0.125</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span>r1<span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span>r2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        discard<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上面的循环变量是整形，我们也可以将其变成浮点型：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span>float f<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">;</span>f<span class="token operator">&lt;=</span><span class="token number">4.0</span><span class="token punctuation">;</span>f<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float r1<span class="token operator">=</span><span class="token number">0.125</span><span class="token operator">*</span>f<span class="token punctuation">;</span>
    float r2<span class="token operator">=</span>r1<span class="token operator">+</span><span class="token number">0.125</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&gt;=</span>r1<span class="token operator">&amp;&amp;</span>dist<span class="token operator">&lt;</span>r2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        gl_FragColor<span class="token operator">=</span>m<span class="token punctuation">[</span><span class="token function">int</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token operator">==</span><span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        discard<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="十二、函数" tabindex="-1"><a class="header-anchor" href="#十二、函数" aria-hidden="true">#</a> 十二、函数</h2><h3 id="_1-函数的建立" tabindex="-1"><a class="header-anchor" href="#_1-函数的建立" aria-hidden="true">#</a> 1.函数的建立</h3><p>函数类型 函数名(形参){</p><p>​ 函数内容;</p><p>​ return 返回值;</p><p>}</p><h3 id="_2-示例" tabindex="-1"><a class="header-anchor" href="#_2-示例" aria-hidden="true">#</a> 2.示例</h3><p>以颜色置灰的方法为例，演示一下函数的用法。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fragmentShader<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-shader/x-fragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  precision mediump float<span class="token punctuation">;</span>
  float <span class="token function">getLum</span><span class="token punctuation">(</span><span class="token parameter">vec3 color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">dot</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.2126</span><span class="token punctuation">,</span><span class="token number">0.7162</span><span class="token punctuation">,</span><span class="token number">0.0722</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 color<span class="token operator">=</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float lum<span class="token operator">=</span><span class="token function">getLum</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>lum<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span>v<span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上面 getLum() 便是获取颜色亮度值的方法。</p><p>让一个以 rgb 为分量的向量 color 与一套置灰的系数 vec3(0.2126,0.7162,0.0722) 进行点积运算，便可得到一个亮度值。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>dot(color,vec3(0.2126,0.7162,0.0722));
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>以此亮度值为 rgb 分量值的颜色便是对初始 color 的置灰。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>vec3 color<span class="token operator">=</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
float lum<span class="token operator">=</span><span class="token function">getLum</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>lum<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-函数的声明" tabindex="-1"><a class="header-anchor" href="#_3-函数的声明" aria-hidden="true">#</a> 3.函数的声明</h3><p>也可以将函数体放到其调用方法的后面，不过在调用之前得提前声明函数。</p><p>其声明方式如下：</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>函数类型 函数名(形参类型);
函数名(实参);
函数类型 函数名(形参)<span class="token punctuation">{</span>
	函数内容;
	return 返回值;
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以基于之前获取亮度的方法写一下：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>precision mediump float<span class="token punctuation">;</span>
float <span class="token function">getLum</span><span class="token punctuation">(</span>vec3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 color<span class="token operator">=</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    float lum<span class="token operator">=</span><span class="token function">getLum</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span>lum<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span>v<span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
float <span class="token function">getLum</span><span class="token punctuation">(</span><span class="token parameter">vec3 color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">dot</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.2126</span><span class="token punctuation">,</span><span class="token number">0.7162</span><span class="token punctuation">,</span><span class="token number">0.0722</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-参数限定词" tabindex="-1"><a class="header-anchor" href="#_4-参数限定词" aria-hidden="true">#</a> 4-参数限定词</h3><p>通过参数限定词，可以更好的控制参数的行为。</p><p>参数的行为是围绕参数读写和拷贝考虑的。</p><p>通过参数的限定词来说一下参数行为：</p><ul><li>in 参数深拷贝，可读写，不影响原始数据，默认限定词</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>precision mediump float<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">in</span> vec3 color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    color<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    vec3 color<span class="token operator">=</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vec4 v<span class="token operator">=</span><span class="token function">vec4</span><span class="token punctuation">(</span>color<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_FragColor<span class="token operator">=</span>v<span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在上面的主函数体中，先声明了一个颜色 color，要通过 setColor() 方法修改颜色。</p><p>当 setColor() 方法中的形参 color 被 in 限定时，就相当于对实参进行了深拷贝，无论在 setColor() 方法里对 color 做了什么，都不会影响原始的 color 数据。</p><p>那么如果想在 setColor() 方法里修改原始的 color 数据，那就得使用 out 限定。</p><ul><li>out 参数浅拷贝，可读写，影响原始数据。</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token parameter">out vec3 color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    color<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>const in 常量限定词，只读。</li></ul><p>比如，下面的写法就是错的：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">const</span> <span class="token keyword">in</span> vec3 color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    color<span class="token punctuation">.</span>x<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们只能读取 color 数据：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">const</span> <span class="token keyword">in</span> vec3 color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    float r<span class="token operator">=</span>color<span class="token punctuation">.</span>r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>inout 功能类似于 out，用得不多，知道即可。</li></ul><p>注：GLSL ES 还有许多内置方法，比如 sin(),cos(),tan,atan() 等，建议去<a href="https://www.khronos.org/registry/OpenGL-Refpages/es3/" target="_blank" rel="noopener noreferrer">官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>看一下。</p><h2 id="十三、变量的作用域" tabindex="-1"><a class="header-anchor" href="#十三、变量的作用域" aria-hidden="true">#</a> 十三、变量的作用域</h2><p>GLSL ES 变量的作用域和 es6 类似。</p><p>可以通过函数或{} 建立块级作用域，块级作用域内建立的变量就是局部变量。</p><p>局部变量只在块级作用域有效。</p><p>在函数之外建立的变量就是全局变量。</p><p>在代码块内可以直接获取其父级定义域的变量。</p><p>变量不存在“变量提升”现象，变量在使用时，需提前声明。</p><p>变量不能重复声明。</p><p>通过 attribute、uniform、varying 限定字声明的变量都是全局变量。</p><p>const 可以声明常量，常量是只读的。</p><h2 id="十四、精度限定词" tabindex="-1"><a class="header-anchor" href="#十四、精度限定词" aria-hidden="true">#</a> 十四、精度限定词</h2><p>精度限定词可以提高着色程序的运行效率，削减内存开支。</p><h3 id="_1-精度的分类" tabindex="-1"><a class="header-anchor" href="#_1-精度的分类" aria-hidden="true">#</a> 1-精度的分类</h3><p>webgl 提供了三种精度：</p><ul><li>highp 高精度</li><li>mediump 中精度</li><li>lowp 低精度</li></ul><p>一般中精度用得会比较多，因为高精度太耗性能，而且有时候片元着色器会不支持，而低精度又太 low。</p><h3 id="_2-精度的定义方法" tabindex="-1"><a class="header-anchor" href="#_2-精度的定义方法" aria-hidden="true">#</a> 2-精度的定义方法</h3><p>可以为某个变量设置精度，也可以为某种数据类型设置精度。</p><p>比如:</p><p>设置某个变量的精度：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>mediump float size<span class="token punctuation">;</span>
highp vec4 position<span class="token punctuation">;</span>
lowp vec4 color<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>设置某种数据类型的精度：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>precision mediump float<span class="token punctuation">;</span>
precision highp int<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注：</p><p>着色器中，除了片元着色器的 float 数据没默认精度，其余的数据都是有默认精度的。</p><p>因此，在片元着色器里要提前声明好浮点型数据的精度。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: wangdouliang@zzltop.com">wangdouliang</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/visual/assets/app.6795915a.js" defer></script>
  </body>
</html>
